<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
<title>3d-crystals web-viewer</title>
<style>
body{margin:0;padding:0;overflow:hidden;font-family:Palatino;}
html, body{height:100%;text-size-adjust:100%;}
#player{z-index:2;position:fixed;cursor:move;}
#infopanel{position:fixed;top:20px;left:8px;width:150px;height:150px;text-align:left;z-index:3;line-height:22px;font-size:0.9em;color:#888;}
#exitpanel{position:fixed;top:6px;right:6px;width:24px;height:24px;z-index:3;cursor:pointer;background:url(data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///1VVVf///yH5BAEAAAMALAAAAAAQABAAAAIjnI+py6L+BDRy0gqxHVqvLjGcJ3Yl+IEhQpLX+m7wMYv2PRQAOw==) center center no-repeat;}
#zoompanel{position:fixed;top:90px;right:6px;width:50px;height:102px;z-index:3;cursor:pointer;background:no-repeat url(data:image/gif;base64,R0lGODlhMgBmAKEBAAAAAP///8zMzP///yH5BAEKAAMALAAAAAAyAGYAAAL+nI+py+0uopzi2UtzvhxNLHXWJ4YiY55Gqg6sRzVvNx+bHKk5FPNV+cOReMBR77EzgoY+0LK2SOI4N2MQdfVBo9mEFHlUTqlhcNd2xjLFXLTmDWd+Ye64vepK5+v3/nWOxudnR4clOAhX2Ea2Bjb2BPioEMnVSGTIuDVJqQljiSmpRblpBqnnNZp3Kki2ZNW5khq7qgoL62bW+akmunqLqocHLFvZctiyq1VLu/m7zKcj7DlTljmoRoyd2Gs8zczaHb78La6dXd6cjC6kvl7p7D4LH19LH21cbT+8rT/+fk7jVruA5DyVm2ewG8BQAd0t3BMPIMJSrexle9iQjcWCVBiLXOoHkSG9LR1PcCqoMFgQRH4UkZLHkl/Il+Ni4jl5yKYclTl1SsEJ0+dOkRuJjlSJMtqpkow+9uPIlKLTo7QmWmkaUWJSqU/QDRwmLt+rlGJzoYxRlh2xKmnVvniTbmvNOGrDETIr12tbkP749sobVprfY4P/Aba7F+RXxT8KAAA7);}
#optionpanel{position:fixed;bottom:4px;left:0;width:100%;height:20px;z-index:3;text-align:center;font-size:1.1em;}
#optionpanel input{margin:4px 2px 0 2px;cursor:pointer;}
#optionpanel label{line-height:22px;vertical-align:top;cursor:pointer;color:#666;}
#landing{display:none;position:fixed;left:0;top:0;right:0;bottom:0;height:auto;z-index:8;background:#fff;margin:0;text-align:center;font-size:1.25em;padding:20px;line-height:1.6em;}
#landing a{color:#666;text-decoration:none;border-bottom:1px solid #999;}
h1{margin:20px auto 35px;font-size:1.5em;color:#999;}
#legend{width:290px;margin:20px auto 0;border-radius:15px;background:#f0f0f0;color:#666;padding:5px;}
#triangle{width:0;height:0;margin:-2px auto 20px;border-left:20px solid transparent;border-right:20px solid transparent;border-top:20px solid #f0f0f0;}
#notifybox{display:none;z-index:9;position:fixed;top:20px;left:20px;width:500px;background:#333;color:#fff;border-radius:5px;font-size:1.25em;}
#cross{float:right;width:24px;height:24px;cursor:pointer;background:url(data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///1VVVf///yH5BAEAAAMALAAAAAAQABAAAAIjnI+py6L+BDRy0gqxHVqvLjGcJ3Yl+IEhQpLX+m7wMYv2PRQAOw==) center center no-repeat;}
#message{margin:20px;}
#fileapi{color:#999;}
#demobox{display:none;position:fixed;z-index:7;top:2px;left:50%;width:500px;height:20px;margin-left:-250px;font-size:0.7em;text-align:center;line-height:20px;}
#preloader{z-index:1;position:fixed;top:50%;left:50%;margin-left:-63px;width:125px;height:60px;font-size:10px;}
#preloader > div {height:100%;width:15px;display:inline-block;margin:0 5px;background:#666;-webkit-animation:stretchdelay 1.2s infinite ease-in-out;animation:stretchdelay 1.2s infinite ease-in-out;}
#preloader > div.rect1 {background:#6d55ae;}
#preloader > div.rect2 {background:#ffb302;-webkit-animation-delay:-1.1s;animation-delay:-1.1s;}
#preloader > div.rect3 {background:#f44c4d;-webkit-animation-delay:-1.0s;animation-delay:-1.0s;}
#preloader > div.rect4 {background:#acc2b3;-webkit-animation-delay:-0.9s;animation-delay:-0.9s;}
#preloader > div.rect5 {background:#6d55ae;-webkit-animation-delay:-0.8s;animation-delay:-0.8s;}
@-webkit-keyframes stretchdelay {
0%, 40%, 100% { -webkit-transform: scaleY(0.4) }
20% { -webkit-transform: scaleY(1.0) }}
@keyframes stretchdelay {
0%, 40%, 100% {
transform: scaleY(0.4);
-webkit-transform: scaleY(0.4);
} 20% {
transform: scaleY(1.0);
-webkit-transform: scaleY(1.0);
}}
@media all and (max-width:570px){#demobox{visibility:hidden;}}
</style>
</head>
<body>
<div id="preloader"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>
<div id="demobox">You are using demo version. Space group is not shown.</div>
<script type="text/javascript">
'use strict';var player=function(ga){function $(r){if(Y[r])return Y[r].exports;var g=Y[r]={exports:{},id:r,loaded:!1};ga[r].call(g.exports,g,g.exports,$);g.loaded=!0;return g.exports}var Y={};$.m=ga;$.c=Y;$.p="";return $(0)}([function(ga,$,Y){!function(){var r=[Y(1),Y(3),Y(5),Y(6)];(function(g,k,y,b){function a(a){a=a||window.event;a.cancelBubble?a.cancelBubble=!0:(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())}function c(a){if(n.mpds_integration)window.parent.wmgui.notify(a),
window.parent.close_vibox();else{var c=document.getElementById("notifybox"),b=document.getElementById("message");c.style.display="block";b.innerHTML="";setTimeout(function(){b.innerHTML=a},250)}}function d(a,c){var b=document.createElement("div");b.setAttribute("id",a);c&&(b.innerHTML=c);document.body.appendChild(b);return b}function e(a,c,b){b||(b=14540253);var d=new z.Geometry;d.vertices.push(new z.Vector3(a[0],a[1],a[2]));d.vertices.push(new z.Vector3(c[0],c[1],c[2]));a=new z.LineBasicMaterial({color:b});
n.atombox.add(new z.Line(d,a))}function f(a){if(n.tweened)return h(f,a);var d=n.atombox.children.filter(function(a){return"atom"==a.name}),e=n.atombox.children.filter(function(a){return"label"==a.name});b.removeAll();a=JSON.parse(a);if(a.length/3!==n.obj3d.atoms.length)return c("Internal error: length of the phonon data != number of atoms * 3");for(var l=0;l<d.length;l++){var m=parseInt(d[l].position.x),p=parseInt(d[l].position.y),u=parseInt(d[l].position.z),m={x:m+600*a[3*l],y:p+600*a[3*l+1],z:u+
600*a[3*l+2]};(new b.Tween(d[l].position)).to(m,750).easing(b.Easing.Cubic.InOut).repeat(Infinity).delay(250).yoyo(!0).start();e[l]&&(new b.Tween(e[l].position)).to(m,750).easing(b.Easing.Cubic.InOut).repeat(Infinity).delay(250).yoyo(!0).start()}n.tweened=!0}function h(a,c){b.removeAll();for(var d=n.atombox.children.filter(function(a){return"atom"==a.name}),e=n.atombox.children.filter(function(a){return"label"==a.name}),f=0;f<d.length;f++){var l=parseInt(100*n.obj3d.atoms[f].x),m=parseInt(100*n.obj3d.atoms[f].y),
p=parseInt(100*n.obj3d.atoms[f].z),l={x:l,y:m,z:p};(new b.Tween(d[f].position)).to(l,250).start();e[f]&&(new b.Tween(e[f].position)).to(l,250).start()}n.tweened=!1;a&&setTimeout(function(){a(c)},250)}function m(a){var c=document.createElement("canvas"),b=c.getContext("2d"),d=3.5*b.measureText(a).width;c.width=d;c.height=30;b.font="normal 30px Palatino";b.textAlign="center";b.textBaseline="middle";b.fillStyle="W"==n.colorset?"#000":"#fff";b.fillText(a,c.width/2,c.height/2);a=new z.Texture(c);a.needsUpdate=
!0;a=new z.SpriteMaterial({map:a,depthTest:!1});a=new z.Sprite(a);a.renderOrder=1;c=new z.Object3D;a.scale.set(d,30,1);c.add(a);c.name="label";return c}function u(){n.loaded=!0;n.container=d("player");n.scene=new z.Scene;n.camera=new z.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,2E4);n.camera.position.set(0,0,1800);var c=new z.AmbientLight(10066329);n.scene.add(c);c=new z.PointLight(6710886,1);c.position.set(1500,1500,1500);n.scene.add(c);n.renderer=n.webgl?new z.WebGLRenderer({antialias:!0,
alpha:!0}):new z.CanvasRenderer;"W"==n.colorset?n.renderer.setClearColor(16777215,1):n.renderer.setClearColor(0,1);n.renderer.setPixelRatio(window.devicePixelRatio);n.renderer.setSize(window.innerWidth,window.innerHeight);n.container.appendChild(n.renderer.domElement);d("zoompanel").onclick=function(c){a(c);c=c.pageY?c.pageY:c.clientY;var b=document.getElementById("zoompanel").offsetTop;n.camera.fov-=7.5*(50>c-b?1:-1);n.camera.updateProjectionMatrix()};n.mpds_integration&&(d("exitpanel").onclick=
function(){window.parent.close_vibox()});n.controls=new z.TrackballControls(n.camera);n.controls.rotateSpeed=7.5;n.controls.staticMoving=!0;E()}function E(){var c=n.scene.getObjectByName("atombox");if(c){n.scene.remove(c);for(var f=c.children.length-1;0<=f;f--){var l=c.children[f];l.geometry&&l.geometry.dispose();l.material&&l.material.dispose();l.dispose&&l.dispose()}n.controls.reset()}n.atombox=new z.Object3D;(c=document.getElementById("infopanel"))&&c.parentNode.removeChild(c);n.obj3d.descr&&(c=
n.obj3d.mpds_data?"":n.obj3d.descr.symlabel?"<i>SG</i> "+n.obj3d.descr.symlabel:"",d("infopanel","<span style=color:#900><i>a</i>="+(Math.round(1E3*parseFloat(n.obj3d.descr.a))/1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#090><i>b</i>="+(Math.round(1E3*parseFloat(n.obj3d.descr.b))/1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#09f><i>c</i>="+(Math.round(1E3*parseFloat(n.obj3d.descr.c))/1E3).toFixed(3)+"&#8491;</span><br /><i>&#945;</i>="+(Math.round(100*parseFloat(n.obj3d.descr.alpha))/
100).toFixed(2)+"&deg;<br /><i>&#946;</i>="+(Math.round(100*parseFloat(n.obj3d.descr.beta))/100).toFixed(2)+"&deg;<br /><i>&#947;</i>="+(Math.round(100*parseFloat(n.obj3d.descr.gamma))/100).toFixed(2)+"&deg;<br />"+c));(c=document.getElementById("optionpanel"))&&c.parentNode.removeChild(c);c=d("optionpanel","<input type=radio name=optionpanel class=optionpanel id=optionpanel_empty /><label for=optionpanel_empty>none</label>  <input type=radio name=optionpanel class=optionpanel id=optionpanel_S checked=checked /><label for=optionpanel_S>elements</label>");
if(Object.keys(n.obj3d.overlayed).length)for(var p in n.obj3d.overlayed)c.innerHTML+="  <input type=radio name=optionpanel class=optionpanel id=optionpanel_"+p+" /><label for=optionpanel_"+p+">"+n.obj3d.overlayed[p]+"</label>",n.available_overlays.push(p);c=document.getElementsByClassName("optionpanel");for(p=c.length-1;0<=p;p--)c[p].onclick=function(c){if(n.tweened)return a(c);c=this.id.replace("optionpanel_","");if(-1!==n.available_overlays.indexOf(c)){for(var b=n.scene.getObjectByName("atombox"),
b=b.children,d=b.filter(function(a){return"label"==a.name}),e=0,f=d.length;e<f;e++)n.atombox.remove(d[e]),n.scene.remove(d[e]);if("empty"!==c){b=b.filter(function(a){return"atom"==a.name});f=b.length;for(e=0;e<f;e++)d=m(b[e].overlays[c]),d.position.set(b[e].position.x,b[e].position.y,b[e].position.z),n.atombox.add(d);n.current_overlay=c}}n.renderer.render(n.scene,n.camera)};n.current_overlay=n.default_overlay;f=n.webgl?{w:10,h:8}:{w:8,h:6};p=0;for(c=n.obj3d.atoms.length;p<c;p++){var l=parseInt(100*
n.obj3d.atoms[p].x),h=parseInt(100*n.obj3d.atoms[p].y),u=parseInt(100*n.obj3d.atoms[p].z),E=new z.Mesh(new z.SphereBufferGeometry(65*n.obj3d.atoms[p].r,f.w,f.h),new z.MeshLambertMaterial({color:n.obj3d.atoms[p].c,overdraw:.75}));E.position.set(l,h,u);E.name="atom";E.overlays=n.obj3d.atoms[p].overlays;n.atombox.add(E);"empty"!==n.current_overlay&&(E=m(E.overlays[n.current_overlay]),E.position.set(l,h,u),n.atombox.add(E))}if(n.obj3d.cell.length){var s,c=[];for(p=0;3>p;p++)f=Math.round(1E3*parseFloat(n.obj3d.cell[p][0]))/
10,l=Math.round(1E3*parseFloat(n.obj3d.cell[p][1]))/10,h=Math.round(1E3*parseFloat(n.obj3d.cell[p][2]))/10,c.push([f,l,h]),0==p?s=10027008:1==p?s=39168:2==p&&(s=39423),n.atombox.add(new z.ArrowHelper((new z.Vector3(f,l,h)).normalize(),new z.Vector3(0,0,0),Math.sqrt(f*f+l*l+h*h),s,75,10));p=[c[0][0]+c[1][0],c[0][1]+c[1][1],c[0][2]+c[1][2]];f=[c[0][0]+c[2][0],c[0][1]+c[2][1],c[0][2]+c[2][2]];l=[p[0]+c[2][0],p[1]+c[2][1],p[2]+c[2][2]];h=[c[1][0]+c[2][0],c[1][1]+c[2][1],c[1][2]+c[2][2]];s=[];s.push([c[0],
p]);s.push([c[0],f]);s.push([c[1],h]);s.push([c[1],p]);s.push([c[2],h]);s.push([c[2],f]);s.push([p,l]);s.push([f,l]);s.push([l,h]);p=0;for(c=s.length;p<c;p++)e(s[p][0],s[p][1])}n.atombox.name="atombox";n.scene.add(n.atombox);b.removeAll();q()}function v(){n.loaded&&(n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight),n.controls.handleResize(),q())}function q(){N(q);n.renderer.render(n.scene,n.camera);n.controls.update();
b.update()}function p(){var a=document.location.hash.substr(1);if(-1==a.indexOf("://"))return n.loaded||l(),c("Error: not a valid url");s(a)}function l(){if(n.local_supported){var a=document.getElementById("landing");"B"==n.colorset&&(a.style.background="#222");a.style.display="block"}else t()}function t(c){a(c);x(n.sample,!1)}function s(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&(200==b.status?x(b.responseText,
!0):(c("Error: HTTP "+b.status+" status received during retrieving data from the server"),n.loaded||l()))};b.open("GET",a);b.send(1)}function x(a,b){if(!a)return c("Cannot read data");n.obj3d=n.converter.to_player(a);n.obj3d?(document.getElementById("landing").style.display="none",n.loaded?E():u(),n.obj3d.info&&(document.title=n.obj3d.info),document.getElementById("demobox").style.display=n.obj3d.mpds_data&&n.obj3d.mpds_demo?"block":"none"):n.loaded||l()}function X(b){a(b);if(1<b.dataTransfer.files.length)return c("Error: only one file at the time may be rendered");
b=b.dataTransfer.files[0];if(!b||!b.size)return c("Error: file cannot be read (unaccessible?)");var d=new FileReader;d.onloadend=function(a){x(a.target.result,!1)};d.abort=function(){c("Error: file reading has been cancelled")};d.onerror=function(a){c("Error: file reading has been cancelled: "+a.target.error.name)};d.readAsText(b)}function w(c){a(c);c.dataTransfer.dropEffect="copy"}var n={version:"0.19.3",loaded:!1,container:null,stats:null,camera:null,scene:null,renderer:null,controls:null,atombox:null,
available_overlays:["empty","S","N"],default_overlay:"S"};n.current_overlay=n.default_overlay;n.obj3d=!1;n.local_supported=window.File&&window.FileReader&&window.FileList&&window.Blob;n.tweened=!1;try{n.mpds_integration=window.parent&&window.parent.wmgui}catch(B){}n.webgl=function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(c){return!1}}();n.colorset="W";n.sample="data_example\n_cell_length_a 24\n_cell_length_b 5.91\n_cell_length_c 5.85\n_cell_angle_alpha 90\n_cell_angle_beta 90\n_cell_angle_gamma 90\n_symmetry_space_group_name_H-M 'P1'\nloop_\n_symmetry_equiv_pos_as_xyz\nx,y,z\nloop_\n_atom_site_label\n_atom_site_type_symbol\n_atom_site_fract_x\n_atom_site_fract_y\n_atom_site_fract_z\n_atom_site_charge\nO1 O 0.425 0.262 0.009 -2.0\nO2 O -0.425 0.262 0.009 -2.0\nH3 H 0.444 0.258 0.154 1.0\nH4 H -0.444 0.258 0.154 1.0\nH5 H 0.396 0.124 0.012 1.0\nH6 H -0.396 0.124 0.012 1.0\nO7 O 0.425 0.236 0.510 -2.0\nO8 O -0.425 0.236 0.510 -2.0\nH9 H 0.444 0.239 0.656 1.0\nH10 H -0.444 0.239 0.656 1.0\nH11 H 0.396 0.374 0.512 1.0\nH12 H -0.396 0.374 0.512 1.0\nSr13 Sr 0.342 0.964 0.467 2.0\nSr14 Sr -0.342 0.964 0.467 2.0\nSr15 Sr 0.342 0.535 0.967 2.0\nSr16 Sr -0.342 0.535 0.967 2.0\nO17 O 0.348 0.971 0.019 -2.0\nO18 O -0.348 0.971 0.019 -2.0\nO19 O 0.348 0.528 0.519 -2.0\nO20 O -0.348 0.528 0.519 -2.0\nO21 O 0.263 0.803 0.701 -2.0\nO22 O -0.263 0.803 0.701 -2.0\nO23 O 0.264 0.695 0.200 -2.0\nO24 O -0.264 0.695 0.200 -2.0\nZr25 Zr 0.261 0.000 0.998 4.0\nZr26 Zr -0.261 0.000 0.998 4.0\nZr27 Zr 0.261 0.499 0.498 4.0\nZr28 Zr -0.261 0.499 0.498 4.0\nO29 O 0.257 0.304 0.806 -2.0\nO30 O -0.257 0.304 0.806 -2.0\nO31 O 0.257 0.195 0.306 -2.0\nO32 O -0.257 0.195 0.306 -2.0\nSr33 Sr 0.173 0.993 0.524 2.0\nSr34 Sr -0.173 0.993 0.524 2.0\nSr35 Sr 0.173 0.506 0.024 2.0\nSr36 Sr -0.173 0.506 0.024 2.0\nO37 O 0.173 0.947 0.986 -2.0\nO38 O -0.173 0.947 0.986 -2.0\nO39 O 0.173 0.551 0.486 -2.0\nO40 O -0.173 0.551 0.486 -2.0\nO41 O 0.098 0.204 0.295 -2.0\nO42 O -0.098 0.204 0.295 -2.0\nO43 O 0.098 0.295 0.795 -2.0\nO44 O -0.098 0.295 0.795 -2.0\nZr45 Zr 0.086 0.004 0.998 4.0\nZr46 Zr -0.086 0.004 0.998 4.0\nZr47 Zr 0.086 0.495 0.498 4.0\nZr48 Zr -0.086 0.495 0.498 4.0\nO49 O 0.074 0.709 0.211 -2.0\nO50 O -0.074 0.709 0.211 -2.0\nO51 O 0.074 0.790 0.711 -2.0\nO52 O -0.074 0.790 0.711 -2.0\nSr53 Sr 0 0.991 0.467 2.0\nSr54 Sr 0 0.508 0.967 2.0\nO55 O 0 0.076 0.020 -2.0\nO56 O 0 0.423 0.520 -2.0";
var z=y.THREE||y,N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1E3/60)};n.converter=g(k,{warning:function(a){n.mpds_integration?window.parent.wmgui.notify(a):alert(a)},error:c});(function(){n.webgl=!0;var a=d("notifybox",'<div id="cross"></div><div id="message"></div>');document.getElementById("cross").onclick=function(){a.style.display="none"};d("landing",'<h1>3d-crystals web-viewer</h1><div id="legend">Choose a <b>CIF</b>, <b>POSCAR</b>, or <b>Optimade</b> file (drag and drop is supported). Files are processed offline in the browser, no remote server is used. <a href=/ id="play_demo">Example</a>.</div><div id="triangle"></div><input type="file" id="fileapi" />');
document.getElementById("play_demo").onclick=t;window.addEventListener("resize",v,!1);window.addEventListener("hashchange",p,!1);if(n.local_supported){window.addEventListener("dragover",w,!1);window.addEventListener("drop",X,!1);var b=document.getElementById("fileapi"),e=new FileReader;b.onchange=function(){if(!this.files[0]||!this.files[0].size)return c("Error: file cannot be read (unaccessible?)");e.currentFilename=this.files[0].name;e.readAsText(this.files[0])};e.onloadend=function(a){x(a.target.result,
!1)}}window.addEventListener("message",function(a){var c=a.data;try{c=JSON.parse(a.data)}catch(b){}x(JSON.stringify(c),!1)});b=!1;try{b=window.parent&&window.parent.playerdata}catch(m){}b?(b="object"===typeof window.parent.playerdata&&document.location.search?window.parent.playerdata[document.location.search.substr(1)]:window.parent.playerdata,x(b,!1)):document.location.hash.length?p():l();window.vibrate=f;window.unvibrate=h})()}).apply(null,r)}()},function(ga,$,Y){"use strict";String.prototype.startswith=
function(r){return 0===this.indexOf(r)};String.prototype.endswith=function(r,g){var k=this.toString();if(void 0===g||g>k.length)g=k.length;g-=r.length;k=k.indexOf(r,g);return-1!==k&&k===g};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};$=function(r,g){function k(a){if(0<a.indexOf("_cell_angle_gamma ")&&0<a.indexOf("loop_"))return"CIF";if(0<a.indexOf('"immutable_id"')&&0<a.indexOf('"cartesian_site_positions"')&&
0<a.indexOf('"lattice_vectors"'))return"OPTIMADE";a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");for(var c=6;9>c&&a[c];c++)if("direct"==a[c].trim().toLowerCase().substr(0,6))return"POSCAR";return"unknown"}function y(a,c,b,d,e,f){if(!(a&&c&&b&&d&&e&&f))return g.error("Error: invalid cell definition!"),!1;d=d*Math.PI/180;e=e*Math.PI/180;f=f*Math.PI/180;var m=[0,0,1],h=[1,0,0],m=r.divide(m,r.norm(m)),h=r.subtract(h,r.multiply(r.dot(h,m),m)),h=r.divide(h,r.norm(h)),u=r.cross(m,h);a=r.multiply(a,
[1,0,0]);c=r.multiply(c,[r.cos(f),r.sin(f),0]);var w=r.cos(e);d=r.divide(r.subtract(r.cos(d),r.multiply(r.cos(e),r.cos(f))),r.sin(f));e=r.sqrt(r.subtract(r.subtract(1,r.multiply(w,w)),r.multiply(d,d)));b=r.multiply(b,[w,d,e]);return r.multiply([a,c,b],[h,u,m])}function b(a){var c=[],b=[],d=0,e,f,m;for(a.forEach(function(a){c.push(r.norm(a))});3>d;d++)e=d-1,f=d-2,m=c[e]*c[f],e=1E-16<m?180/Math.PI*Math.acos(r.dot(a[e],a[f])/m):90,b.push(e);return c.concat(b)}function a(a){var c,b=!1;if(6==Object.keys(a.cell).length){c=
y(a.cell.a,a.cell.b,a.cell.c,a.cell.alpha,a.cell.beta,a.cell.gamma);var b=a.cell,d=a.sg_name||a.ng_name?(a.sg_name?a.sg_name:"")+(a.ng_name?" ("+a.ng_name+")":""):!1;d&&(b.symlabel=d)}else c=a.cell;a.atoms.length||g.warning("Note: no atomic coordinates supplied");for(var b={atoms:[],cell:c,descr:b,overlayed:{},info:a.info,mpds_data:a.mpds_data,mpds_demo:a.mpds_demo},e,f,h,d={},x=0,k=a.atoms.length,w={},n={};x<k;x++){var B=[a.atoms[x].x,a.atoms[x].y,a.atoms[x].z],z=B.map(function(a){return a.toFixed(2)}).join(",");
if(n.hasOwnProperty(z))for(h in e="",b.atoms[n[z]].overlays)"S"==h?-1==w[z].indexOf(a.atoms[x].symbol)&&(e=" "+a.atoms[x].symbol,w[z].push(a.atoms[x].symbol)):e="N"==h?", "+(x+1):"_atom_site_occupancy"==h?"+"+a.atoms[x].overlays[h]:" "+a.atoms[x].overlays[h],b.atoms[n[z]].overlays[h]+=e;else{e=m.JmolColors[a.atoms[x].symbol]?m.JmolColors[a.atoms[x].symbol]:"#FFFF00";f=m.AseRadii[a.atoms[x].symbol]?m.AseRadii[a.atoms[x].symbol]:.66;d={S:a.atoms[x].symbol,N:x+1};for(h in a.atoms[x].overlays)d[h]=a.atoms[x].overlays[h];
B=a.cartesian?B:r.multiply(B,c);b.atoms.push({x:B[0],y:B[1],z:B[2],c:e,r:f,overlays:d});n[z]=b.atoms.length-1;w[z]=[a.atoms[x].symbol]}}for(var N in d)"S"!==N&&"N"!==N&&(b.overlayed[N]=u[N]);return b}function c(a){var c="data_matinfio\n",d,e;6==Object.keys(a.cell).length?(d=a.cell,e=y(a.cell)):(d=b(a.cell),e=a.cell);c+="_cell_length_a    "+d[0].toFixed(6)+"\n";c+="_cell_length_b    "+d[1].toFixed(6)+"\n";c+="_cell_length_c    "+d[2].toFixed(6)+"\n";c+="_cell_angle_alpha "+d[3].toFixed(6)+"\n";c+=
"_cell_angle_beta  "+d[4].toFixed(6)+"\n";c+="_cell_angle_gamma "+d[5].toFixed(6)+"\n";c+="_symmetry_space_group_name_H-M 'P1'\n_symmetry_Int_Tables_number 1\n";c+="\nloop_\n";c+=" _symmetry_equiv_pos_as_xyz\n";c+=" +x,+y,+z\n";c+="\nloop_\n";c+=" _atom_site_label\n";c+=" _atom_site_type_symbol\n";c+=" _atom_site_fract_x\n";c+=" _atom_site_fract_y\n";c+=" _atom_site_fract_z\n";if(a.cartesian){var f=e;a.atoms.forEach(function(a,b){var d=r.lusolve(f,[a.x,a.y,a.z]),d=r.transpose(d)[0];c+=" "+a.symbol+
(b+1)+"  "+a.symbol+"  "+d[0].toFixed(3)+"  "+d[1].toFixed(3)+"  "+d[2].toFixed(3)+"\n"})}else a.atoms.forEach(function(a,b){c+=" "+a.symbol+(b+1)+"  "+a.symbol+"  "+a.x.toFixed(3)+"  "+a.y.toFixed(3)+"  "+a.z.toFixed(3)+"\n"});return c}function d(a){a.symops&&g.warning("Warning! Reading of symmetry operations is not yet implemented, expect error now.");var c;c=6==Object.keys(a.cell).length?y(a.cell.a,a.cell.b,a.cell.c,a.cell.alpha,a.cell.beta,a.cell.gamma):a.cell;var b=[],d=[],e=[],f=[],b=c[0].map(function(a,
b){return c.map(function(a){return a[b]})}),d=d.concat.apply(d,b),m=0,h=a.atoms.length;if(a.types)for(;m<h;m++)f.push([a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]);else{for(var u=[],b={};m<h;m++)-1==Object.keys(b).indexOf(a.atoms[m].symbol)?b[a.atoms[m].symbol]=[[a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]]:b[a.atoms[m].symbol].push([a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]);var m=1,w;for(w in b){for(h=0;h<b[w].length;h++)f.push(b[w][h]),u.push(m);m++}}e=e.concat.apply(e,f);return{cell:d,atoms:e,types:u||
a.types,symlabel:a.sg_name||a.ng_name?(a.sg_name?a.sg_name:"")+(a.ng_name?" ("+a.ng_name+")":""):!1}}function e(a){var c=[],b=[],d=[];a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");var e={cell:{},atoms:[],cartesian:!1},f=!1,h=!1,x=!1,k="",w="",n="",h=[],B="a b c alpha beta gamma".split(" "),z=["_atom_site_label","_atom_site_type_symbol","_atom_site_fract_x","_atom_site_fract_y","_atom_site_fract_z"],N=["label","symbol","x","y","z"],I=[0,1],L=[],F;for(F in u)L.push(z.length),z.push(F);F=0;
for(var y=a.length;F<y;F++)if(!a[F].startswith("#"))if(w=a[F].trim()){n=w.toLowerCase();h=!1;if(n.startswith("data_"))h=!0,f=!1,d=[],x=!1,k=w.substr(5);else if(n.startswith("_cell_")){f=!1;h=w.split(" ");w=h[0].split("_");w=w[w.length-1];-1!==B.indexOf(w)&&h[h.length-1]&&("a"==w&&(n=h[h.length-1].split("."),2==n[n.length-1].length&&(e.mpds_demo=!0)),e.cell[w]=parseFloat(h[h.length-1]));continue}else if(n.startswith("_symmetry_space_group_name_h-m")||n.startswith("_space_group.patterson_name_h-m")){f=
!1;e.sg_name=a[F].substr(31).replace(/"/g,"").replace(/'/g,"").trim();continue}else if(n.startswith("_space_group.it_number")||n.startswith("_space_group_it_number")||n.startswith("_symmetry_int_tables_number")){f=!1;h=w.split(" ");e.ng_name=h[h.length-1].trim();continue}else{if(n.startswith("_cif_error"))return g.error(w.substr(12,w.length-13)),!1;if(n.startswith("_pauling_file_entry")){e.mpds_data=!0;continue}else if(n.startswith("loop_")){f=!0;d=[];x=!1;continue}}if(f)if(w.startswith("_symmetry_equiv")||
w.startswith("_space_group"))x=!0;else if(w.startswith("_"))d.push(w);else if(x)b.push(w.replace(/"/g,"").replace(/'/g,""));else{for(var h=w.replace(/\t/g," ").split(" ").filter(function(a){return a?!0:!1}),w={overlays:{}},n=0,M=d.length;n<M;n++){var R=z.indexOf(d[n]);if(-1!=R){var D=I.indexOf(R);1==D?h[n]=h[n].charAt(0).toUpperCase()+h[n].slice(1).toLowerCase():0>D&&(h[n]=parseFloat(h[n]));-1<L.indexOf(R)?w.overlays[z[R]]=h[n]:w[N[R]]=h[n]}}void 0!==w.x&&void 0!==w.y&&void 0!==w.z&&(w.label&&(w.overlays.label=
w.label,w.symbol||(w.symbol=w.label.replace(/[0-9]/g,""))),!m.JmolColors[w.symbol]&&w.symbol&&1<w.symbol.length&&(w.symbol=w.symbol.substr(0,w.symbol.length-1)),w.symbol&&e.atoms.push(w))}else h&&e.atoms.length&&(e.info=k,1<b.length&&(e.symops=b),c.push(e),e={cell:{},atoms:[],cartesian:!1},b=[])}else f=!1,d=[],x=!1;e.cell.gamma&&(e.info=k,1<b.length&&(e.symops=b),c.push(e));if(c.length)return c[c.length-1];g.error("Error: unexpected CIF format!");return!1}function f(a){a=a.toString().replace(/(\r\n|\r)/gm,
"\n").split("\n");var c=[],b=[],d=1,e=[],f=[],h=[],u=[],k=["x","y","z","symbol"],w=0,n=0,B=a.length,z=[],N=0,z=[],I=[];a:for(;w<B;w++)if(0==w){z=a[w].split(" ").filter(function(a){return a?!0:!1});I=Object.keys(m.AseRadii);for(n=0;n<z.length;n++)if(-1==I.indexOf(z[n]))continue a;f=z}else if(1==w)d=parseFloat(a[w]);else if(-1!==[2,3,4].indexOf(w))c.push(a[w].split(" ").filter(function(a){return a?!0:!1}).map(Number));else if(5==w)if(z=a[w].split(" ").filter(function(a){return a?!0:!1}),z[0].isnumeric())for(e=
z.map(Number),n=0;n<e.length;n++)for(z=0;z<e[n];z++)u.push(n+1);else f=z;else if(6==w){if("direct"==a[w].trim().toLowerCase().substr(0,6))continue a;z=a[w].split(" ").filter(function(a){return a?!0:!1});if(z[0].isnumeric())for(e=z.map(Number),n=0;n<e.length;n++)for(z=0;z<e[n];z++)u.push(n+1);else f=z}else if(6<w){if(9>w){if(f.length&&!h.length)for(n=0;n<f.length;n++)for(z=0;z<e[n];z++)h.push(f[n]);if(-1!==["direct","select"].indexOf(a[w].trim().toLowerCase().substr(0,6)))continue a}I={};z=a[w].replace("#",
"").replace("!","").split(" ").filter(function(a){return a?!0:!1});if(!z.length)break;else if(3==z.length)h.length?z.push(h[N]):z.push("Xx");else if(3>z.length)return g.error("Error: invalid atom definition!"),!1;for(n=0;4>n;n++)I[k[n]]=3>n?parseFloat(z[n]):z[n];I.symbol=I.symbol.replace(/\W+/,"").replace(/\d+/,"");I.symbol.length||(I.symbol="Xx");b.push(I);N++}c=r.multiply(c,d);if(b.length)return{cell:c,atoms:b,types:u,cartesian:!1};g.error("Error: unexpected POSCAR format!");return!1}function h(a){a=
JSON.parse(a);var c=[],b;try{b=a.data[0]}catch(d){b=a}if(!b)return g.error("Error: unexpected OPTIMADE format!"),!1;a=b.attributes.cartesian_site_positions.length;if(!a)return g.error("Error: no atomic positions found!"),!1;if(b.attributes.species&&b.attributes.species[a-1]&&b.attributes.species[a-1].chemical_symbols)b.attributes.species.forEach(function(a,d){c.push({x:b.attributes.cartesian_site_positions[d][0],y:b.attributes.cartesian_site_positions[d][1],z:b.attributes.cartesian_site_positions[d][2],
symbol:a.chemical_symbols[0]})});else if(b.attributes.species_at_sites)b.attributes.species_at_sites.forEach(function(a,d){c.push({x:b.attributes.cartesian_site_positions[d][0],y:b.attributes.cartesian_site_positions[d][1],z:b.attributes.cartesian_site_positions[d][2],symbol:a.replace(/\W+/,"").replace(/\d+/,""),overlays:{label:a}})});else return g.error("Error: no atomic data found!"),!1;return{cell:b.attributes.lattice_vectors,atoms:c,info:"id="+b.id,cartesian:!0}}var m={JmolColors:{D:"#FFFFC0",
H:"#FFFFFF",He:"#D9FFFF",Li:"#CC80FF",Be:"#C2FF00",B:"#FFB5B5",C:"#909090",N:"#3050F8",O:"#FF0D0D",F:"#90E050",Ne:"#B3E3F5",Na:"#AB5CF2",Mg:"#8AFF00",Al:"#BFA6A6",Si:"#F0C8A0",P:"#FF8000",S:"#FFFF30",Cl:"#1FF01F",Ar:"#80D1E3",K:"#8F40D4",Ca:"#3DFF00",Sc:"#E6E6E6",Ti:"#BFC2C7",V:"#A6A6AB",Cr:"#8A99C7",Mn:"#9C7AC7",Fe:"#E06633",Co:"#F090A0",Ni:"#50D050",Cu:"#C88033",Zn:"#7D80B0",Ga:"#C28F8F",Ge:"#668F8F",As:"#BD80E3",Se:"#FFA100",Br:"#A62929",Kr:"#5CB8D1",Rb:"#702EB0",Sr:"#00FF00",Y:"#94FFFF",Zr:"#94E0E0",
Nb:"#73C2C9",Mo:"#54B5B5",Tc:"#3B9E9E",Ru:"#248F8F",Rh:"#0A7D8C",Pd:"#006985",Ag:"#C0C0C0",Cd:"#FFD98F",In:"#A67573",Sn:"#668080",Sb:"#9E63B5",Te:"#D47A00",I:"#940094",Xe:"#429EB0",Cs:"#57178F",Ba:"#00C900",La:"#70D4FF",Ce:"#FFFFC7",Pr:"#D9FFC7",Nd:"#C7FFC7",Pm:"#A3FFC7",Sm:"#8FFFC7",Eu:"#61FFC7",Gd:"#45FFC7",Tb:"#30FFC7",Dy:"#1FFFC7",Ho:"#00FF9C",Er:"#00E675",Tm:"#00D452",Yb:"#00BF38",Lu:"#00AB24",Hf:"#4DC2FF",Ta:"#4DA6FF",W:"#2194D6",Re:"#267DAB",Os:"#266696",Ir:"#175487",Pt:"#D0D0E0",Au:"#FFD123",
Hg:"#B8B8D0",Tl:"#A6544D",Pb:"#575961",Bi:"#9E4FB5",Po:"#AB5C00",At:"#754F45",Rn:"#428296",Fr:"#420066",Ra:"#007D00",Ac:"#70ABFA",Th:"#00BAFF",Pa:"#00A1FF",U:"#008FFF",Np:"#0080FF",Pu:"#006BFF",Am:"#545CF2",Cm:"#785CE3",Bk:"#8A4FE3",Cf:"#A136D4",Es:"#B31FD4",Fm:"#B31FBA",Md:"#B30DA6",No:"#BD0D87",Lr:"#C70066",Rf:"#CC0059",Db:"#D1004F",Sg:"#D90045",Bh:"#E00038",Hs:"#E6002E",Mt:"#EB0026"},AseRadii:{X:.66,H:.31,He:.28,Li:1.28,Be:.96,B:.84,C:.76,N:.71,O:.66,F:.57,Ne:.58,Na:1.66,Mg:1.41,Al:1.21,Si:1.11,
P:1.07,S:1.05,Cl:1.02,Ar:1.06,K:2.03,Ca:1.76,Sc:1.7,Ti:1.6,V:1.53,Cr:1.39,Mn:1.39,Fe:1.32,Co:1.26,Ni:1.24,Cu:1.32,Zn:1.22,Ga:1.22,Ge:1.2,As:1.19,Se:1.2,Br:1.2,Kr:1.16,Rb:2.2,Sr:1.95,Y:1.9,Zr:1.75,Nb:1.64,Mo:1.54,Tc:1.47,Ru:1.46,Rh:1.42,Pd:1.39,Ag:1.45,Cd:1.44,In:1.42,Sn:1.39,Sb:1.39,Te:1.38,I:1.39,Xe:1.4,Cs:2.44,Ba:2.15,La:2.07,Ce:2.04,Pr:2.03,Nd:2.01,Pm:1.99,Sm:1.98,Eu:1.98,Gd:1.96,Tb:1.94,Dy:1.92,Ho:1.92,Er:1.89,Tm:1.9,Yb:1.87,Lu:1.87,Hf:1.75,Ta:1.7,W:1.62,Re:1.51,Os:1.44,Ir:1.41,Pt:1.36,Au:1.36,
Hg:1.32,Tl:1.45,Pb:1.46,Bi:1.48,Po:1.4,At:1.5,Rn:1.5,Fr:2.6,Ra:2.21,Ac:2.15,Th:2.06,Pa:2,U:1.96,Np:1.9,Pu:1.87,Am:1.8,Cm:1.69,Bk:3,Cf:3,Es:3,Fm:3,Md:3,No:3,Lr:3,Rf:3,Db:3,Sg:3,Bh:3,Hs:3,Mt:3}},u={_atom_site_occupancy:"site occupancies",_atom_site_charge:"formal charges",label:"labels"};return{to_player:function(c){var b;switch(k(c)){case "CIF":b=e(c);break;case "POSCAR":b=f(c);break;case "OPTIMADE":b=h(c);break;default:g.error("Error: file format not recognized!")}return b?a(b):!1},to_flatten:function(a){var c;
switch(k(a)){case "CIF":c=e(a);break;case "POSCAR":c=f(a);break;case "OPTIMADE":g.error("OPTIMADE not supported!");break;default:g.error("Error: file format not recognized!")}return c?d(c):!1},to_cif:function(a){var b;switch(k(a)){case "CIF":return a;case "POSCAR":b=f(a);break;case "OPTIMADE":b=h(a);break;default:g.error("Error: file format not recognized!")}return b?c(b):!1},version:"0.5.1"}};"undefined"!==typeof ga&&ga.exports?ga.exports=$:"function"===typeof Y(2).specified&&!(void 0!==$&&(ga.exports=
$))},function(ga,$,Y){function r(k){return Y(g(k))}function g(g){var b;if(!(b=k[g]))throw Error("Cannot find module '"+g+"'.");return b}var k={"./math.custom":3,"./math.custom.js":3,"./matinfio":1,"./matinfio.js":1,"./require":4,"./require.js":4,"./three.custom":5,"./three.custom.js":5,"./tween.umd":6,"./tween.umd.js":6};r.keys=function(){return Object.keys(k)};r.resolve=g;ga.exports=r;r.id=2},function(ga,$,Y){(function(r,g){ga.exports=g()})(this,function(){return function(r){function g(y){if(k[y])return k[y].exports;
var b=k[y]={exports:{},id:y,loaded:!1};r[y].call(b.exports,b,b.exports,g);b.loaded=!0;return b.exports}var k={};g.m=r;g.c=k;g.p="";return g(0)}([function(r,g,k){g=k(1).create();g.import(k(15));g.import(k(24));g.import(k(27));g.import(k(29));g.import(k(30));g.import(k(31));g.import(k(58));g.import(k(47));g.import(k(65));g.import(k(68));g.import(k(69));g.import(k(70));g.import(k(71));r.exports=g},function(r,g,k){r.exports=k(2)},function(r,g,k){k(3);var y=k(4).isFactory,b=k(6),a=k(10),c=k(12),d=k(14);
g.create=function(e){function f(a){if(!y(a))throw Error("Factory object with properties `type`, `name`, and `factory` expected");var c=h.indexOf(a);-1===c?(c=!0===a.math?a.factory(u.type,E,f,u.typed,u):a.factory(u.type,E,f,u.typed),h.push(a),m.push(c)):c=m[c];return c}if("function"!==typeof Object.create)throw Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var h=[],m=[],u=a.mixin({});u.type={};u.expression={transform:{},mathWithTransform:{}};
u.typed=b.create(u.type);var E={epsilon:1E-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};u["import"]=f(c);u.config=f(d);u.expression.mathWithTransform.config=u.config;e&&u.config(e);return u}},function(r,g){Number.isFinite=Number.isFinite||function(k){return"number"===typeof k&&isFinite(k)};Number.isNaN=Number.isNaN||function(k){return k!==k}},function(r,g,k){function y(a){y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:
function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return y(a)}var b=k(5);g.clone=function c(d){var e=y(d);if("number"===e||"string"===e||"boolean"===e||null===d||void 0===d)return d;if("function"===typeof d.clone)return d.clone();if(Array.isArray(d))return d.map(function(b){return c(b)});if(d instanceof Date)return new Date(d.valueOf());if(b(d))return d;if(d instanceof RegExp)throw new TypeError("Cannot clone "+d);return g.map(d,c)};
g.map=function(c,b){var e={},f;for(f in c)g.hasOwnProperty(c,f)&&(e[f]=b(c[f]));return e};g.extend=function(c,b){for(var e in b)g.hasOwnProperty(b,e)&&(c[e]=b[e]);return c};g.deepExtend=function d(b,f){if(Array.isArray(f))throw new TypeError("Arrays are not supported by deepExtend");for(var h in f)if(g.hasOwnProperty(f,h))if(f[h]&&f[h].constructor===Object)void 0===b[h]&&(b[h]={}),b[h].constructor===Object?d(b[h],f[h]):b[h]=f[h];else{if(Array.isArray(f[h]))throw new TypeError("Arrays are not supported by deepExtend");
b[h]=f[h]}return b};g.deepEqual=function(b,e){var f,h;if(Array.isArray(b)){if(!Array.isArray(e)||b.length!==e.length)return!1;f=0;for(h=b.length;f<h;f++)if(!g.deepEqual(b[f],e[f]))return!1;return!0}if(b instanceof Object){if(Array.isArray(e)||!(e instanceof Object))return!1;for(f in b)if(!g.deepEqual(b[f],e[f]))return!1;for(f in e)if(!g.deepEqual(b[f],e[f]))return!1;return!0}return b===e};g.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),
!0}catch(b){}return!1};g.lazy=function(b,e,f){if(g.canDefineProperty()){var h=!0,m;Object.defineProperty(b,e,{get:function(){h&&(m=f(),h=!1);return m},set:function(b){m=b;h=!1},configurable:!0,enumerable:!0})}else b[e]=f()};g.traverse=function(b,e){var f=b;if(e)for(var h=e.split("."),m=0;m<h.length;m++){var u=h[m];u in f||(f[u]={});f=f[u]}return f};g.hasOwnProperty=function(b,e){return b&&Object.hasOwnProperty.call(b,e)};g.isFactory=function(b){return b&&"function"===typeof b.factory}},function(r,
g){r.exports=function(k){return k&&k.constructor.prototype.isBigNumber||!1}},function(r,g,k){function y(a){y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return y(a)}var b=k(7),a=k(8).digits,c=k(5),d=k(9),e=function(){e=b.create;return b};g.create=function(b){b.isNumber=function(a){return"number"===typeof a};b.isComplex=function(a){return b.Complex&&
a instanceof b.Complex||!1};b.isBigNumber=c;b.isFraction=function(a){return b.Fraction&&a instanceof b.Fraction||!1};b.isUnit=function(a){return a&&a.constructor.prototype.isUnit||!1};b.isString=function(a){return"string"===typeof a};b.isArray=Array.isArray;b.isMatrix=d;b.isDenseMatrix=function(a){return a&&a.isDenseMatrix&&a.constructor.prototype.isMatrix||!1};b.isSparseMatrix=function(a){return a&&a.isSparseMatrix&&a.constructor.prototype.isMatrix||!1};b.isRange=function(a){return a&&a.constructor.prototype.isRange||
!1};b.isIndex=function(a){return a&&a.constructor.prototype.isIndex||!1};b.isBoolean=function(a){return"boolean"===typeof a};b.isResultSet=function(a){return a&&a.constructor.prototype.isResultSet||!1};b.isHelp=function(a){return a&&a.constructor.prototype.isHelp||!1};b.isFunction=function(a){return"function"===typeof a};b.isDate=function(a){return a instanceof Date};b.isRegExp=function(a){return a instanceof RegExp};b.isObject=function(a){return"object"===y(a)&&a.constructor===Object&&!b.isComplex(a)&&
!b.isFraction(a)};b.isNull=function(a){return null===a};b.isUndefined=function(a){return void 0===a};b.isAccessorNode=function(a){return a&&a.isAccessorNode&&a.constructor.prototype.isNode||!1};b.isArrayNode=function(a){return a&&a.isArrayNode&&a.constructor.prototype.isNode||!1};b.isAssignmentNode=function(a){return a&&a.isAssignmentNode&&a.constructor.prototype.isNode||!1};b.isBlockNode=function(a){return a&&a.isBlockNode&&a.constructor.prototype.isNode||!1};b.isConditionalNode=function(a){return a&&
a.isConditionalNode&&a.constructor.prototype.isNode||!1};b.isConstantNode=function(a){return a&&a.isConstantNode&&a.constructor.prototype.isNode||!1};b.isFunctionAssignmentNode=function(a){return a&&a.isFunctionAssignmentNode&&a.constructor.prototype.isNode||!1};b.isFunctionNode=function(a){return a&&a.isFunctionNode&&a.constructor.prototype.isNode||!1};b.isIndexNode=function(a){return a&&a.isIndexNode&&a.constructor.prototype.isNode||!1};b.isNode=function(a){return a&&a.isNode&&a.constructor.prototype.isNode||
!1};b.isObjectNode=function(a){return a&&a.isObjectNode&&a.constructor.prototype.isNode||!1};b.isOperatorNode=function(a){return a&&a.isOperatorNode&&a.constructor.prototype.isNode||!1};b.isParenthesisNode=function(a){return a&&a.isParenthesisNode&&a.constructor.prototype.isNode||!1};b.isRangeNode=function(a){return a&&a.isRangeNode&&a.constructor.prototype.isNode||!1};b.isSymbolNode=function(a){return a&&a.isSymbolNode&&a.constructor.prototype.isNode||!1};b.isChain=function(a){return a&&a.constructor.prototype.isChain||
!1};var h=e();h.types=[{name:"number",test:b.isNumber},{name:"Complex",test:b.isComplex},{name:"BigNumber",test:b.isBigNumber},{name:"Fraction",test:b.isFraction},{name:"Unit",test:b.isUnit},{name:"string",test:b.isString},{name:"Array",test:b.isArray},{name:"Matrix",test:b.isMatrix},{name:"DenseMatrix",test:b.isDenseMatrix},{name:"SparseMatrix",test:b.isSparseMatrix},{name:"Range",test:b.isRange},{name:"Index",test:b.isIndex},{name:"boolean",test:b.isBoolean},{name:"ResultSet",test:b.isResultSet},
{name:"Help",test:b.isHelp},{name:"function",test:b.isFunction},{name:"Date",test:b.isDate},{name:"RegExp",test:b.isRegExp},{name:"null",test:b.isNull},{name:"undefined",test:b.isUndefined},{name:"OperatorNode",test:b.isOperatorNode},{name:"ConstantNode",test:b.isConstantNode},{name:"SymbolNode",test:b.isSymbolNode},{name:"ParenthesisNode",test:b.isParenthesisNode},{name:"FunctionNode",test:b.isFunctionNode},{name:"FunctionAssignmentNode",test:b.isFunctionAssignmentNode},{name:"ArrayNode",test:b.isArrayNode},
{name:"AssignmentNode",test:b.isAssignmentNode},{name:"BlockNode",test:b.isBlockNode},{name:"ConditionalNode",test:b.isConditionalNode},{name:"IndexNode",test:b.isIndexNode},{name:"RangeNode",test:b.isRangeNode},{name:"Node",test:b.isNode},{name:"Object",test:b.isObject}];h.conversions=[{from:"number",to:"BigNumber",convert:function(c){if(15<a(c))throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+c+"). Use function bignumber(x) to convert to BigNumber.");
return new b.BigNumber(c)}},{from:"number",to:"Complex",convert:function(a){return new b.Complex(a,0)}},{from:"number",to:"string",convert:function(a){return a+""}},{from:"BigNumber",to:"Complex",convert:function(a){return new b.Complex(a.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(a){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.");}},{from:"Fraction",
to:"Complex",convert:function(a){return new b.Complex(a.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(a){if((new b.Fraction(a)).valueOf()!==a)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+a+"). Use function fraction(x) to convert to Fraction.");return new b.Fraction(a)}},{from:"string",to:"number",convert:function(a){var c=Number(a);if(isNaN(c))throw Error('Cannot convert "'+a+'" to a number');return c}},{from:"string",
to:"BigNumber",convert:function(a){try{return new b.BigNumber(a)}catch(c){throw Error('Cannot convert "'+a+'" to BigNumber');}}},{from:"string",to:"Fraction",convert:function(a){try{return new b.Fraction(a)}catch(c){throw Error('Cannot convert "'+a+'" to Fraction');}}},{from:"string",to:"Complex",convert:function(a){try{return new b.Complex(a)}catch(c){throw Error('Cannot convert "'+a+'" to Complex');}}},{from:"boolean",to:"number",convert:function(a){return+a}},{from:"boolean",to:"BigNumber",convert:function(a){return new b.BigNumber(+a)}},
{from:"boolean",to:"Fraction",convert:function(a){return new b.Fraction(+a)}},{from:"boolean",to:"string",convert:function(a){return+a}},{from:"Array",to:"Matrix",convert:function(a){return new b.DenseMatrix(a)}},{from:"Matrix",to:"Array",convert:function(a){return a.valueOf()}}];return h}},function(r,g,k){var y,b,a;"use strict";(function(c,d){!(b=[],y=d,a="function"===typeof y?y.apply(g,b):y,void 0!==a&&(r.exports=a))})(this,function(){function a(){return!0}function b(){return!1}function e(){}function f(){function h(a){var c=
K(da.types,function(c){return c.name===a});if(c)return c;if("any"===a)return T;c=K(da.types,function(c){return c.name.toLowerCase()===a.toLowerCase()});throw new TypeError('Unknown type "'+a+'"'+(c?'. Did you mean "'+c.name+'"?':""));}function m(a){var c=K(da.types,function(c){return c.test(a)});if(c)return c.name;throw new TypeError("Value has unknown type. Value: "+a);}function u(a){return a.map(function(a){var c=a.types.map(k);return(a.restParam?"...":"")+c.join("|")}).join(",")}function E(a,c){var b=
0===a.indexOf("..."),d=(b?3<a.length?a.slice(3):"any":a).split("|").map(r).filter(C).filter(H),e=L(c,d),d=d.map(function(a){var c=h(a);return{name:a,typeIndex:c===T?999:da.types.indexOf(c),test:c.test,conversion:null,conversionIndex:-1}}),e=e.map(function(a){var b=h(a.from);return{name:a.from,typeIndex:b===T?999:da.types.indexOf(b),test:b.test,conversion:a,conversionIndex:c.indexOf(a)}});return{types:d.concat(e),restParam:b}}function v(a,c,b){var d=[];""!==a.trim()&&(d=a.split(",").map(r).map(function(a,
c,d){var e=E(a,b);if(e.restParam&&c!==d.length-1)throw new SyntaxError('Unexpected rest parameter "'+a+'": only allowed for the last parameter');return e}));return d.some(J)?null:{params:d,fn:c}}function q(a){return(a=a[a.length-1])?a.restParam:!1}function p(a){return a.types.some(function(a){return null!=a.conversion})}function l(b){if(b&&0!==b.types.length){if(1===b.types.length)return h(b.types[0].name).test;if(2===b.types.length){var d=h(b.types[0].name).test,e=h(b.types[1].name).test;return function(a){return d(a)||
e(a)}}var f=b.types.map(function(a){return h(a.name).test});return function(a){for(var c=0;c<f.length;c++)if(f[c](a))return!0;return!1}}return a}function t(a){var c,b,d;if(q(a)){c=a.slice(0,a.length-1).map(l);var e=c.length,f=l(a[a.length-1]);return function(a){for(var b=0;b<c.length;b++)if(!c[b](a[b]))return!1;a:{for(b=e;b<a.length;b++)if(!f(a[b])){b=!1;break a}b=!0}return b&&a.length>=e+1}}if(0===a.length)return function(a){return 0===a.length};if(1===a.length)return b=l(a[0]),function(a){return b(a[0])&&
1===a.length};if(2===a.length)return b=l(a[0]),d=l(a[1]),function(a){return b(a[0])&&d(a[1])&&2===a.length};c=a.map(l);return function(a){for(var b=0;b<c.length;b++)if(!c[b](a[b]))return!1;return a.length===c.length}}function s(a,c){var b;c<a.params.length?b=a.params[c]:q(a.params)?(b=a.params,b=b[b.length-1]):b=null;return b}function x(a,c,b){a=s(a,c);return(a?b?a.types.filter(w):a.types:[]).map(k)}function k(a){return a.name}function w(a){return null===a.conversion||void 0===a.conversion}function n(a,
c){var b=G(P(a,function(a){return x(a,c,!1)}));return-1!==b.indexOf("any")?["any"]:b}function g(a,c,b){var d;a=a||"unnamed";var e;for(e=0;e<c.length;e++)if(d=b.filter(function(a){var b=l(s(a,e));return(e<a.params.length||q(a.params))&&b(c[e])}),0===d.length){if(d=n(b,e),0<d.length){var f=m(c[e]);b=new TypeError("Unexpected type of argument in function "+a+" (expected: "+d.join(" or ")+", actual: "+f+", index: "+e+")");b.data={category:"wrongType",fn:a,index:e,actual:f,expected:d};return b}}else b=
d;d=b.map(function(a){return q(a.params)?Infinity:a.params.length});if(c.length<Math.min.apply(null,d))return d=n(b,e),b=new TypeError("Too few arguments in function "+a+" (expected: "+d.join(" or ")+", index: "+c.length+")"),b.data={category:"tooFewArgs",fn:a,index:c.length,expected:d},b;d=Math.max.apply(null,d);if(c.length>d)return b=new TypeError("Too many arguments in function "+a+" (expected: "+d+", actual: "+c.length+")"),b.data={category:"tooManyArgs",fn:a,index:c.length,expectedLength:d},
b;b=new TypeError('Arguments of type "'+c.join(", ")+'" do not match any of the defined signatures of function '+a+".");b.data={category:"mismatch",actual:c.map(m)};return b}function z(a){for(var c=999,b=0;b<a.types.length;b++)w(a.types[b])&&(c=Math.min(c,a.types[b].typeIndex));return c}function N(a){for(var c=999,b=0;b<a.types.length;b++)w(a.types[b])||(c=Math.min(c,a.types[b].conversionIndex));return c}function I(a,c){var b=Math.min(a.params.length,c.params.length),d,e;e=a.params.some(p)-c.params.some(p);
if(0!==e)return e;for(d=0;d<b;d++)if(e=p(a.params[d])-p(c.params[d]),0!==e)return e;for(d=0;d<b;d++){e=a.params[d];var f=c.params[d],l=void 0,l=e.restParam-f.restParam;0!==l?e=l:(l=p(e)-p(f),0!==l?e=l:(l=z(e)-z(f),e=0!==l?l:N(e)-N(f)));if(0!==e)return e}return a.params.length-c.params.length}function L(a,c){var b={};a.forEach(function(a){-1!==c.indexOf(a.from)||-1===c.indexOf(a.to)||b[a.from]||(b[a.from]=a)});return Object.keys(b).map(function(a){return b[a]})}function F(a,c){var b=c;if(a.some(p))var d=
q(a),e=a.map(y),b=function(){for(var a=[],b=d?arguments.length-1:arguments.length,f=0;f<b;f++)a[f]=e[f](arguments[f]);d&&(a[b]=arguments[b].map(e[b]));return c.apply(null,a)};var f=b;if(q(a))var l=a.length-1,f=function(){return b.apply(null,Array.prototype.slice.call(arguments,0,l).concat([Array.prototype.slice.call(arguments,l,void 0)]))};return f}function y(a){var c,b,d,e,f=[],l=[];a.types.forEach(function(a){a.conversion&&(f.push(h(a.conversion.from).test),l.push(a.conversion.convert))});switch(l.length){case 0:return function(a){return a};
case 1:return c=f[0],d=l[0],function(a){return c(a)?d(a):a};case 2:return c=f[0],b=f[1],d=l[0],e=l[1],function(a){return c(a)?d(a):b(a)?e(a):a};default:return function(a){for(var c=0;c<l.length;c++)if(f[c](a))return l[c](a);return a}}}function M(a){var c={};a.forEach(function(a){a.params.some(p)||R(a.params,!0).forEach(function(b){c[u(b)]=a.fn})});return c}function R(a,c){function b(a,d,e){if(d<a.length){var f=a[d],l=c?f.types.filter(w):f.types;f.restParam?(f=l.filter(w),l=f.length<l.length?[f,l]:
[l]):l=l.map(function(a){return[a]});return P(l,function(c){return b(a,d+1,e.concat([c]))})}return[e.map(function(c,b){return{types:c,restParam:b===a.length-1&&q(a)}})]}return b(a,0,[])}function D(a,c){if(0===Object.keys(c).length)throw new SyntaxError("No signatures provided");var f=[];Object.keys(c).map(function(a){return v(a,c[a],da.conversions)}).filter(Q).forEach(function(a){var c=K(f,function(c){a:{for(var b=Math.max(c.params.length,a.params.length),d=0;d<b;d++){var e=x(c,d,!0),f=x(a,d,!0);
b:{for(var l=0;l<e.length;l++)if(-1!==f.indexOf(e[l])){e=!0;break b}e=!1}if(!e){c=!1;break a}}b=c.params.length;d=a.params.length;c=q(c.params);e=q(a.params);c=c?e?b===d:d>=b:e?b>=d:b===d}return c});if(c)throw new TypeError('Conflicting signatures "'+u(c.params)+'" and "'+u(a.params)+'".');f.push(a)});var h=P(f,function(a){return(a?R(a.params,!1):[]).map(function(c){return{params:c,fn:a.fn}})}).filter(Q);h.sort(I);var m=h[0]&&2>=h[0].params.length&&!q(h[0].params),p=h[1]&&2>=h[1].params.length&&!q(h[1].params),
n=h[2]&&2>=h[2].params.length&&!q(h[2].params),s=h[3]&&2>=h[3].params.length&&!q(h[3].params),E=h[4]&&2>=h[4].params.length&&!q(h[4].params),w=h[5]&&2>=h[5].params.length&&!q(h[5].params),z=m&&p&&n&&s&&E&&w,k=h.map(function(a){return t(a.params)}),X=m?l(h[0].params[0]):b,N=p?l(h[1].params[0]):b,y=n?l(h[2].params[0]):b,L=s?l(h[3].params[0]):b,D=E?l(h[4].params[0]):b,O=w?l(h[5].params[0]):b,J=m?l(h[0].params[1]):b,G=p?l(h[1].params[1]):b,H=n?l(h[2].params[1]):b,sa=s?l(h[3].params[1]):b,U=E?l(h[4].params[1]):
b,va=w?l(h[5].params[1]):b,r=h.map(function(a){return F(a.params,a.fn)}),C=m?r[0]:e,T=p?r[1]:e,Ma=n?r[2]:e,W=s?r[3]:e,oa=E?r[4]:e,aa=w?r[5]:e,S=m?h[0].params.length:-1,ra=p?h[1].params.length:-1,fa=n?h[2].params.length:-1,Ia=s?h[3].params.length:-1,Da=E?h[4].params.length:-1,A=w?h[5].params.length:-1,Sa=z?6:0,Qa=h.length,ja=function(){for(var c=Sa;c<Qa;c++)if(k[c](arguments))return r[c].apply(null,arguments);throw g(a,arguments,h);},m=function(a,c){return arguments.length===S&&X(a)&&J(c)?C.apply(null,
arguments):arguments.length===ra&&N(a)&&G(c)?T.apply(null,arguments):arguments.length===fa&&y(a)&&H(c)?Ma.apply(null,arguments):arguments.length===Ia&&L(a)&&sa(c)?W.apply(null,arguments):arguments.length===Da&&D(a)&&U(c)?oa.apply(null,arguments):arguments.length===A&&O(a)&&va(c)?aa.apply(null,arguments):ja.apply(null,arguments)};try{Object.defineProperty(m,"name",{value:a})}catch(za){}m.signatures=M(h);return m}function H(a){return-1===da.ignore.indexOf(a)}function r(a){return a.trim()}function C(a){return!!a}
function Q(a){return null!==a}function J(a){return 0===a.types.length}function K(a,c){for(var b=0;b<a.length;b++)if(c(a[b]))return a[b]}function G(a){for(var c={},b=0;b<a.length;b++)c[a[b]]=!0;return Object.keys(c)}function P(a,c){return Array.prototype.concat.apply([],a.map(c))}function U(a){for(var c="",b=0;b<a.length;b++){var d=a[b];if(("object"===typeof d.signatures||"string"===typeof d.signature)&&""!==d.name)if(""===c)c=d.name;else if(c!==d.name)throw a=Error("Function names do not match (expected: "+
c+", actual: "+d.name+")"),a.data={actual:d.name,expected:c},a;}return c}function W(a){function c(a,e){if(d.hasOwnProperty(a)&&e!==d[a])throw b=Error('Signature "'+a+'" is defined twice'),b.data={signature:a},b;}for(var b,d={},e=0;e<a.length;e++){var f=a[e];if("object"===typeof f.signatures)for(var l in f.signatures)f.signatures.hasOwnProperty(l)&&(c(l,f.signatures[l]),d[l]=f.signatures[l]);else if("string"===typeof f.signature)c(f.signature,f),d[f.signature]=f;else throw b=new TypeError("Function is no typed-function (index: "+
e+")"),b.data={index:e},b;}return d}var aa=[{name:"number",test:function(a){return"number"===typeof a}},{name:"string",test:function(a){return"string"===typeof a}},{name:"boolean",test:function(a){return"boolean"===typeof a}},{name:"Function",test:function(a){return"function"===typeof a}},{name:"Array",test:Array.isArray},{name:"Date",test:function(a){return a instanceof Date}},{name:"RegExp",test:function(a){return a instanceof RegExp}},{name:"Object",test:function(a){return"object"===typeof a&&
a.constructor===Object}},{name:"null",test:function(a){return null===a}},{name:"undefined",test:function(a){return void 0===a}}],T={name:"any",test:a},oa=[],sa=[],da={types:aa,conversions:sa,ignore:oa},da=D("typed",{"string, Object":D,Object:function(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);c=U(c);return D(c,a)},"...Function":function(a){return D(U(a),W(a))},"string, ...Function":function(a,c){return D(a,W(c))}});da.create=f;da.types=aa;da.conversions=sa;da.ignore=oa;da.convert=
function(a,c){var b=m(a);if(c===b)return a;for(var d=0;d<da.conversions.length;d++){var e=da.conversions[d];if(e.from===b&&e.to===c)return e.convert(a)}throw Error("Cannot convert from "+b+" to "+c);};da.find=function(a,c){if(!a.signatures)throw new TypeError("Function is no typed-function");var b;if("string"===typeof c){b=c.split(",");for(var d=0;d<b.length;d++)b[d]=b[d].trim()}else if(Array.isArray(c))b=c;else throw new TypeError("String array or a comma separated string expected");d=b.join(",");
if(d=a.signatures[d])return d;throw new TypeError("Signature not found (signature: "+(a.name||"unnamed")+"("+b.join(", ")+"))");};da.addType=function(a,c){if(!a||"string"!==typeof a.name||"function"!==typeof a.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==c)for(var b=0;b<da.types.length;b++)if("Object"===da.types[b].name){da.types.splice(b,0,a);return}da.types.push(a)};da.addConversion=function(a){if(!a||"string"!==typeof a.from||"string"!==typeof a.to||
"function"!==typeof a.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");da.conversions.push(a)};return da}return f()})},function(r,g,k){function y(a){for(var c=[],b=0;b<a;b++)c.push(0);return c}var b=k(4);g.isNumber=function(a){return"number"===typeof a};g.isInteger=function(a){return"boolean"===typeof a?!0:isFinite(a)?a===Math.round(a):!1};g.sign=Math.sign||function(a){return 0<a?1:0>a?-1:0};g.format=function(a,c){if("function"===typeof c)return c(a);
if(Infinity===a)return"Infinity";if(-Infinity===a)return"-Infinity";if(isNaN(a))return"NaN";var d="auto",e;c&&(c.notation&&(d=c.notation),g.isNumber(c)?e=c:g.isNumber(c.precision)&&(e=c.precision));switch(d){case "fixed":return g.toFixed(a,e);case "exponential":return g.toExponential(a,e);case "engineering":return g.toEngineering(a,e);case "auto":return c&&c.exponential&&(void 0!==c.exponential.lower||void 0!==c.exponential.upper)?(d=b.map(c,function(a){return a}),d.exponential=void 0,void 0!==c.exponential.lower&&
(d.lowerExp=Math.round(Math.log(c.exponential.lower)/Math.LN10)),void 0!==c.exponential.upper&&(d.upperExp=Math.round(Math.log(c.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(c)+" with "+JSON.stringify(d)),g.toPrecision(a,e,d)):g.toPrecision(a,e,c&&c).replace(/((\.\d*?)(0+))($|e)/,
function(a,c,b,d,e){return"."!==b?b+e:e});default:throw Error('Unknown notation "'+d+'". Choose "auto", "exponential", or "fixed".');}};g.splitNumber=function(a){var c=String(a).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!c)throw new SyntaxError("Invalid number "+a);a=c[1];var b=c[2],e=parseFloat(c[4]||"0"),c=b.indexOf("."),e=e+(-1!==c?c-1:b.length-1),c=b.replace(".","").replace(/^0*/,function(a){e-=a.length;return""}).replace(/0*$/,"").split("").map(function(a){return parseInt(a)});
0===c.length&&(c.push(0),e++);return{sign:a,coefficients:c,exponent:e}};g.toEngineering=function(a,c){if(isNaN(a)||!isFinite(a))return String(a);var b=g.roundDigits(g.splitNumber(a),c),e=b.exponent,f=b.coefficients,h=0===e%3?e:0>e?e-3-e%3:e-e%3;if(g.isNumber(c))for(;c>f.length||e-h+1>f.length;)f.push(0);else for(var m=0<=e?e:Math.abs(h);f.length-1<m;)f.push(0);for(var u=Math.abs(e-h),m=1;0<u;)m++,u--;u=f.slice(m).join("");u=g.isNumber(c)&&u.length||u.match(/[1-9]/)?"."+u:"";e=f.slice(0,m).join("")+
u+"e"+(0<=e?"+":"")+h.toString();return b.sign+e};g.toFixed=function(a,c){if(isNaN(a)||!isFinite(a))return String(a);var b=g.splitNumber(a),b="number"===typeof c?g.roundDigits(b,b.exponent+1+c):b,e=b.coefficients,f=b.exponent+1,h=f+(c||0);e.length<h&&(e=e.concat(y(h-e.length)));0>f&&(e=y(-f+1).concat(e),f=1);f<e.length&&e.splice(f,0,0===f?"0.":".");return b.sign+e.join("")};g.toExponential=function(a,c){if(isNaN(a)||!isFinite(a))return String(a);var b=g.splitNumber(a),b=c?g.roundDigits(b,c):b,e=b.coefficients,
f=b.exponent;e.length<c&&(e=e.concat(y(c-e.length)));var h=e.shift();return b.sign+h+(0<e.length?"."+e.join(""):"")+"e"+(0<=f?"+":"")+f};g.toPrecision=function(a,c,b){if(isNaN(a)||!isFinite(a))return String(a);var e=b&&void 0!==b.lowerExp?b.lowerExp:-3;b=b&&void 0!==b.upperExp?b.upperExp:5;var f=g.splitNumber(a);if(f.exponent<e||f.exponent>=b)return g.toExponential(a,c);a=c?g.roundDigits(f,c):f;e=a.coefficients;b=a.exponent;e.length<c&&(e=e.concat(y(c-e.length)));e=e.concat(y(b-e.length+1+(e.length<
c?c-e.length:0)));e=y(-b).concat(e);c=0<b?b:0;c<e.length-1&&e.splice(c+1,0,".");return a.sign+e.join("")};g.roundDigits=function(a,b){for(var d={sign:a.sign,coefficients:a.coefficients,exponent:a.exponent},e=d.coefficients;0>=b;)e.unshift(0),d.exponent++,b++;if(e.length>b&&5<=e.splice(b,e.length-b)[0]){var f=b-1;for(e[f]++;10===e[f];)e.pop(),0===f&&(e.unshift(0),d.exponent++,f++),f--,e[f]++}return d};g.digits=function(a){return a.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length};
g.DBL_EPSILON=Number.EPSILON||2.220446049250313E-16;g.nearlyEqual=function(a,b,d){if(null===d||void 0===d)return a===b;if(a===b)return!0;if(isNaN(a)||isNaN(b))return!1;if(isFinite(a)&&isFinite(b)){var e=Math.abs(a-b);return e<g.DBL_EPSILON?!0:e<=Math.max(Math.abs(a),Math.abs(b))*d}return!1}},function(r,g){r.exports=function(k){return k&&k.constructor.prototype.isMatrix||!1}},function(r,g,k){var y=k(11);g.mixin=function(b){var a=new y;b.on=a.on.bind(a);b.off=a.off.bind(a);b.once=a.once.bind(a);b.emit=
a.emit.bind(a);return b}},function(r,g){function k(){}k.prototype={on:function(k,b,a){var c=this.e||(this.e={});(c[k]||(c[k]=[])).push({fn:b,ctx:a});return this},once:function(k,b,a){function c(){d.off(k,c);b.apply(a,arguments)}var d=this;c._=b;return this.on(k,c,a)},emit:function(k){var b=[].slice.call(arguments,1),a=((this.e||(this.e={}))[k]||[]).slice(),c=0,d=a.length;for(c;c<d;c++)a[c].fn.apply(a[c].ctx,b);return this},off:function(k,b){var a=this.e||(this.e={}),c=a[k],d=[];if(c&&b)for(var e=
0,f=c.length;e<f;e++)c[e].fn!==b&&c[e].fn._!==b&&d.push(c[e]);d.length?a[k]=d:delete a[k];return this}};r.exports=k;r.exports.TinyEmitter=k},function(r,g,k){function y(a){y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return y(a)}var b=k(4).lazy,a=k(4).isFactory,c=k(4).traverse,d=k(13);g.math=!0;g.name="import";g.factory=function(e,f,h,m,u){function E(b,
c){var e=arguments.length;if(1!==e&&2!==e)throw new d("import",e,1,2);c||(c={});if(a(b))t(b,c);else if(Array.isArray(b))b.forEach(function(a){E(a,c)});else if("object"===y(b))for(var f in b)b.hasOwnProperty(f)&&(e=b[f],s(e)?v(f,e,c):a(b)?t(b,c):E(e,c));else if(!c.silent)throw new TypeError("Factory, Object, or Array expected");}function v(a,b,c){c.wrap&&"function"===typeof b&&(b=l(b));if(x(u[a])&&x(b))b=c.override?m(a,b.signatures):m(u[a],b),u[a]=b,q(a,b),u.emit("import",a,function(){return b});else if(void 0===
u[a]||c.override)u[a]=b,q(a,b),u.emit("import",a,function(){return b});else if(!c.silent)throw Error('Cannot import "'+a+'": already exists');}function q(a,b){b&&"function"===typeof b.transform?(u.expression.transform[a]=b.transform,k.hasOwnProperty(a)||(u.expression.mathWithTransform[a]=b.transform)):(delete u.expression.transform[a],k.hasOwnProperty(a)||(u.expression.mathWithTransform[a]=b))}function p(a){delete u.expression.transform[a];k.hasOwnProperty(a)?delete u.expression.mathWithTransform[a]:
u.expression.mathWithTransform[a]=u[a]}function l(a){var b=function(){for(var b=[],c=0,d=arguments.length;c<d;c++){var e=arguments[c];b[c]=e&&e.valueOf()}return a.apply(u,b)};a.transform&&(b.transform=a.transform);return b}function t(a,d){if("string"===typeof a.name){var e=a.name,f=e in u.expression.transform,l=a.path?c(u,a.path):u,s=l.hasOwnProperty(e)?l[e]:void 0,q=function(){var b=h(a);if(b&&"function"===typeof b.transform)throw Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');
if(x(s)&&x(b))return d.override||(b=m(s,b)),b;if(void 0===s||d.override)return b;if(!d.silent)throw Error('Cannot import "'+e+'": already exists');};if(!1!==a.lazy)b(l,e,q),f?p(e):("expression.transform"===a.path||void 0===a.path&&!k.hasOwnProperty(a.name))&&b(u.expression.mathWithTransform,e,q);else if(l[e]=q(),f)p(e);else if("expression.transform"===a.path||void 0===a.path&&!k.hasOwnProperty(a.name))u.expression.mathWithTransform[e]=q();u.emit("import",e,q,a.path)}else h(a)}function s(a){return"function"===
typeof a||"number"===typeof a||"string"===typeof a||"boolean"===typeof a||null===a||a&&e.isUnit(a)||a&&e.isComplex(a)||a&&e.isBigNumber(a)||a&&e.isFraction(a)||a&&e.isMatrix(a)||a&&Array.isArray(a)}function x(a){return"function"===typeof a&&"object"===y(a.signatures)}var k={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return E};g.lazy=!0},function(r,g){function k(g,b,a,c){if(!(this instanceof k))throw new SyntaxError("Constructor must be called with the new operator");this.fn=g;this.count=
b;this.min=a;this.max=c;this.message="Wrong number of arguments in function "+g+" ("+b+" provided, "+a+(void 0!==c&&null!==c?"-"+c:"")+" expected)";this.stack=Error().stack}k.prototype=Error();k.prototype.constructor=Error;k.prototype.name="ArgumentsError";k.prototype.isArgumentsError=!0;r.exports=k},function(r,g,k){function y(a,b){return a.map(function(a){return a.toLowerCase()}).indexOf(b.toLowerCase())}function b(a,b,e){if(void 0!==a[b]&&-1===e.indexOf(a[b])){var f=y(e,a[b]);-1!==f?(console.warn('Warning: Wrong casing for configuration option "'+
b+'", should be "'+e[f]+'" instead of "'+a[b]+'".'),a[b]=e[f]):console.warn('Warning: Unknown value "'+a[b]+'" for configuration option "'+b+'". Available options: '+e.map(JSON.stringify).join(", ")+".")}}var a=k(4);g.name="config";g.math=!0;g.factory=function(c,d,e,f,h){function m(c){if(c){var e=a.map(d,a.clone);b(c,"matrix",u);b(c,"number",E);a.deepExtend(d,c);var f=a.map(d,a.clone);c=a.map(c,a.clone);h.emit("config",f,e,c);return f}return a.map(d,a.clone)}var u=["Matrix","Array"],E=["number","BigNumber",
"Fraction"];m.MATRIX=u;m.NUMBER=E;return m}},function(r,g,k){var y=k(16).string.isString;g.name="Matrix";g.path="type";g.factory=function(b,a,c,d){function e(){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");}e.prototype.type="Matrix";e.prototype.isMatrix=!0;e.storage=function(a){if(!y(a))throw new TypeError("format must be a string value");var b=e._storage[a];if(!b)throw new SyntaxError("Unsupported matrix storage format: "+a);return b};e._storage=
{};e.prototype.storage=function(){throw Error("Cannot invoke storage on a Matrix interface");};e.prototype.datatype=function(){throw Error("Cannot invoke datatype on a Matrix interface");};e.prototype.create=function(a,b){throw Error("Cannot invoke create on a Matrix interface");};e.prototype.subset=function(a,b,c){throw Error("Cannot invoke subset on a Matrix interface");};e.prototype.get=function(a){throw Error("Cannot invoke get on a Matrix interface");};e.prototype.set=function(a,b,c){throw Error("Cannot invoke set on a Matrix interface");
};e.prototype.resize=function(a,b){throw Error("Cannot invoke resize on a Matrix interface");};e.prototype.reshape=function(a,b){throw Error("Cannot invoke reshape on a Matrix interface");};e.prototype.clone=function(){throw Error("Cannot invoke clone on a Matrix interface");};e.prototype.size=function(){throw Error("Cannot invoke size on a Matrix interface");};e.prototype.map=function(a,b){throw Error("Cannot invoke map on a Matrix interface");};e.prototype.forEach=function(a){throw Error("Cannot invoke forEach on a Matrix interface");
};e.prototype.toArray=function(){throw Error("Cannot invoke toArray on a Matrix interface");};e.prototype.valueOf=function(){throw Error("Cannot invoke valueOf on a Matrix interface");};e.prototype.format=function(a){throw Error("Cannot invoke format on a Matrix interface");};e.prototype.toString=function(){throw Error("Cannot invoke toString on a Matrix interface");};return e}},function(r,g,k){g.array=k(17);g["boolean"]=k(22);g["function"]=k(23);g.number=k(8);g.object=k(4);g.string=k(18);g.emitter=
k(10)},function(r,g,k){function y(a){return a&&a.__esModule?a:{"default":a}}function b(a){for(var b=[];Array.isArray(a);)b.push(a.length),a=a[0];return b}function a(b,c,d){var e=b.length;if(e!==c[d])throw new E["default"](e,c[d]);if(d<c.length-1){var f=d+1;for(d=0;d<e;d++){if(!Array.isArray(b[d]))throw new E["default"](c.length-1,c.length,"<");a(b[d],c,f)}}else for(d=0;d<e;d++)if(Array.isArray(b[d]))throw new E["default"](c.length+1,c.length,">");}function c(a,b,d,e){var f,h=b[d],m=Math.min(a.length,
h);a.length=h;if(d<b.length-1){var u=d+1;for(d=0;d<m;d++)f=a[d],Array.isArray(f)||(f=[f],a[d]=f),c(f,b,u,e);for(d=m;d<h;d++)f=[],a[d]=f,c(f,b,u,e)}else{for(d=0;d<m;d++)for(;Array.isArray(a[d]);)a[d]=a[d][0];for(d=m;d<h;d++)a[d]=e}}function d(a,b){for(var c=a,d,e=b.length-1;0<e;e--){var f=b[e];d=[];for(var h=c.length/f,m=0;m<h;m++)d.push(c.slice(m*f,(m+1)*f));c=d}return c}function e(a,b,c){var d;if(c<b){var f=c+1;c=0;for(d=a.length;c<d;c++)a[c]=e(a[c],b,f)}else for(;Array.isArray(a);)a=a[0];return a}
function f(a,b,c){var d;if(Array.isArray(a)){var e=c+1;c=0;for(d=a.length;c<d;c++)a[c]=f(a[c],b,e)}else for(;c<b;c++)a=[a];return a}function h(a){if(!Array.isArray(a))return a;var b=[];a.forEach(function t(a){Array.isArray(a)?a.forEach(t):b.push(a)});return b}Object.defineProperty(g,"__esModule",{value:!0});g.size=b;g.validate=function(b,c){if(0===c.length){if(Array.isArray(b))throw new E["default"](b.length,0);}else a(b,c,0)};g.validateIndex=function(a,b){if(!m["default"].isNumber(a)||!m["default"].isInteger(a))throw new TypeError("Index must be an integer (value: "+
a+")");if(0>a||"number"===typeof b&&a>=b)throw new v["default"](a,b);};g.resize=function(a,b,d){if(!Array.isArray(a)||!Array.isArray(b))throw new TypeError("Array expected");if(0===b.length)throw Error("Resizing to scalar is not supported");b.forEach(function(a){if(!m["default"].isNumber(a)||!m["default"].isInteger(a)||0>a)throw new TypeError("Invalid size, must contain positive integers (size: "+u["default"].format(b)+")");});c(a,b,0,void 0!==d?d:0);return a};g.reshape=function(a,c){function e(a){return a.reduce(function(a,
b){return a*b})}var f=h(a),m;if(!Array.isArray(a)||!Array.isArray(c))throw new TypeError("Array expected");if(0===c.length)throw new E["default"](0,e(b(a)),"!=");for(var u=1,v=0;v<c.length;v++)u*=c[v];if(f.length!==u)throw new E["default"](e(c),e(b(a)),"!=");try{m=d(f,c)}catch(w){if(w instanceof E["default"])throw new E["default"](e(c),e(b(a)),"!=");throw w;}return m};g.squeeze=function(a,c){for(var d=c||b(a);Array.isArray(a)&&1===a.length;)a=a[0],d.shift();for(var f=d.length;1===d[f-1];)f--;f<d.length&&
(a=e(a,f,0),d.length=f);return a};g.unsqueeze=function(a,c,d,e){e=e||b(a);if(d)for(var h=0;h<d;h++)a=[a],e.unshift(1);for(a=f(a,c,0);e.length<c;)e.push(1);return a};g.flatten=h;g.map=function(a,b){return Array.prototype.map.call(a,b)};g.forEach=function(a,b){Array.prototype.forEach.call(a,b)};g.filter=function(a,c){if(1!==b(a).length)throw Error("Only one dimensional matrices supported");return Array.prototype.filter.call(a,c)};g.filterRegExp=function(a,c){if(1!==b(a).length)throw Error("Only one dimensional matrices supported");
return Array.prototype.filter.call(a,function(a){return c.test(a)})};g.join=function(a,b){return Array.prototype.join.call(a,b)};g.identify=function(a){if(!Array.isArray(a))throw new TypeError("Array input expected");if(0===a.length)return a;var b=[],c=0;b[0]={value:a[0],identifier:0};for(var d=1;d<a.length;d++)a[d]===a[d-1]?c++:c=0,b.push({value:a[d],identifier:c});return b};g.generalize=function(a){if(!Array.isArray(a))throw new TypeError("Array input expected");if(0===a.length)return a;for(var b=
[],c=0;c<a.length;c++)b.push(a[c].value);return b};var m=y(k(8)),u=y(k(18)),E=y(k(20)),v=y(k(21))},function(r,g,k){function y(a){y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return y(a)}function b(a,c){if(Array.isArray(a)){for(var d="[",m=a.length,u=0;u<m;u++)0!==u&&(d+=", "),d+=b(a[u],c);return d+"]"}return g.format(a,c)}var a=k(8).format,
c=k(19).format,d=k(5);g.isString=function(a){return"string"===typeof a};g.endsWith=function(a,b){return a.substring(a.length-b.length,a.length)===b};g.format=function(e,f){if("number"===typeof e)return a(e,f);if(d(e))return c(e,f);if(e&&"object"===y(e)&&"number"===typeof e.s&&"number"===typeof e.n&&"number"===typeof e.d)return f&&"decimal"===f.fraction?e.toString():e.s*e.n+"/"+e.d;if(Array.isArray(e))return b(e,f);if(g.isString(e))return'"'+e+'"';if("function"===typeof e)return e.syntax?String(e.syntax):
"function";if(e&&"object"===y(e)){if("function"===typeof e.format)return e.format(f);if(e&&e.toString()!=={}.toString())return e.toString();var h=[],m;for(m in e)e.hasOwnProperty(m)&&h.push('"'+m+'": '+g.format(e[m],f));return"{"+h.join(", ")+"}"}return String(e)};g.stringify=function(a){a=String(a);for(var b="",c=0;c<a.length;){var d=a.charAt(c);if("\\"===d){b+=d;c++;d=a.charAt(c);if(""===d||-1==='"\\/bfnrtu'.indexOf(d))b+="\\";b+=d}else b='"'===d?b+'\\"':b+d;c++}return'"'+b+'"'};g.escape=function(a){a=
String(a);return a=a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(r,g,k){var y=k(4);g.format=function(b,a){if("function"===typeof a)return a(b);if(!b.isFinite())return b.isNaN()?"NaN":b.gt(0)?"Infinity":"-Infinity";var c="auto",d;void 0!==a&&(a.notation&&(c=a.notation),"number"===typeof a?d=a:a.precision&&(d=a.precision));switch(c){case "fixed":return g.toFixed(b,d);case "exponential":return g.toExponential(b,d);case "engineering":return g.toEngineering(b,
d);case "auto":if(a&&a.exponential&&(void 0!==a.exponential.lower||void 0!==a.exponential.upper))return d=y.map(a,function(a){return a}),d.exponential=void 0,void 0!==a.exponential.lower&&(d.lowerExp=Math.round(Math.log(a.exponential.lower)/Math.LN10)),void 0!==a.exponential.upper&&(d.upperExp=Math.round(Math.log(a.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+
JSON.stringify(a)+" with "+JSON.stringify(d)),g.format(b,d);var c=a&&void 0!==a.lowerExp?a.lowerExp:-3,e=a&&void 0!==a.upperExp?a.upperExp:5;if(b.isZero())return"0";var f=b.e;return(f>=c&&f<e?b.toSignificantDigits(d).toFixed():g.toExponential(b,d)).replace(/((\.\d*?)(0+))($|e)/,function(a,b,c,d,e){return"."!==c?c+e:e});default:throw Error('Unknown notation "'+c+'". Choose "auto", "exponential", or "fixed".');}};g.toEngineering=function(b,a){var c=b.e,d=0===c%3?c:0>c?c-3-c%3:c-c%3,e=b.mul(Math.pow(10,
-d)),f=e.toPrecision(a);-1!==f.indexOf("e")&&(f=e.toString());return f+"e"+(0<=c?"+":"")+d.toString()};g.toExponential=function(b,a){return void 0!==a?b.toExponential(a-1):b.toExponential()};g.toFixed=function(b,a){return b.toFixed(a)}},function(r,g){function k(g,b,a){if(!(this instanceof k))throw new SyntaxError("Constructor must be called with the new operator");this.actual=g;this.expected=b;this.relation=a;this.message="Dimension mismatch ("+(Array.isArray(g)?"["+g.join(", ")+"]":g)+" "+(this.relation||
"!=")+" "+(Array.isArray(b)?"["+b.join(", ")+"]":b)+")";this.stack=Error().stack}k.prototype=new RangeError;k.prototype.constructor=RangeError;k.prototype.name="DimensionError";k.prototype.isDimensionError=!0;r.exports=k},function(r,g){function k(g,b,a){if(!(this instanceof k))throw new SyntaxError("Constructor must be called with the new operator");this.index=g;3>arguments.length?(this.min=0,this.max=b):(this.min=b,this.max=a);this.message=void 0!==this.min&&this.index<this.min?"Index out of range ("+
this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?"Index out of range ("+this.index+" > "+(this.max-1)+")":"Index out of range ("+this.index+")";this.stack=Error().stack}k.prototype=new RangeError;k.prototype.constructor=RangeError;k.prototype.name="IndexError";k.prototype.isIndexError=!0;r.exports=k},function(r,g){g.isBoolean=function(k){return"boolean"===typeof k}},function(r,g){function k(g){k="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:
function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return k(g)}g.memoize=function(g,b){return function c(){"object"!==k(c.cache)&&(c.cache={});for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];e=b?b(d):JSON.stringify(d);e in c.cache||(c.cache[e]=g.apply(g,d));return c.cache[e]}};g.maxArgumentCount=function(k){return Object.keys(k.signatures||{}).reduce(function(b,a){var c=(a.match(/,/g)||[]).length+1;return Math.max(b,c)},-1)};
g.callWithRightArgumentCount=function(k,b,a){return Object.keys(k.signatures||{}).reduce(function(a,b){var e=(b.match(/,/g)||[]).length+1;return Math.max(a,e)},-1)}},function(r,g,k){var y=k(16),b=k(20),a=y.string,c=y.array,d=y.object;r=y.number;var e=Array.isArray,f=r.isNumber,h=r.isInteger,m=a.isString,u=c.validateIndex;g.name="DenseMatrix";g.path="type";g.factory=function(E,v,q,p){function l(a,b){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(b&&
!m(b))throw Error("Invalid datatype: "+b);if(E.isMatrix(a))"DenseMatrix"===a.type?(this._data=d.clone(a._data),this._size=d.clone(a._size)):(this._data=a.toArray(),this._size=a.size()),this._datatype=b||a._datatype;else if(a&&e(a.data)&&e(a.size))this._data=a.data,this._size=a.size,this._datatype=b||a.datatype;else{if(e(a))this._data=n(a),this._size=c.size(this._data),c.validate(this._data,this._size);else{if(a)throw new TypeError("Unsupported type of data ("+y.types.type(a)+")");this._data=[];this._size=
[0]}this._datatype=b}}function t(a,b,c,d){var e=d===c-1,f=b.dimension(d);return e?f.map(function(b){u(b,a.length);return a[b]}).valueOf():f.map(function(e){u(e,a.length);return t(a[e],b,c,d+1)}).valueOf()}function s(a,e,f,l){if(!e||!0!==e.isIndex)throw new TypeError("Invalid index");var h=e.size(),m=e.isScalar(),p;E.isMatrix(f)?(p=f.size(),f=f.valueOf()):p=c.size(f);if(m){if(0!==p.length)throw new TypeError("Scalar expected");a.set(e.min(),f,l)}else{if(h.length<a._size.length)throw new b(h.length,
a._size.length,"<");if(p.length<h.length){for(var u=m=0;1===h[m]&&1===p[m];)m++;for(;1===h[m];)u++,m++;f=c.unsqueeze(f,h.length,u,p)}if(!d.deepEqual(h,p))throw new b(h,p,">");p=e.max().map(function(a){return a+1});w(a,p,l);x(a._data,e,f,h.length,0)}return a}function x(a,b,c,d,e){var f=e===d-1,l=b.dimension(e);f?l.forEach(function(b,d){u(b);a[b]=c[d[0]]}):l.forEach(function(f,l){u(f);x(a[f],b,c[l[0]],d,e+1)})}function g(a,b,d){if(0===b.length){for(a=a._data;e(a);)a=a[0];return a}a._size=b.slice(0);
a._data=c.resize(a._data,a._size,d);return a}function w(a,b,c){for(var d=a._size.slice(0),e=!1;d.length<b.length;)d.push(0),e=!0;for(var f=0,l=b.length;f<l;f++)b[f]>d[f]&&(d[f]=b[f],e=!0);e&&g(a,d,c)}function n(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];e(d)?a[b]=n(d):d&&!0===d.isMatrix&&(a[b]=n(d.valueOf()))}return a}var B=q(k(25));v=q(k(15));l.prototype=new v;l.prototype.type="DenseMatrix";l.prototype.isDenseMatrix=!0;l.prototype.getDataType=function(){return B(this._data)};l.prototype.storage=
function(){return"dense"};l.prototype.datatype=function(){return this._datatype};l.prototype.create=function(a,b){return new l(a,b)};l.prototype.subset=function(a,c,d){switch(arguments.length){case 1:var e;if(!E.isIndex(a))throw new TypeError("Invalid index");if(a.isScalar())e=this.get(a.min());else{e=a.size();if(e.length!==this._size.length)throw new b(e.length,this._size.length);for(var f=a.min(),h=a.max(),m=0,p=this._size.length;m<p;m++)u(f[m],this._size[m]),u(h[m],this._size[m]);e=new l(t(this._data,
a,e.length,0),this._datatype)}return e;case 2:case 3:return s(this,a,c,d);default:throw new SyntaxError("Wrong number of arguments");}};l.prototype.get=function(a){if(!e(a))throw new TypeError("Array expected");if(a.length!==this._size.length)throw new b(a.length,this._size.length);for(var c=0;c<a.length;c++)u(a[c],this._size[c]);for(var c=this._data,d=0,f=a.length;d<f;d++){var l=a[d];u(l,c.length);c=c[l]}return c};l.prototype.set=function(a,c,d){if(!e(a))throw new TypeError("Array expected");if(a.length<
this._size.length)throw new b(a.length,this._size.length,"<");var f,l;f=a.map(function(a){return a+1});w(this,f,d);var h=this._data;d=0;for(f=a.length-1;d<f;d++)l=a[d],u(l,h.length),h=h[l];l=a[a.length-1];u(l,h.length);h[l]=c;return this};l.prototype.resize=function(a,b,c){if(!e(a))throw new TypeError("Array expected");c=c?this.clone():this;return g(c,a,b)};l.prototype.reshape=function(a,b){var d=b?this.clone():this;d._data=c.reshape(d._data,a);d._size=a.slice(0);return d};l.prototype.clone=function(){return new l({data:d.clone(this._data),
size:d.clone(this._size),datatype:this._datatype})};l.prototype.size=function(){return this._size.slice(0)};l.prototype.map=function(a){var b=this;return new l({data:function L(c,d){return e(c)?c.map(function(a,b){return L(a,d.concat(b))}):a(c,d,b)}(this._data,[]),size:d.clone(this._size),datatype:this._datatype})};l.prototype.forEach=function(a){var b=this;(function L(c,d){e(c)?c.forEach(function(a,b){L(a,d.concat(b))}):a(c,d,b)})(this._data,[])};l.prototype.toArray=function(){return d.clone(this._data)};
l.prototype.valueOf=function(){return this._data};l.prototype.format=function(b){return a.format(this._data,b)};l.prototype.toString=function(){return a.format(this._data)};l.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}};l.prototype.diagonal=function(a){if(a){if(E.isBigNumber(a)&&(a=a.toNumber()),!f(a)||!h(a))throw new TypeError("The parameter k must be an integer number");}else a=0;var b=0<a?a:0;a=0>a?-a:0;for(var c=Math.min(this._size[0]-
a,this._size[1]-b),d=[],e=0;e<c;e++)d[e]=this._data[e+a][e+b];return new l({data:d,size:[c],datatype:this._datatype})};l.diagonal=function(a,b,d,u,n){if(!e(a))throw new TypeError("Array expected, size parameter");if(2!==a.length)throw Error("Only two dimensions matrix are supported");a=a.map(function(a){E.isBigNumber(a)&&(a=a.toNumber());if(!f(a)||!h(a)||1>a)throw Error("Size values must be positive integers");return a});if(d){if(E.isBigNumber(d)&&(d=d.toNumber()),!f(d)||!h(d))throw new TypeError("The parameter k must be an integer number");
}else d=0;u&&m(n)&&(u=p.convert(u,n));n=0<d?d:0;d=0>d?-d:0;var s=a[0],v=a[1],t=Math.min(s-d,v-n),q;if(e(b)){if(b.length!==t)throw Error("Invalid value array length");q=function(a){return b[a]}}else if(E.isMatrix(b)){q=b.size();if(1!==q.length||q[0]!==t)throw Error("Invalid matrix length");q=function(a){return b.get([a])}}else q=function(){return b};u||(u=E.isBigNumber(q(0))?new E.BigNumber(0):0);var w=[];if(0<a.length)for(w=c.resize(w,a,u),a=0;a<t;a++)w[a+d][a+n]=q(a);return new l({data:w,size:[s,
v]})};l.fromJSON=function(a){return new l(a)};l.prototype.swapRows=function(a,b){if(!(f(a)&&h(a)&&f(b)&&h(b)))throw Error("Row index must be positive integers");if(2!==this._size.length)throw Error("Only two dimensional matrix is supported");u(a,this._size[0]);u(b,this._size[0]);l._swapRows(a,b,this._data);return this};l._swapRows=function(a,b,c){var d=c[a];c[a]=c[b];c[b]=d};E.Matrix._storage.dense=l;return E.Matrix._storage["default"]=l};g.lazy=!1},function(r,g,k){g.factory=function(g,b,a,c){function d(a){for(var b,
c=0,u=0;u<a.length;u++){var E=a[u],v=Array.isArray(E);0===u&&v&&(c=E.length);if(v&&E.length!==c)return;E=v?d(E):e(E);if(void 0===b)b=E;else if(b!==E)return"mixed"}return b}var e=a(k(26));return d}},function(r,g){function k(g){k="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return k(g)}g.name="typeof";g.factory=function(g,b,a,c){b=c("_typeof",
{any:function(a){var b=k(a);return"object"===b?null===a?"null":Array.isArray(a)?"Array":a instanceof Date?"Date":a instanceof RegExp?"RegExp":g.isBigNumber(a)?"BigNumber":g.isComplex(a)?"Complex":g.isFraction(a)?"Fraction":g.isMatrix(a)?"Matrix":g.isUnit(a)?"Unit":g.isIndex(a)?"Index":g.isRange(a)?"Range":g.isResultSet(a)?"ResultSet":g.isNode(a)?a.type:g.isChain(a)?"Chain":g.isHelp(a)?"Help":"Object":"function"===b?"Function":b}});b.toTex=void 0;return b}},function(r,g,k){var y=k(28);g.name="sin";
g.factory=function(b,a,c,d){var e=d("sin",{number:Math.sin,Complex:function(a){return a.sin()},BigNumber:function(a){return a.sin()},Unit:function(a){if(!a.hasBase(b.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");return e(a.value)},"Array | Matrix":function(a){return y(a,e,!0)}});e.toTex={1:"\\sin\\left(${args[0]}\\right)"};return e}},function(r,g){r.exports=function y(b,a,c){return b&&"function"===typeof b.map?b.map(function(b){return y(b,a,c)}):a(b)}},function(r,
g,k){var y=k(28);g.name="cos";g.factory=function(b,a,c,d){var e=d("cos",{number:Math.cos,Complex:function(a){return a.cos()},BigNumber:function(a){return a.cos()},Unit:function(a){if(!a.hasBase(b.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return e(a.value)},"Array | Matrix":function(a){return y(a,e)}});e.toTex={1:"\\cos\\left(${args[0]}\\right)"};return e}},function(r,g,k){var y=k(28);g.name="sqrt";g.factory=function(b,a,c,d){function e(c){return isNaN(c)?NaN:0<=
c||a.predictable?Math.sqrt(c):(new b.Complex(c,0)).sqrt()}var f=d("sqrt",{number:e,Complex:function(a){return a.sqrt()},BigNumber:function(b){return!b.isNegative()||a.predictable?b.sqrt():e(b.toNumber())},"Array | Matrix":function(a){return y(a,f,!0)},Unit:function(a){return a.pow(.5)}});f.toTex={1:"\\sqrt{${args[0]}}"};return f}},function(r,g,k){g.name="norm";g.factory=function(g,b,a,c){function d(a,b){var c=a.size();if(1===c.length){if(b===Number.POSITIVE_INFINITY||"inf"===b){var l=0;a.forEach(function(a){a=
e(a);q(a,l)&&(l=a)},!0);return l}if(b===Number.NEGATIVE_INFINITY||"-inf"===b){var n;a.forEach(function(a){a=e(a);if(!n||p(a,n))n=a},!0);return n||0}if("fro"===b)return d(a,2);if("number"===typeof b&&!isNaN(b)){if(!v(b,0)){var t=0;a.forEach(function(a){t=f(h(e(a),b),t)},!0);return h(t,1/b)}return Number.POSITIVE_INFINITY}throw Error("Unsupported parameter value");}if(2===c.length){if(1===b){var k=[],g=0;a.forEach(function(a,b){var c=b[1],d=f(k[c]||0,e(a));q(d,g)&&(g=d);k[c]=d},!0);return g}if(b===
Number.POSITIVE_INFINITY||"inf"===b){var I=[],y=0;a.forEach(function(a,b){var c=b[0],d=f(I[c]||0,e(a));q(d,y)&&(y=d);I[c]=d},!0);return y}if("fro"===b){var F=0;a.forEach(function(a,b){F=f(F,E(a,m(a)))});return e(u(F))}if(2===b)throw Error("Unsupported parameter value, missing implementation of matrix singular value decomposition");throw Error("Unsupported parameter value");}}var e=a(k(32)),f=a(k(33)),h=a(k(45)),m=a(k(52)),u=a(k(30)),E=a(k(47)),v=a(k(40)),q=a(k(53)),p=a(k(57)),l=a(k(34)),t=c("norm",
{number:Math.abs,Complex:function(a){return a.abs()},BigNumber:function(a){return a.abs()},"boolean":function(a){return Math.abs(a)},Array:function(a){return d(l(a),2)},Matrix:function(a){return d(a,2)},"number | Complex | BigNumber | boolean, number | BigNumber | string":function(a){return t(a)},"Array, number | BigNumber | string":function(a,b){return d(l(a),b)},"Matrix, number | BigNumber | string":function(a,b){return d(a,b)}});t.toTex={1:"\\left\\|${args[0]}\\right\\|",2:void 0};return t}},function(r,
g,k){var y=k(28);g.name="abs";g.factory=function(b,a,c,d){var e=d("abs",{number:Math.abs,Complex:function(a){return a.abs()},BigNumber:function(a){return a.abs()},Fraction:function(a){return a.abs()},"Array | Matrix":function(a){return y(a,e,!0)},Unit:function(a){return a.abs()}});e.toTex={1:"\\left|${args[0]}\\right|"};return e}},function(r,g,k){var y=k(4).extend;g.name="add";g.factory=function(b,a,c,d){var e=c(k(34)),f=c(k(35));b=k(36);var h=c(k(38)),m=c(k(39)),u=c(k(42)),E=c(k(43)),v=c(k(44)),
q=d("add",y({"DenseMatrix, DenseMatrix":function(a,b){return E(a,b,f)},"DenseMatrix, SparseMatrix":function(a,b){return h(a,b,f,!1)},"SparseMatrix, DenseMatrix":function(a,b){return h(b,a,f,!0)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,f)},"Array, Array":function(a,b){return q(e(a),e(b)).valueOf()},"Array, Matrix":function(a,b){return q(e(a),b)},"Matrix, Array":function(a,b){return q(a,e(b))},"DenseMatrix, any":function(a,b){return v(a,b,f,!1)},"SparseMatrix, any":function(a,b){return u(a,
b,f,!1)},"any, DenseMatrix":function(a,b){return v(b,a,f,!0)},"any, SparseMatrix":function(a,b){return u(b,a,f,!0)},"Array, any":function(a,b){return v(e(a),b,f,!1).valueOf()},"any, Array":function(a,b){return v(e(b),a,f,!0).valueOf()},"any, any":f,"any, any, ...any":function(a,b,c){a=q(a,b);for(b=0;b<c.length;b++)a=q(a,c[b]);return a}},f.signatures));q.toTex={2:"\\left(${args[0]}".concat(b.operators.add,"${args[1]}\\right)")};return q}},function(r,g){g.name="matrix";g.factory=function(k,g,b,a){function c(a,
b,c){return new (k.Matrix.storage(b||"default"))(a,c)}g=a("matrix",{"":function(){return c([])},string:function(a){return c([],a)},"string, string":function(a,b){return c([],a,b)},Array:function(a){return c(a)},Matrix:function(a){return c(a,a.storage())},"Array | Matrix, string":c,"Array | Matrix, string, string":c});g.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"};return g}},function(r,g){g.factory=function(k,g,b,a){var c=a("add",{"number, number":function(a,
b){return a+b},"Complex, Complex":function(a,b){return a.add(b)},"BigNumber, BigNumber":function(a,b){return a.plus(b)},"Fraction, Fraction":function(a,b){return a.add(b)},"Unit, Unit":function(a,b){if(null===a.value||void 0===a.value)throw Error("Parameter x contains a unit with undefined value");if(null===b.value||void 0===b.value)throw Error("Parameter y contains a unit with undefined value");if(!a.equalBase(b))throw Error("Units do not match");var f=a.clone();f.value=c(f.value,b.value);f.fixPrefix=
!1;return f}});return c}},function(r,g,k){var y=k(37);g.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",
omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega","true":"\\mathrm{True}","false":"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"};g.operators=
{transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"};g.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";
var b={deg:"^\\circ"};g.escape=function(a){return y(a,{preserveFormatting:!0})};g.toSymbol=function(a,c){return("undefined"===typeof c?0:c)?b.hasOwnProperty(a)?b[a]:"\\mathrm{"+g.escape(a)+"}":g.symbols.hasOwnProperty(a)?g.symbols[a]:g.escape(a)}},function(r,g){var k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b],f;for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a},y={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%",
"&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},b={"\u2013":"\\--","\u2014":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},a=function(a,b){return k({},a,b)};r.exports=function(c){for(var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=d.preserveFormatting,e=void 0===e?!1:e,d=d.escapeMapFn,f=String(c),h="",m=(void 0===d?a:d)(k({},y),e?k({},b):{}),u=Object.keys(m),d=function(){var a=!1;u.forEach(function(b,c){!a&&f.length>=b.length&&f.slice(0,
b.length)===b&&(h+=m[u[c]],f=f.slice(b.length,f.length),a=!0)});a||(h+=f.slice(0,1),f=f.slice(1,f.length))};f;)d();return h}},function(r,g,k){var y=k(20);g.name="algorithm01";g.factory=function(b,a,c,d){var e=b.DenseMatrix;return function(a,b,c,u){var E=a._data,v=a._size,q=a._datatype;a=b._values;var p=b._index,l=b._ptr,t=b._size,s=b._datatype;if(v.length!==t.length)throw new y(v.length,t.length);if(v[0]!==t[0]||v[1]!==t[1])throw new RangeError("Dimension mismatch. Matrix A ("+v+") must match Matrix B ("+
t+")");if(!a)throw Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");b=v[0];v=v[1];c=(q="string"===typeof q&&q===s?q:void 0)?d.find(c,[q,q]):c;for(var x=[],s=0;s<b;s++)x[s]=[];for(var k=[],w=[],t=0;t<v;t++){for(var n=t+1,g=l[t+1],z=l[t];z<g;z++)s=p[z],k[s]=u?c(a[z],E[s][t]):c(E[s][t],a[z]),w[s]=n;for(s=0;s<b;s++)x[s][t]=w[s]===n?k[s]:E[s][t]}return new e({data:x,size:[b,v],datatype:q})}}},function(r,g,k){var y=k(20);g.name="algorithm04";g.factory=function(b,a,c,d){var e=
c(k(40)),f=b.SparseMatrix;return function(a,b,c){var E=a._values,v=a._index,q=a._ptr,p=a._size,l=a._datatype;a=b._values;var t=b._index,s=b._ptr,x=b._size,k=b._datatype;if(p.length!==x.length)throw new y(p.length,x.length);if(p[0]!==x[0]||p[1]!==x[1])throw new RangeError("Dimension mismatch. Matrix A ("+p+") must match Matrix B ("+x+")");var w=p[0],p=p[1],n;b=e;var x=0,g=c;"string"===typeof l&&l===k&&(n=l,b=d.find(e,[n,n]),x=d.convert(0,n),g=d.find(c,[n,n]));c=E&&a?[]:void 0;l=[];k=[];n=new f({values:c,
index:l,ptr:k,size:[w,p],datatype:n});var w=E&&a?[]:void 0,z=E&&a?[]:void 0,N=[],I=[],L,F,O,M;for(F=0;F<p;F++){k[F]=l.length;var r=F+1;L=q[F];M=q[F+1];for(O=L;O<M;O++)L=v[O],l.push(L),N[L]=r,w&&(w[L]=E[O]);L=s[F];M=s[F+1];for(O=L;O<M;O++)if(L=t[O],N[L]===r){if(w){var D=g(w[L],a[O]);b(D,x)?N[L]=null:w[L]=D}}else l.push(L),I[L]=r,z&&(z[L]=a[O]);if(w&&z)for(O=k[F];O<l.length;)L=l[O],N[L]===r?(c[O]=w[L],O++):I[L]===r?(c[O]=z[L],O++):l.splice(O,1)}k[p]=l.length;return n}}},function(r,g,k){var y=k(8).nearlyEqual,
b=k(41);g.factory=function(a,c,d,e){var f=e("equalScalar",{"boolean, boolean":function(a,b){return a===b},"number, number":function(a,b){return a===b||y(a,b,c.epsilon)},"BigNumber, BigNumber":function(a,d){return a.eq(d)||b(a,d,c.epsilon)},"Fraction, Fraction":function(a,b){return a.equals(b)},"Complex, Complex":function(a,b){return a.equals(b)},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return f(a.value,b.value)}});return f}},function(r,
g){r.exports=function(k,g,b){if(null===b||void 0===b)return k.eq(g);if(k.eq(g))return!0;if(k.isNaN()||g.isNaN())return!1;if(k.isFinite()&&g.isFinite()){var a=k.minus(g).abs();if(a.isZero())return!0;k=k.constructor.max(k.abs(),g.abs());return a.lte(k.times(b))}return!1}},function(r,g){g.name="algorithm10";g.factory=function(k,g,b,a){var c=k.DenseMatrix;return function(b,e,f,h){var m=b._values,u=b._index,E=b._ptr,v=b._size,q=b._datatype;if(!m)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");
b=v[0];var v=v[1],p,l=f;"string"===typeof q&&(p=q,e=a.convert(e,p),l=a.find(f,[p,p]));f=[];p=new c({data:f,size:[b,v],datatype:p});for(var q=[],t=[],s=0;s<v;s++){for(var k=s+1,g=E[s+1],w=E[s];w<g;w++){var n=u[w];q[n]=m[w];t[n]=k}for(g=0;g<b;g++)0===s&&(f[g]=[]),f[g][s]=t[g]===k?h?l(e,q[g]):l(q[g],e):e}return p}}},function(r,g,k){var y=k(20);g.name="algorithm13";g.factory=function(b,a,c,d){function e(a,b,c,d,f,q){var p=[];if(b===c.length-1)for(b=0;b<d;b++)p[b]=a(f[b],q[b]);else for(var l=0;l<d;l++)p[l]=
e(a,b+1,c,c[b+1],f[l],q[l]);return p}var f=b.DenseMatrix;return function(a,b,c){var E=a._data,v=a._size;a=a._datatype;var q=b._data,p=b._size,l=b._datatype;b=[];if(v.length!==p.length)throw new y(v.length,p.length);for(var t=0;t<v.length;t++){if(v[t]!==p[t])throw new RangeError("Dimension mismatch. Matrix A ("+v+") must match Matrix B ("+p+")");b[t]=v[t]}var s,v=c;"string"===typeof a&&a===l&&(s=a,v=d.find(c,[s,s]));c=0<b.length?e(v,0,b,b[0],E,q):[];return new f({data:c,size:b,datatype:s})}}},function(r,
g,k){var y=k(4).clone;g.name="algorithm14";g.factory=function(b,a,c,d){function e(a,b,c,d,f,q,p){var l=[];if(b===c.length-1)for(b=0;b<d;b++)l[b]=p?a(q,f[b]):a(f[b],q);else for(var t=0;t<d;t++)l[t]=e(a,b+1,c,c[b+1],f[t],q,p);return l}var f=b.DenseMatrix;return function(a,b,c,E){var v=a._data,q=a._size;a=a._datatype;var p,l=c;"string"===typeof a&&(p=a,b=d.convert(b,p),l=d.find(c,[p,p]));b=0<q.length?e(l,0,q,q[0],v,b,E):[];return new f({data:b,size:y(q),datatype:p})}}},function(r,g,k){var y=k(8).isInteger,
b=k(17).size;g.name="pow";g.factory=function(a,c,d,e){function f(b,d){if(c.predictable&&!y(d)&&0>b)try{var e=p(d),f=l(e);if((d===f||1E-14>Math.abs((d-f)/d))&&1===e.d%2)return(0===e.n%2?1:-1)*Math.pow(-b,d)}catch(h){}return 1>b*b&&Infinity===d||1<b*b&&-Infinity===d?0:c.predictable&&(-1>b&&Infinity===d||-1<b&&0>b&&-Infinity===d)?NaN:y(d)||0<=b||c.predictable?Math.pow(b,d):(new a.Complex(b,0)).pow(d,0)}function h(a,c){if(!y(c)||0>c)throw new TypeError("For A^b, b must be a positive integer (value is "+
c+")");var d=b(a);if(2!==d.length)throw Error("For A^b, A must be 2 dimensional (A has "+d.length+" dimensions)");if(d[0]!==d[1])throw Error("For A^b, A must be square (size is "+d[0]+"x"+d[1]+")");for(var d=E(d[0]).valueOf(),e=a;1<=c;)1===(c&1)&&(d=v(e,d)),c>>=1,e=v(e,e);return d}function m(a,b){return q(h(a.valueOf(),b))}var u=k(36),E=d(k(46)),v=d(k(47)),q=d(k(34)),p=d(k(50)),l=d(k(51));d=e("pow",{"number, number":f,"Complex, Complex":function(a,b){return a.pow(b)},"BigNumber, BigNumber":function(b,
d){return d.isInteger()||0<=b||c.predictable?b.pow(d):(new a.Complex(b.toNumber(),0)).pow(d.toNumber(),0)},"Fraction, Fraction":function(a,b){if(1!==b.d){if(c.predictable)throw Error("Function pow does not support non-integer exponents for fractions.");return f(a.valueOf(),b.valueOf())}return a.pow(b)},"Array, number":h,"Array, BigNumber":function(a,b){return h(a,b.toNumber())},"Matrix, number":m,"Matrix, BigNumber":function(a,b){return m(a,b.toNumber())},"Unit, number | BigNumber":function(a,b){return a.pow(b)}});
d.toTex={2:"\\left(${args[0]}\\right)".concat(u.operators.pow,"{${args[1]}}")};return d}},function(r,g,k){var y=k(17),b=k(8).isInteger;g.name="identity";g.factory=function(a,c,d,e){function f(a,b){switch(a.length){case 0:return b?m(b):[];case 1:return h(a[0],a[0],b);case 2:return h(a[0],a[1],b);default:throw Error("Vector containing two values expected");}}function h(c,d,e){var f=a.isBigNumber(c)||a.isBigNumber(d)?a.BigNumber:null;a.isBigNumber(c)&&(c=c.toNumber());a.isBigNumber(d)&&(d=d.toNumber());
if(!b(c)||1>c)throw Error("Parameters in function identity must be positive integers");if(!b(d)||1>d)throw Error("Parameters in function identity must be positive integers");var h=f?new a.BigNumber(1):1,f=f?new f(0):0,l=[c,d];if(e)return a.Matrix.storage(e).diagonal(l,h,0,f);e=y.resize([],l,f);c=c<d?c:d;for(d=0;d<c;d++)e[d][d]=h;return e}var m=d(k(34));d=e("identity",{"":function(){return"Matrix"===c.matrix?m([]):[]},string:function(a){return m(a)},"number | BigNumber":function(a){return h(a,a,"Matrix"===
c.matrix?"default":void 0)},"number | BigNumber, string":function(a,b){return h(a,a,b)},"number | BigNumber, number | BigNumber":function(a,b){return h(a,b,"Matrix"===c.matrix?"default":void 0)},"number | BigNumber, number | BigNumber, string":function(a,b,c){return h(a,b,c)},Array:function(a){return f(a)},"Array, string":function(a,b){return f(a,b)},Matrix:function(a){return f(a.valueOf(),a.storage())},"Matrix, string":function(a,b){return f(a.valueOf(),b)}});d.toTex=void 0;return d}},function(r,
g,k){var y=k(4).extend,b=k(17);g.name="multiply";g.factory=function(a,c,d,e){function f(a,b){switch(a.length){case 1:switch(b.length){case 1:if(a[0]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(a[0]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+a[0]+") must match Matrix rows ("+b[0]+")");break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+b.length+" dimensions)");
}break;case 2:switch(b.length){case 1:if(a[1]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+a[1]+") must match Vector length ("+b[0]+")");break;case 2:if(a[1]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+a[1]+") must match Matrix B rows ("+b[0]+")");break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+b.length+" dimensions)");}break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+
a.length+" dimensions)");}}c=k(36);var h=d(k(34)),m=d(k(35)),u=d(k(48)),E=d(k(40)),v=d(k(49)),q=d(k(44)),p=a.DenseMatrix,l=a.SparseMatrix,t=e("multiply",y({"Array, Array":function(c,d){f(b.size(c),b.size(d));var e=t(h(c),h(d));return a.isMatrix(e)?e.valueOf():e},"Matrix, Matrix":function(a,b){var c=a.size(),d=b.size();f(c,d);if(1===c.length){if(1===d.length){var l=c[0];if(0===l)throw Error("Cannot multiply two empty vectors");var c=a._data,h=a._datatype,d=b._data,E=b._datatype,v=m,t=u;h&&E&&h===E&&
"string"===typeof h&&(v=e.find(m,[h,h]),t=e.find(u,[h,h]));h=t(c[0],d[0]);for(E=1;E<l;E++)h=v(h,t(c[E],d[E]));return h}if("dense"!==b.storage())throw Error("Support for SparseMatrix not implemented");var c=a._data,q=a._datatype,d=b._data,k=b._datatype,v=a._size[0],t=b._size[1],h=m,E=u;q&&k&&q===k&&"string"===typeof q&&(l=q,h=e.find(m,[l,l]),E=e.find(u,[l,l]));q=[];for(k=0;k<t;k++){for(var y=E(c[0],d[0][k]),D=1;D<v;D++)y=h(y,E(c[D],d[D][k]));q[k]=y}return new p({data:q,size:[t],datatype:l})}return 1===
d.length?s(a,b):g(a,b)},"Matrix, Array":function(a,b){return t(a,h(b))},"Array, Matrix":function(a,b){return t(h(a,b.storage()),b)},"SparseMatrix, any":function(a,b){return v(a,b,u,!1)},"DenseMatrix, any":function(a,b){return q(a,b,u,!1)},"any, SparseMatrix":function(a,b){return v(b,a,u,!0)},"any, DenseMatrix":function(a,b){return q(b,a,u,!0)},"Array, any":function(a,b){return q(h(a),b,u,!1).valueOf()},"any, Array":function(a,b){return q(h(b),a,u,!0).valueOf()},"any, any":u,"any, any, ...any":function(a,
b,c){a=t(a,b);for(b=0;b<c.length;b++)a=t(a,c[b]);return a}},u.signatures)),s=e("_multiplyMatrixVector",{"DenseMatrix, any":function(a,b){var c=a._data,d=a._size,f=a._datatype,l=b._data,h=b._datatype,E=d[0],d=d[1],v,s=m,t=u;f&&h&&f===h&&"string"===typeof f&&(v=f,s=e.find(m,[v,v]),t=e.find(u,[v,v]));f=[];for(h=0;h<E;h++){for(var q=c[h],k=t(q[0],l[0]),g=1;g<d;g++)k=s(k,t(q[g],l[g]));f[h]=k}return new p({data:f,size:[E],datatype:v})},"SparseMatrix, any":function(a,b){var c=a._values,d=a._index,f=a._ptr,
h=a._datatype;if(!c)throw Error("Cannot multiply Pattern only Matrix times Dense Matrix");var p=b._data,v=b._datatype,s=a._size[0],t=b._size[0],q=[],k=[],g=[],x,y=m,r=u,Q=E,J=0;h&&v&&h===v&&"string"===typeof h&&(x=h,y=e.find(m,[x,x]),r=e.find(u,[x,x]),Q=e.find(E,[x,x]),J=e.convert(0,x));for(var h=[],v=[],K=g[0]=0;K<t;K++){var G=p[K];if(!Q(G,J))for(var P=f[K+1],U=f[K];U<P;U++){var W=d[U];v[W]?h[W]=y(h[W],r(G,c[U])):(v[W]=!0,k.push(W),h[W]=r(G,c[U]))}}c=k.length;for(d=0;d<c;d++)q[d]=h[k[d]];g[1]=k.length;
return new l({values:q,index:k,ptr:g,size:[s,1],datatype:x})}}),g=e("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(a,b){var c=a._data,d=a._size,f=a._datatype,l=b._data,h=b._datatype,E=d[0],d=d[1],v=b._size[1],s,t=m,q=u;f&&h&&f===h&&"string"===typeof f&&(s=f,t=e.find(m,[s,s]),q=e.find(u,[s,s]));f=[];for(h=0;h<E;h++){var k=c[h];f[h]=[];for(var g=0;g<v;g++){for(var x=q(k[0],l[0][g]),y=1;y<d;y++)x=t(x,q(k[y],l[y][g]));f[h][g]=x}}return new p({data:f,size:[E,v],datatype:s})},"DenseMatrix, SparseMatrix":function(a,
b){var c=a._data,d=a._size,f=a._datatype,h=b._values,p=b._index,v=b._ptr,s=b._size,t=b._datatype;if(!h)throw Error("Cannot multiply Dense Matrix times Pattern only Matrix");var d=d[0],s=s[1],q,k=m,g=u,x=E,y=0;f&&t&&f===t&&"string"===typeof f&&(q=f,k=e.find(m,[q,q]),g=e.find(u,[q,q]),x=e.find(E,[q,q]),y=e.convert(0,q));var f=[],t=[],r=[];q=new l({values:f,index:t,ptr:r,size:[d,s],datatype:q});for(var Q=0;Q<s;Q++){r[Q]=t.length;var J=v[Q],K=v[Q+1];if(K>J)for(var G=0,P=0;P<d;P++){for(var U=P+1,W=void 0,
aa=J;aa<K;aa++){var T=p[aa];G!==U?(W=g(c[P][T],h[aa]),G=U):W=k(W,g(c[P][T],h[aa]))}G!==U||x(W,y)||(t.push(P),f.push(W))}}r[s]=t.length;return q},"SparseMatrix, DenseMatrix":function(a,b){var c=a._values,d=a._index,f=a._ptr,h=a._datatype;if(!c)throw Error("Cannot multiply Pattern only Matrix times Dense Matrix");var p=b._data,v=b._datatype,s=a._size[0],t=b._size[0],q=b._size[1],k,g=m,x=u,y=E,r=0;h&&v&&h===v&&"string"===typeof h&&(k=h,g=e.find(m,[k,k]),x=e.find(u,[k,k]),y=e.find(E,[k,k]),r=e.convert(0,
k));var h=[],v=[],Q=[],s=new l({values:h,index:v,ptr:Q,size:[s,q],datatype:k});k=[];for(var J=[],K=0;K<q;K++){Q[K]=v.length;for(var G=K+1,P=0;P<t;P++){var U=p[P][K];if(!y(U,r))for(var W=f[P+1],aa=f[P];aa<W;aa++){var T=d[aa];J[T]!==G?(J[T]=G,v.push(T),k[T]=x(U,c[aa])):k[T]=g(k[T],x(U,c[aa]))}}G=v.length;for(P=Q[K];P<G;P++)h[P]=k[v[P]]}Q[q]=v.length;return s},"SparseMatrix, SparseMatrix":function(a,b){var c=a._values,d=a._index,f=a._ptr,h=a._datatype,p=b._values,E=b._index,v=b._ptr,s=b._datatype,t=
a._size[0],q=b._size[1],k=c&&p,g,x=m,y=u;h&&s&&h===s&&"string"===typeof h&&(g=h,x=e.find(m,[g,g]),y=e.find(u,[g,g]));var h=k?[]:void 0,s=[],r=[],t=new l({values:h,index:s,ptr:r,size:[t,q],datatype:g});g=k?[]:void 0;for(var J=[],K,G,P,U,W,aa=0;aa<q;aa++){r[aa]=s.length;var T=aa+1;P=v[aa];for(U=v[aa+1];P<U;P++)if(G=E[P],k)for(K=f[G],G=f[G+1];K<G;K++)W=d[K],J[W]!==T?(J[W]=T,s.push(W),g[W]=y(p[P],c[K])):g[W]=x(g[W],y(p[P],c[K]));else for(K=f[G],G=f[G+1];K<G;K++)W=d[K],J[W]!==T&&(J[W]=T,s.push(W));if(k)for(U=
s.length,T=r[aa];T<U;T++)h[T]=g[s[T]]}r[q]=s.length;return t}});t.toTex={2:"\\left(${args[0]}".concat(c.operators.multiply,"${args[1]}\\right)")};return t}},function(r,g){g.factory=function(k,g,b,a){var c=a("multiplyScalar",{"number, number":function(a,b){return a*b},"Complex, Complex":function(a,b){return a.mul(b)},"BigNumber, BigNumber":function(a,b){return a.times(b)},"Fraction, Fraction":function(a,b){return a.mul(b)},"number | Fraction | BigNumber | Complex, Unit":function(a,b){var f=b.clone();
f.value=null===f.value?f._normalize(a):c(f.value,a);return f},"Unit, number | Fraction | BigNumber | Complex":function(a,b){var f=a.clone();f.value=null===f.value?f._normalize(b):c(f.value,b);return f},"Unit, Unit":function(a,b){return a.multiply(b)}});return c}},function(r,g,k){g.name="algorithm11";g.factory=function(g,b,a,c){var d=a(k(40)),e=g.SparseMatrix;return function(a,b,m,u){var E=a._values,v=a._index,q=a._ptr,p=a._size,l=a._datatype;if(!E)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");
var t=p[0],p=p[1],s;a=d;var k=0,g=m;"string"===typeof l&&(s=l,a=c.find(d,[s,s]),k=c.convert(0,s),b=c.convert(b,s),g=c.find(m,[s,s]));m=[];var l=[],w=[];s=new e({values:m,index:l,ptr:w,size:[t,p],datatype:s});for(t=0;t<p;t++){w[t]=l.length;for(var n=q[t+1],B=q[t];B<n;B++){var z=v[B],y=u?g(b,E[B]):g(E[B],b);a(y,k)||(l.push(z),m.push(y))}}w[p]=l.length;return s}}},function(r,g,k){var y=k(28);g.name="fraction";g.factory=function(b,a,c,d){var e=d("fraction",{number:function(a){if(!isFinite(a)||isNaN(a))throw Error(a+
" cannot be represented as a fraction");return new b.Fraction(a)},string:function(a){return new b.Fraction(a)},"number, number":function(a,c){return new b.Fraction(a,c)},"null":function(a){return new b.Fraction(0)},BigNumber:function(a){return new b.Fraction(a.toString())},Fraction:function(a){return a},Object:function(a){return new b.Fraction(a)},"Array | Matrix":function(a){return y(a,e)}});return e}},function(r,g,k){var y=k(28);g.name="number";g.factory=function(b,a,c,d){var e=d("number",{"":function(){return 0},
number:function(a){return a},string:function(a){if("NaN"===a)return NaN;var b=Number(a);if(isNaN(b))throw new SyntaxError('String "'+a+'" is no valid number');return b},BigNumber:function(a){return a.toNumber()},Fraction:function(a){return a.valueOf()},Unit:function(a){throw Error("Second argument with valueless unit expected");},"null":function(a){return 0},"Unit, string | Unit":function(a,b){return a.toNumber(b)},"Array | Matrix":function(a){return y(a,e)}});e.toTex={0:"0",1:"\\left(${args[0]}\\right)",
2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"};return e}},function(r,g,k){var y=k(28);g.name="conj";g.factory=function(b,a,c,d){var e=d("conj",{number:function(a){return a},BigNumber:function(a){return a},Complex:function(a){return a.conjugate()},"Array | Matrix":function(a){return y(a,e)}});e.toTex={1:"\\left(${args[0]}\\right)^*"};return e}},function(r,g,k){var y=k(8).nearlyEqual,b=k(41);g.name="larger";g.factory=function(a,c,d,e){var f=d(k(34)),h=d(k(54)),m=d(k(55)),u=d(k(56)),E=d(k(43)),
v=d(k(44));a=k(36);var q=e("larger",{"boolean, boolean":function(a,b){return a>b},"number, number":function(a,b){return a>b&&!y(a,b,c.epsilon)},"BigNumber, BigNumber":function(a,d){return a.gt(d)&&!b(a,d,c.epsilon)},"Fraction, Fraction":function(a,b){return 1===a.compare(b)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers");},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return q(a.value,
b.value)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,q)},"SparseMatrix, DenseMatrix":function(a,b){return h(b,a,q,!0)},"DenseMatrix, SparseMatrix":function(a,b){return h(a,b,q,!1)},"DenseMatrix, DenseMatrix":function(a,b){return E(a,b,q)},"Array, Array":function(a,b){return q(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return q(f(a),b)},"Matrix, Array":function(a,b){return q(a,f(b))},"SparseMatrix, any":function(a,b){return u(a,b,q,!1)},"DenseMatrix, any":function(a,b){return v(a,
b,q,!1)},"any, SparseMatrix":function(a,b){return u(b,a,q,!0)},"any, DenseMatrix":function(a,b){return v(b,a,q,!0)},"Array, any":function(a,b){return v(f(a),b,q,!1).valueOf()},"any, Array":function(a,b){return v(f(b),a,q,!0).valueOf()}});q.toTex={2:"\\left(${args[0]}".concat(a.operators.larger,"${args[1]}\\right)")};return q}},function(r,g,k){var y=k(20);g.name="algorithm03";g.factory=function(b,a,c,d){var e=b.DenseMatrix;return function(a,b,c,u){var E=a._data,v=a._size,q=a._datatype;a=b._values;
var p=b._index,l=b._ptr,t=b._size,s=b._datatype;if(v.length!==t.length)throw new y(v.length,t.length);if(v[0]!==t[0]||v[1]!==t[1])throw new RangeError("Dimension mismatch. Matrix A ("+v+") must match Matrix B ("+t+")");if(!a)throw Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");b=v[0];var v=v[1],k,t=0,g=c;"string"===typeof q&&q===s&&(k=q,t=d.convert(0,k),g=d.find(c,[k,k]));c=[];for(q=0;q<b;q++)c[q]=[];for(var q=[],s=[],w=0;w<v;w++){for(var n=w+1,B=l[w+1],z=l[w];z<B;z++){var N=
p[z];q[N]=u?g(a[z],E[N][w]):g(E[N][w],a[z]);s[N]=n}for(B=0;B<b;B++)c[B][w]=s[B]===n?q[B]:u?g(t,E[B][w]):g(E[B][w],t)}return new e({data:c,size:[b,v],datatype:k})}}},function(r,g,k){var y=k(20);g.name="algorithm07";g.factory=function(b,a,c,d){function e(a,b,c,d,e){var f=a._values,p=a._index,l=a._ptr;a=l[b];for(b=l[b+1];a<b;a++)l=p[a],c[l]=e,d[l]=f[a]}var f=b.DenseMatrix;return function(a,b,c){var E=a._size,v=a._datatype,q=b._size,p=b._datatype;if(E.length!==q.length)throw new y(E.length,q.length);
if(E[0]!==q[0]||E[1]!==q[1])throw new RangeError("Dimension mismatch. Matrix A ("+E+") must match Matrix B ("+q+")");var q=E[0],E=E[1],l,t=0,s=c;"string"===typeof v&&v===p&&(l=v,t=d.convert(0,l),s=d.find(c,[l,l]));v=[];for(c=0;c<q;c++)v[c]=[];var p=new f({data:v,size:[q,E],datatype:l}),k=[],g=[],w=[],n=[];for(l=0;l<E;l++){var B=l+1;e(a,l,w,k,B);e(b,l,n,g,B);for(c=0;c<q;c++)v[c][l]=s(w[c]===B?k[c]:t,n[c]===B?g[c]:t)}return p}}},function(r,g){g.name="algorithm12";g.factory=function(k,g,b,a){var c=k.DenseMatrix;
return function(b,e,f,h){var m=b._values,u=b._index,E=b._ptr,v=b._size,q=b._datatype;if(!m)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");b=v[0];var v=v[1],p,l=f;"string"===typeof q&&(p=q,e=a.convert(e,p),l=a.find(f,[p,p]));f=[];p=new c({data:f,size:[b,v],datatype:p});for(var q=[],t=[],s=0;s<v;s++){for(var k=s+1,g=E[s+1],w=E[s];w<g;w++){var n=u[w];q[n]=m[w];t[n]=k}for(g=0;g<b;g++)0===s&&(f[g]=[]),f[g][s]=t[g]===k?h?l(e,q[g]):l(q[g],e):h?l(e,0):l(0,e)}return p}}},
function(r,g,k){var y=k(8).nearlyEqual,b=k(41);g.name="smaller";g.factory=function(a,c,d,e){var f=d(k(34)),h=d(k(54)),m=d(k(55)),u=d(k(56)),E=d(k(43)),v=d(k(44));a=k(36);var q=e("smaller",{"boolean, boolean":function(a,b){return a<b},"number, number":function(a,b){return a<b&&!y(a,b,c.epsilon)},"BigNumber, BigNumber":function(a,d){return a.lt(d)&&!b(a,d,c.epsilon)},"Fraction, Fraction":function(a,b){return-1===a.compare(b)},"Complex, Complex":function(a,b){throw new TypeError("No ordering relation is defined for complex numbers");
},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return q(a.value,b.value)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,q)},"SparseMatrix, DenseMatrix":function(a,b){return h(b,a,q,!0)},"DenseMatrix, SparseMatrix":function(a,b){return h(a,b,q,!1)},"DenseMatrix, DenseMatrix":function(a,b){return E(a,b,q)},"Array, Array":function(a,b){return q(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return q(f(a),b)},"Matrix, Array":function(a,
b){return q(a,f(b))},"SparseMatrix, any":function(a,b){return u(a,b,q,!1)},"DenseMatrix, any":function(a,b){return v(a,b,q,!1)},"any, SparseMatrix":function(a,b){return u(b,a,q,!0)},"any, DenseMatrix":function(a,b){return v(b,a,q,!0)},"Array, any":function(a,b){return v(f(a),b,q,!1).valueOf()},"any, Array":function(a,b){return v(f(b),a,q,!0).valueOf()}});q.toTex={2:"\\left(${args[0]}".concat(a.operators.smaller,"${args[1]}\\right)")};return q}},function(r,g,k){var y=k(4).extend;g.name="divide";g.factory=
function(b,a,c,d){var e=c(k(59)),f=c(k(47)),h=c(k(62)),m=c(k(34)),u=c(k(49)),E=c(k(44));b=d("divide",y({"Array | Matrix, Array | Matrix":function(a,b){return f(a,h(b))},"DenseMatrix, any":function(a,b){return E(a,b,e,!1)},"SparseMatrix, any":function(a,b){return u(a,b,e,!1)},"Array, any":function(a,b){return E(m(a),b,e,!1).valueOf()},"any, Array | Matrix":function(a,b){return f(a,h(b))}},e.signatures));b.toTex={2:"\\frac{${args[0]}}{${args[1]}}"};return b}},function(r,g,k){g.factory=function(g,b,
a,c){var d=a(k(60)),e=a(k(26)),f=c("divide",{"number, number":function(a,b){return a/b},"Complex, Complex":function(a,b){return a.div(b)},"BigNumber, BigNumber":function(a,b){return a.div(b)},"Fraction, Fraction":function(a,b){return a.div(b)},"Unit, number | Fraction | BigNumber":function(a,b){var c=a.clone(),E=d(1,e(b));c.value=f(null===c.value?c._normalize(E):c.value,b);return c},"number | Fraction | BigNumber, Unit":function(a,b){var c=b.clone(),c=c.pow(-1),E=d(1,e(a));c.value=f(a,null===b.value?
b._normalize(E):b.value);return c},"Unit, Unit":function(a,b){return a.divide(b)}});return f}},function(r,g,k){g.path="type";g.name="_numeric";g.factory=function(g,b,a,c){var d=a(k(26)),e={string:!0,number:!0,BigNumber:!0,Fraction:!0},f={number:a(k(51)),BigNumber:a(k(61)),Fraction:a(k(50))};g=function(a,b){var c=d(a);if(!(c in e))throw new TypeError("Cannot convert "+a+' of type "'+c+'"; valid input types are '+Object.keys(e).join(", "));if(!(b in f))throw new TypeError("Cannot convert "+a+' to type "'+
b+'"; valid output types are '+Object.keys(f).join(", "));return b===c?a:f[b](a)};g.toTex=function(a,b){return a.args[0].toTex()};return g}},function(r,g,k){var y=k(28);g.name="bignumber";g.factory=function(b,a,c,d){var e=d("bignumber",{"":function(){return new b.BigNumber(0)},number:function(a){return new b.BigNumber(a+"")},string:function(a){return new b.BigNumber(a)},BigNumber:function(a){return a},Fraction:function(a){return(new b.BigNumber(a.n)).div(a.d).times(a.s)},"null":function(a){return new b.BigNumber(0)},
"Array | Matrix":function(a){return y(a,e)}});e.toTex={0:"0",1:"\\left(${args[0]}\\right)"};return e}},function(r,g,k){var y=k(16);g.name="inv";g.factory=function(b,a,c,d){function e(a,b,c){var d,e;if(1===b){b=a[0][0];if(0===b)throw Error("Cannot calculate inverse, determinant is zero");return[[h(1,b)]]}if(2===b){b=v(a);if(0===b)throw Error("Cannot calculate inverse, determinant is zero");return[[h(a[1][1],b),h(E(a[0][1]),b)],[h(E(a[1][0]),b),h(a[0][0],b)]]}var f=a.concat();for(a=0;a<b;a++)f[a]=f[a].concat();
for(var n=q(b).valueOf(),k=0;k<c;k++){d=p(f[k][k]);e=k;for(a=k+1;a<b;)p(f[a][k])>d&&(d=p(f[a][k]),e=a),a++;if(0===d)throw Error("Cannot calculate inverse, determinant is zero");a=e;a!==k&&(d=f[k],f[k]=f[a],f[a]=d,d=n[k],n[k]=n[a],n[a]=d);var g=f[k],y=n[k];for(a=0;a<b;a++){var I=f[a],r=n[a];if(a!==k){if(0!==I[k]){e=h(E(I[k]),g[k]);for(d=k;d<c;d++)I[d]=m(I[d],u(e,g[d]));for(d=0;d<c;d++)r[d]=m(r[d],u(e,y[d]))}}else{e=g[k];for(d=k;d<c;d++)I[d]=h(I[d],e);for(d=0;d<c;d++)r[d]=h(r[d],e)}}}return n}var f=
c(k(34)),h=c(k(59)),m=c(k(35)),u=c(k(47)),E=c(k(63)),v=c(k(64)),q=c(k(46)),p=c(k(32));a=d("inv",{"Array | Matrix":function(a){var c=b.isMatrix(a)?a.size():y.array.size(a);switch(c.length){case 1:if(1===c[0])return b.isMatrix(a)?f([h(1,a.valueOf()[0])]):[h(1,a[0])];throw new RangeError("Matrix must be square (size: "+y.string.format(c)+")");case 2:var d=c[0],m=c[1];if(d===m)return b.isMatrix(a)?f(e(a.valueOf(),d,m),a.storage()):e(a,d,m);throw new RangeError("Matrix must be square (size: "+y.string.format(c)+
")");default:throw new RangeError("Matrix must be two dimensional (size: "+y.string.format(c)+")");}},any:function(a){return h(1,a)}});a.toTex={1:"\\left(${args[0]}\\right)^{-1}"};return a}},function(r,g,k){var y=k(28);g.name="unaryMinus";g.factory=function(b,a,c,d){b=k(36);var e=d("unaryMinus",{number:function(a){return-a},Complex:function(a){return a.neg()},BigNumber:function(a){return a.neg()},Fraction:function(a){return a.neg()},Unit:function(a){var b=a.clone();b.value=e(a.value);return b},"Array | Matrix":function(a){return y(a,
e,!0)}});e.toTex={1:"".concat(b.operators.unaryMinus,"\\left(${args[0]}\\right)")};return e}},function(r,g,k){r=k(16);var y=r.object,b=r.string;g.name="det";g.factory=function(a,c,d,e){var f=d(k(34)),h=d(k(65)),m=d(k(47)),u=d(k(63)),E=d(k(67));c=e("det",{any:function(a){return y.clone(a)},"Array | Matrix":function(c){var d;a.isMatrix(c)?d=c.size():Array.isArray(c)?(c=f(c),d=c.size()):d=[];switch(d.length){case 0:return y.clone(c);case 1:if(1===d[0])return y.clone(c.valueOf()[0]);throw new RangeError("Matrix must be square (size: "+
b.format(d)+")");case 2:var e=d[0];if(e===d[1]){c=c.clone().valueOf();if(1===e)e=y.clone(c[0][0]);else if(2===e)e=h(m(c[0][0],c[1][1]),m(c[1][0],c[0][1]));else{c=E(c);d=c.U[0][0];for(var l=1;l<e;l++)d=m(d,c.U[l][l]);for(var k=l=0,s=[];;){for(;s[k];)k++;if(k>=e)break;for(var g=k,X=0;!s[c.p[g]];)s[c.p[g]]=!0,g=c.p[g],X++;0===X%2&&l++}e=0===l%2?d:u(d)}return e}throw new RangeError("Matrix must be square (size: "+b.format(d)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+b.format(d)+
")");}}});c.toTex={1:"\\det\\left(${args[0]}\\right)"};return c}},function(r,g,k){function y(a,c){var d=a.size(),e=c.size();if(d.length!==e.length)throw new b(d.length,e.length);}var b=k(20);g.name="subtract";g.factory=function(a,b,d,e){a=k(36);var f=d(k(34)),h=d(k(35)),m=d(k(63)),u=d(k(38)),E=d(k(54)),v=d(k(66)),g=d(k(42)),p=d(k(43)),l=d(k(44)),t=e("subtract",{"number, number":function(a,b){return a-b},"Complex, Complex":function(a,b){return a.sub(b)},"BigNumber, BigNumber":function(a,b){return a.minus(b)},
"Fraction, Fraction":function(a,b){return a.sub(b)},"Unit, Unit":function(a,b){if(null===a.value)throw Error("Parameter x contains a unit with undefined value");if(null===b.value)throw Error("Parameter y contains a unit with undefined value");if(!a.equalBase(b))throw Error("Units do not match");var c=a.clone();c.value=t(c.value,b.value);c.fixPrefix=!1;return c},"SparseMatrix, SparseMatrix":function(a,b){y(a,b);return v(a,b,t)},"SparseMatrix, DenseMatrix":function(a,b){y(a,b);return E(b,a,t,!0)},"DenseMatrix, SparseMatrix":function(a,
b){y(a,b);return u(a,b,t,!1)},"DenseMatrix, DenseMatrix":function(a,b){y(a,b);return p(a,b,t)},"Array, Array":function(a,b){return t(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return t(f(a),b)},"Matrix, Array":function(a,b){return t(a,f(b))},"SparseMatrix, any":function(a,b){return g(a,m(b),h)},"DenseMatrix, any":function(a,b){return l(a,b,t)},"any, SparseMatrix":function(a,b){return g(b,a,t,!0)},"any, DenseMatrix":function(a,b){return l(b,a,t,!0)},"Array, any":function(a,b){return l(f(a),
b,t,!1).valueOf()},"any, Array":function(a,b){return l(f(b),a,t,!0).valueOf()}});t.toTex={2:"\\left(${args[0]}".concat(a.operators.subtract,"${args[1]}\\right)")};return t}},function(r,g,k){var y=k(20);g.name="algorithm05";g.factory=function(b,a,c,d){var e=c(k(40)),f=b.SparseMatrix;return function(a,b,c){var E=a._values,k=a._index,g=a._ptr,p=a._size,l=a._datatype;a=b._values;var t=b._index,s=b._ptr,x=b._size,X=b._datatype;if(p.length!==x.length)throw new y(p.length,x.length);if(p[0]!==x[0]||p[1]!==
x[1])throw new RangeError("Dimension mismatch. Matrix A ("+p+") must match Matrix B ("+x+")");var w=p[0],p=p[1],n;b=e;var x=0,B=c;"string"===typeof l&&l===X&&(n=l,b=d.find(e,[n,n]),x=d.convert(0,n),B=d.find(c,[n,n]));c=E&&a?[]:void 0;l=[];X=[];n=new f({values:c,index:l,ptr:X,size:[w,p],datatype:n});var w=c?[]:void 0,z=c?[]:void 0,N=[],I=[],r,F,O,M;for(F=0;F<p;F++){X[F]=l.length;var R=F+1;O=g[F];for(M=g[F+1];O<M;O++)r=k[O],l.push(r),N[r]=R,w&&(w[r]=E[O]);O=s[F];for(M=s[F+1];O<M;O++)r=t[O],N[r]!==R&&
l.push(r),I[r]=R,z&&(z[r]=a[O]);if(c)for(O=X[F];O<l.length;){r=l[O];M=N[r];var D=I[r];if(M===R||D===R)r=B(M===R?w[r]:x,D===R?z[r]:x),b(r,x)?l.splice(O,1):(c.push(r),O++)}}X[p]=l.length;return n}}},function(r,g,k){var y=k(16).object;g.name="lup";g.factory=function(b,a,c,d){function e(a){var b=a._size[0],c=a._size[1],d=Math.min(b,c),e=y.clone(a._data),f=[],h=[b,d],k=[],d=[d,c],t,s,X=[];for(a=0;a<b;a++)X[a]=a;for(t=0;t<c;t++){if(0<t)for(a=0;a<b;a++){var r=Math.min(a,t),H=0;for(s=0;s<r;s++)H=u(H,g(e[a][s],
e[s][t]));e[a][t]=q(e[a][t],H)}s=t;H=r=0;for(a=t;a<b;a++){var S=e[a][t],C=m(S);p(C,r)&&(s=a,r=C,H=S)}t!==s&&(X[t]=[X[s],X[s]=X[t]][0],x._swapRows(t,s,e));if(t<b)for(a=t+1;a<b;a++)l(e[a][t],0)||(e[a][t]=E(e[a][t],H))}for(t=0;t<c;t++)for(a=0;a<b;a++)0===t&&(a<c&&(k[a]=[]),f[a]=[]),a<t?(a<c&&(k[a][t]=e[a][t]),t<b&&(f[a][t]=0)):a===t?(a<c&&(k[a][t]=e[a][t]),t<b&&(f[a][t]=1)):(a<c&&(k[a][t]=0),t<b&&(f[a][t]=e[a][t]));b=new x({data:f,size:h});c=new x({data:k,size:d});k=[];a=0;for(d=X.length;a<d;a++)k[X[a]]=
a;return{L:b,U:c,p:k,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}function f(a){var b=a._size[0],c=a._size[1],d=Math.min(b,c),e=a._values,f=a._index,h=a._ptr,u=[],k=[],q=[],x=[b,d],r=[],y=[],S=[],C=[d,c],Q,J,K,G=[],P=[];for(Q=0;Q<b;Q++)G[Q]=Q,P[Q]=Q;var U=function(a,b){var c=P[a],d=P[b];G[c]=b;G[d]=a;P[a]=d;P[b]=c};a=function(){var a=new X;J<b&&(q.push(u.length),u.push(1),k.push(J));S.push(r.length);var c=h[J+1];for(K=h[J];K<c;K++)Q=f[K],a.set(G[Q],
e[K]);0<J&&a.forEach(0,J-1,function(b,c){s._forEachRow(b,u,k,q,function(d,e){d>b&&a.accumulate(d,t(g(e,c)))})});var d=J,w=a.get(J),z=m(w);a.forEach(J+1,b-1,function(a,b){var c=m(b);p(c,z)&&(d=a,z=c,w=b)});J!==d&&(s._swapRows(J,d,x[1],u,k,q),s._swapRows(J,d,C[1],r,y,S),a.swap(J,d),U(J,d));a.forEach(0,b-1,function(a,b){a<=J?(r.push(b),y.push(a)):(b=E(b,w),l(b,0)||(u.push(b),k.push(a)))})};for(J=0;J<c;J++)a();S.push(r.length);q.push(u.length);return{L:new s({values:u,index:k,ptr:q,size:x}),U:new s({values:r,
index:y,ptr:S,size:C}),p:G,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}var h=c(k(34)),m=c(k(32)),u=c(k(35)),E=c(k(59)),g=c(k(48)),q=c(k(65)),p=c(k(53)),l=c(k(40)),t=c(k(63)),s=b.SparseMatrix,x=b.DenseMatrix,X=b.Spa;return d("lup",{DenseMatrix:function(a){return e(a)},SparseMatrix:function(a){return f(a)},Array:function(a){a=h(a);a=e(a);return{L:a.L.valueOf(),U:a.U.valueOf(),p:a.p}}})}},function(r,g,k){var y=k(17);g.name="cross";g.factory=function(b,
a,c,d){function e(a,b){var c=Math.max(y.size(a).length,y.size(b).length);a=y.squeeze(a);b=y.squeeze(b);var d=y.size(a),e=y.size(b);if(1!==d.length||1!==e.length||3!==d[0]||3!==e[0])throw new RangeError("Vectors with length 3 expected (Size A = ["+d.join(", ")+"], B = ["+e.join(", ")+"])");d=[h(m(a[1],b[2]),m(a[2],b[1])),h(m(a[2],b[0]),m(a[0],b[2])),h(m(a[0],b[1]),m(a[1],b[0]))];return 1<c?[d]:d}var f=c(k(34)),h=c(k(65)),m=c(k(47));b=d("cross",{"Matrix, Matrix":function(a,b){return f(e(a.toArray(),
b.toArray()))},"Matrix, Array":function(a,b){return f(e(a.toArray(),b))},"Array, Matrix":function(a,b){return f(e(a,b.toArray()))},"Array, Array":e});b.toTex={2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"};return b}},function(r,g,k){var y=k(17).size;g.name="dot";g.factory=function(b,a,c,d){function e(a,b){var c=y(a),d=y(b),e=c[0];if(1!==c.length||1!==d.length)throw new RangeError("Vector expected");if(c[0]!==d[0])throw new RangeError("Vectors must have equal length ("+c[0]+" != "+
d[0]+")");if(0===e)throw new RangeError("Cannot calculate the dot product of empty vectors");for(d=c=0;d<e;d++)c=f(c,h(a[d],b[d]));return c}var f=c(k(33)),h=c(k(47));b=d("dot",{"Matrix, Matrix":function(a,b){return e(a.toArray(),b.toArray())},"Matrix, Array":function(a,b){return e(a.toArray(),b)},"Array, Matrix":function(a,b){return e(a,b.toArray())},"Array, Array":e});b.toTex={2:"\\left(${args[0]}\\cdot${args[1]}\\right)"};return b}},function(r,g,k){var y=k(4).clone,b=k(18).format;g.name="transpose";
g.factory=function(a,c,d,e){c=k(36);var f=d(k(34)),h=a.DenseMatrix,m=a.SparseMatrix,u=e("transpose",{Array:function(a){return u(f(a)).valueOf()},Matrix:function(a){var c=a.size(),d;switch(c.length){case 1:d=a.clone();break;case 2:var e=c[0],f=c[1];if(0===f)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+b(c)+")");switch(a.storage()){case "dense":c=a._data;d=[];for(var u,k=0;k<f;k++){u=d[k]=[];for(var g=0;g<e;g++)u[g]=y(c[g][k])}d=new h({data:d,size:[f,e],datatype:a._datatype});
break;case "sparse":c=a._values;d=a._index;u=a._ptr;for(var k=c?[]:void 0,g=[],X=[],w=[],n=0;n<e;n++)w[n]=0;var B,n=0;for(B=d.length;n<B;n++)w[d[n]]++;for(B=n=0;B<e;B++)X.push(n),n+=w[B],w[B]=X[B];X.push(n);for(n=0;n<f;n++){B=u[n+1];for(var z=u[n];z<B;z++){var r=w[d[z]]++;g[r]=n;c&&(k[r]=y(c[z]))}}d=new m({values:k,index:g,ptr:X,size:[f,e],datatype:a._datatype})}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+b(this._size)+")");}return d},any:function(a){return y(a)}});
u.toTex={1:"\\left(${args[0]}\\right)".concat(c.operators.transpose)};return u}},function(r,g,k){var y=Array.isArray;g.name="lusolve";g.factory=function(b,a,c,d){function e(a,b,c,d,e){a=p(a);b=p(b);e=g(a,e,!1);c&&(e._data=u(c,e._data));a=q(a,e);b=v(b,a);d&&(b._data=u(d,b._data));return b}var f=c(k(34)),h=c(k(67)),m=c(k(72)),u=c(k(91)),g=c(k(92)),v=c(k(93)),q=c(k(94)),p=function(a){if(b.isMatrix(a))return a;if(y(a))return f(a);throw new TypeError("Invalid Matrix LU decomposition");};return d("lusolve",
{"Array, Array | Matrix":function(a,b){a=f(a);var c=h(a);return e(c.L,c.U,c.p,null,b).valueOf()},"DenseMatrix, Array | Matrix":function(a,b){var c=h(a);return e(c.L,c.U,c.p,null,b)},"SparseMatrix, Array | Matrix":function(a,b){var c=h(a);return e(c.L,c.U,c.p,null,b)},"SparseMatrix, Array | Matrix, number, number":function(a,b,c,d){a=m(a,c,d);return e(a.L,a.U,a.p,a.q,b)},"Object, Array | Matrix":function(a,b){return e(a.L,a.U,a.p,a.q,b)}})}},function(r,g,k){var y=k(16).number.isInteger;g.name="slu";
g.factory=function(b,a,c,d){var e=c(k(73)),f=c(k(83));return d("slu",{"SparseMatrix, number, number":function(a,b,c){if(!y(b)||0>b||3<b)throw Error("Symbolic Ordering and Analysis order must be an integer number in the interval [0, 3]");if(0>c||1<c)throw Error("Partial pivoting threshold must be a number from 0 to 1");b=e(b,a,!1);a=f(a,b,c);return{L:a.L,U:a.U,p:a.pinv,q:b.q,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\np: "+this.p.toString()+(this.q?"\nq: "+this.q.toString():
"")+"\n"}}}})}},function(r,g,k){g.name="csSqr";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(74)),d=a(k(78)),e=a(k(79)),f=a(k(80)),h=a(k(81));return function(a,b,k){var g=b._ptr,q=b._size[1],p={};p.q=c(a,b);if(a&&!p.q)return null;if(k){k=a?d(b,null,p.q,0):b;p.parent=e(k,1);a=f(p.parent,q);p.cp=h(k,p.parent,a,1);if(a=k&&p.parent&&p.cp){a=k._ptr;b=k._index;g=k._size;k=g[0];g=g[1];p.pinv=[];p.leftmost=[];var l=p.parent,t=p.pinv,s=p.leftmost,x=[],r=k+g,w=k+2*g,n,B,z;for(B=0;B<g;B++)x[k+
B]=-1,x[r+B]=-1,x[w+B]=0;for(n=0;n<k;n++)s[n]=-1;for(B=g-1;0<=B;B--)for(z=a[B],n=a[B+1];z<n;z++)s[b[z]]=B;for(n=k-1;0<=n;n--)t[n]=-1,B=s[n],-1!==B&&(0===x[w+B]++&&(x[r+B]=n),x[0+n]=x[k+B],x[k+B]=n);p.lnz=0;p.m2=k;for(B=0;B<g;B++)n=x[k+B],p.lnz++,0>n&&(n=p.m2++),t[n]=B,0>=--w[B]||(p.lnz+=x[w+B],a=l[B],-1!==a&&(0===x[w+a]&&(x[r+a]=x[r+B]),x[0+x[r+B]]=x[k+a],x[k+a]=x[0+n],x[w+a]+=x[w+B]));for(n=0;n<k;n++)0>t[n]&&(t[n]=B++);a=!0}if(a)for(a=p.unz=0;a<q;a++)p.unz+=p.cp[a]}else p.unz=4*g[q]+q,p.lnz=p.unz;
return p}}},function(r,g,k){g.name="csAmd";g.path="algebra.sparse";g.factory=function(g,b,a){function c(a,b,c,d,e){if(2>a||0>a+b){for(a=0;a<e;a++)0!==c[d+a]&&(c[d+a]=1);a=2}return a}function d(a,b){return a!==b}var e=a(k(75)),f=a(k(76)),h=a(k(77)),m=a(k(33)),u=a(k(47)),E=a(k(70));return function(a,b){if(!b||0>=a||3<a)return null;var p=b._size,l=p[0],p=p[1],k=0,g=Math.max(16,10*Math.sqrt(p)),g=Math.min(p-2,g),x;var r=b;x=g;var w=E(r);if(1===a&&p===l)x=m(r,w);else{if(2===a){for(var r=w._index,n=w._ptr,
B=0,z=0;z<l;z++){var y=n[z];n[z]=B;if(!(n[z+1]-y>x))for(var I=n[z+1];y<I;y++)r[B++]=r[y]}n[l]=B;r=E(w)}x=u(w,r)}f(x,d,null);l=x._index;x=x._ptr;var w=x[p],r=[],n=[],B=p+1,z=2*(p+1),y=3*(p+1),I=4*(p+1),L=5*(p+1),F=6*(p+1),O=7*(p+1),M;for(M=0;M<p;M++)n[0+M]=x[M+1]-x[M];for(M=n[0+p]=0;M<=p;M++)n[y+M]=-1,r[M]=-1,n[z+M]=-1,n[O+M]=-1,n[B+M]=1,n[F+M]=1,n[I+M]=0,n[L+M]=n[0+M];M=c(0,0,n,F,p);n[I+p]=-2;x[p]=-1;for(var R=n[F+p]=0,D=0;D<p;D++){var H=n[L+D];if(0===H)n[I+D]=-2,R++,x[D]=-1,n[F+D]=0;else if(H>g)n[B+
D]=0,n[I+D]=-1,R++,x[D]=e(p),n[B+p]++;else{var S=n[y+H];-1!==S&&(r[S]=D);n[z+D]=n[y+H];n[y+H]=D}}for(var g=R,R=0,C,Q,J,K,G,P,U;g<p;){for(H=-1;R<p&&-1===(H=n[y+R]);R++);-1!==n[z+H]&&(r[n[z+H]]=-1);n[y+R]=n[z+H];var S=n[I+H],W=n[B+H],g=g+W,aa=0;n[B+H]=-W;var T=x[H],oa=0===S?T:w,sa=oa;for(Q=1;Q<=S+1;Q++){Q>S?(C=H,K=T,G=n[0+H]-S):(C=l[T++],K=x[C],G=n[0+C]);for(J=1;J<=G;J++)D=l[K++],0>=(P=n[B+D])||(aa+=P,n[B+D]=-P,l[sa++]=D,-1!==n[z+D]&&(r[n[z+D]]=r[D]),-1!==r[D]?n[z+r[D]]=n[z+D]:n[y+n[L+D]]=n[z+D]);C!==
H&&(x[C]=e(H),n[F+C]=0)}0!==S&&(w=sa);n[L+H]=aa;x[H]=oa;n[0+H]=sa-oa;n[I+H]=-2;M=c(M,k,n,F,p);for(Q=oa;Q<sa;Q++)if(D=l[Q],!(0>=(J=n[I+D])))for(P=-n[B+D],K=M-P,T=x[D],G=x[D]+J-1;T<=G;T++)C=l[T],n[F+C]>=M?n[F+C]-=P:0!==n[F+C]&&(n[F+C]=n[L+C]+K);for(Q=oa;Q<sa;Q++){D=l[Q];G=x[D];U=G+n[I+D]-1;P=G;J=K=0;for(T=G;T<=U;T++)if(C=l[T],0!==n[F+C]){var da=n[F+C]-M;0<da?(J+=da,l[P++]=C,K+=C):(x[C]=e(H),n[F+C]=0)}n[I+D]=P-G+1;for(var da=P,Ja=G+n[0+D],T=U+1;T<Ja;T++)C=l[T],U=n[B+C],0>=U||(J+=U,l[P++]=C,K+=C);0===
J?(x[D]=e(H),P=-n[B+D],aa-=P,W+=P,g+=P,n[B+D]=0,n[I+D]=-1):(n[L+D]=Math.min(n[L+D],J),l[P]=l[da],l[da]=l[G],l[G]=H,n[0+D]=P-G+1,K=(0>K?-K:K)%p,n[z+D]=n[O+K],n[O+K]=D,r[D]=K)}n[L+H]=aa;k=Math.max(k,aa);M=c(M+k,k,n,F,p);for(Q=oa;Q<sa;Q++)if(D=l[Q],!(0<=n[B+D]))for(K=r[D],D=n[O+K],n[O+K]=-1;-1!==D&&-1!==n[z+D];D=n[z+D],M++){G=n[0+D];J=n[I+D];for(T=x[D]+1;T<=x[D]+G-1;T++)n[F+l[T]]=M;P=D;for(C=n[z+D];-1!==C;){K=n[0+C]===G&&n[I+C]===J;for(T=x[C]+1;K&&T<=x[C]+G-1;T++)n[F+l[T]]!==M&&(K=0);K?(x[C]=e(D),n[B+
D]+=n[B+C],n[B+C]=0,n[I+C]=-1,C=n[z+C],n[z+P]=C):(P=C,C=n[z+C])}}for(Q=T=oa;Q<sa;Q++)D=l[Q],0>=(P=-n[B+D])||(n[B+D]=P,J=n[L+D]+aa-P,J=Math.min(J,p-g-P),-1!==n[y+J]&&(r[n[y+J]]=D),n[z+D]=n[y+J],r[D]=-1,n[y+J]=D,R=Math.min(R,J),n[L+D]=J,l[T++]=D);n[B+H]=W;0===(n[0+H]=T-oa)&&(x[H]=-1,n[F+H]=0);0!==S&&(w=T)}for(D=0;D<p;D++)x[D]=e(x[D]);for(C=0;C<=p;C++)n[y+C]=-1;for(C=p;0<=C;C--)0<n[B+C]||(n[z+C]=n[y+x[C]],n[y+x[C]]=C);for(C=p;0<=C;C--)0>=n[B+C]||-1===x[C]||(n[z+C]=n[y+x[C]],n[y+x[C]]=C);for(D=H=0;D<=
p;D++)-1===x[D]&&(H=h(D,H,n,y,z,r,F));r.splice(r.length-1,1);return r}}},function(r,g){g.name="csFlip";g.path="algebra.sparse";g.factory=function(){return function(k){return-k-2}}},function(r,g){g.name="csFkeep";g.path="algebra.sparse";g.factory=function(){return function(k,g,b){var a=k._values,c=k._index,d=k._ptr;k=k._size[1];for(var e=0,f=0;f<k;f++){var h=d[f];for(d[f]=e;h<d[f+1];h++)g(c[h],f,a?a[h]:1,b)&&(c[e]=c[h],a&&(a[e]=a[h]),e++)}d[k]=e;c.splice(e,c.length-e);a&&a.splice(e,a.length-e);return e}}},
function(r,g){g.name="csTdfs";g.path="algebra.sparse";g.factory=function(){return function(k,g,b,a,c,d,e){var f=0;for(b[e]=k;0<=f;){k=b[e+f];var h=b[a+k];-1===h?(f--,d[g++]=k):(b[a+k]=b[c+h],++f,b[e+f]=h)}return g}}},function(r,g){g.name="csPermute";g.path="algebra.sparse";g.factory=function(k){var g=k.SparseMatrix;return function(b,a,c,d){var e=b._values,f=b._index,h=b._ptr,m=b._size,u=b._datatype,k=m[0],m=m[1];b=d&&b._values?[]:null;d=[];for(var v=[],q=0,p=0;p<m;p++){v[p]=q;for(var l=c?c[p]:p,t=
h[l+1],l=h[l];l<t;l++)d[q]=a?a[f[l]]:f[l],b&&(b[q]=e[l]),q++}v[m]=q;return new g({values:b,index:d,ptr:v,size:[k,m],datatype:u})}}},function(r,g){g.name="csEtree";g.path="algebra.sparse";g.factory=function(){return function(k,g){if(!k)return null;var b=k._index,a=k._ptr,c=k._size,d=c[0],c=c[1],e=[],f=[],h;if(g)for(h=0;h<d;h++)f[c+h]=-1;for(var m=0;m<c;m++){e[m]=-1;f[0+m]=-1;for(var u=a[m+1],E=a[m];E<u;E++){var v=b[E];for(h=g?f[c+v]:v;-1!==h&&h<m;h=d)d=f[0+h],f[0+h]=m,-1===d&&(e[h]=m);g&&(f[c+v]=m)}}return e}}},
function(r,g,k){g.name="csPost";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(77));return function(a,b){if(!a)return null;var f=0,h,m=[],u=[],k=2*b;for(h=0;h<b;h++)u[0+h]=-1;for(h=b-1;0<=h;h--)-1!==a[h]&&(u[b+h]=u[0+a[h]],u[0+a[h]]=h);for(h=0;h<b;h++)-1===a[h]&&(f=c(h,f,u,0,b,m,k));return m}}},function(r,g,k){g.name="csCounts";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(70)),d=a(k(82));return function(a,b,h,m){if(!a||!b||!h)return null;var u=a._size,k=u[0],u=u[1],g,q,
p,l,t=4*u+(m?u+k+1:0),s=[],x=2*u,r=3*u,w=4*u,n=5*u+1;for(p=0;p<t;p++)s[p]=-1;t=[];p=c(a);a=p._index;var y=p._ptr;for(p=0;p<u;p++)for(q=h[p],t[q]=-1===s[r+q]?1:0;-1!==q&&-1===s[r+q];q=b[q])s[r+q]=p;if(m){for(p=0;p<u;p++)s[h[p]]=p;for(g=0;g<k;g++){p=u;l=y[g];for(q=y[g+1];l<q;l++)p=Math.min(p,s[a[l]]);s[n+g]=s[w+p];s[w+p]=g}}for(g=0;g<u;g++)s[0+g]=g;for(p=0;p<u;p++){q=h[p];-1!==b[q]&&t[b[q]]--;for(k=m?s[w+p]:q;-1!==k;k=m?s[n+k]:-1)for(l=y[k];l<y[k+1];l++)g=a[l],g=d(g,q,s,r,u,x,0),1<=g.jleaf&&t[q]++,
2===g.jleaf&&t[g.q]--; -1!==b[q]&&(s[0+q]=b[q])}for(q=0;q<u;q++)-1!==b[q]&&(t[b[q]]+=t[q]);return t}}},function(r,g){g.name="csLeaf";g.path="algebra.sparse";g.factory=function(){return function(k,g,b,a,c,d,e){var f=0;if(k<=g||b[a+g]<=b[c+k])return-1;b[c+k]=b[a+g];a=b[d+k];b[d+k]=g;if(-1===a)f=1;else{f=2;for(k=a;k!==b[e+k];k=b[e+k]);for(g=a;g!==k;g=d)d=b[e+g],b[e+g]=k}return{jleaf:f,q:k}}}},function(r,g,k){g.name="csLu";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(32)),d=a(k(59)),e=
a(k(47)),f=a(k(53)),h=a(k(84)),m=a(k(85)),u=g.SparseMatrix;return function(a,b,k){if(!a)return null;var p=a._size[1],l,g=100,s=100;b&&(l=b.q);b=[];var x=[],r=[],w=new u({values:b,index:x,ptr:r,size:[p,p]}),n=[],B=[],z=[],y=new u({values:n,index:B,ptr:z,size:[p,p]}),I=[],L,F,O=[],M=[];for(L=0;L<p;L++)O[L]=0,I[L]=-1,r[L+1]=0;for(var R=s=g=0;R<p;R++){r[R]=g;z[R]=s;var D=l?l[R]:R,H=m(w,a,D,M,O,I,1),S=-1,C=-1;for(F=H;F<p;F++)if(L=M[F],0>I[L]){var Q=c(O[L]);f(Q,C)&&(C=Q,S=L)}else B[s]=I[L],n[s++]=O[L];
if(-1===S||0>=C)return null;0>I[D]&&h(c(O[D]),e(C,k))&&(S=D);D=O[S];B[s]=R;n[s++]=D;I[S]=R;x[g]=S;b[g++]=1;for(F=H;F<p;F++)L=M[F],0>I[L]&&(x[g]=L,b[g++]=d(O[L],D)),O[L]=0}r[p]=g;z[p]=s;for(F=0;F<g;F++)x[F]=I[x[F]];b.splice(g,b.length-g);x.splice(g,x.length-g);n.splice(s,n.length-s);B.splice(s,B.length-s);return{L:w,U:y,pinv:I}}}},function(r,g,k){var y=k(8).nearlyEqual,b=k(41);g.name="largerEq";g.factory=function(a,c,d,e){var f=d(k(34)),h=d(k(54)),m=d(k(55)),u=d(k(56)),g=d(k(43)),v=d(k(44));a=k(36);
var q=e("largerEq",{"boolean, boolean":function(a,b){return a>=b},"number, number":function(a,b){return a>=b||y(a,b,c.epsilon)},"BigNumber, BigNumber":function(a,d){return a.gte(d)||b(a,d,c.epsilon)},"Fraction, Fraction":function(a,b){return-1!==a.compare(b)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers");},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return q(a.value,b.value)},"SparseMatrix, SparseMatrix":function(a,
b){return m(a,b,q)},"SparseMatrix, DenseMatrix":function(a,b){return h(b,a,q,!0)},"DenseMatrix, SparseMatrix":function(a,b){return h(a,b,q,!1)},"DenseMatrix, DenseMatrix":function(a,b){return g(a,b,q)},"Array, Array":function(a,b){return q(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return q(f(a),b)},"Matrix, Array":function(a,b){return q(a,f(b))},"SparseMatrix, any":function(a,b){return u(a,b,q,!1)},"DenseMatrix, any":function(a,b){return v(a,b,q,!1)},"any, SparseMatrix":function(a,b){return u(b,
a,q,!0)},"any, DenseMatrix":function(a,b){return v(b,a,q,!0)},"Array, any":function(a,b){return v(f(a),b,q,!1).valueOf()},"any, Array":function(a,b){return v(f(b),a,q,!0).valueOf()}});q.toTex={2:"\\left(${args[0]}".concat(a.operators.largerEq,"${args[1]}\\right)")};return q}},function(r,g,k){g.name="csSpsolve";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(59)),d=a(k(47)),e=a(k(65)),f=a(k(86));return function(a,b,u,g,k,q,p){var l=a._values,t=a._index,s=a._ptr,x=a._size[1],r=b._values,
w=b._index,n=b._ptr;for(b=a=f(a,b,u,g,q);b<x;b++)k[g[b]]=0;b=n[u];for(u=n[u+1];b<u;b++)k[w[b]]=r[b];for(r=a;r<x;r++)if(w=g[r],u=q?q[w]:w,!(0>u))for(b=s[u],u=s[u+1],k[w]=c(k[w],l[p?b:u-1]),b=p?b+1:b,u=p?u:u-1;b<u;b++)n=t[b],k[n]=e(k[n],d(l[b],k[w]));return a}}},function(r,g,k){g.name="csReach";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(87)),d=a(k(88)),e=a(k(89));return function(a,b,m,u,g){var k=a._ptr,q=b._index,p=b._ptr;b=a._size[1];var l,t=b;l=p[m];for(m=p[m+1];l<m;l++)p=q[l],d(k,
p)||(t=c(p,a,t,u,g));for(l=t;l<b;l++)e(k,u[l]);return t}}},function(r,g,k){g.name="csDfs";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(88)),d=a(k(89)),e=a(k(90));return function(a,b,m,u,g){var k=b._index,q=b._ptr;b=b._size[1];var p,l,t,s=0;for(u[0]=a;0<=s;){a=u[s];p=g?g[a]:a;c(q,a)||(d(q,a),u[b+s]=0>p?0:e(q[p]));var x=1;l=u[b+s];for(t=0>p?0:e(q[p+1]);l<t;l++)if(p=k[l],!c(q,p)){u[b+s]=l;u[++s]=p;x=0;break}x&&(s--,u[--m]=a)}return m}}},function(r,g){g.name="csMarked";g.path="algebra.sparse";
g.factory=function(){return function(g,r){return 0>g[r]}}},function(r,g,k){g.name="csMark";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(75));return function(a,b){a[b]=c(a[b])}}},function(r,g,k){g.name="csUnflip";g.path="algebra.sparse";g.factory=function(g,b,a){var c=a(k(75));return function(a){return 0>a?c(a):a}}},function(r,g){g.name="csIpvec";g.path="algebra.sparse";g.factory=function(){return function(g,r){var b,a=r.length,c=[];if(g)for(b=0;b<a;b++)c[g[b]]=r[b];else for(b=0;b<a;b++)c[b]=
r[b];return c}}},function(r,g,k){r=k(16);var y=r.string,b=r.array,a=Array.isArray;g.factory=function(c){var d=c.DenseMatrix;return function(e,f,h){var m=e.size();if(2!==m.length)throw new RangeError("Matrix must be two dimensional (size: "+y.format(m)+")");e=m[0];if(e!==m[1])throw new RangeError("Matrix must be square (size: "+y.format(m)+")");var u;if(c.isMatrix(f)){m=f.size();if(1===m.length){if(m[0]!==e)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");h=[];u=
f._data;for(m=0;m<e;m++)h[m]=[u[m]];return new d({data:h,size:[e,1],datatype:f._datatype})}if(2===m.length){if(m[0]!==e||1!==m[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");if(c.isDenseMatrix(f)){if(h){h=[];u=f._data;for(m=0;m<e;m++)h[m]=[u[m][0]];return new d({data:h,size:[e,1],datatype:f._datatype})}return f}h=[];for(m=0;m<e;m++)h[m]=[0];u=f._values;for(var g=f._index,m=f._ptr,k=m[1],q=m[0];q<k;q++)m=g[q],h[m][0]=u[q];return new d({data:h,size:[e,1],datatype:f._datatype})}throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");
}if(a(f)){h=b.size(f);if(1===h.length){if(h[0]!==e)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");h=[];for(m=0;m<e;m++)h[m]=[f[m]];return new d({data:h,size:[e,1]})}if(2===h.length){if(h[0]!==e||1!==h[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");h=[];for(m=0;m<e;m++)h[m]=[f[m][0]];return new d({data:h,size:[e,1]})}throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");}}}},function(r,g,k){g.name=
"usolve";g.factory=function(g,b,a,c){function d(a,b){b=E(a,b,!0);for(var c=b._data,d=a._size[0],e=[],g=a._data,k=a._size[1]-1;0<=k;k--){var w=c[k][0]||0,n=void 0;if(u(w,0))n=0;else{n=g[k][k];if(u(n,0))throw Error("Linear system cannot be solved since matrix is singular");n=f(w,n);for(w=k-1;0<=w;w--)c[w]=[m(c[w][0]||0,h(n,g[w][k]))]}e[k]=[n]}return new v({data:e,size:[d,1]})}var e=a(k(34)),f=a(k(59)),h=a(k(48)),m=a(k(65)),u=a(k(40)),E=a(k(92)),v=g.DenseMatrix;return c("usolve",{"SparseMatrix, Array | Matrix":function(a,
b){var c;c=E(a,b,!0);c=c._data;for(var d=a._size[0],e=a._values,g=a._index,k=a._ptr,w,n,r=[],z=a._size[1]-1;0<=z;z--){var y=c[z][0]||0;if(u(y,0))r[z]=[0];else{var I=0,L=[],F=[],O=k[z],M=k[z+1];for(n=M-1;n>=O;n--)w=g[n],w===z?I=e[n]:w<z&&(L.push(e[n]),F.push(w));if(u(I,0))throw Error("Linear system cannot be solved since matrix is singular");y=f(y,I);n=0;for(M=F.length;n<M;n++)w=F[n],c[w]=[m(c[w][0],h(y,L[n]))];r[z]=[y]}}return new v({data:r,size:[d,1]})},"DenseMatrix, Array | Matrix":function(a,b){return d(a,
b)},"Array, Array | Matrix":function(a,b){var c=e(a);return d(c,b).valueOf()}})}},function(r,g,k){g.name="lsolve";g.factory=function(g,b,a,c){function d(a,b){b=E(a,b,!0);for(var c=b._data,d=a._size[0],e=a._size[1],g=[],k=a._data,w=0;w<e;w++){var n=c[w][0]||0,r=void 0;if(u(n,0))r=0;else{r=k[w][w];if(u(r,0))throw Error("Linear system cannot be solved since matrix is singular");r=f(n,r);for(n=w+1;n<d;n++)c[n]=[m(c[n][0]||0,h(r,k[n][w]))]}g[w]=[r]}return new v({data:g,size:[d,1]})}var e=a(k(34)),f=a(k(59)),
h=a(k(48)),m=a(k(65)),u=a(k(40)),E=a(k(92)),v=g.DenseMatrix;return c("lsolve",{"SparseMatrix, Array | Matrix":function(a,b){var c;c=E(a,b,!0);c=c._data;for(var d=a._size[0],e=a._size[1],g=a._values,k=a._index,w=a._ptr,n,r,z=[],y=0;y<e;y++){var I=c[y][0]||0;if(u(I,0))z[y]=[0];else{var L=0,F=[],O=[],M=w[y+1];for(r=w[y];r<M;r++)n=k[r],n===y?L=g[r]:n>y&&(F.push(g[r]),O.push(n));if(u(L,0))throw Error("Linear system cannot be solved since matrix is singular");I=f(I,L);r=0;for(M=O.length;r<M;r++)n=O[r],
c[n]=[m(c[n][0]||0,h(I,F[r]))];z[y]=[I]}}return new v({data:z,size:[d,1]})},"DenseMatrix, Array | Matrix":function(a,b){return d(a,b)},"Array, Array | Matrix":function(a,b){var c=e(a);return d(c,b).valueOf()}})}}])})},function(ga,$,Y){var r,g,k;(function(y){function b(a){return"[object Function]"===M.call(a)}function a(a){return"[object Array]"===M.call(a)}function c(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function d(a,b){if(a){var c;for(c=a.length-1;-1<c&&(!a[c]||!b(a[c],
c,a));c-=1);}}function e(a,b){return R.call(a,b)}function f(a,b){return e(a,b)&&a[b]}function h(a,b){for(var c in a)if(e(a,c)&&b(a[c],c))break}function m(c,d,f,l){d&&h(d,function(d,h){if(f||!e(c,h))!l||"object"!==typeof d||!d||a(d)||b(d)||d instanceof RegExp?c[h]=d:(c[h]||(c[h]={}),m(c[h],d,f,l))});return c}function u(a,b){return function(){return b.apply(a,arguments)}}function E(a){throw a;}function v(a){if(!a)return a;var b=y;c(a.split("."),function(a){b=b[a]});return b}function q(a,b,c,d){b=Error(b+
"\nhttp://requirejs.org/docs/errors.html#"+a);b.requireType=a;b.requireModules=d;c&&(b.originalError=c);return b}function p(p){function g(a,b,c){var d,e,h,l,m,p,u,k;b=b&&b.split("/");var n=ca.map,t=n&&n["*"];if(a){a=a.split("/");e=a.length-1;ca.nodeIdCompat&&F.test(a[e])&&(a[e]=a[e].replace(F,""));"."===a[0].charAt(0)&&b&&(e=b.slice(0,b.length-1),a=e.concat(a));e=a;for(h=0;h<e.length;h++)(l=e[h],"."===l)?(e.splice(h,1),h-=1):".."===l&&0!==h&&(1!==h||".."!==e[2])&&".."!==e[h-1]&&0<h&&(e.splice(h-1,
2),h-=2);a=a.join("/")}if(c&&n&&(b||t)){e=a.split("/");h=e.length;a:for(;0<h;h-=1){m=e.slice(0,h).join("/");if(b)for(l=b.length;0<l;l-=1)if(c=f(n,b.slice(0,l).join("/")))if(c=f(c,m)){d=c;p=h;break a}!u&&t&&f(t,m)&&(u=f(t,m),k=h)}!d&&u&&(d=u,p=k);d&&(e.splice(0,p,d),a=e.join("/"))}return(d=f(ca.pkgs,a))?d:a}function k(a){D&&c(document.getElementsByTagName("script"),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===Z.contextName)return b.parentNode.removeChild(b),
!0})}function t(b){var c=f(ca.paths,b);if(c&&a(c)&&1<c.length)return c.shift(),Z.require.undef(b),Z.makeRequire(null,{skipMap:!0})([b]),!0}function s(a){var b,c=a?a.indexOf("!"):-1;-1<c&&(b=a.substring(0,c),a=a.substring(c+1,a.length));return[b,a]}function x(a,b,c,d){var e,h,l=null,m=b?b.name:null,p=a,u=!0,k="";a||(u=!1,a="_@r"+(ga+=1));a=s(a);l=a[0];a=a[1];l&&(l=g(l,m,d),h=f(ba,l));a&&(l?k=h&&h.normalize?h.normalize(a,function(a){return g(a,m,d)}):-1===a.indexOf("!")?g(a,m,d):a:(k=g(a,m,d),a=s(k),
l=a[0],k=a[1],c=!0,e=Z.nameToUrl(k)));c=!l||h||c?"":"_unnormalized"+(xa+=1);return{prefix:l,name:k,parentMap:b,unnormalized:!!c,url:e,originalName:p,isDefine:u,id:(l?l+"!"+k:k)+c}}function w(a){var b=a.id,c=f(ea,b);c||(c=ea[b]=new Z.Module(a));return c}function z(a,b,c){var d=a.id,h=f(ea,d);if(!e(ba,d)||h&&!h.defineEmitComplete)if(h=w(a),h.error&&"error"===b)c(h.error);else h.on(b,c);else"defined"===b&&c(ba[d])}function r(a,b){var d=a.requireModules,e=!1;if(b)b(a);else if(c(d,function(b){if(b=f(ea,
b))b.error=a,b.events.error&&(e=!0,b.emit("error",a))}),!e)l.onError(a)}function J(){K.length&&(c(K,function(a){var b=a[0];"string"===typeof b&&(Z.defQueueMap[b]=!0);la.push(a)}),K=[])}function I(a){delete ea[a];delete Y[a]}function B(a,b,d){var e=a.map.id;a.error?a.emit("error",a.error):(b[e]=!0,c(a.depMaps,function(c,e){var h=c.id,l=f(ea,h);l&&!a.depMatched[e]&&!d[h]&&(f(b,h)?(a.defineDep(e,ba[h]),a.check()):B(l,b,d))}),d[e]=!0)}function X(){var a,b,d=(a=1E3*ca.waitSeconds)&&Z.startTime+a<(new Date).getTime(),
e=[],f=[],l=!1,m=!0;if(!R){R=!0;h(Y,function(a){var c=a.map,h=c.id;if(a.enabled&&(c.isDefine||f.push(a),!a.error))if(!a.inited&&d)t(h)?l=b=!0:(e.push(h),k(h));else if(!a.inited&&a.fetched&&c.isDefine&&(l=!0,!c.prefix))return m=!1});if(d&&e.length)return a=q("timeout","Load timeout for modules: "+e,null,e),a.contextName=Z.contextName,r(a);m&&c(f,function(a){B(a,{},{})});d&&!b||!l||!D&&!H||qa||(qa=setTimeout(function(){qa=0;X()},50));R=!1}}function N(a){e(ba,a[0])||w(x(a[0],null,!0)).init(a[1],a[2])}
function L(a){a=a.currentTarget||a.srcElement;var b=Z.onScriptLoad;a.detachEvent&&!C?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=Z.onScriptError;a.detachEvent&&!C||a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function M(){var a;for(J();la.length;){a=la.shift();if(null===a[0])return r(q("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));N(a)}Z.defQueueMap={}}var R,Q,Z,Ga,qa,ca={waitSeconds:7,baseUrl:"./",
paths:{},bundles:{},pkgs:{},shim:{},config:{}},ea={},Y={},ia={},la=[],ba={},ma={},$={},ga=1,xa=1;Ga={require:function(a){return a.require?a.require:a.require=Z.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?ba[a.map.id]=a.exports:a.exports=ba[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return f(ca.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}};Q=function(a){this.events=f(ia,
a.id)||{};this.map=a;this.shim=f(ca.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Q.prototype={init:function(a,b,c,d){d=d||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=u(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;this.ignore=d.ignore;d.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=
!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;Z.startTime=(new Date).getTime();var a=this.map;if(this.shim)Z.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;ma[a]||(ma[a]=!0,Z.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,c,d=this.map.id;c=this.depExports;
var f=this.exports,h=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(b(h)){if(this.events.error&&this.map.isDefine||l.onError!==E)try{f=Z.execCb(d,h,c,f)}catch(m){a=m}else f=Z.execCb(d,h,c,f);this.map.isDefine&&void 0===f&&((c=this.module)?f=c.exports:this.usingExports&&(f=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?
"define":"require",r(this.error=a)}else f=h;this.exports=f;if(this.map.isDefine&&!this.ignore&&(ba[d]=f,l.onResourceLoad))l.onResourceLoad(Z,this.map,this.depMaps);I(d);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else e(Z.defQueueMap,d)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,c=x(a.prefix);this.depMaps.push(c);z(c,"defined",u(this,function(c){var d,m;m=f($,this.map.id);
var p=this.map.name,k=this.map.parentMap?this.map.parentMap.name:null,n=Z.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(c.normalize&&(p=c.normalize(p,function(a){return g(a,k,!0)})||""),c=x(a.prefix+"!"+p,this.map.parentMap),z(c,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),m=f(ea,c.id)){this.depMaps.push(c);if(this.events.error)m.on("error",u(this,function(a){this.emit("error",a)}));m.enable()}}else m?(this.map.url=
Z.nameToUrl(m),this.load()):(d=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),d.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];h(ea,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&I(a.map.id)});r(a)}),d.fromText=u(this,function(c,f){var h=a.name,m=x(h),p=G;f&&(c=f);p&&(G=!1);w(m);e(ca.config,b)&&(ca.config[h]=ca.config[b]);try{l.exec(c)}catch(u){return r(q("fromtexteval","fromText eval for "+b+" failed: "+u,u,[b]))}p&&(G=!0);this.depMaps.push(m);
Z.completeLoad(h);n([h],d)}),c.load(a.name,n,d,ca))}));Z.enable(c,this);this.pluginMaps[c.id]=c},enable:function(){Y[this.map.id]=this;this.enabling=this.enabled=!0;c(this.depMaps,u(this,function(a,b){var c,d;if("string"===typeof a){a=x(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=f(Ga,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;z(a,"defined",u(this,function(a){this.undefed||(this.defineDep(b,a),this.check())}));this.errback?z(a,"error",u(this,
this.errback)):this.events.error&&z(a,"error",u(this,function(a){this.emit("error",a)}))}c=a.id;d=ea[c];!e(Ga,c)&&d&&!d.enabled&&Z.enable(a,this)}));h(this.pluginMaps,u(this,function(a){var b=f(ea,a.id);b&&!b.enabled&&Z.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){c(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};Z={config:ca,contextName:p,registry:ea,defined:ba,urlFetched:ma,defQueue:la,
defQueueMap:{},Module:Q,makeModuleMap:x,nextTick:l.nextTick,onError:r,configure:function(b){b.baseUrl&&"/"!==b.baseUrl.charAt(b.baseUrl.length-1)&&(b.baseUrl+="/");var d=ca.shim,e={paths:!0,bundles:!0,config:!0,map:!0};h(b,function(a,b){e[b]?(ca[b]||(ca[b]={}),m(ca[b],a,!0,!0)):ca[b]=a});b.bundles&&h(b.bundles,function(a,b){c(a,function(a){a!==b&&($[a]=b)})});b.shim&&(h(b.shim,function(b,c){a(b)&&(b={deps:b});!b.exports&&!b.init||b.exportsFn||(b.exportsFn=Z.makeShimExports(b));d[c]=b}),ca.shim=d);
b.packages&&c(b.packages,function(a){var b;a="string"===typeof a?{name:a}:a;b=a.name;a.location&&(ca.paths[b]=a.location);ca.pkgs[b]=a.name+"/"+(a.main||"main").replace(O,"").replace(F,"")});h(ea,function(a,b){a.inited||a.map.unnormalized||(a.map=x(b,null,!0))});(b.deps||b.callback)&&Z.require(b.deps||[],b.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(y,arguments));return b||a.exports&&v(a.exports)}},makeRequire:function(a,c){function h(d,f,m){var u,g;c.enableBuildCallback&&
f&&b(f)&&(f.__requireJsBuild=!0);if("string"===typeof d){if(b(f))return r(q("requireargs","Invalid require call"),m);if(a&&e(Ga,d))return Ga[d](ea[a.id]);if(l.get)return l.get(Z,d,a,h);u=x(d,a,!1,!0);u=u.id;return e(ba,u)?ba[u]:r(q("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+p+(a?"":". Use require([])")))}M();Z.nextTick(function(){M();g=w(x(null,a));g.skipMap=c.skipMap;g.init(d,f,m,{enabled:!0});X()});return h}c=c||{};m(h,{isBrowser:D,toUrl:function(b){var c,d=b.lastIndexOf("."),
e=b.split("/")[0];-1!==d&&("."!==e&&".."!==e||1<d)&&(c=b.substring(d,b.length),b=b.substring(0,d));return Z.nameToUrl(g(b,a&&a.id,!0),c,!0)},defined:function(b){return e(ba,x(b,a,!1,!0).id)},specified:function(b){b=x(b,a,!1,!0).id;return e(ba,b)||e(ea,b)}});a||(h.undef=function(b){J();var c=x(b,a,!0),e=f(ea,b);e.undefed=!0;k(b);delete ba[b];delete ma[c.url];delete ia[b];d(la,function(a,c){a[0]===b&&la.splice(c,1)});delete Z.defQueueMap[b];e&&(e.events.defined&&(ia[b]=e.events),I(b))});return h},enable:function(a){f(ea,
a.id)&&w(a).enable()},completeLoad:function(a){var b,c,d=f(ca.shim,a)||{},h=d.exports;for(J();la.length;){c=la.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);N(c)}Z.defQueueMap={};c=f(ea,a);if(!b&&!e(ba,a)&&c&&!c.inited){if(ca.enforceDefine&&(!h||!v(h)))return t(a)?void 0:r(q("nodefine","No define call for "+a,null,[a]));N([a,d.deps||[],d.exportsFn])}X()},nameToUrl:function(b,c,d){var e,h,m;(e=f(ca.pkgs,b))&&(b=e);if(e=f($,b))return Z.nameToUrl(e,c,d);if(l.jsExtRegExp.test(b))e=
b+(c||"");else{e=ca.paths;b=b.split("/");for(h=b.length;0<h;h-=1)if(m=b.slice(0,h).join("/"),m=f(e,m)){a(m)&&(m=m[0]);b.splice(0,h,m);break}e=b.join("/");e+=c||(/^data\:|\?/.test(e)||d?"":".js");e=("/"===e.charAt(0)||e.match(/^[\w\+\.\-]+:/)?"":ca.baseUrl)+e}return ca.urlArgs?e+((-1===e.indexOf("?")?"?":"&")+ca.urlArgs):e},load:function(a,b){l.load(Z,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||S.test((a.currentTarget||a.srcElement).readyState))n=
null,a=L(a),Z.completeLoad(a.id)},onScriptError:function(a){var b=L(a);if(!t(b.id))return r(q("scripterror","Script error for: "+b.id,a,[b.id]))}};Z.require=Z.makeRequire();return Z}var l,t,s,x,X,w,n,B,z,N,I=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,L=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,F=/\.js$/,O=/^\.\//;t=Object.prototype;var M=t.toString,R=t.hasOwnProperty,D=!("undefined"===typeof window||"undefined"===typeof navigator||!window.document),H=!D&&"undefined"!==typeof importScripts,
S=D&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,C="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),Q={},J={},K=[],G=!1;if("undefined"===typeof k){if("undefined"!==typeof g){if(b(g))return;J=g;g=void 0}"undefined"!==typeof r&&!b(r)&&(J=r,r=void 0);l=g=function(b,c,d,e){var h,m="_";!a(b)&&"string"!==typeof b&&(h=b,a(c)?(b=c,c=d,d=e):b=[]);h&&h.context&&(m=h.context);(e=f(Q,m))||(e=Q[m]=l.s.newContext(m));h&&e.configure(h);return e.require(b,c,d)};l.config=
function(a){return l(a)};l.nextTick="undefined"!==typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()};r||(r=l);l.version="2.1.20";l.jsExtRegExp=/^\/|:|\?|\.js$/;l.isBrowser=D;t=l.s={contexts:Q,newContext:p};l({});c(["toUrl","undef","defined","specified"],function(a){l[a]=function(){var b=Q._;return b.require[a].apply(b,arguments)}});D&&(s=t.head=document.getElementsByTagName("head")[0],x=document.getElementsByTagName("base")[0])&&(s=t.head=x.parentNode);l.onError=E;l.createNode=function(a){var b=
a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");b.type=a.scriptType||"text/javascript";b.charset="utf-8";b.async=!0;return b};l.load=function(a,b,c){var d=a&&a.config||{},e;if(D){e=l.createNode(d,b,c);if(d.onNodeCreated)d.onNodeCreated(e,d,b,c);e.setAttribute("data-requirecontext",a.contextName);e.setAttribute("data-requiremodule",b);!e.attachEvent||e.attachEvent.toString&&0>e.attachEvent.toString().indexOf("[native code")||C?(e.addEventListener("load",
a.onScriptLoad,!1),e.addEventListener("error",a.onScriptError,!1)):(G=!0,e.attachEvent("onreadystatechange",a.onScriptLoad));e.src=c;B=e;x?s.insertBefore(e,x):s.appendChild(e);B=null;return e}if(H)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(q("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}};D&&!J.skipDataMain&&d(document.getElementsByTagName("script"),function(a){s||(s=a.parentNode);if(X=a.getAttribute("data-main"))return z=X,J.baseUrl||(w=z.split("/"),z=w.pop(),N=w.length?
w.join("/")+"/":"./",J.baseUrl=N),z=z.replace(F,""),l.jsExtRegExp.test(z)&&(z=X),J.deps=J.deps?J.deps.concat(z):[z],!0});k=function(c,e,f){var h,m;"string"!==typeof c&&(f=e,e=c,c=null);a(e)||(f=e,e=null);!e&&b(f)&&(e=[],f.length&&(f.toString().replace(I,"").replace(L,function(a,b){e.push(b)}),e=(1===f.length?["require"]:["require","exports","module"]).concat(e)));G&&((h=B)||(n&&"interactive"===n.readyState||d(document.getElementsByTagName("script"),function(a){if("interactive"===a.readyState)return n=
a}),h=n),h&&(c||(c=h.getAttribute("data-requiremodule")),m=Q[h.getAttribute("data-requirecontext")]));m?(m.defQueue.push([c,e,f]),m.defQueueMap[c]=!0):K.push([c,e,f])};k.amd={jQuery:!0};l.exec=function(a){return eval(a)};l(J)}})(this)},function(ga,$,Y){var r,g,k;(function(y,b){!(g=[$],r=b,k="function"===typeof r?r.apply($,g):r,void 0!==k&&(ga.exports=k))})(this,function(g){var b={REVISION:"76"};!(r=b,k="function"===typeof r?r.call(g,Y,g,ga):r,void 0!==k&&(ga.exports=k));void 0===Number.EPSILON&&(Number.EPSILON=
Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b=Object(a),d=1,e=
arguments.length;d!==e;++d){var f=arguments[d];if(void 0!==f&&null!==f)for(var f=Object(f),h=Object.keys(f),m=0,u=h.length;m!==u;++m){var g=h[m],k=Object.getOwnPropertyDescriptor(f,g);void 0!==k&&k.enumerable&&(b[g]=f[g])}}return b}});b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};b.CullFaceNone=0;b.CullFaceBack=1;b.CullFaceFront=2;b.CullFaceFrontBack=3;b.FrontFaceDirectionCW=0;b.FrontFaceDirectionCCW=1;b.BasicShadowMap=0;b.PCFShadowMap=1;b.PCFSoftShadowMap=2;b.FrontSide=0;b.BackSide=1;b.DoubleSide=2;b.FlatShading=
1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=2;b.NoBlending=0;b.NormalBlending=1;b.AdditiveBlending=2;b.SubtractiveBlending=3;b.MultiplyBlending=4;b.CustomBlending=5;b.AddEquation=100;b.SubtractEquation=101;b.ReverseSubtractEquation=102;b.MinEquation=103;b.MaxEquation=104;b.ZeroFactor=200;b.OneFactor=201;b.SrcColorFactor=202;b.OneMinusSrcColorFactor=203;b.SrcAlphaFactor=204;b.OneMinusSrcAlphaFactor=205;b.DstAlphaFactor=206;b.OneMinusDstAlphaFactor=207;b.DstColorFactor=208;b.OneMinusDstColorFactor=
209;b.SrcAlphaSaturateFactor=210;b.NeverDepth=0;b.AlwaysDepth=1;b.LessDepth=2;b.LessEqualDepth=3;b.EqualDepth=4;b.GreaterEqualDepth=5;b.GreaterDepth=6;b.NotEqualDepth=7;b.MultiplyOperation=0;b.MixOperation=1;b.AddOperation=2;b.NoToneMapping=0;b.LinearToneMapping=1;b.ReinhardToneMapping=2;b.Uncharted2ToneMapping=3;b.CineonToneMapping=4;b.UVMapping=300;b.CubeReflectionMapping=301;b.CubeRefractionMapping=302;b.EquirectangularReflectionMapping=303;b.EquirectangularRefractionMapping=304;b.SphericalReflectionMapping=
305;b.CubeUVReflectionMapping=306;b.CubeUVRefractionMapping=307;b.RepeatWrapping=1E3;b.ClampToEdgeWrapping=1001;b.MirroredRepeatWrapping=1002;b.NearestFilter=1003;b.NearestMipMapNearestFilter=1004;b.NearestMipMapLinearFilter=1005;b.LinearFilter=1006;b.LinearMipMapNearestFilter=1007;b.LinearMipMapLinearFilter=1008;b.UnsignedByteType=1009;b.ByteType=1010;b.ShortType=1011;b.UnsignedShortType=1012;b.IntType=1013;b.UnsignedIntType=1014;b.FloatType=1015;b.HalfFloatType=1025;b.UnsignedShort4444Type=1016;
b.UnsignedShort5551Type=1017;b.UnsignedShort565Type=1018;b.AlphaFormat=1019;b.RGBFormat=1020;b.RGBAFormat=1021;b.LuminanceFormat=1022;b.LuminanceAlphaFormat=1023;b.RGBEFormat=b.RGBAFormat;b.DepthFormat=1026;b.RGB_S3TC_DXT1_Format=2001;b.RGBA_S3TC_DXT1_Format=2002;b.RGBA_S3TC_DXT3_Format=2003;b.RGBA_S3TC_DXT5_Format=2004;b.RGB_PVRTC_4BPPV1_Format=2100;b.RGB_PVRTC_2BPPV1_Format=2101;b.RGBA_PVRTC_4BPPV1_Format=2102;b.RGBA_PVRTC_2BPPV1_Format=2103;b.RGB_ETC1_Format=2151;b.LoopOnce=2200;b.LoopRepeat=2201;
b.LoopPingPong=2202;b.InterpolateDiscrete=2300;b.InterpolateLinear=2301;b.InterpolateSmooth=2302;b.ZeroCurvatureEnding=2400;b.ZeroSlopeEnding=2401;b.WrapAroundEnding=2402;b.TrianglesDrawMode=0;b.TriangleStripDrawMode=1;b.TriangleFanDrawMode=2;b.LinearEncoding=3E3;b.sRGBEncoding=3001;b.GammaEncoding=3007;b.RGBEEncoding=3002;b.LogLuvEncoding=3003;b.RGBM7Encoding=3004;b.RGBM16Encoding=3005;b.RGBDEncoding=3006;b.BasicDepthPacking=3200;b.RGBADepthPacking=3201;b.Color=function(a){return 3===arguments.length?
this.fromArray(arguments):this.set(a)};b.Color.prototype={constructor:b.Color,r:1,g:1,b:1,set:function(a){a instanceof b.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,d){this.r=a;this.g=b;this.b=d;return this},setHSL:function(){function a(a,b,e){0>e&&(e+=1);1<e&&(e-=
1);return e<1/6?a+6*(b-a)*e:.5>e?b:e<2/3?a+6*(b-a)*(2/3-e):a}return function(c,d,e){c=b.Math.euclideanModulo(c,1);d=b.Math.clamp(d,0,1);e=b.Math.clamp(e,0,1);0===d?this.r=this.g=this.b=e:(d=.5>=e?e*(1+d):e+d-e*d,e=2*e-d,this.r=a(e,d,c+1/3),this.g=a(e,d,c),this.b=a(e,d,c-1/3));return this}}(),setStyle:function(a){function c(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var d;if(d=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var e=d[2];switch(d[1]){case "rgb":case "rgba":if(d=
/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,c(d[5]),this;if(d=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,c(d[5]),this;break;case "hsl":case "hsla":if(d=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e)){var e=
parseFloat(d[1])/360,f=parseInt(d[2],10)/100,h=parseInt(d[3],10)/100;c(d[5]);return this.setHSL(e,f,h)}}}else if(d=/^\#([A-Fa-f0-9]+)$/.exec(a)){d=d[1];e=d.length;if(3===e)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,this}a&&0<a.length&&
(d=b.ColorKeywords[a],void 0!==d?this.setHex(d):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var d=0<b?1/b:1;this.r=Math.pow(a.r,d);this.g=Math.pow(a.g,d);this.b=Math.pow(a.b,
d);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,d=this.b;this.r=a*a;this.g=b*b;this.b=d*d;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,d=this.g,e=this.b,f=Math.max(b,d,e),h=Math.min(b,d,e),m,u=
(h+f)/2;if(h===f)h=m=0;else{var g=f-h,h=.5>=u?g/(f+h):g/(2-f-h);switch(f){case b:m=(d-e)/g+(d<e?6:0);break;case d:m=(e-b)/g+2;break;case e:m=(b-d)/g+4}m/=6}a.h=m;a.s=h;a.l=u;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,d){var e=this.getHSL();e.h+=a;e.s+=b;e.l+=d;this.setHSL(e.h,e.s,e.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=
a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};b.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,
darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,
gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,
lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,
orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,
springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};b.Quaternion=function(a,b,d,e){this._x=a||0;this._y=b||0;this._z=d||0;this._w=void 0!==e?e:1};b.Quaternion.prototype={constructor:b.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},
set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,d,e){this._x=a;this._y=b;this._z=d;this._w=e;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,c){if(!1===a instanceof b.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var d=Math.cos(a._x/2),e=Math.cos(a._y/2),f=Math.cos(a._z/2),h=Math.sin(a._x/2),m=Math.sin(a._y/2),u=Math.sin(a._z/2),g=a.order;"XYZ"===g?(this._x=h*e*f+d*m*u,this._y=d*m*f-h*e*u,this._z=d*e*u+h*m*f,this._w=d*e*f-h*m*u):"YXZ"===g?(this._x=h*e*f+d*m*u,this._y=d*m*f-h*e*u,this._z=d*e*u-h*m*f,this._w=d*e*f+h*m*u):"ZXY"===g?(this._x=h*e*f-d*m*u,this._y=d*m*f+h*e*u,this._z=d*e*u+h*m*f,this._w=d*e*f-h*m*u):"ZYX"===g?(this._x=h*e*f-d*m*u,this._y=d*m*f+h*e*u,this._z=d*e*u-h*m*f,this._w=d*e*f+h*m*u):"YZX"===
g?(this._x=h*e*f+d*m*u,this._y=d*m*f+h*e*u,this._z=d*e*u-h*m*f,this._w=d*e*f-h*m*u):"XZY"===g&&(this._x=h*e*f-d*m*u,this._y=d*m*f-h*e*u,this._z=d*e*u+h*m*f,this._w=d*e*f+h*m*u);if(!1!==c)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){var d=b/2,e=Math.sin(d);this._x=a.x*e;this._y=a.y*e;this._z=a.z*e;this._w=Math.cos(d);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,d=b[0];a=b[4];var e=b[8],f=b[1],h=b[5],m=b[9],u=b[2],g=b[6],b=b[10],k=d+
h+b;0<k?(d=.5/Math.sqrt(k+1),this._w=.25/d,this._x=(g-m)*d,this._y=(e-u)*d,this._z=(f-a)*d):d>h&&d>b?(d=2*Math.sqrt(1+d-h-b),this._w=(g-m)/d,this._x=.25*d,this._y=(a+f)/d,this._z=(e+u)/d):h>b?(d=2*Math.sqrt(1+h-d-b),this._w=(e-u)/d,this._x=(a+f)/d,this._y=.25*d,this._z=(m+g)/d):(d=2*Math.sqrt(1+b-d-h),this._w=(f-a)/d,this._x=(e+u)/d,this._y=(m+g)/d,this._z=.25*d);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,c;return function(d,e){void 0===a&&(a=new b.Vector3);c=d.dot(e)+
1;1E-6>c?(c=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,e);this._x=a.x;this._y=a.y;this._z=a.z;this._w=c;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},
length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},
multiplyQuaternions:function(a,b){var d=a._x,e=a._y,f=a._z,h=a._w,m=b._x,u=b._y,g=b._z,k=b._w;this._x=d*k+h*m+e*g-f*u;this._y=e*k+h*u+f*m-d*g;this._z=f*k+h*g+d*u-e*m;this._w=h*k-d*m-e*u-f*g;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var d=this._x,e=this._y,f=this._z,h=this._w,m=h*a._w+d*a._x+e*a._y+f*a._z;0>m?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,m=-m):this.copy(a);if(1<=m)return this._w=h,this._x=d,this._y=e,this._z=
f,this;var u=Math.sqrt(1-m*m);if(.001>Math.abs(u))return this._w=.5*(h+this._w),this._x=.5*(d+this._x),this._y=.5*(e+this._y),this._z=.5*(f+this._z),this;var g=Math.atan2(u,m),m=Math.sin((1-b)*g)/u,u=Math.sin(b*g)/u;this._w=h*m+this._w*u;this._x=d*m+this._x*u;this._y=e*m+this._y*u;this._z=f*m+this._z*u;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];
this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(b.Quaternion,{slerp:function(a,b,d,e){return d.copy(a).slerp(b,e)},slerpFlat:function(a,b,d,e,f,h,m){var u=d[e+0],g=d[e+1],k=d[e+2];d=d[e+3];e=f[h+0];var q=f[h+1],p=f[h+2];f=f[h+3];if(d!==f||u!==e||g!==q||
k!==p){h=1-m;var l=u*e+g*q+k*p+d*f,t=0<=l?1:-1,s=1-l*l;s>Number.EPSILON&&(s=Math.sqrt(s),l=Math.atan2(s,l*t),h=Math.sin(h*l)/s,m=Math.sin(m*l)/s);t*=m;u=u*h+e*t;g=g*h+q*t;k=k*h+p*t;d=d*h+f*t;h===1-m&&(m=1/Math.sqrt(u*u+g*g+k*k+d*d),u*=m,g*=m,k*=m,d*=m)}a[b]=u;a[b+1]=g;a[b+2]=k;a[b+3]=d}});b.Vector2=function(a,b){this.x=a||0;this.y=b||0};b.Vector2.prototype={constructor:b.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=
a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;
this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,c;return function(d,e){void 0===a&&(a=new b.Vector2,c=new b.Vector2);a.set(d,d);c.set(e,e);return this.clamp(a,c)}}(),clampLength:function(a,b){var d=this.length();this.multiplyScalar(Math.max(a,Math.min(b,d))/d);return this},floor:function(){this.x=Math.floor(this.x);
this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},
length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,
b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,d){this.subVectors(b,a).multiplyScalar(d).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,
b){var d=Math.cos(b),e=Math.sin(b),f=this.x-a.x,h=this.y-a.y;this.x=f*d-h*e+a.x;this.y=f*e+h*d+a.y;return this}};b.Vector3=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0};b.Vector3.prototype={constructor:b.Vector3,set:function(a,b,d){this.x=a;this.y=b;this.z=d;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=
b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(c){!1===c instanceof b.Euler&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new b.Quaternion);this.applyQuaternion(a.setFromEuler(c));return this}}(),applyAxisAngle:function(){var a;return function(c,d){void 0===a&&(a=new b.Quaternion);this.applyQuaternion(a.setFromAxisAngle(c,d));return this}}(),applyMatrix3:function(a){var b=
this.x,d=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[3]*d+a[6]*e;this.y=a[1]*b+a[4]*d+a[7]*e;this.z=a[2]*b+a[5]*d+a[8]*e;return this},applyMatrix4:function(a){var b=this.x,d=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*e+a[12];this.y=a[1]*b+a[5]*d+a[9]*e+a[13];this.z=a[2]*b+a[6]*d+a[10]*e+a[14];return this},applyProjection:function(a){var b=this.x,d=this.y,e=this.z;a=a.elements;var f=1/(a[3]*b+a[7]*d+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*d+a[8]*e+a[12])*f;this.y=(a[1]*b+a[5]*d+a[9]*e+a[13])*
f;this.z=(a[2]*b+a[6]*d+a[10]*e+a[14])*f;return this},applyQuaternion:function(a){var b=this.x,d=this.y,e=this.z,f=a.x,h=a.y,m=a.z;a=a.w;var u=a*b+h*e-m*d,g=a*d+m*b-f*e,k=a*e+f*d-h*b,b=-f*b-h*d-m*e;this.x=u*a+b*-f+g*-m-k*-h;this.y=g*a+b*-h+k*-f-u*-m;this.z=k*a+b*-m+u*-h-g*-f;return this},project:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.multiplyMatrices(c.projectionMatrix,a.getInverse(c.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(c){void 0===
a&&(a=new b.Matrix4);a.multiplyMatrices(c.matrixWorld,a.getInverse(c.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,d=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*e;this.y=a[1]*b+a[5]*d+a[9]*e;this.z=a[2]*b+a[6]*d+a[10]*e;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,c;return function(d,e){void 0===a&&(a=new b.Vector3,c=new b.Vector3);a.set(d,d,d);c.set(e,e,e);return this.clamp(a,c)}}(),clampLength:function(a,b){var d=
this.length();this.multiplyScalar(Math.max(a,Math.min(b,d))/d);return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,d){this.subVectors(b,a).multiplyScalar(d).add(a);return this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var d=this.x,e=this.y,f=this.z;this.x=e*a.z-f*a.y;this.y=f*a.x-d*a.z;this.z=
d*a.y-e*a.x;return this},crossVectors:function(a,b){var d=a.x,e=a.y,f=a.z,h=b.x,m=b.y,u=b.z;this.x=e*u-f*m;this.y=f*h-d*u;this.z=d*m-e*h;return this},projectOnVector:function(){var a,c;return function(d){void 0===a&&(a=new b.Vector3);a.copy(d).normalize();c=this.dot(a);return this.copy(a).multiplyScalar(c)}}(),projectOnPlane:function(){var a;return function(c){void 0===a&&(a=new b.Vector3);a.copy(this).projectOnVector(c);return this.sub(a)}}(),reflect:function(){var a;return function(c){void 0===
a&&(a=new b.Vector3);return this.sub(a.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(b.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,d=this.y-a.y;a=this.z-a.z;return b*b+d*d+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);
return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),d=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=d;this.z=a;return this},setFromMatrixColumn:function(a,b){"number"===typeof a&&(console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index )."),b=a=b);return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&
a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};b.Vector4=function(a,b,d,e){this.x=a||0;this.y=b||0;this.z=d||0;this.w=void 0!==e?e:1};b.Vector4.prototype={constructor:b.Vector4,set:function(a,
b,d,e){this.x=a;this.y=b;this.z=d;this.w=e;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},
addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=
a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,d=this.y,e=this.z,f=this.w;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*e+a[12]*f;this.y=a[1]*b+a[5]*d+a[9]*e+a[13]*f;this.z=a[2]*b+a[6]*d+a[10]*e+a[14]*f;this.w=a[3]*b+a[7]*d+a[11]*e+a[15]*f;return this},
divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,d,e;a=a.elements;var f=a[0];e=a[4];var h=a[8],m=a[1],u=a[5],g=a[9];d=a[2];b=a[6];var k=a[10];if(.01>Math.abs(e-m)&&.01>Math.abs(h-d)&&.01>Math.abs(g-b)){if(.1>Math.abs(e+m)&&.1>Math.abs(h+d)&&.1>Math.abs(g+b)&&.1>Math.abs(f+
u+k-3))return this.set(1,0,0,0),this;a=Math.PI;f=(f+1)/2;u=(u+1)/2;k=(k+1)/2;e=(e+m)/4;h=(h+d)/4;g=(g+b)/4;f>u&&f>k?.01>f?(b=0,e=d=.707106781):(b=Math.sqrt(f),d=e/b,e=h/b):u>k?.01>u?(b=.707106781,d=0,e=.707106781):(d=Math.sqrt(u),b=e/d,e=g/d):.01>k?(d=b=.707106781,e=0):(e=Math.sqrt(k),b=h/e,d=g/e);this.set(b,d,e,a);return this}a=Math.sqrt((b-g)*(b-g)+(h-d)*(h-d)+(m-e)*(m-e));.001>Math.abs(a)&&(a=1);this.x=(b-g)/a;this.y=(h-d)/a;this.z=(m-e)/a;this.w=Math.acos((f+u+k-1)/2);return this},min:function(a){this.x=
Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,c;return function(d,
e){void 0===a&&(a=new b.Vector4,c=new b.Vector4);a.set(d,d,d,d);c.set(e,e,e,e);return this.clamp(a,c)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},
roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,d){this.subVectors(b,a).multiplyScalar(d).add(a);return this},equals:function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};b.Euler=function(a,c,d,e){this._x=a||0;this._y=c||0;this._z=d||
0;this._order=e||b.Euler.DefaultOrder};b.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");b.Euler.DefaultOrder="XYZ";b.Euler.prototype={constructor:b.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,d,e){this._x=a;this._y=b;this._z=
d;this._order=e||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,c,d){var e=b.Math.clamp,f=a.elements;a=f[0];var h=f[4],m=f[8],u=f[1],g=f[5],k=f[9],q=f[2],p=f[6],f=f[10];c=c||this._order;"XYZ"===c?(this._y=Math.asin(e(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(-k,f),
this._z=Math.atan2(-h,a)):(this._x=Math.atan2(p,g),this._z=0)):"YXZ"===c?(this._x=Math.asin(-e(k,-1,1)),.99999>Math.abs(k)?(this._y=Math.atan2(m,f),this._z=Math.atan2(u,g)):(this._y=Math.atan2(-q,a),this._z=0)):"ZXY"===c?(this._x=Math.asin(e(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-q,f),this._z=Math.atan2(-h,g)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===c?(this._y=Math.asin(-e(q,-1,1)),.99999>Math.abs(q)?(this._x=Math.atan2(p,f),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-h,
g))):"YZX"===c?(this._z=Math.asin(e(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(-k,g),this._y=Math.atan2(-q,a)):(this._x=0,this._y=Math.atan2(m,f))):"XZY"===c?(this._z=Math.asin(-e(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(p,g),this._y=Math.atan2(m,a)):(this._x=Math.atan2(-k,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+c);this._order=c;if(!1!==d)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(c,d,e){void 0===
a&&(a=new b.Matrix4);a.makeRotationFromQuaternion(c);this.setFromRotationMatrix(a,d,e);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new b.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();
return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new b.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};b.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
b.Matrix3.prototype={constructor:b.Matrix3,set:function(a,b,d,e,f,h,m,g,k){var v=this.elements;v[0]=a;v[1]=e;v[2]=m;v[3]=b;v[4]=f;v[5]=g;v[6]=d;v[7]=h;v[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},
applyToVector3Array:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Vector3);void 0===d&&(d=0);void 0===e&&(e=c.length);for(var f=0;f<e;f+=3,d+=3)a.fromArray(c,d),a.applyMatrix3(this),a.toArray(c,d);return c}}(),applyToBuffer:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Vector3);void 0===d&&(d=0);void 0===e&&(e=c.length/c.itemSize);for(var f=0;f<e;f++,d++)a.x=c.getX(d),a.y=c.getY(d),a.z=c.getZ(d),a.applyMatrix3(this),c.setXYZ(a.x,a.y,a.z);return c}}(),multiplyScalar:function(a){var b=
this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],d=a[1],e=a[2],f=a[3],h=a[4],m=a[5],g=a[6],k=a[7],a=a[8];return b*h*a-b*m*k-d*f*a+d*m*g+e*f*k-e*h*g},getInverse:function(a,c){a instanceof b.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var d=a.elements,e=this.elements,f=d[0],h=d[1],m=d[2],g=d[3],k=d[4],v=d[5],q=d[6],p=d[7],d=d[8],l=d*k-v*p,t=v*q-d*g,s=p*g-k*q,
x=f*l+h*t+m*s;if(0===x){if(c)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}e[0]=l;e[1]=m*p-d*h;e[2]=v*h-m*k;e[3]=t;e[4]=d*f-m*q;e[5]=m*g-v*f;e[6]=s;e[7]=h*q-p*f;e[8]=k*f-h*g;return this.multiplyScalar(1/x)},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,
b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var d=this.elements;
a[b]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];return a}};b.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};b.Matrix4.prototype={constructor:b.Matrix4,set:function(a,b,d,e,f,h,m,g,k,v,q,p,l,t,s,x){var r=this.elements;r[0]=a;r[4]=b;r[8]=d;r[12]=e;r[1]=f;r[5]=h;r[9]=m;r[13]=g;r[2]=k;r[6]=v;
r[10]=q;r[14]=p;r[3]=l;r[7]=t;r[11]=s;r[15]=x;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new b.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,d){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);d.setFromMatrixColumn(this,2);return this},makeBasis:function(a,
b,d){this.set(a.x,b.x,d.x,0,a.y,b.y,d.y,0,a.z,b.z,d.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(c){void 0===a&&(a=new b.Vector3);var d=this.elements,e=c.elements,f=1/a.setFromMatrixColumn(c,0).length(),h=1/a.setFromMatrixColumn(c,1).length();c=1/a.setFromMatrixColumn(c,2).length();d[0]=e[0]*f;d[1]=e[1]*f;d[2]=e[2]*f;d[4]=e[4]*h;d[5]=e[5]*h;d[6]=e[6]*h;d[8]=e[8]*c;d[9]=e[9]*c;d[10]=e[10]*c;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof b.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var c=this.elements,d=a.x,e=a.y,f=a.z,h=Math.cos(d),d=Math.sin(d),m=Math.cos(e),e=Math.sin(e),g=Math.cos(f),f=Math.sin(f);if("XYZ"===a.order){a=h*g;var k=h*f,v=d*g,q=d*f;c[0]=m*g;c[4]=-m*f;c[8]=e;c[1]=k+v*e;c[5]=a-q*e;c[9]=-d*m;c[2]=q-a*e;c[6]=v+k*e;c[10]=h*m}else"YXZ"===a.order?(a=m*g,k=m*f,v=e*g,q=e*f,c[0]=a+q*d,c[4]=v*d-k,c[8]=h*e,c[1]=h*f,c[5]=h*g,c[9]=-d,c[2]=k*d-v,c[6]=q+a*d,c[10]=h*m):"ZXY"===a.order?(a=m*g,k=m*f,v=e*g,q=e*f,c[0]=a-q*d,c[4]=-h*f,c[8]=v+k*d,c[1]=k+v*d,c[5]=h*g,c[9]=q-a*d,c[2]=
-h*e,c[6]=d,c[10]=h*m):"ZYX"===a.order?(a=h*g,k=h*f,v=d*g,q=d*f,c[0]=m*g,c[4]=v*e-k,c[8]=a*e+q,c[1]=m*f,c[5]=q*e+a,c[9]=k*e-v,c[2]=-e,c[6]=d*m,c[10]=h*m):"YZX"===a.order?(a=h*m,k=h*e,v=d*m,q=d*e,c[0]=m*g,c[4]=q-a*f,c[8]=v*f+k,c[1]=f,c[5]=h*g,c[9]=-d*g,c[2]=-e*g,c[6]=k*f+v,c[10]=a-q*f):"XZY"===a.order&&(a=h*m,k=h*e,v=d*m,q=d*e,c[0]=m*g,c[4]=-f,c[8]=e*g,c[1]=a*f+q,c[5]=h*g,c[9]=k*f-v,c[2]=v*f-k,c[6]=d*g,c[10]=q*f+a);c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},makeRotationFromQuaternion:function(a){var b=
this.elements,d=a.x,e=a.y,f=a.z,h=a.w,m=d+d,g=e+e,k=f+f;a=d*m;var v=d*g,d=d*k,q=e*g,e=e*k,f=f*k,m=h*m,g=h*g,h=h*k;b[0]=1-(q+f);b[4]=v-h;b[8]=d+g;b[1]=v+h;b[5]=1-(a+f);b[9]=e-m;b[2]=d-g;b[6]=e+m;b[10]=1-(a+q);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,c,d;return function(e,f,h){void 0===a&&(a=new b.Vector3);void 0===c&&(c=new b.Vector3);void 0===d&&(d=new b.Vector3);var m=this.elements;d.subVectors(e,f).normalize();0===d.lengthSq()&&(d.z=1);a.crossVectors(h,
d).normalize();0===a.lengthSq()&&(d.x+=1E-4,a.crossVectors(h,d).normalize());c.crossVectors(d,a);m[0]=a.x;m[4]=c.x;m[8]=d.x;m[1]=a.y;m[5]=c.y;m[9]=d.y;m[2]=a.z;m[6]=c.z;m[10]=d.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var d=
a.elements,e=b.elements,f=this.elements,h=d[0],m=d[4],g=d[8],k=d[12],v=d[1],q=d[5],p=d[9],l=d[13],t=d[2],s=d[6],x=d[10],r=d[14],w=d[3],n=d[7],y=d[11],d=d[15],z=e[0],N=e[4],I=e[8],L=e[12],F=e[1],O=e[5],M=e[9],R=e[13],D=e[2],H=e[6],S=e[10],C=e[14],Q=e[3],J=e[7],K=e[11],e=e[15];f[0]=h*z+m*F+g*D+k*Q;f[4]=h*N+m*O+g*H+k*J;f[8]=h*I+m*M+g*S+k*K;f[12]=h*L+m*R+g*C+k*e;f[1]=v*z+q*F+p*D+l*Q;f[5]=v*N+q*O+p*H+l*J;f[9]=v*I+q*M+p*S+l*K;f[13]=v*L+q*R+p*C+l*e;f[2]=t*z+s*F+x*D+r*Q;f[6]=t*N+s*O+x*H+r*J;f[10]=t*I+s*M+
x*S+r*K;f[14]=t*L+s*R+x*C+r*e;f[3]=w*z+n*F+y*D+d*Q;f[7]=w*N+n*O+y*H+d*J;f[11]=w*I+n*M+y*S+d*K;f[15]=w*L+n*R+y*C+d*e;return this},multiplyToArray:function(a,b,d){var e=this.elements;this.multiplyMatrices(a,b);d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=e[3];d[4]=e[4];d[5]=e[5];d[6]=e[6];d[7]=e[7];d[8]=e[8];d[9]=e[9];d[10]=e[10];d[11]=e[11];d[12]=e[12];d[13]=e[13];d[14]=e[14];d[15]=e[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=
a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Vector3);void 0===d&&(d=0);void 0===e&&(e=c.length);for(var f=0;f<e;f+=3,d+=3)a.fromArray(c,d),a.applyMatrix4(this),a.toArray(c,d);return c}}(),applyToBuffer:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Vector3);void 0===d&&(d=0);void 0===e&&(e=c.length/c.itemSize);for(var f=0;f<e;f++,d++)a.x=c.getX(d),a.y=c.getY(d),a.z=
c.getZ(d),a.applyMatrix4(this),c.setXYZ(a.x,a.y,a.z);return c}}(),determinant:function(){var a=this.elements,b=a[0],d=a[4],e=a[8],f=a[12],h=a[1],m=a[5],g=a[9],k=a[13],v=a[2],q=a[6],p=a[10],l=a[14];return a[3]*(+f*g*q-e*k*q-f*m*p+d*k*p+e*m*l-d*g*l)+a[7]*(+b*g*l-b*k*p+f*h*p-e*h*l+e*k*v-f*g*v)+a[11]*(+b*k*q-b*m*l-f*h*q+d*h*l+f*m*v-d*k*v)+a[15]*(-e*m*v-b*g*q+b*m*p+e*h*q-d*h*p+d*g*v)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];
a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new b.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=
this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var d=this.elements,e=a.elements,f=e[0],h=e[1],m=e[2],g=e[3],k=e[4],v=e[5],q=e[6],p=e[7],l=e[8],t=e[9],s=e[10],x=e[11],r=e[12],w=e[13],n=e[14],e=e[15],y=t*n*p-w*s*p+w*q*x-v*n*x-t*q*e+v*s*e,z=r*s*p-l*n*p-r*q*x+k*n*x+l*q*e-k*s*e,N=l*w*p-r*t*p+r*v*x-k*w*x-l*v*e+k*t*e,I=r*t*q-l*w*q-r*v*s+k*w*s+l*v*n-k*t*n,L=f*y+h*z+m*N+g*I;if(0===L){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}d[0]=y;d[1]=w*s*g-t*n*g-w*m*x+h*n*x+t*m*e-h*s*e;d[2]=v*n*g-w*q*g+w*m*p-h*n*p-v*m*e+h*q*e;d[3]=t*q*g-v*s*g-t*m*p+h*s*p+v*m*x-h*q*x;d[4]=z;d[5]=l*n*g-r*s*g+r*m*x-f*n*x-l*m*e+f*s*e;d[6]=r*q*g-k*n*g-r*m*p+f*n*p+k*m*e-f*q*e;d[7]=k*s*g-l*q*g+l*m*p-f*s*p-k*m*x+f*q*x;d[8]=N;d[9]=r*t*g-l*w*g-r*h*x+f*w*x+l*h*e-f*t*e;d[10]=k*w*g-r*v*g+r*h*p-f*w*p-k*h*e+f*v*e;d[11]=l*v*g-k*t*g-l*h*p+f*t*p+k*h*x-f*v*x;d[12]=I;d[13]=l*w*m-r*t*m+r*h*s-f*w*s-l*h*n+f*t*n;d[14]=r*v*m-k*w*m-r*h*q+f*w*q+k*h*n-
f*v*n;d[15]=k*t*m-l*v*m+l*h*q-f*t*q-k*h*s+f*v*s;return this.multiplyScalar(1/L)},scale:function(a){var b=this.elements,d=a.x,e=a.y;a=a.z;b[0]*=d;b[4]*=e;b[8]*=a;b[1]*=d;b[5]*=e;b[9]*=a;b[2]*=d;b[6]*=e;b[10]*=a;b[3]*=d;b[7]*=e;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,d){this.set(1,0,0,a,0,1,0,b,0,0,1,d,0,0,0,1);return this},
makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var d=Math.cos(b),e=Math.sin(b),f=1-d,h=a.x,m=a.y,g=a.z,k=f*h,v=f*m;this.set(k*h+d,k*m-e*g,k*g+e*m,0,k*m+e*g,v*m+d,v*g-e*h,0,k*g-
e*m,v*g+e*h,f*g*g+d,0,0,0,0,1);return this},makeScale:function(a,b,d){this.set(a,0,0,0,0,b,0,0,0,0,d,0,0,0,0,1);return this},compose:function(a,b,d){this.makeRotationFromQuaternion(b);this.scale(d);this.setPosition(a);return this},decompose:function(){var a,c;return function(d,e,f){void 0===a&&(a=new b.Vector3);void 0===c&&(c=new b.Matrix4);var h=this.elements,m=a.set(h[0],h[1],h[2]).length(),g=a.set(h[4],h[5],h[6]).length(),k=a.set(h[8],h[9],h[10]).length();0>this.determinant()&&(m=-m);d.x=h[12];
d.y=h[13];d.z=h[14];c.elements.set(this.elements);d=1/m;var h=1/g,v=1/k;c.elements[0]*=d;c.elements[1]*=d;c.elements[2]*=d;c.elements[4]*=h;c.elements[5]*=h;c.elements[6]*=h;c.elements[8]*=v;c.elements[9]*=v;c.elements[10]*=v;e.setFromRotationMatrix(c);f.x=m;f.y=g;f.z=k;return this}}(),makeFrustum:function(a,b,d,e,f,h){var m=this.elements;m[0]=2*f/(b-a);m[4]=0;m[8]=(b+a)/(b-a);m[12]=0;m[1]=0;m[5]=2*f/(e-d);m[9]=(e+d)/(e-d);m[13]=0;m[2]=0;m[6]=0;m[10]=-(h+f)/(h-f);m[14]=-2*h*f/(h-f);m[3]=0;m[7]=0;
m[11]=-1;m[15]=0;return this},makePerspective:function(a,c,d,e){a=d*Math.tan(b.Math.DEG2RAD*a*.5);var f=-a;return this.makeFrustum(f*c,a*c,f,a,d,e)},makeOrthographic:function(a,b,d,e,f,h){var m=this.elements,g=1/(b-a),k=1/(d-e),v=1/(h-f);m[0]=2*g;m[4]=0;m[8]=0;m[12]=-((b+a)*g);m[1]=0;m[5]=2*k;m[9]=0;m[13]=-((d+e)*k);m[2]=0;m[6]=0;m[10]=-2*v;m[14]=-((h+f)*v);m[3]=0;m[7]=0;m[11]=0;m[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var d=0;16>d;d++)if(b[d]!==a[d])return!1;return!0},
fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var d=this.elements;a[b]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];a[b+9]=d[9];a[b+10]=d[10];a[b+11]=d[11];a[b+12]=d[12];a[b+13]=d[13];a[b+14]=d[14];a[b+15]=d[15];return a}};b.Ray=function(a,c){this.origin=void 0!==a?a:new b.Vector3;this.direction=void 0!==c?c:new b.Vector3};b.Ray.prototype={constructor:b.Ray,set:function(a,b){this.origin.copy(a);
this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,c){return(c||new b.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize()},recast:function(){var a=new b.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,c){var d=c||
new b.Vector3;d.subVectors(a,this.origin);var e=d.dot(this.direction);return 0>e?d.copy(this.origin):d.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new b.Vector3;return function(b){var d=a.subVectors(b,this.origin).dot(this.direction);if(0>d)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(d).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=
new b.Vector3,c=new b.Vector3,d=new b.Vector3;return function(b,f,h,m){a.copy(b).add(f).multiplyScalar(.5);c.copy(f).sub(b).normalize();d.copy(this.origin).sub(a);var g=.5*b.distanceTo(f),k=-this.direction.dot(c),v=d.dot(this.direction),q=-d.dot(c),p=d.lengthSq(),l=Math.abs(1-k*k),t;0<l?(b=k*q-v,f=k*v-q,t=g*l,0<=b?f>=-t?f<=t?(g=1/l,b*=g,f*=g,k=b*(b+k*f+2*v)+f*(k*b+f+2*q)+p):(f=g,b=Math.max(0,-(k*f+v)),k=-b*b+f*(f+2*q)+p):(f=-g,b=Math.max(0,-(k*f+v)),k=-b*b+f*(f+2*q)+p):f<=-t?(b=Math.max(0,-(-k*g+
v)),f=0<b?-g:Math.min(Math.max(-g,-q),g),k=-b*b+f*(f+2*q)+p):f<=t?(b=0,f=Math.min(Math.max(-g,-q),g),k=f*(f+2*q)+p):(b=Math.max(0,-(k*g+v)),f=0<b?g:Math.min(Math.max(-g,-q),g),k=-b*b+f*(f+2*q)+p)):(f=0<k?-g:g,b=Math.max(0,-(k*f+v)),k=-b*b+f*(f+2*q)+p);h&&h.copy(this.direction).multiplyScalar(b).add(this.origin);m&&m.copy(c).multiplyScalar(f).add(a);return k}}(),intersectSphere:function(){var a=new b.Vector3;return function(b,d){a.subVectors(b.center,this.origin);var e=a.dot(this.direction),f=a.dot(a)-
e*e,h=b.radius*b.radius;if(f>h)return null;h=Math.sqrt(h-f);f=e-h;e+=h;return 0>f&&0>e?null:0>f?this.at(e,d):this.at(f,d)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var d=this.distanceToPlane(a);return null===d?null:this.at(d,b)},intersectsPlane:function(a){var b=
a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var d,e,f,h,m;e=1/this.direction.x;h=1/this.direction.y;m=1/this.direction.z;var g=this.origin;0<=e?(d=(a.min.x-g.x)*e,e*=a.max.x-g.x):(d=(a.max.x-g.x)*e,e*=a.min.x-g.x);0<=h?(f=(a.min.y-g.y)*h,h*=a.max.y-g.y):(f=(a.max.y-g.y)*h,h*=a.min.y-g.y);if(d>h||f>e)return null;if(f>d||d!==d)d=f;if(h<e||e!==e)e=h;0<=m?(f=(a.min.z-g.z)*m,m*=a.max.z-g.z):(f=(a.max.z-g.z)*m,m*=a.min.z-g.z);if(d>m||f>
e)return null;if(f>d||d!==d)d=f;if(m<e||e!==e)e=m;return 0>e?null:this.at(0<=d?d:e,b)},intersectsBox:function(){var a=new b.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new b.Vector3,c=new b.Vector3,d=new b.Vector3,e=new b.Vector3;return function(b,h,m,g,k){c.subVectors(h,b);d.subVectors(m,b);e.crossVectors(c,d);h=this.direction.dot(e);if(0<h){if(g)return null;g=1}else if(0>h)g=-1,h=-h;else return null;a.subVectors(this.origin,b);b=g*this.direction.dot(d.crossVectors(a,
d));if(0>b)return null;m=g*this.direction.dot(c.cross(a));if(0>m||b+m>h)return null;b=-g*a.dot(e);return 0>b?null:this.at(b/h,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};b.Box2=function(a,c){this.min=void 0!==a?a:new b.Vector2(Infinity,Infinity);this.max=void 0!==c?c:new b.Vector2(-Infinity,
-Infinity)};b.Box2.prototype={constructor:b.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,d=a.length;b<d;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new b.Vector2;return function(b,d){var e=a.copy(d).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);
return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new b.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new b.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,c){return(c||new b.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?
!1:!0},clampPoint:function(a,c){return(c||new b.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new b.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};
b.Box3=function(a,c){this.min=void 0!==a?a:new b.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==c?c:new b.Vector3(-Infinity,-Infinity,-Infinity)};b.Box3.prototype={constructor:b.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,d=Infinity,e=Infinity,f=-Infinity,h=-Infinity,m=-Infinity,g=0,k=a.length;g<k;g+=3){var v=a[g],q=a[g+1],p=a[g+2];v<b&&(b=v);q<d&&(d=q);p<e&&(e=p);v>f&&(f=v);q>h&&(h=q);p>m&&(m=p)}this.min.set(b,d,e);this.max.set(f,
h,m)},setFromPoints:function(a){this.makeEmpty();for(var b=0,d=a.length;b<d;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new b.Vector3;return function(b,d){var e=a.copy(d).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),setFromObject:function(){var a=new b.Vector3;return function(c){var d=this;c.updateMatrixWorld(!0);this.makeEmpty();c.traverse(function(c){var f=c.geometry;if(void 0!==f)if(f instanceof b.Geometry)for(var h=f.vertices,
f=0,m=h.length;f<m;f++)a.copy(h[f]),a.applyMatrix4(c.matrixWorld),d.expandByPoint(a);else if(f instanceof b.BufferGeometry&&void 0!==f.attributes.position)for(h=f.attributes.position.array,f=0,m=h.length;f<m;f+=3)a.fromArray(h,f),a.applyMatrix4(c.matrixWorld),d.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=
this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new b.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new b.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);
return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,c){return(c||new b.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<
this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(c){void 0===a&&(a=new b.Vector3);this.clampPoint(c.center,a);return a.distanceToSquared(c.center)<=c.radius*c.radius}}(),intersectsPlane:function(a){var b,d;0<a.normal.x?(b=a.normal.x*this.min.x,d=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,d=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,d+=a.normal.y*this.max.y):
(b+=a.normal.y*this.max.y,d+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,d+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,d+=a.normal.z*this.min.z);return b<=a.constant&&d>=a.constant},clampPoint:function(a,c){return(c||new b.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new b.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new b.Vector3;return function(c){c=c||new b.Sphere;
c.center=this.center();c.radius=.5*this.size(a).length();return c}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};b.Sphere=function(a,c){this.center=void 0!==a?a:new b.Vector3;this.radius=void 0!==c?c:0};b.Sphere.prototype={constructor:b.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new b.Box3;return function(b,d){var e=this.center;void 0!==d?e.copy(d):a.setFromPoints(b).center(e);for(var f=0,h=0,m=b.length;h<m;h++)f=Math.max(f,e.distanceToSquared(b[h]));this.radius=
Math.sqrt(f);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},
intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,c){var d=this.center.distanceToSquared(a),e=c||new b.Vector3;e.copy(a);d>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center));return e},getBoundingBox:function(a){a=a||new b.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();
return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}};b.Plane=function(a,c){this.normal=void 0!==a?a:new b.Vector3(1,0,0);this.constant=void 0!==c?c:0};b.Plane.prototype={constructor:b.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,d,e){this.normal.set(a,b,d);this.constant=e;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=
-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new b.Vector3,c=new b.Vector3;return function(b,e,f){e=a.subVectors(f,e).cross(c.subVectors(b,e)).normalize();this.setFromNormalAndCoplanarPoint(e,b);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=
-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,c){var d=this.distanceToPoint(a);return(c||new b.Vector3).copy(this.normal).multiplyScalar(d)},intersectLine:function(){var a=new b.Vector3;return function(c,d){var e=d||new b.Vector3,f=c.delta(a),h=this.normal.dot(f);if(0===
h){if(0===this.distanceToPoint(c.start))return e.copy(c.start)}else return h=-(c.start.dot(this.normal)+this.constant)/h,0>h||1<h?void 0:e.copy(f).multiplyScalar(h).add(c.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new b.Vector3).copy(this.normal).multiplyScalar(-this.constant)},
applyMatrix4:function(){var a=new b.Vector3,c=new b.Matrix3;return function(b,e){var f=this.coplanarPoint(a).applyMatrix4(b),h=e||c.getNormalMatrix(b),h=this.normal.applyMatrix3(h).normalize();this.constant=-f.dot(h);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};b.Frustum=function(a,c,d,e,f,h){this.planes=[void 0!==a?a:new b.Plane,void 0!==c?c:new b.Plane,void 0!==d?d:new b.Plane,
void 0!==e?e:new b.Plane,void 0!==f?f:new b.Plane,void 0!==h?h:new b.Plane]};b.Frustum.prototype={constructor:b.Frustum,set:function(a,b,d,e,f,h){var m=this.planes;m[0].copy(a);m[1].copy(b);m[2].copy(d);m[3].copy(e);m[4].copy(f);m[5].copy(h);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,d=0;6>d;d++)b[d].copy(a.planes[d]);return this},setFromMatrix:function(a){var b=this.planes,d=a.elements;a=d[0];var e=d[1],f=d[2],h=d[3],m=d[4],g=d[5],
k=d[6],v=d[7],q=d[8],p=d[9],l=d[10],t=d[11],s=d[12],x=d[13],r=d[14],d=d[15];b[0].setComponents(h-a,v-m,t-q,d-s).normalize();b[1].setComponents(h+a,v+m,t+q,d+s).normalize();b[2].setComponents(h+e,v+g,t+p,d+x).normalize();b[3].setComponents(h-e,v-g,t-p,d-x).normalize();b[4].setComponents(h-f,v-k,t-l,d-r).normalize();b[5].setComponents(h+f,v+k,t+l,d+r).normalize();return this},intersectsObject:function(){var a=new b.Sphere;return function(b){var d=b.geometry;null===d.boundingSphere&&d.computeBoundingSphere();
a.copy(d.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,d=a.center;a=-a.radius;for(var e=0;6>e;e++)if(b[e].distanceToPoint(d)<a)return!1;return!0},intersectsBox:function(){var a=new b.Vector3,c=new b.Vector3;return function(b){for(var e=this.planes,f=0;6>f;f++){var h=e[f];a.x=0<h.normal.x?b.min.x:b.max.x;c.x=0<h.normal.x?b.max.x:b.min.x;a.y=0<h.normal.y?b.min.y:b.max.y;c.y=0<h.normal.y?b.max.y:b.min.y;a.z=0<h.normal.z?
b.min.z:b.max.z;c.z=0<h.normal.z?b.max.z:b.min.z;var m=h.distanceToPoint(a),h=h.distanceToPoint(c);if(0>m&&0>h)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,d=0;6>d;d++)if(0>b[d].distanceToPoint(a))return!1;return!0}};b.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),d=0,e;return function(){for(var f=0;36>f;f++)8===f||13===f||18===f||23===f?b[f]="-":14===f?b[f]=
"4":(2>=d&&(d=33554432+16777216*Math.random()|0),e=d&15,d>>=4,b[f]=a[19===f?e&3|8:e]);return b.join("")}}(),clamp:function(a,b,d){return Math.max(b,Math.min(d,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,d,e,f){return e+(a-b)*(f-e)/(d-b)},smoothstep:function(a,b,d){if(a<=b)return 0;if(a>=d)return 1;a=(a-b)/(d-b);return a*a*(3-2*a)},smootherstep:function(a,b,d){if(a<=b)return 0;if(a>=d)return 1;a=(a-b)/(d-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");
return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*b.Math.DEG2RAD},radToDeg:function(a){return a*b.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;
return a}};b.Triangle=function(a,c,d){this.a=void 0!==a?a:new b.Vector3;this.b=void 0!==c?c:new b.Vector3;this.c=void 0!==d?d:new b.Vector3};b.Triangle.normal=function(){var a=new b.Vector3;return function(c,d,e,f){f=f||new b.Vector3;f.subVectors(e,d);a.subVectors(c,d);f.cross(a);c=f.lengthSq();return 0<c?f.multiplyScalar(1/Math.sqrt(c)):f.set(0,0,0)}}();b.Triangle.barycoordFromPoint=function(){var a=new b.Vector3,c=new b.Vector3,d=new b.Vector3;return function(e,f,h,m,g){a.subVectors(m,f);c.subVectors(h,
f);d.subVectors(e,f);e=a.dot(a);f=a.dot(c);h=a.dot(d);var k=c.dot(c);m=c.dot(d);var v=e*k-f*f;g=g||new b.Vector3;if(0===v)return g.set(-2,-1,-1);v=1/v;k=(k*h-f*m)*v;e=(e*m-f*h)*v;return g.set(1-k-e,e,k)}}();b.Triangle.containsPoint=function(){var a=new b.Vector3;return function(c,d,e,f){c=b.Triangle.barycoordFromPoint(c,d,e,f,a);return 0<=c.x&&0<=c.y&&1>=c.x+c.y}}();b.Triangle.prototype={constructor:b.Triangle,set:function(a,b,d){this.a.copy(a);this.b.copy(b);this.c.copy(d);return this},setFromPointsAndIndices:function(a,
b,d,e){this.a.copy(a[b]);this.b.copy(a[d]);this.c.copy(a[e]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new b.Vector3,c=new b.Vector3;return function(){a.subVectors(this.c,this.b);c.subVectors(this.a,this.b);return.5*a.cross(c).length()}}(),midpoint:function(a){return(a||new b.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return b.Triangle.normal(this.a,
this.b,this.c,a)},plane:function(a){return(a||new b.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,c){return b.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,c)},containsPoint:function(a){return b.Triangle.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,c,d,e;return function(f,h){void 0===a&&(a=new b.Plane,c=[new b.Line3,new b.Line3,new b.Line3],d=new b.Vector3,e=new b.Vector3);var m=h||new b.Vector3,g=Infinity;a.setFromCoplanarPoints(this.a,
this.b,this.c);a.projectPoint(f,d);if(!0===this.containsPoint(d))m.copy(d);else{c[0].set(this.a,this.b);c[1].set(this.b,this.c);c[2].set(this.c,this.a);for(var k=0;k<c.length;k++){c[k].closestPointToPoint(d,!0,e);var v=d.distanceToSquared(e);v<g&&(g=v,m.copy(e))}}return m}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};b.EventDispatcher=function(){};b.EventDispatcher.prototype={constructor:b.EventDispatcher,apply:function(a){a.addEventListener=b.EventDispatcher.prototype.addEventListener;
a.hasEventListener=b.EventDispatcher.prototype.hasEventListener;a.removeEventListener=b.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=b.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(b)&&d[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(b)?!0:!1},removeEventListener:function(a,
b){if(void 0!==this._listeners){var d=this._listeners[a];if(void 0!==d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var d=[],e=b.length,f=0;f<e;f++)d[f]=b[f];for(f=0;f<e;f++)d[f].call(this,a)}}}};(function(a){function b(a,c){return a.distance-c.distance}function d(a,b,c,m){if(!1!==a.visible&&(a.raycast(b,c),!0===m)){a=a.children;m=0;for(var g=a.length;m<g;m++)d(a[m],b,c,!0)}}a.Raycaster=
function(b,c,d,m){this.ray=new a.Ray(b,c);this.near=d||0;this.far=m||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),
this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,f){var h=[];d(a,this,h,f);h.sort(b);return h},intersectObjects:function(a,f){var h=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),
h;for(var m=0,g=a.length;m<g;m++)d(a[m],this,h,f);h.sort(b);return h}}})(b);b.Object3D=function(){Object.defineProperty(this,"id",{value:b.Object3DIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=b.Object3D.DefaultUp.clone();var a=new b.Vector3,c=new b.Euler,d=new b.Quaternion,e=new b.Vector3(1,1,1);c.onChange(function(){d.setFromEuler(c,!1)});d.onChange(function(){c.setFromQuaternion(d,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:c},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new b.Matrix4},normalMatrix:{value:new b.Matrix3}});this.rotationAutoUpdate=!0;this.matrix=new b.Matrix4;this.matrixWorld=new b.Matrix4;this.matrixAutoUpdate=b.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new b.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData=
{}};b.Object3D.DefaultUp=new b.Vector3(0,1,0);b.Object3D.DefaultMatrixAutoUpdate=!0;b.Object3D.prototype={constructor:b.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},
rotateOnAxis:function(){var a=new b.Quaternion;return function(b,d){a.setFromAxisAngle(b,d);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new b.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new b.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new b.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new b.Vector3;return function(b,d){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(d));return this}}(),translateX:function(){var a=new b.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new b.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new b.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new b.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),
lookAt:function(){var a=new b.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var c=0;c<arguments.length;c++)this.add(arguments[c]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof b.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var d=0,e=this.children.length;d<e;d++){var f=this.children[d].getObjectByProperty(a,
b);if(void 0!==f)return f}},getWorldPosition:function(a){a=a||new b.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new b.Vector3,c=new b.Vector3;return function(d){d=d||new b.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,d,c);return d}}(),getWorldRotation:function(){var a=new b.Quaternion;return function(c){c=c||new b.Euler;this.getWorldQuaternion(a);return c.setFromQuaternion(a,this.rotation.order,!1)}}(),
getWorldScale:function(){var a=new b.Vector3,c=new b.Quaternion;return function(d){d=d||new b.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,d);return d}}(),getWorldDirection:function(){var a=new b.Quaternion;return function(c){c=c||new b.Vector3;this.getWorldQuaternion(a);return c.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,d=0,e=b.length;d<e;d++)b[d].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);
for(var b=this.children,d=0,e=b.length;d<e;d++)b[d].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,d=this.children.length;b<d;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var c=[],d;for(d in a){var e=a[d];delete e.metadata;c.push(e)}return c}var d=void 0===a||""===a,e={};d&&(a={geometries:{},materials:{},textures:{},images:{}},e.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var f={};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);"{}"!==JSON.stringify(this.userData)&&
(f.userData=this.userData);!0===this.castShadow&&(f.castShadow=!0);!0===this.receiveShadow&&(f.receiveShadow=!0);!1===this.visible&&(f.visible=!1);f.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),f.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),f.material=this.material.uuid);if(0<this.children.length){f.children=
[];for(var h=0;h<this.children.length;h++)f.children.push(this.children[h].toJSON(a).object)}if(d){var d=b(a.geometries),h=b(a.materials),m=b(a.textures);a=b(a.images);0<d.length&&(e.geometries=d);0<h.length&&(e.materials=h);0<m.length&&(e.textures=m);0<a.length&&(e.images=a)}e.object=f;return e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.rotationAutoUpdate=a.rotationAutoUpdate;this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var d=0;d<a.children.length;d++)this.add(a.children[d].clone());return this}};
b.EventDispatcher.prototype.apply(b.Object3D.prototype);b.Object3DIdCount=0;b.Face3=function(a,c,d,e,f,h){this.a=a;this.b=c;this.c=d;this.normal=e instanceof b.Vector3?e:new b.Vector3;this.vertexNormals=Array.isArray(e)?e:[];this.color=f instanceof b.Color?f:new b.Color;this.vertexColors=Array.isArray(f)?f:[];this.materialIndex=void 0!==h?h:0};b.Face3.prototype={constructor:b.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);
this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,d=a.vertexNormals.length;b<d;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(d=a.vertexColors.length;b<d;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};b.Layers=function(){this.mask=1};b.Layers.prototype={constructor:b.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==
(this.mask&a.mask)}};b.BufferAttribute=function(a,c,d){this.uuid=b.Math.generateUUID();this.array=a;this.itemSize=c;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===d};b.BufferAttribute.prototype={constructor:b.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=
a.dynamic;return this},copyAt:function(a,b,d){a*=this.itemSize;d*=b.itemSize;for(var e=0,f=this.itemSize;e<f;e++)this.array[a+e]=b.array[d+e];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var c=this.array,d=0,e=0,f=a.length;e<f;e++){var h=a[e];void 0===h&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),h=new b.Color);c[d++]=h.r;c[d++]=h.g;c[d++]=h.b}return this},copyIndicesArray:function(a){for(var b=this.array,d=0,
e=0,f=a.length;e<f;e++){var h=a[e];b[d++]=h.a;b[d++]=h.b;b[d++]=h.c}return this},copyVector2sArray:function(a){for(var c=this.array,d=0,e=0,f=a.length;e<f;e++){var h=a[e];void 0===h&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),h=new b.Vector2);c[d++]=h.x;c[d++]=h.y}return this},copyVector3sArray:function(a){for(var c=this.array,d=0,e=0,f=a.length;e<f;e++){var h=a[e];void 0===h&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),
h=new b.Vector3);c[d++]=h.x;c[d++]=h.y;c[d++]=h.z}return this},copyVector4sArray:function(a){for(var c=this.array,d=0,e=0,f=a.length;e<f;e++){var h=a[e];void 0===h&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),h=new b.Vector4);c[d++]=h.x;c[d++]=h.y;c[d++]=h.z;c[d++]=h.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},
getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=d;return this},setXYZ:function(a,b,d,e){a*=this.itemSize;this.array[a+0]=
b;this.array[a+1]=d;this.array[a+2]=e;return this},setXYZW:function(a,b,d,e,f){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=d;this.array[a+2]=e;this.array[a+3]=f;return this},clone:function(){return(new this.constructor).copy(this)}};b.Int8Attribute=function(a,c){return new b.BufferAttribute(new Int8Array(a),c)};b.Uint8Attribute=function(a,c){return new b.BufferAttribute(new Uint8Array(a),c)};b.Uint8ClampedAttribute=function(a,c){return new b.BufferAttribute(new Uint8ClampedArray(a),c)};b.Int16Attribute=
function(a,c){return new b.BufferAttribute(new Int16Array(a),c)};b.Uint16Attribute=function(a,c){return new b.BufferAttribute(new Uint16Array(a),c)};b.Int32Attribute=function(a,c){return new b.BufferAttribute(new Int32Array(a),c)};b.Uint32Attribute=function(a,c){return new b.BufferAttribute(new Uint32Array(a),c)};b.Float32Attribute=function(a,c){return new b.BufferAttribute(new Float32Array(a),c)};b.Float64Attribute=function(a,c){return new b.BufferAttribute(new Float64Array(a),c)};b.DynamicBufferAttribute=
function(a,c){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new b.BufferAttribute(a,c)).setDynamic(!0)};b.InstancedBufferAttribute=function(a,c,d){b.BufferAttribute.call(this,a,c);this.meshPerAttribute=d||1};b.InstancedBufferAttribute.prototype=Object.create(b.BufferAttribute.prototype);b.InstancedBufferAttribute.prototype.constructor=b.InstancedBufferAttribute;b.InstancedBufferAttribute.prototype.copy=function(a){b.BufferAttribute.prototype.copy.call(this,
a);this.meshPerAttribute=a.meshPerAttribute;return this};b.Geometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=
this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};b.Geometry.prototype={constructor:b.Geometry,applyMatrix:function(a){for(var c=(new b.Matrix3).getNormalMatrix(a),d=0,e=this.vertices.length;d<e;d++)this.vertices[d].applyMatrix4(a);d=0;for(e=this.faces.length;d<e;d++){a=this.faces[d];a.normal.applyMatrix3(c).normalize();for(var f=0,h=a.vertexNormals.length;f<h;f++)a.vertexNormals[f].applyMatrix3(c).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&
this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a;
return function(c,d,e){void 0===a&&(a=new b.Matrix4);a.makeTranslation(c,d,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Matrix4);a.makeScale(c,d,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(c){void 0===a&&(a=new b.Object3D);a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function c(a,c,e,f){var h=void 0!==m?[q[a].clone(),q[c].clone(),q[e].clone()]:[],t=void 0!==
g?[d.colors[a].clone(),d.colors[c].clone(),d.colors[e].clone()]:[];f=new b.Face3(a,c,e,h,t,f);d.faces.push(f);void 0!==k&&d.faceVertexUvs[0].push([p[a].clone(),p[c].clone(),p[e].clone()]);void 0!==v&&d.faceVertexUvs[1].push([l[a].clone(),l[c].clone(),l[e].clone()])}var d=this,e=null!==a.index?a.index.array:void 0,f=a.attributes,h=f.position.array,m=void 0!==f.normal?f.normal.array:void 0,g=void 0!==f.color?f.color.array:void 0,k=void 0!==f.uv?f.uv.array:void 0,v=void 0!==f.uv2?f.uv2.array:void 0;
void 0!==v&&(this.faceVertexUvs[1]=[]);for(var q=[],p=[],l=[],t=f=0;f<h.length;f+=3,t+=2)d.vertices.push(new b.Vector3(h[f],h[f+1],h[f+2])),void 0!==m&&q.push(new b.Vector3(m[f],m[f+1],m[f+2])),void 0!==g&&d.colors.push(new b.Color(g[f],g[f+1],g[f+2])),void 0!==k&&p.push(new b.Vector2(k[t],k[t+1])),void 0!==v&&l.push(new b.Vector2(v[t],v[t+1]));if(void 0!==e)if(h=a.groups,0<h.length)for(f=0;f<h.length;f++)for(var s=h[f],x=s.start,r=s.count,t=x,x=x+r;t<x;t+=3)c(e[t],e[t+1],e[t+2],s.materialIndex);
else for(f=0;f<e.length;f+=3)c(e[f],e[f+1],e[f+2]);else for(f=0;f<h.length/3;f+=3)c(f,f+1,f+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,c=this.boundingSphere.radius,
c=0===c?1:1/c,d=new b.Matrix4;d.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1);this.applyMatrix(d);return this},computeFaceNormals:function(){for(var a=new b.Vector3,c=new b.Vector3,d=0,e=this.faces.length;d<e;d++){var f=this.faces[d],h=this.vertices[f.a],m=this.vertices[f.b];a.subVectors(this.vertices[f.c],m);c.subVectors(h,m);a.cross(c);a.normalize();f.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var c,d,e;e=Array(this.vertices.length);c=0;for(d=this.vertices.length;c<
d;c++)e[c]=new b.Vector3;if(a){var f,h,m,g=new b.Vector3,k=new b.Vector3;a=0;for(c=this.faces.length;a<c;a++)d=this.faces[a],f=this.vertices[d.a],h=this.vertices[d.b],m=this.vertices[d.c],g.subVectors(m,h),k.subVectors(f,h),g.cross(k),e[d.a].add(g),e[d.b].add(g),e[d.c].add(g)}else for(a=0,c=this.faces.length;a<c;a++)d=this.faces[a],e[d.a].add(d.normal),e[d.b].add(d.normal),e[d.c].add(d.normal);c=0;for(d=this.vertices.length;c<d;c++)e[c].normalize();a=0;for(c=this.faces.length;a<c;a++)d=this.faces[a],
f=d.vertexNormals,3===f.length?(f[0].copy(e[d.a]),f[1].copy(e[d.b]),f[2].copy(e[d.c])):(f[0]=e[d.a].clone(),f[1]=e[d.b].clone(),f[2]=e[d.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,c,d,e,f;d=0;for(e=this.faces.length;d<e;d++)for(f=this.faces[d],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]),a=0,c=f.vertexNormals.length;a<c;a++)f.__originalVertexNormals[a]?
f.__originalVertexNormals[a].copy(f.vertexNormals[a]):f.__originalVertexNormals[a]=f.vertexNormals[a].clone();var h=new b.Geometry;h.faces=this.faces;a=0;for(c=this.morphTargets.length;a<c;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];f=this.morphNormals[a].faceNormals;var m=this.morphNormals[a].vertexNormals,g,k;d=0;for(e=this.faces.length;d<e;d++)g=new b.Vector3,k={a:new b.Vector3,b:new b.Vector3,c:new b.Vector3},
f.push(g),m.push(k)}m=this.morphNormals[a];h.vertices=this.morphTargets[a].vertices;h.computeFaceNormals();h.computeVertexNormals();d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],g=m.faceNormals[d],k=m.vertexNormals[d],g.copy(f.normal),k.a.copy(f.vertexNormals[0]),k.b.copy(f.vertexNormals[1]),k.c.copy(f.vertexNormals[2])}d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},
computeLineDistances:function(){for(var a=0,b=this.vertices,d=0,e=b.length;d<e;d++)0<d&&(a+=b[d].distanceTo(b[d-1])),this.lineDistances[d]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new b.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new b.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,c,d){if(!1===a instanceof b.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",
a);else{var e,f=this.vertices.length,h=this.vertices,m=a.vertices,g=this.faces,k=a.faces,v=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===d&&(d=0);void 0!==c&&(e=(new b.Matrix3).getNormalMatrix(c));for(var q=0,p=m.length;q<p;q++){var l=m[q].clone();void 0!==c&&l.applyMatrix4(c);h.push(l)}q=0;for(p=k.length;q<p;q++){var m=k[q],t,s=m.vertexNormals,x=m.vertexColors,l=new b.Face3(m.a+f,m.b+f,m.c+f);l.normal.copy(m.normal);void 0!==e&&l.normal.applyMatrix3(e).normalize();c=0;for(h=s.length;c<h;c++)t=
s[c].clone(),void 0!==e&&t.applyMatrix3(e).normalize(),l.vertexNormals.push(t);l.color.copy(m.color);c=0;for(h=x.length;c<h;c++)t=x[c],l.vertexColors.push(t.clone());l.materialIndex=m.materialIndex+d;g.push(l)}q=0;for(p=a.length;q<p;q++)if(d=a[q],e=[],void 0!==d){c=0;for(h=d.length;c<h;c++)e.push(d[c].clone());v.push(e)}}},mergeMesh:function(a){!1===a instanceof b.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,
a.matrix))},mergeVertices:function(){var a={},b=[],d=[],e,f=Math.pow(10,4),h,m;h=0;for(m=this.vertices.length;h<m;h++)e=this.vertices[h],e=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===a[e]?(a[e]=h,b.push(this.vertices[h]),d[h]=b.length-1):d[h]=d[a[e]];a=[];h=0;for(m=this.faces.length;h<m;h++)for(f=this.faces[h],f.a=d[f.a],f.b=d[f.b],f.c=d[f.c],f=[f.a,f.b,f.c],e=0;3>e;e++)if(f[e]===f[(e+1)%3]){a.push(h);break}for(h=a.length-1;0<=h;h--)for(f=a[h],this.faces.splice(f,1),d=0,
m=this.faceVertexUvs.length;d<m;d++)this.faceVertexUvs[d].splice(f,1);h=this.vertices.length-b.length;this.vertices=b;return h},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,d=0;d<b;d++)a[d]._id=d;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var e=this.faceVertexUvs[0],f=this.faceVertexUvs[1],h,m;e&&e.length===b&&(h=[]);f&&f.length===b&&(m=[]);for(d=0;d<b;d++){var g=a[d]._id;h&&h.push(e[g]);m&&m.push(f[g])}h&&(this.faceVertexUvs[0]=h);m&&(this.faceVertexUvs[1]=
m)},toJSON:function(){function a(a,b,d){return d?a|1<<b:a&~(1<<b)}function b(a){var d=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==v[d])return v[d];v[d]=k.length/3;k.push(a.x,a.y,a.z);return v[d]}function d(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=q.length;q.push(a.getHex());return p[b]}function e(a){var b=a.x.toString()+a.y.toString();if(void 0!==t[b])return t[b];t[b]=l.length/2;l.push(a.x,a.y);return t[b]}var f={metadata:{version:4.4,type:"Geometry",
generator:"Geometry.toJSON"}};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);if(void 0!==this.parameters){var h=this.parameters,m;for(m in h)void 0!==h[m]&&(f[m]=h[m]);return f}h=[];for(m=0;m<this.vertices.length;m++){var g=this.vertices[m];h.push(g.x,g.y,g.z)}var g=[],k=[],v={},q=[],p={},l=[],t={};for(m=0;m<this.faces.length;m++){var s=this.faces[m],x=void 0!==this.faceVertexUvs[0][m],r=0<s.normal.length(),w=0<s.vertexNormals.length,n=1!==s.color.r||1!==s.color.g||1!==s.color.b,
y=0<s.vertexColors.length,z=0,z=a(z,0,0),z=a(z,1,!0),z=a(z,2,!1),z=a(z,3,x),z=a(z,4,r),z=a(z,5,w),z=a(z,6,n),z=a(z,7,y);g.push(z);g.push(s.a,s.b,s.c);g.push(s.materialIndex);x&&(x=this.faceVertexUvs[0][m],g.push(e(x[0]),e(x[1]),e(x[2])));r&&g.push(b(s.normal));w&&(r=s.vertexNormals,g.push(b(r[0]),b(r[1]),b(r[2])));n&&g.push(d(s.color));y&&(s=s.vertexColors,g.push(d(s[0]),d(s[1]),d(s[2])))}f.data={};f.data.vertices=h;f.data.normals=k;0<q.length&&(f.data.colors=q);0<l.length&&(f.data.uvs=[l]);f.data.faces=
g;return f},clone:function(){return(new b.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,d=0,e=b.length;d<e;d++)this.vertices.push(b[d].clone());b=a.faces;d=0;for(e=b.length;d<e;d++)this.faces.push(b[d].clone());d=0;for(e=a.faceVertexUvs.length;d<e;d++){b=a.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(var f=0,h=b.length;f<h;f++){for(var g=b[f],k=[],r=0,v=g.length;r<v;r++)k.push(g[r].clone());this.faceVertexUvs[d].push(k)}}return this},
dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.Geometry.prototype);b.GeometryIdCount=0;b.DirectGeometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;
this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};b.DirectGeometry.prototype={constructor:b.DirectGeometry,computeBoundingBox:b.Geometry.prototype.computeBoundingBox,computeBoundingSphere:b.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},
computeGroups:function(a){var b,d=[],e;a=a.faces;for(var f=0;f<a.length;f++){var h=a[f];h.materialIndex!==e&&(e=h.materialIndex,void 0!==b&&(b.count=3*f-b.start,d.push(b)),b={start:3*f,materialIndex:e})}void 0!==b&&(b.count=3*f-b.start,d.push(b));this.groups=d},fromGeometry:function(a){var c=a.faces,d=a.vertices,e=a.faceVertexUvs,f=e[0]&&0<e[0].length,h=e[1]&&0<e[1].length,g=a.morphTargets,k=g.length,r;if(0<k){r=[];for(var v=0;v<k;v++)r[v]=[];this.morphTargets.position=r}var q=a.morphNormals,p=q.length,
l;if(0<p){l=[];for(v=0;v<p;v++)l[v]=[];this.morphTargets.normal=l}for(var t=a.skinIndices,s=a.skinWeights,x=t.length===d.length,y=s.length===d.length,v=0;v<c.length;v++){var w=c[v];this.vertices.push(d[w.a],d[w.b],d[w.c]);var n=w.vertexNormals;3===n.length?this.normals.push(n[0],n[1],n[2]):(n=w.normal,this.normals.push(n,n,n));n=w.vertexColors;3===n.length?this.colors.push(n[0],n[1],n[2]):(n=w.color,this.colors.push(n,n,n));!0===f&&(n=e[0][v],void 0!==n?this.uvs.push(n[0],n[1],n[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",
v),this.uvs.push(new b.Vector2,new b.Vector2,new b.Vector2)));!0===h&&(n=e[1][v],void 0!==n?this.uvs2.push(n[0],n[1],n[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new b.Vector2,new b.Vector2,new b.Vector2)));for(n=0;n<k;n++){var B=g[n].vertices;r[n].push(B[w.a],B[w.b],B[w.c])}for(n=0;n<p;n++)B=q[n].vertexNormals[v],l[n].push(B.a,B.b,B.c);x&&this.skinIndices.push(t[w.a],t[w.b],t[w.c]);y&&this.skinWeights.push(s[w.a],s[w.b],s[w.c])}this.computeGroups(a);
this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.DirectGeometry.prototype);b.BufferGeometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=
null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};b.BufferGeometry.prototype={constructor:b.BufferGeometry,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,c,d){if(!1===c instanceof b.BufferAttribute&&!1===c instanceof b.InterleavedBufferAttribute)console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new b.BufferAttribute(c,
d));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(c);else return this.attributes[a]=c,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,d){this.groups.push({start:a,count:b,materialIndex:void 0!==d?d:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var c=
this.attributes.position;void 0!==c&&(a.applyToVector3Array(c.array),c.needsUpdate=!0);c=this.attributes.normal;void 0!==c&&((new b.Matrix3).getNormalMatrix(a).applyToVector3Array(c.array),c.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(c){void 0===
a&&(a=new b.Matrix4);a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(c){void 0===a&&(a=new b.Matrix4);a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Matrix4);a.makeTranslation(c,d,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(c,d,e){void 0===a&&(a=new b.Matrix4);a.makeScale(c,d,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;
return function(c){void 0===a&&(a=new b.Object3D);a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var c=a.geometry;if(a instanceof b.Points||a instanceof b.Line){a=new b.Float32Attribute(3*c.vertices.length,3);var d=new b.Float32Attribute(3*c.colors.length,3);this.addAttribute("position",a.copyVector3sArray(c.vertices));this.addAttribute("color",
d.copyColorsArray(c.colors));c.lineDistances&&c.lineDistances.length===c.vertices.length&&(a=new b.Float32Attribute(c.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(c.lineDistances)));null!==c.boundingSphere&&(this.boundingSphere=c.boundingSphere.clone());null!==c.boundingBox&&(this.boundingBox=c.boundingBox.clone())}else a instanceof b.Mesh&&c instanceof b.Geometry&&this.fromGeometry(c);return this},updateFromObject:function(a){var c=a.geometry;if(a instanceof b.Mesh){var d=
c.__directGeometry;if(void 0===d)return this.fromGeometry(c);d.verticesNeedUpdate=c.verticesNeedUpdate;d.normalsNeedUpdate=c.normalsNeedUpdate;d.colorsNeedUpdate=c.colorsNeedUpdate;d.uvsNeedUpdate=c.uvsNeedUpdate;d.groupsNeedUpdate=c.groupsNeedUpdate;c.verticesNeedUpdate=!1;c.normalsNeedUpdate=!1;c.colorsNeedUpdate=!1;c.uvsNeedUpdate=!1;c.groupsNeedUpdate=!1;c=d}!0===c.verticesNeedUpdate&&(d=this.attributes.position,void 0!==d&&(d.copyVector3sArray(c.vertices),d.needsUpdate=!0),c.verticesNeedUpdate=
!1);!0===c.normalsNeedUpdate&&(d=this.attributes.normal,void 0!==d&&(d.copyVector3sArray(c.normals),d.needsUpdate=!0),c.normalsNeedUpdate=!1);!0===c.colorsNeedUpdate&&(d=this.attributes.color,void 0!==d&&(d.copyColorsArray(c.colors),d.needsUpdate=!0),c.colorsNeedUpdate=!1);c.uvsNeedUpdate&&(d=this.attributes.uv,void 0!==d&&(d.copyVector2sArray(c.uvs),d.needsUpdate=!0),c.uvsNeedUpdate=!1);c.lineDistancesNeedUpdate&&(d=this.attributes.lineDistance,void 0!==d&&(d.copyArray(c.lineDistances),d.needsUpdate=
!0),c.lineDistancesNeedUpdate=!1);c.groupsNeedUpdate&&(c.computeGroups(a.geometry),this.groups=c.groups,c.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new b.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var c=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new b.BufferAttribute(c,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(c=new Float32Array(3*a.normals.length),this.addAttribute("normal",
(new b.BufferAttribute(c,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(c=new Float32Array(3*a.colors.length),this.addAttribute("color",(new b.BufferAttribute(c,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(c=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new b.BufferAttribute(c,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(c=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new b.BufferAttribute(c,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(c=new (65535<
a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new b.BufferAttribute(c,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var d in a.morphTargets){for(var c=[],e=a.morphTargets[d],f=0,h=e.length;f<h;f++){var g=e[f],k=new b.Float32Attribute(3*g.length,3);c.push(k.copyVector3sArray(g))}this.morphAttributes[d]=c}0<a.skinIndices.length&&(d=new b.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute("skinIndex",d.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&
(d=new b.Float32Attribute(4*a.skinWeights.length,4),this.addAttribute("skinWeight",d.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new b.Box3);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||
isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new b.Box3,c=new b.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new b.Sphere);var d=this.attributes.position.array;if(d){var e=this.boundingSphere.center;a.setFromArray(d);a.center(e);for(var f=0,h=0,g=d.length;h<g;h+=3)c.fromArray(d,h),f=Math.max(f,
e.distanceToSquared(c));this.boundingSphere.radius=Math.sqrt(f);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,c=this.attributes,d=this.groups;if(c.position){var e=c.position.array;if(void 0===c.normal)this.addAttribute("normal",new b.BufferAttribute(new Float32Array(e.length),3));
else for(var f=c.normal.array,h=0,g=f.length;h<g;h++)f[h]=0;var f=c.normal.array,k,r,v,q=new b.Vector3,p=new b.Vector3,l=new b.Vector3,t=new b.Vector3,s=new b.Vector3;if(a){a=a.array;0===d.length&&this.addGroup(0,a.length);for(var x=0,y=d.length;x<y;++x)for(h=d[x],g=h.start,k=h.count,h=g,g+=k;h<g;h+=3)k=3*a[h+0],r=3*a[h+1],v=3*a[h+2],q.fromArray(e,k),p.fromArray(e,r),l.fromArray(e,v),t.subVectors(l,p),s.subVectors(q,p),t.cross(s),f[k]+=t.x,f[k+1]+=t.y,f[k+2]+=t.z,f[r]+=t.x,f[r+1]+=t.y,f[r+2]+=t.z,
f[v]+=t.x,f[v+1]+=t.y,f[v+2]+=t.z}else for(h=0,g=e.length;h<g;h+=9)q.fromArray(e,h),p.fromArray(e,h+3),l.fromArray(e,h+6),t.subVectors(l,p),s.subVectors(q,p),t.cross(s),f[h]=t.x,f[h+1]=t.y,f[h+2]=t.z,f[h+3]=t.x,f[h+4]=t.y,f[h+5]=t.z,f[h+6]=t.x,f[h+7]=t.y,f[h+8]=t.z;this.normalizeNormals();c.normal.needsUpdate=!0}},merge:function(a,c){if(!1===a instanceof b.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===c&&(c=0);var d=
this.attributes,e;for(e in d)if(void 0!==a.attributes[e])for(var f=d[e].array,h=a.attributes[e],g=h.array,k=0,h=h.itemSize*c;k<g.length;k++,h++)f[h]=g[k];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,d,e,f=0,h=a.length;f<h;f+=3)b=a[f],d=a[f+1],e=a[f+2],b=1/Math.sqrt(b*b+d*d+e*e),a[f]*=b,a[f+1]*=b,a[f+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new b.BufferGeometry,
c=this.index.array,d=this.attributes,e;for(e in d){for(var f=d[e],h=f.array,f=f.itemSize,g=new h.constructor(c.length*f),k=0,r=0,v=0,q=c.length;v<q;v++)for(var k=c[v]*f,p=0;p<f;p++)g[r++]=h[k++];a.addAttribute(e,new b.BufferAttribute(g,f))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,d;for(d in b)void 0!==b[d]&&
(a[d]=b[d]);return a}a.data={attributes:{}};var e=this.index;null!==e&&(b=Array.prototype.slice.call(e.array),a.data.index={type:e.array.constructor.name,array:b});e=this.attributes;for(d in e){var f=e[d],b=Array.prototype.slice.call(f.array);a.data.attributes[d]={itemSize:f.itemSize,type:f.array.constructor.name,array:b,normalized:f.normalized}}d=this.groups;0<d.length&&(a.data.groups=JSON.parse(JSON.stringify(d)));d=this.boundingSphere;null!==d&&(a.data.boundingSphere={center:d.center.toArray(),
radius:d.radius});return a},clone:function(){return(new b.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,d;for(d in b)this.addAttribute(d,b[d].clone());a=a.groups;d=0;for(b=a.length;d<b;d++){var e=a[d];this.addGroup(e.start,e.count,e.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.BufferGeometry.prototype);b.BufferGeometry.MaxIndex=65535;b.InstancedBufferGeometry=
function(){b.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0};b.InstancedBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.InstancedBufferGeometry.prototype.constructor=b.InstancedBufferGeometry;b.InstancedBufferGeometry.prototype.addGroup=function(a,b,d){this.groups.push({start:a,count:b,instances:d})};b.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,d;for(d in b)this.addAttribute(d,
b[d].clone());a=a.groups;d=0;for(b=a.length;d<b;d++){var e=a[d];this.addGroup(e.start,e.count,e.instances)}return this};b.EventDispatcher.prototype.apply(b.InstancedBufferGeometry.prototype);b.InterleavedBufferAttribute=function(a,c,d){this.uuid=b.Math.generateUUID();this.data=a;this.itemSize=c;this.offset=d};b.InterleavedBufferAttribute.prototype={constructor:b.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},
get count(){return this.data.count},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+
this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;return this},setXYZ:function(a,b,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;this.data.array[a+2]=e;return this},setXYZW:function(a,b,d,e,f){a=a*this.data.stride+this.offset;this.data.array[a+0]=
b;this.data.array[a+1]=d;this.data.array[a+2]=e;this.data.array[a+3]=f;return this}};b.Camera=function(){b.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new b.Matrix4;this.projectionMatrix=new b.Matrix4};b.Camera.prototype=Object.create(b.Object3D.prototype);b.Camera.prototype.constructor=b.Camera;b.Camera.prototype.getWorldDirection=function(){var a=new b.Quaternion;return function(c){c=c||new b.Vector3;this.getWorldQuaternion(a);return c.set(0,0,-1).applyQuaternion(a)}}();b.Camera.prototype.lookAt=
function(){var a=new b.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();b.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};b.Camera.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};b.PerspectiveCamera=function(a,c,d,e){b.Camera.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:
50;this.zoom=1;this.near=void 0!==d?d:.1;this.far=void 0!==e?e:2E3;this.focus=10;this.aspect=void 0!==c?c:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype=Object.create(b.Camera.prototype);b.PerspectiveCamera.prototype.constructor=b.PerspectiveCamera;b.PerspectiveCamera.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==
b&&(this.filmGauge=b);this.setFocalLength(a)};b.PerspectiveCamera.prototype.setFocalLength=function(a){a=.5*this.getFilmHeight()/a;this.fov=2*b.Math.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.getFocalLength=function(){var a=Math.tan(.5*b.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a};b.PerspectiveCamera.prototype.getEffectiveFOV=function(){return 2*b.Math.RAD2DEG*Math.atan(Math.tan(.5*b.Math.DEG2RAD*this.fov)/this.zoom)};b.PerspectiveCamera.prototype.getFilmWidth=
function(){return this.filmGauge*Math.min(this.aspect,1)};b.PerspectiveCamera.prototype.getFilmHeight=function(){return this.filmGauge/Math.max(this.aspect,1)};b.PerspectiveCamera.prototype.setViewOffset=function(a,b,d,e,f,h){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:d,offsetY:e,width:f,height:h};this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=this.near,c=a*Math.tan(.5*b.Math.DEG2RAD*this.fov)/this.zoom,d=2*c,e=this.aspect*d,f=
-.5*e,h=this.view;if(null!==h)var g=h.fullWidth,k=h.fullHeight,f=f+h.offsetX*e/g,c=c-h.offsetY*d/k,e=h.width/g*e,d=h.height/k*d;h=this.filmOffset;0!==h&&(f+=a*h/this.getFilmWidth());this.projectionMatrix.makeFrustum(f,f+e,c-d,c,a,this.far)};b.PerspectiveCamera.prototype.copy=function(a){b.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;
this.filmOffset=a.filmOffset;return this};b.PerspectiveCamera.prototype.toJSON=function(a){a=b.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a};b.Light=function(a,c){b.Object3D.call(this);this.type="Light";this.color=new b.Color(a);
this.intensity=void 0!==c?c:1;this.receiveShadow=void 0};b.Light.prototype=Object.create(b.Object3D.prototype);b.Light.prototype.constructor=b.Light;b.Light.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this};b.Light.prototype.toJSON=function(a){a=b.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());
void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a};b.AmbientLight=function(a,c){b.Light.call(this,a,c);this.type="AmbientLight";this.castShadow=void 0};b.AmbientLight.prototype=Object.create(b.Light.prototype);b.AmbientLight.prototype.constructor=b.AmbientLight;b.PointLight=function(a,c,d,e){b.Light.call(this,a,c);this.type="PointLight";
this.distance=void 0!==d?d:0;this.decay=void 0!==e?e:1;this.shadow=new b.LightShadow(new b.PerspectiveCamera(90,1,.5,500))};b.PointLight.prototype=Object.create(b.Light.prototype);b.PointLight.prototype.constructor=b.PointLight;Object.defineProperty(b.PointLight.prototype,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});b.PointLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=
a.shadow.clone();return this};b.DirectionalLight=function(a,c){b.Light.call(this,a,c);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new b.Object3D;this.shadow=new b.DirectionalLightShadow};b.DirectionalLight.prototype=Object.create(b.Light.prototype);b.DirectionalLight.prototype.constructor=b.DirectionalLight;b.DirectionalLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this};
b.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new b.Vector2(512,512);this.map=null;this.matrix=new b.Matrix4};b.LightShadow.prototype={constructor:b.LightShadow,copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}};b.SpotLight=function(a,c,d,e,f,h){b.Light.call(this,a,c);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();
this.target=new b.Object3D;this.distance=void 0!==d?d:0;this.angle=void 0!==e?e:Math.PI/3;this.penumbra=void 0!==f?f:0;this.decay=void 0!==h?h:1;this.shadow=new b.SpotLightShadow};b.SpotLight.prototype=Object.create(b.Light.prototype);b.SpotLight.prototype.constructor=b.SpotLight;Object.defineProperty(b.SpotLight.prototype,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});b.SpotLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.distance=
a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this};b.Material=function(){Object.defineProperty(this,"id",{value:b.MaterialIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Material";this.side=b.FrontSide;this.opacity=1;this.transparent=!1;this.blending=b.NormalBlending;this.blendSrc=b.SrcAlphaFactor;this.blendDst=b.OneMinusSrcAlphaFactor;this.blendEquation=b.AddEquation;this.blendEquationAlpha=
this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=b.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};b.Material.prototype={constructor:b.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=
a},setValues:function(a){if(void 0!==a)for(var c in a){var d=a[c];if(void 0===d)console.warn("THREE.Material: '"+c+"' parameter is undefined.");else{var e=this[c];void 0===e?console.warn("THREE."+this.type+": '"+c+"' is not a property of this material."):e instanceof b.Color?e.set(d):e instanceof b.Vector3&&d instanceof b.Vector3?e.copy(d):this[c]="overdraw"===c?Number(d):d}}},toJSON:function(a){function c(a){var b=[],d;for(d in a){var c=a[d];delete c.metadata;b.push(c)}return b}var d=void 0===a;
d&&(a={textures:{},images:{}});var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);this.color instanceof b.Color&&(e.color=this.color.getHex());.5!==this.roughness&&(e.roughness=this.roughness);.5!==this.metalness&&(e.metalness=this.metalness);this.emissive instanceof b.Color&&(e.emissive=this.emissive.getHex());this.specular instanceof b.Color&&(e.specular=this.specular.getHex());void 0!==this.shininess&&
(e.shininess=this.shininess);this.map instanceof b.Texture&&(e.map=this.map.toJSON(a).uuid);this.alphaMap instanceof b.Texture&&(e.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof b.Texture&&(e.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof b.Texture&&(e.bumpMap=this.bumpMap.toJSON(a).uuid,e.bumpScale=this.bumpScale);this.normalMap instanceof b.Texture&&(e.normalMap=this.normalMap.toJSON(a).uuid,e.normalScale=this.normalScale.toArray());this.displacementMap instanceof
b.Texture&&(e.displacementMap=this.displacementMap.toJSON(a).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias);this.roughnessMap instanceof b.Texture&&(e.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof b.Texture&&(e.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap instanceof b.Texture&&(e.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof b.Texture&&(e.specularMap=this.specularMap.toJSON(a).uuid);
this.envMap instanceof b.Texture&&(e.envMap=this.envMap.toJSON(a).uuid,e.reflectivity=this.reflectivity);void 0!==this.size&&(e.size=this.size);void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation);void 0!==this.vertexColors&&this.vertexColors!==b.NoColors&&(e.vertexColors=this.vertexColors);void 0!==this.shading&&this.shading!==b.SmoothShading&&(e.shading=this.shading);void 0!==this.blending&&this.blending!==b.NormalBlending&&(e.blending=this.blending);void 0!==this.side&&this.side!==
b.FrontSide&&(e.side=this.side);1>this.opacity&&(e.opacity=this.opacity);!0===this.transparent&&(e.transparent=this.transparent);0<this.alphaTest&&(e.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(e.wireframe=this.wireframe);1<this.wireframeLinewidth&&(e.wireframeLinewidth=this.wireframeLinewidth);d&&(d=c(a.textures),a=c(a.images),0<d.length&&(e.textures=d),0<a.length&&(e.images=a));return e},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.name=a.name;this.side=a.side;this.opacity=a.opacity;this.transparent=a.transparent;this.blending=a.blending;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;
this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==a)for(var d=a.length,b=Array(d),e=0;e!==d;++e)b[e]=a[e].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.Material.prototype);
b.MaterialIdCount=0;b.LineBasicMaterial=function(a){b.Material.call(this);this.type="LineBasicMaterial";this.color=new b.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=!0;this.setValues(a)};b.LineBasicMaterial.prototype=Object.create(b.Material.prototype);b.LineBasicMaterial.prototype.constructor=b.LineBasicMaterial;b.LineBasicMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);
this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.LineDashedMaterial=function(a){b.Material.call(this);this.type="LineDashedMaterial";this.color=new b.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=!0;this.setValues(a)};b.LineDashedMaterial.prototype=Object.create(b.Material.prototype);b.LineDashedMaterial.prototype.constructor=
b.LineDashedMaterial;b.LineDashedMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.MeshBasicMaterial=function(a){b.Material.call(this);this.type="MeshBasicMaterial";this.color=new b.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=
b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshBasicMaterial.prototype=Object.create(b.Material.prototype);b.MeshBasicMaterial.prototype.constructor=b.MeshBasicMaterial;b.MeshBasicMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=
a.skinning;this.morphTargets=a.morphTargets;return this};b.MeshLambertMaterial=function(a){b.Material.call(this);this.type="MeshLambertMaterial";this.color=new b.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.blending=b.NormalBlending;
this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshLambertMaterial.prototype=Object.create(b.Material.prototype);b.MeshLambertMaterial.prototype.constructor=b.MeshLambertMaterial;b.MeshLambertMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=
a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=
a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};b.MultiMaterial=function(a){this.uuid=b.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0};b.MultiMaterial.prototype={constructor:b.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},d=this.materials,
e=0,f=d.length;e<f;e++){var h=d[e].toJSON(a);delete h.metadata;b.materials.push(h)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};b.PointsMaterial=function(a){b.Material.call(this);this.type="PointsMaterial";this.color=new b.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=
!0;this.setValues(a)};b.PointsMaterial.prototype=Object.create(b.Material.prototype);b.PointsMaterial.prototype.constructor=b.PointsMaterial;b.PointsMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.MeshPhongMaterial=function(a){b.Material.call(this);this.type="MeshPhongMaterial";this.color=new b.Color(16777215);this.specular=
new b.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new b.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=
!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshPhongMaterial.prototype=Object.create(b.Material.prototype);b.MeshPhongMaterial.prototype.constructor=b.MeshPhongMaterial;b.MeshPhongMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);
this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;
this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
b.MeshDepthMaterial=function(a){b.Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=b.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.setValues(a)};b.MeshDepthMaterial.prototype=Object.create(b.Material.prototype);b.MeshDepthMaterial.prototype.constructor=b.MeshDepthMaterial;b.MeshDepthMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};b.MeshNormalMaterial=function(a){b.Material.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(a)};
b.MeshNormalMaterial.prototype=Object.create(b.Material.prototype);b.MeshNormalMaterial.prototype.constructor=b.MeshNormalMaterial;b.MeshNormalMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};b.MeshStandardMaterial=function(a){b.Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new b.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=
null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new b.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.fog=!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=
!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshStandardMaterial.prototype=Object.create(b.Material.prototype);b.MeshStandardMaterial.prototype.constructor=b.MeshStandardMaterial;b.MeshStandardMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=
a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=
a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
b.MeshPhysicalMaterial=function(a){b.MeshStandardMaterial.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.setValues(a)};b.MeshPhysicalMaterial.prototype=Object.create(b.MeshStandardMaterial.prototype);b.MeshPhysicalMaterial.prototype.constructor=b.MeshPhysicalMaterial;b.MeshPhysicalMaterial.prototype.copy=function(a){b.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;return this};b.SpriteMaterial=
function(a){b.Material.call(this);this.type="SpriteMaterial";this.color=new b.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(a)};b.SpriteMaterial.prototype=Object.create(b.Material.prototype);b.SpriteMaterial.prototype.constructor=b.SpriteMaterial;b.SpriteMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;this.fog=a.fog;return this};b.ShaderMaterial=function(a){b.Material.call(this);
this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=b.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.clipping=this.lights=this.fog=!1;this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.extensions={derivatives:!1,
fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))};b.ShaderMaterial.prototype=Object.create(b.Material.prototype);b.ShaderMaterial.prototype.constructor=b.ShaderMaterial;b.ShaderMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=b.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.fog=a.fog;this.lights=a.lights;this.clipping=a.clipping;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};b.ShaderMaterial.prototype.toJSON=function(a){a=
b.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};b.RawShaderMaterial=function(a){b.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};b.RawShaderMaterial.prototype=Object.create(b.ShaderMaterial.prototype);b.RawShaderMaterial.prototype.constructor=b.RawShaderMaterial;b.Texture=function(a,c,d,e,f,h,g,k,r,v){Object.defineProperty(this,"id",{value:b.TextureIdCount++});this.uuid=b.Math.generateUUID();
this.sourceFile=this.name="";this.image=void 0!==a?a:b.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==c?c:b.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==d?d:b.ClampToEdgeWrapping;this.wrapT=void 0!==e?e:b.ClampToEdgeWrapping;this.magFilter=void 0!==f?f:b.LinearFilter;this.minFilter=void 0!==h?h:b.LinearMipMapLinearFilter;this.anisotropy=void 0!==r?r:1;this.format=void 0!==g?g:b.RGBAFormat;this.type=void 0!==k?k:b.UnsignedByteType;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,
1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==v?v:b.LinearEncoding;this.version=0;this.onUpdate=null};b.Texture.DEFAULT_IMAGE=void 0;b.Texture.DEFAULT_MAPPING=b.UVMapping;b.Texture.prototype={constructor:b.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=
a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},
uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=b.Math.generateUUID());if(void 0===a.images[d.uuid]){var e=a.images,f=d.uuid,h=d.uuid,g;void 0!==d.toDataURL?g=d:(g=document.createElement("canvas"),g.width=d.width,g.height=d.height,g.getContext("2d").drawImage(d,
0,0,d.width,d.height));g=2048<g.width||2048<g.height?g.toDataURL("image/jpeg",.6):g.toDataURL("image/png");e[f]={uuid:h,url:g}}c.image=d.uuid}return a.textures[this.uuid]=c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(this.mapping===b.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case b.RepeatWrapping:a.x-=Math.floor(a.x);break;case b.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case b.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%
2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case b.RepeatWrapping:a.y-=Math.floor(a.y);break;case b.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case b.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};b.EventDispatcher.prototype.apply(b.Texture.prototype);b.TextureIdCount=0;b.DepthTexture=function(a,c,d,e,f,h,g,k,r){b.Texture.call(this,null,e,f,h,g,k,b.DepthFormat,d,r);this.image={width:a,
height:c};this.type=void 0!==d?d:b.UnsignedShortType;this.magFilter=void 0!==g?g:b.NearestFilter;this.minFilter=void 0!==k?k:b.NearestFilter;this.generateMipmaps=this.flipY=!1};b.DepthTexture.prototype=Object.create(b.Texture.prototype);b.DepthTexture.prototype.constructor=b.DepthTexture;b.CompressedTexture=function(a,c,d,e,f,h,g,k,r,v,q,p){b.Texture.call(this,null,h,g,k,r,v,e,f,q,p);this.image={width:c,height:d};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};b.CompressedTexture.prototype=Object.create(b.Texture.prototype);
b.CompressedTexture.prototype.constructor=b.CompressedTexture;b.DataTexture=function(a,c,d,e,f,h,g,k,r,v,q,p){b.Texture.call(this,null,h,g,k,r,v,e,f,q,p);this.image={data:a,width:c,height:d};this.magFilter=void 0!==r?r:b.NearestFilter;this.minFilter=void 0!==v?v:b.NearestFilter;this.generateMipmaps=this.flipY=!1};b.DataTexture.prototype=Object.create(b.Texture.prototype);b.DataTexture.prototype.constructor=b.DataTexture;b.Line=function(a,c,d){if(1===d)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
new b.LineSegments(a,c);b.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new b.Geometry;this.material=void 0!==c?c:new b.LineBasicMaterial({color:16777215*Math.random()})};b.Line.prototype=Object.create(b.Object3D.prototype);b.Line.prototype.constructor=b.Line;b.Line.prototype.raycast=function(){var a=new b.Matrix4,c=new b.Ray,d=new b.Sphere;return function(e,f){var h=e.linePrecision,h=h*h,g=this.geometry,k=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();d.copy(g.boundingSphere);
d.applyMatrix4(k);if(!1!==e.ray.intersectsSphere(d)){a.getInverse(k);c.copy(e.ray).applyMatrix4(a);var r=new b.Vector3,v=new b.Vector3,k=new b.Vector3,q=new b.Vector3,p=this instanceof b.LineSegments?2:1;if(g instanceof b.BufferGeometry){var l=g.index,t=g.attributes.position.array;if(null!==l)for(var l=l.array,g=0,s=l.length-1;g<s;g+=p){var x=l[g+1];r.fromArray(t,3*l[g]);v.fromArray(t,3*x);x=c.distanceSqToSegment(r,v,q,k);x>h||(q.applyMatrix4(this.matrixWorld),x=e.ray.origin.distanceTo(q),x<e.near||
x>e.far||f.push({distance:x,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,s=t.length/3-1;g<s;g+=p)r.fromArray(t,3*g),v.fromArray(t,3*g+3),x=c.distanceSqToSegment(r,v,q,k),x>h||(q.applyMatrix4(this.matrixWorld),x=e.ray.origin.distanceTo(q),x<e.near||x>e.far||f.push({distance:x,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof b.Geometry)for(r=g.vertices,v=r.length,g=0;g<v-
1;g+=p)x=c.distanceSqToSegment(r[g],r[g+1],q,k),x>h||(q.applyMatrix4(this.matrixWorld),x=e.ray.origin.distanceTo(q),x<e.near||x>e.far||f.push({distance:x,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}();b.Line.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.LineStrip=0;b.LinePieces=1;b.Points=function(a,c){b.Object3D.call(this);this.type="Points";this.geometry=void 0!==a?a:new b.Geometry;this.material=
void 0!==c?c:new b.PointsMaterial({color:16777215*Math.random()})};b.Points.prototype=Object.create(b.Object3D.prototype);b.Points.prototype.constructor=b.Points;b.Points.prototype.raycast=function(){var a=new b.Matrix4,c=new b.Ray,d=new b.Sphere;return function(e,f){function h(a,b){var d=c.distanceSqToPoint(a);if(d<q){var h=c.closestPointToPoint(a);h.applyMatrix4(r);var l=e.ray.origin.distanceTo(h);l<e.near||l>e.far||f.push({distance:l,distanceToRay:Math.sqrt(d),point:h.clone(),index:b,face:null,
object:g})}}var g=this,k=this.geometry,r=this.matrixWorld,v=e.params.Points.threshold;null===k.boundingSphere&&k.computeBoundingSphere();d.copy(k.boundingSphere);d.applyMatrix4(r);if(!1!==e.ray.intersectsSphere(d)){a.getInverse(r);c.copy(e.ray).applyMatrix4(a);var v=v/((this.scale.x+this.scale.y+this.scale.z)/3),q=v*v,v=new b.Vector3;if(k instanceof b.BufferGeometry){var p=k.index,k=k.attributes.position.array;if(null!==p)for(var l=p.array,p=0,t=l.length;p<t;p++){var s=l[p];v.fromArray(k,3*s);h(v,
s)}else for(p=0,l=k.length/3;p<l;p++)v.fromArray(k,3*p),h(v,p)}else for(v=k.vertices,p=0,l=v.length;p<l;p++)h(v[p],p)}}}();b.Points.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.LineSegments=function(a,c){b.Line.call(this,a,c);this.type="LineSegments"};b.LineSegments.prototype=Object.create(b.Line.prototype);b.LineSegments.prototype.constructor=b.LineSegments;b.Mesh=function(a,c){b.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:
new b.Geometry;this.material=void 0!==c?c:new b.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=b.TrianglesDrawMode;this.updateMorphTargets()};b.Mesh.prototype=Object.create(b.Object3D.prototype);b.Mesh.prototype.constructor=b.Mesh;b.Mesh.prototype.setDrawMode=function(a){this.drawMode=a};b.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary=
{};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};b.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};b.Mesh.prototype.raycast=function(){function a(a,d,c,e,f,h,g){b.Triangle.barycoordFromPoint(a,
d,c,e,x);f.multiplyScalar(x.x);h.multiplyScalar(x.y);g.multiplyScalar(x.z);f.add(h).add(g);return f.clone()}function c(a,d,c,e,f,h,g){var l=a.material;if(null===(l.side===b.BackSide?c.intersectTriangle(h,f,e,!0,g):c.intersectTriangle(e,f,h,l.side!==b.DoubleSide,g)))return null;w.copy(g);w.applyMatrix4(a.matrixWorld);c=d.ray.origin.distanceTo(w);return c<d.near||c>d.far?null:{distance:c,point:w.clone(),object:a}}function d(d,e,f,h,p,q,v,x){g.fromArray(h,3*q);k.fromArray(h,3*v);r.fromArray(h,3*x);if(d=
c(d,e,f,g,k,r,y))p&&(l.fromArray(p,2*q),t.fromArray(p,2*v),s.fromArray(p,2*x),d.uv=a(y,g,k,r,l,t,s)),d.face=new b.Face3(q,v,x,b.Triangle.normal(g,k,r)),d.faceIndex=q;return d}var e=new b.Matrix4,f=new b.Ray,h=new b.Sphere,g=new b.Vector3,k=new b.Vector3,r=new b.Vector3,v=new b.Vector3,q=new b.Vector3,p=new b.Vector3,l=new b.Vector2,t=new b.Vector2,s=new b.Vector2,x=new b.Vector3,y=new b.Vector3,w=new b.Vector3;return function(n,x){var w=this.geometry,N=this.material,I=this.matrixWorld;if(void 0!==
N&&(null===w.boundingSphere&&w.computeBoundingSphere(),h.copy(w.boundingSphere),h.applyMatrix4(I),!1!==n.ray.intersectsSphere(h)&&(e.getInverse(I),f.copy(n.ray).applyMatrix4(e),null===w.boundingBox||!1!==f.intersectsBox(w.boundingBox)))){var L,F;if(w instanceof b.BufferGeometry){var O,M,N=w.index,I=w.attributes,w=I.position.array;void 0!==I.uv&&(L=I.uv.array);if(null!==N)for(var I=N.array,R=0,D=I.length;R<D;R+=3){if(N=I[R],O=I[R+1],M=I[R+2],F=d(this,n,f,w,L,N,O,M))F.faceIndex=Math.floor(R/3),x.push(F)}else for(R=
0,D=w.length;R<D;R+=9)if(N=R/3,O=N+1,M=N+2,F=d(this,n,f,w,L,N,O,M))F.index=N,x.push(F)}else if(w instanceof b.Geometry){var H,S,I=N instanceof b.MultiMaterial,R=!0===I?N.materials:null,D=w.vertices;O=w.faces;M=w.faceVertexUvs[0];0<M.length&&(L=M);for(var C=0,Q=O.length;C<Q;C++){var J=O[C];F=!0===I?R[J.materialIndex]:N;if(void 0!==F){M=D[J.a];H=D[J.b];S=D[J.c];if(!0===F.morphTargets){F=w.morphTargets;var K=this.morphTargetInfluences;g.set(0,0,0);k.set(0,0,0);r.set(0,0,0);for(var G=0,P=F.length;G<P;G++){var U=
K[G];if(0!==U){var W=F[G].vertices;g.addScaledVector(v.subVectors(W[J.a],M),U);k.addScaledVector(q.subVectors(W[J.b],H),U);r.addScaledVector(p.subVectors(W[J.c],S),U)}}g.add(M);k.add(H);r.add(S);M=g;H=k;S=r}if(F=c(this,n,f,M,H,S,y))L&&(K=L[C],l.copy(K[0]),t.copy(K[1]),s.copy(K[2]),F.uv=a(y,M,H,S,l,t,s)),F.face=J,F.faceIndex=C,x.push(F)}}}}}}();b.Mesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.SkinnedMesh=function(a,c,d){b.Mesh.call(this,a,c);
this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new b.Matrix4;this.bindMatrixInverse=new b.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var e,f=0,h=this.geometry.bones.length;f<h;++f)e=this.geometry.bones[f],c=new b.Bone(this),a.push(c),c.name=e.name,c.position.fromArray(e.pos),c.quaternion.fromArray(e.rotq),void 0!==e.scl&&c.scale.fromArray(e.scl);f=0;for(h=this.geometry.bones.length;f<h;++f)e=this.geometry.bones[f],-1!==e.parent&&null!==e.parent&&void 0!==a[e.parent]?
a[e.parent].add(a[f]):this.add(a[f])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new b.Skeleton(a,void 0,d),this.matrixWorld)};b.SkinnedMesh.prototype=Object.create(b.Mesh.prototype);b.SkinnedMesh.prototype.constructor=b.SkinnedMesh;b.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)};b.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};
b.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof b.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var c=this.geometry.skinWeights[a],d=1/c.lengthManhattan();Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0)}else if(this.geometry instanceof b.BufferGeometry)for(var c=new b.Vector4,e=this.geometry.attributes.skinWeight,a=0;a<e.count;a++)c.x=e.getX(a),c.y=e.getY(a),c.z=e.getZ(a),c.w=e.getW(a),d=1/c.lengthManhattan(),Infinity!==d?c.multiplyScalar(d):c.set(1,
0,0,0),e.setXYZW(a,c.x,c.y,c.z,c.w)};b.SkinnedMesh.prototype.updateMatrixWorld=function(a){b.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)};b.SkinnedMesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material,this.useVertexTexture)).copy(this)};
b.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),c=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),e=new b.BufferGeometry;e.setIndex(new b.BufferAttribute(a,1));e.addAttribute("position",new b.BufferAttribute(c,3));e.addAttribute("uv",new b.BufferAttribute(d,2));return function(a){b.Object3D.call(this);this.type="Sprite";this.geometry=e;this.material=void 0!==a?a:new b.SpriteMaterial}}();b.Sprite.prototype=Object.create(b.Object3D.prototype);b.Sprite.prototype.constructor=
b.Sprite;b.Sprite.prototype.raycast=function(){var a=new b.Vector3;return function(b,d){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.distanceSqToPoint(a);e>this.scale.x*this.scale.y/4||d.push({distance:Math.sqrt(e),point:this.position,face:null,object:this})}}();b.Sprite.prototype.clone=function(){return(new this.constructor(this.material)).copy(this)};b.Particle=b.Sprite;b.LensFlare=function(a,c,d,e,f){b.Object3D.call(this);this.lensFlares=[];this.positionScreen=new b.Vector3;this.customUpdateCallback=
void 0;void 0!==a&&this.add(a,c,d,e,f)};b.LensFlare.prototype=Object.create(b.Object3D.prototype);b.LensFlare.prototype.constructor=b.LensFlare;b.LensFlare.prototype.add=function(a,c,d,e,f,h){void 0===c&&(c=-1);void 0===d&&(d=0);void 0===h&&(h=1);void 0===f&&(f=new b.Color(16777215));void 0===e&&(e=b.NormalBlending);d=Math.min(d,Math.max(0,d));this.lensFlares.push({texture:a,size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:0,opacity:h,color:f,blending:e})};b.LensFlare.prototype.updateLensFlares=function(){var a,
b=this.lensFlares.length,d,e=2*-this.positionScreen.x,f=2*-this.positionScreen.y;for(a=0;a<b;a++)d=this.lensFlares[a],d.x=this.positionScreen.x+e*d.distance,d.y=this.positionScreen.y+f*d.distance,d.wantedRotation=d.x*Math.PI*.25,d.rotation+=.25*(d.wantedRotation-d.rotation)};b.LensFlare.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var c=0,d=a.lensFlares.length;c<d;c++)this.lensFlares.push(a.lensFlares[c]);
return this};b.ImmediateRenderObject=function(a){b.Object3D.call(this);this.material=a;this.render=function(a){}};b.ImmediateRenderObject.prototype=Object.create(b.Object3D.prototype);b.ImmediateRenderObject.prototype.constructor=b.ImmediateRenderObject;b.Scene=function(){b.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};b.Scene.prototype=Object.create(b.Object3D.prototype);b.Scene.prototype.constructor=b.Scene;b.Scene.prototype.copy=function(a,c){b.Object3D.prototype.copy.call(this,
a,c);null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};b.FogExp2=function(a,c){this.name="";this.color=new b.Color(a);this.density=void 0!==c?c:2.5E-4};b.FogExp2.prototype.clone=function(){return new b.FogExp2(this.color.getHex(),this.density)};b.ShaderChunk={};b.ShaderChunk.common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n";
b.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";b.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";b.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";b.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";b.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";
b.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n";b.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif";
b.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";b.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";b.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";
b.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";b.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";b.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";b.ShaderChunk.encodings_pars_fragment=
"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n";
b.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";b.ShaderChunk.envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";b.ShaderChunk.envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";
b.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";
b.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";
b.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";
b.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";b.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";b.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";b.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";b.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";b.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";
b.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";b.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";b.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";
b.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";b.ShaderChunk.clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";
b.ShaderChunk.clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";b.ShaderChunk.clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n";b.ShaderChunk.clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";
b.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";b.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";b.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";
b.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";b.ShaderChunk.lights_lambert_vertex=
"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";
b.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";b.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";
b.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";b.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";b.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n";
b.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif";b.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";b.ShaderChunk.packing="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nvec4 packDepthToRGBA( const in float value ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( value * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nfloat unpackRGBAToDepth( const in vec4 rgba ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( rgba, bitSh );\n}\nfloat viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";
b.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";b.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";
b.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";
b.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";
b.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";
b.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";
b.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n";b.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";
b.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";b.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";
b.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";b.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n";b.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n";b.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n";
b.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n";b.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";b.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";
b.UniformsUtils={merge:function(a){for(var b={},d=0;d<a.length;d++){var e=this.clone(a[d]),f;for(f in e)b[f]=e[f]}return b},clone:function(a){var c={},d;for(d in a){c[d]={};for(var e in a[d]){var f=a[d][e];f instanceof b.Color||f instanceof b.Vector2||f instanceof b.Vector3||f instanceof b.Vector4||f instanceof b.Matrix3||f instanceof b.Matrix4||f instanceof b.Texture?c[d][e]=f.clone():Array.isArray(f)?c[d][e]=f.slice():c[d][e]=f}}return c}};b.UniformsLib={common:{diffuse:{type:"c",value:new b.Color(15658734)},
opacity:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"1f",value:-1},reflectivity:{type:"1f",value:1},refractionRatio:{type:"1f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"1f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"1f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},
bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"1f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new b.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"1f",value:1},displacementBias:{type:"1f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"1f",value:2.5E-4},fogNear:{type:"1f",value:1},fogFar:{type:"1f",value:2E3},fogColor:{type:"c",
value:new b.Color(16777215)}},lights:{ambientLightColor:{type:"3fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"1f"},coneCos:{type:"1f"},penumbraCos:{type:"1f"},
decay:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"1f"},distance:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",
value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new b.Color(15658734)},opacity:{type:"1f",value:1},size:{type:"1f",value:1},scale:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)}}};b.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\t#include <logdepthbuf_fragment>\n}\n";
b.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";b.ShaderChunk.depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";
b.ShaderChunk.depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n";b.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n";
b.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <logdepthbuf_fragment>\n}\n";
b.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";b.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n";
b.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n";b.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderLib={basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.fog]),vertexShader:b.ShaderChunk.meshbasic_vert,fragmentShader:b.ShaderChunk.meshbasic_frag},lambert:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)}}]),vertexShader:b.ShaderChunk.meshlambert_vert,fragmentShader:b.ShaderChunk.meshlambert_frag},
phong:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.bumpmap,b.UniformsLib.normalmap,b.UniformsLib.displacementmap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"1f",value:30}}]),vertexShader:b.ShaderChunk.meshphong_vert,fragmentShader:b.ShaderChunk.meshphong_frag},standard:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,
b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.bumpmap,b.UniformsLib.normalmap,b.UniformsLib.displacementmap,b.UniformsLib.roughnessmap,b.UniformsLib.metalnessmap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)},roughness:{type:"1f",value:.5},metalness:{type:"1f",value:0},envMapIntensity:{type:"1f",value:1}}]),vertexShader:b.ShaderChunk.meshphysical_vert,fragmentShader:b.ShaderChunk.meshphysical_frag},points:{uniforms:b.UniformsUtils.merge([b.UniformsLib.points,
b.UniformsLib.fog]),vertexShader:b.ShaderChunk.points_vert,fragmentShader:b.ShaderChunk.points_frag},dashed:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,{scale:{type:"1f",value:1},dashSize:{type:"1f",value:1},totalSize:{type:"1f",value:2}}]),vertexShader:b.ShaderChunk.linedashed_vert,fragmentShader:b.ShaderChunk.linedashed_frag},depth:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.displacementmap]),vertexShader:b.ShaderChunk.depth_vert,fragmentShader:b.ShaderChunk.depth_frag},
normal:{uniforms:{opacity:{type:"1f",value:1}},vertexShader:b.ShaderChunk.normal_vert,fragmentShader:b.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:b.ShaderChunk.cube_vert,fragmentShader:b.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:b.ShaderChunk.equirect_vert,fragmentShader:b.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new b.Vector3}},
vertexShader:b.ShaderChunk.distanceRGBA_vert,fragmentShader:b.ShaderChunk.distanceRGBA_frag}};b.ShaderLib.physical={uniforms:b.UniformsUtils.merge([b.ShaderLib.standard.uniforms,{}]),vertexShader:b.ShaderChunk.meshphysical_vert,fragmentShader:b.ShaderChunk.meshphysical_frag};b.WebGLRenderer=function(a){function c(a,b,d,c){!0===G&&(a*=c,b*=c,d*=c);V.clearColor(a,b,d,c)}function d(){V.init();V.scissor(Ea.copy(la).multiplyScalar(ia));V.viewport(Z.copy(ma).multiplyScalar(ia));c(qa.r,qa.g,qa.b,ca)}function e(){wa=
ta=null;Ca="";pa=-1;V.reset()}function f(a){a.preventDefault();e();d();ha.clear()}function h(a){a=a.target;a.removeEventListener("dispose",h);a:{var b=ha.get(a);if(a.image&&b.__image__webglTextureCube)A.deleteTexture(b.__image__webglTextureCube);else{if(void 0===b.__webglInit)break a;A.deleteTexture(b.__webglTexture)}ha.delete(a)}Ia.textures--}function g(a){a=a.target;a.removeEventListener("dispose",g);var d=ha.get(a),c=ha.get(a.texture);if(a){void 0!==c.__webglTexture&&A.deleteTexture(c.__webglTexture);
a.depthTexture&&a.depthTexture.dispose();if(a instanceof b.WebGLRenderTargetCube)for(c=0;6>c;c++)A.deleteFramebuffer(d.__webglFramebuffer[c]),d.__webglDepthbuffer&&A.deleteRenderbuffer(d.__webglDepthbuffer[c]);else A.deleteFramebuffer(d.__webglFramebuffer),d.__webglDepthbuffer&&A.deleteRenderbuffer(d.__webglDepthbuffer);ha.delete(a.texture);ha.delete(a)}Ia.textures--}function k(a){a=a.target;a.removeEventListener("dispose",k);r(a);ha.delete(a)}function r(a){var b=ha.get(a).program;a.program=void 0;
void 0!==b&&Na.releaseProgram(b)}function v(a,b){return Math.abs(b[0])-Math.abs(a[0])}function q(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function p(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function l(a,b,d,c,e){var f;d.transparent?(c=T,f=++oa):(c=W,f=++aa);f=c[f];void 0!==
f?(f.id=a.id,f.object=a,f.geometry=b,f.material=d,f.z=ra.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:d,z:ra.z,group:e},c.push(f))}function t(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();var d=Ya.copy(b.boundingSphere).applyMatrix4(a.matrixWorld);if(!ga.intersectsSphere(d))return!1;if(0===ua)return!0;a=ka.clippingPlanes;var b=d.center,d=-d.radius,c=0;do if(a[c].distanceToPoint(b)<d)return!1;while(++c!==ua);return!0}function s(a,d){if(!1!==a.visible){if(a.layers.test(d.layers))if(a instanceof
b.Light)U.push(a);else if(a instanceof b.Sprite)!1!==a.frustumCulled&&!0!==t(a)||da.push(a);else if(a instanceof b.LensFlare)Ja.push(a);else if(a instanceof b.ImmediateRenderObject)!0===ka.sortObjects&&(ra.setFromMatrixPosition(a.matrixWorld),ra.applyProjection(Pa)),l(a,null,a.material,ra.z,null);else if(a instanceof b.Mesh||a instanceof b.Line||a instanceof b.Points)if(a instanceof b.SkinnedMesh&&a.skeleton.update(),!1===a.frustumCulled||!0===t(a)){var c=a.material;if(!0===c.visible){!0===ka.sortObjects&&
(ra.setFromMatrixPosition(a.matrixWorld),ra.applyProjection(Pa));var e=Ka.update(a);if(c instanceof b.MultiMaterial)for(var f=e.groups,h=c.materials,c=0,g=f.length;c<g;c++){var k=f[c],m=h[k.materialIndex];!0===m.visible&&l(a,e,m,ra.z,k)}else l(a,e,c,ra.z,null)}}e=a.children;c=0;for(g=e.length;c<g;c++)s(e[c],d)}}function x(a,d,c,e){for(var f=0,h=a.length;f<h;f++){var g=a[f],l=g.object,k=g.geometry,m=void 0===e?g.material:e,g=g.group;l.modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,l.matrixWorld);
l.normalMatrix.getNormalMatrix(l.modelViewMatrix);if(l instanceof b.ImmediateRenderObject){y(m);var p=w(d,c,m,l);Ca="";l.render(function(a){ka.renderBufferImmediate(a,p,m)})}else ka.renderBufferDirect(d,c,k,m,l,g)}}function y(a){a.side!==b.DoubleSide?V.enable(A.CULL_FACE):V.disable(A.CULL_FACE);V.setFlipSided(a.side===b.BackSide);!0===a.transparent?V.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):V.setBlending(b.NoBlending);
V.setDepthFunc(a.depthFunc);V.setDepthTest(a.depthTest);V.setDepthWrite(a.depthWrite);V.setColorWrite(a.colorWrite);V.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function w(a,d,c,e){Y=0;var f=ha.get(c);if(La){if(xa||a!==wa){var h=c.clippingPlanes,g=a===wa&&c.id===pa;if(!xa||null===h||0===h.length||va&&!c.clipShadows)va?B(null):z();else{var l=va?0:Ma,m=4*l,p=f.clippingState||null;na.value=p;p=B(h,a,m,g);for(h=0;h!==m;++h)p[h]=ya[h];f.clippingState=p;ua+=l}}void 0!==
f.numClippingPlanes&&f.numClippingPlanes!==ua&&(c.needsUpdate=!0)}void 0===f.program&&(c.needsUpdate=!0);void 0!==f.lightsHash&&f.lightsHash!==fa.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{l=ha.get(c);m=Na.getParameters(c,fa,d,ua,e);p=Na.getProgramCode(c,m);h=l.program;g=!0;if(void 0===h)c.addEventListener("dispose",k);else if(h.code!==p)r(c);else if(void 0!==m.shaderID)break a;else g=!1;g&&(m.shaderID?(h=b.ShaderLib[m.shaderID],l.__webglShader={name:c.type,uniforms:b.UniformsUtils.clone(h.uniforms),
vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}):l.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=l.__webglShader,h=Na.acquireProgram(c,m,p),l.program=h,c.program=h);m=h.getAttributes();if(c.morphTargets)for(p=c.numSupportedMorphTargets=0;p<ka.maxMorphTargets;p++)0<=m["morphTarget"+p]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(p=c.numSupportedMorphNormals=0;p<ka.maxMorphNormals;p++)0<=m["morphNormal"+
p]&&c.numSupportedMorphNormals++;m=l.__webglShader.uniforms;(c instanceof b.ShaderMaterial||c instanceof b.RawShaderMaterial)&&!0!==c.clipping||(l.numClippingPlanes=ua,m.clippingPlanes=na);if(c instanceof b.MeshPhongMaterial||c instanceof b.MeshLambertMaterial||c instanceof b.MeshStandardMaterial||c.lights)l.lightsHash=fa.hash,m.ambientLightColor.value=fa.ambient,m.directionalLights.value=fa.directional,m.spotLights.value=fa.spot,m.pointLights.value=fa.point,m.hemisphereLights.value=fa.hemi,m.directionalShadowMap.value=
fa.directionalShadowMap,m.directionalShadowMatrix.value=fa.directionalShadowMatrix,m.spotShadowMap.value=fa.spotShadowMap,m.spotShadowMatrix.value=fa.spotShadowMatrix,m.pointShadowMap.value=fa.pointShadowMap,m.pointShadowMatrix.value=fa.pointShadowMatrix;p=l.program.getUniforms();p=b.WebGLUniforms.seqWithValue(p.seq,m);l.uniformsList=p;l.dynamicUniforms=b.WebGLUniforms.splitDynamic(p,m)}c.needsUpdate=!1}var t=!1,g=h=!1,l=f.program,p=l.getUniforms(),m=f.__webglShader.uniforms;l.id!==ta&&(A.useProgram(l.program),
ta=l.id,g=h=t=!0);c.id!==pa&&(pa=c.id,h=!0);if(t||a!==wa){p.set(A,a,"projectionMatrix");za.logarithmicDepthBuffer&&p.setValue(A,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==wa&&(wa=a,g=h=!0);if(c instanceof b.ShaderMaterial||c instanceof b.MeshPhongMaterial||c instanceof b.MeshStandardMaterial||c.envMap)t=p.map.cameraPosition,void 0!==t&&t.setValue(A,ra.setFromMatrixPosition(a.matrixWorld));(c instanceof b.MeshPhongMaterial||c instanceof b.MeshLambertMaterial||c instanceof b.MeshBasicMaterial||
c instanceof b.MeshStandardMaterial||c instanceof b.ShaderMaterial||c.skinning)&&p.setValue(A,"viewMatrix",a.matrixWorldInverse);p.set(A,ka,"toneMappingExposure");p.set(A,ka,"toneMappingWhitePoint")}c.skinning&&(p.setOptional(A,e,"bindMatrix"),p.setOptional(A,e,"bindMatrixInverse"),t=e.skeleton)&&(za.floatVertexTextures&&t.useVertexTexture?(p.set(A,t,"boneTexture"),p.set(A,t,"boneTextureWidth"),p.set(A,t,"boneTextureHeight")):p.setOptional(A,t,"boneMatrices"));if(h){if(c instanceof b.MeshPhongMaterial||
c instanceof b.MeshLambertMaterial||c instanceof b.MeshStandardMaterial||c.lights)h=g,m.ambientLightColor.needsUpdate=h,m.directionalLights.needsUpdate=h,m.pointLights.needsUpdate=h,m.spotLights.needsUpdate=h,m.hemisphereLights.needsUpdate=h;d&&c.fog&&(m.fogColor.value=d.color,d instanceof b.Fog?(m.fogNear.value=d.near,m.fogFar.value=d.far):d instanceof b.FogExp2&&(m.fogDensity.value=d.density));if(c instanceof b.MeshBasicMaterial||c instanceof b.MeshLambertMaterial||c instanceof b.MeshPhongMaterial||
c instanceof b.MeshStandardMaterial||c instanceof b.MeshDepthMaterial){m.opacity.value=c.opacity;m.diffuse.value=c.color;c.emissive&&m.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);m.map.value=c.map;m.specularMap.value=c.specularMap;m.alphaMap.value=c.alphaMap;c.aoMap&&(m.aoMap.value=c.aoMap,m.aoMapIntensity.value=c.aoMapIntensity);var s;c.map?s=c.map:c.specularMap?s=c.specularMap:c.displacementMap?s=c.displacementMap:c.normalMap?s=c.normalMap:c.bumpMap?s=c.bumpMap:c.roughnessMap?
s=c.roughnessMap:c.metalnessMap?s=c.metalnessMap:c.alphaMap?s=c.alphaMap:c.emissiveMap&&(s=c.emissiveMap);void 0!==s&&(s instanceof b.WebGLRenderTarget&&(s=s.texture),d=s.offset,s=s.repeat,m.offsetRepeat.value.set(d.x,d.y,s.x,s.y));m.envMap.value=c.envMap;m.flipEnvMap.value=c.envMap instanceof b.WebGLRenderTargetCube?1:-1;m.reflectivity.value=c.reflectivity;m.refractionRatio.value=c.refractionRatio}c instanceof b.LineBasicMaterial?(m.diffuse.value=c.color,m.opacity.value=c.opacity):c instanceof b.LineDashedMaterial?
(m.diffuse.value=c.color,m.opacity.value=c.opacity,m.dashSize.value=c.dashSize,m.totalSize.value=c.dashSize+c.gapSize,m.scale.value=c.scale):c instanceof b.PointsMaterial?(m.diffuse.value=c.color,m.opacity.value=c.opacity,m.size.value=c.size*ia,m.scale.value=.5*H.clientHeight,m.map.value=c.map,null!==c.map&&(s=c.map.offset,c=c.map.repeat,m.offsetRepeat.value.set(s.x,s.y,c.x,c.y))):c instanceof b.MeshLambertMaterial?(c.lightMap&&(m.lightMap.value=c.lightMap,m.lightMapIntensity.value=c.lightMapIntensity),
c.emissiveMap&&(m.emissiveMap.value=c.emissiveMap)):c instanceof b.MeshPhongMaterial?(m.specular.value=c.specular,m.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(m.lightMap.value=c.lightMap,m.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(m.emissiveMap.value=c.emissiveMap),c.bumpMap&&(m.bumpMap.value=c.bumpMap,m.bumpScale.value=c.bumpScale),c.normalMap&&(m.normalMap.value=c.normalMap,m.normalScale.value.copy(c.normalScale)),c.displacementMap&&(m.displacementMap.value=c.displacementMap,
m.displacementScale.value=c.displacementScale,m.displacementBias.value=c.displacementBias)):c instanceof b.MeshPhysicalMaterial?n(m,c):c instanceof b.MeshStandardMaterial?n(m,c):c instanceof b.MeshDepthMaterial?c.displacementMap&&(m.displacementMap.value=c.displacementMap,m.displacementScale.value=c.displacementScale,m.displacementBias.value=c.displacementBias):c instanceof b.MeshNormalMaterial&&(m.opacity.value=c.opacity);b.WebGLUniforms.upload(A,f.uniformsList,m,ka)}p.set(A,e,"modelViewMatrix");
p.set(A,e,"normalMatrix");p.setValue(A,"modelMatrix",e.matrixWorld);f=f.dynamicUniforms;null!==f&&(b.WebGLUniforms.evalDynamic(f,m,e,a),b.WebGLUniforms.upload(A,f,m,ka));return l}function n(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);
b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function B(a,b,c,d){var e=null!==a?a.length:0,f=null;if(0!==e){f=na.value;if(!0!==d||null===f){var h=c+4*e;b=b.matrixWorldInverse;d=Xa.getNormalMatrix(b);
if(null===f||f.length<h)f=new Float32Array(h);for(h=0;h!==e;++h,c+=4){var g=Za.copy(a[h]).applyMatrix4(b,d);g.normal.toArray(f,c);f[c+3]=g.constant}}na.value=f;na.needsUpdate=!0}ua=e;return f}function z(){na.value!==ya&&(na.value=ya,na.needsUpdate=0<Ma);ua=Ma}function N(a,c,d){d?(A.texParameteri(a,A.TEXTURE_WRAP_S,D(c.wrapS)),A.texParameteri(a,A.TEXTURE_WRAP_T,D(c.wrapT)),A.texParameteri(a,A.TEXTURE_MAG_FILTER,D(c.magFilter)),A.texParameteri(a,A.TEXTURE_MIN_FILTER,D(c.minFilter))):(A.texParameteri(a,
A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(a,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),c.wrapS===b.ClampToEdgeWrapping&&c.wrapT===b.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",c),A.texParameteri(a,A.TEXTURE_MAG_FILTER,R(c.magFilter)),A.texParameteri(a,A.TEXTURE_MIN_FILTER,R(c.minFilter)),c.minFilter!==b.NearestFilter&&c.minFilter!==b.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",
c));!(d=ja.get("EXT_texture_filter_anisotropic"))||c.type===b.FloatType&&null===ja.get("OES_texture_float_linear")||c.type===b.HalfFloatType&&null===ja.get("OES_texture_half_float_linear")||!(1<c.anisotropy||ha.get(c).__currentAnisotropy)||(A.texParameterf(a,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(c.anisotropy,ka.getMaxAnisotropy())),ha.get(c).__currentAnisotropy=c.anisotropy)}function I(a,c){a instanceof b.WebGLRenderTarget&&(a=a.texture);var d=ha.get(a);if(0<a.version&&d.__version!==a.version){var e=
a.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",a);else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",a);else{e=a;void 0===d.__webglInit&&(d.__webglInit=!0,e.addEventListener("dispose",h),d.__webglTexture=A.createTexture(),Ia.textures++);V.activeTexture(A.TEXTURE0+c);V.bindTexture(A.TEXTURE_2D,d.__webglTexture);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,e.flipY);A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
e.premultiplyAlpha);A.pixelStorei(A.UNPACK_ALIGNMENT,e.unpackAlignment);var f=L(e.image,za.maxTextureSize);if((e.wrapS!==b.ClampToEdgeWrapping||e.wrapT!==b.ClampToEdgeWrapping||e.minFilter!==b.NearestFilter&&e.minFilter!==b.LinearFilter)&&!1===F(f)){var g=f;if(g instanceof HTMLImageElement||g instanceof HTMLCanvasElement){var l=document.createElement("canvas");l.width=b.Math.nearestPowerOfTwo(g.width);l.height=b.Math.nearestPowerOfTwo(g.height);l.getContext("2d").drawImage(g,0,0,l.width,l.height);
console.warn("THREE.WebGLRenderer: image is not power of two ("+g.width+"x"+g.height+"). Resized to "+l.width+"x"+l.height,g);f=l}else f=g}var g=F(f),l=D(e.format),k=D(e.type);N(A.TEXTURE_2D,e,g);var m=e.mipmaps;if(e instanceof b.DepthTexture){m=A.DEPTH_COMPONENT;if(e.type===b.FloatType){if(!Qa)throw Error("Float Depth Texture only supported in WebGL2.0");m=A.DEPTH_COMPONENT32F}else Qa&&(m=A.DEPTH_COMPONENT16);V.texImage2D(A.TEXTURE_2D,0,m,f.width,f.height,0,l,k,null)}else if(e instanceof b.DataTexture)if(0<
m.length&&g){for(var p=0,n=m.length;p<n;p++)f=m[p],V.texImage2D(A.TEXTURE_2D,p,l,f.width,f.height,0,l,k,f.data);e.generateMipmaps=!1}else V.texImage2D(A.TEXTURE_2D,0,l,f.width,f.height,0,l,k,f.data);else if(e instanceof b.CompressedTexture)for(p=0,n=m.length;p<n;p++)f=m[p],e.format!==b.RGBAFormat&&e.format!==b.RGBFormat?-1<V.getCompressedTextureFormats().indexOf(l)?V.compressedTexImage2D(A.TEXTURE_2D,p,l,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):
V.texImage2D(A.TEXTURE_2D,p,l,f.width,f.height,0,l,k,f.data);else if(0<m.length&&g){p=0;for(n=m.length;p<n;p++)f=m[p],V.texImage2D(A.TEXTURE_2D,p,l,l,k,f);e.generateMipmaps=!1}else V.texImage2D(A.TEXTURE_2D,0,l,l,k,f);e.generateMipmaps&&g&&A.generateMipmap(A.TEXTURE_2D);d.__version=e.version;if(e.onUpdate)e.onUpdate(e)}}else V.activeTexture(A.TEXTURE0+c),V.bindTexture(A.TEXTURE_2D,d.__webglTexture)}function L(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");
d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function F(a){return b.Math.isPowerOfTwo(a.width)&&b.Math.isPowerOfTwo(a.height)}function O(a,b,c,d){var e=D(b.texture.format),f=D(b.texture.type);V.texImage2D(d,0,e,b.width,b.height,0,e,f,null);A.bindFramebuffer(A.FRAMEBUFFER,a);
A.framebufferTexture2D(A.FRAMEBUFFER,c,d,ha.get(b.texture).__webglTexture,0);A.bindFramebuffer(A.FRAMEBUFFER,null)}function M(a,b){A.bindRenderbuffer(A.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,b.width,b.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_STENCIL,b.width,b.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,
A.RENDERBUFFER,a)):A.renderbufferStorage(A.RENDERBUFFER,A.RGBA4,b.width,b.height);A.bindRenderbuffer(A.RENDERBUFFER,null)}function R(a){return a===b.NearestFilter||a===b.NearestMipMapNearestFilter||a===b.NearestMipMapLinearFilter?A.NEAREST:A.LINEAR}function D(a){var c;if(a===b.RepeatWrapping)return A.REPEAT;if(a===b.ClampToEdgeWrapping)return A.CLAMP_TO_EDGE;if(a===b.MirroredRepeatWrapping)return A.MIRRORED_REPEAT;if(a===b.NearestFilter)return A.NEAREST;if(a===b.NearestMipMapNearestFilter)return A.NEAREST_MIPMAP_NEAREST;
if(a===b.NearestMipMapLinearFilter)return A.NEAREST_MIPMAP_LINEAR;if(a===b.LinearFilter)return A.LINEAR;if(a===b.LinearMipMapNearestFilter)return A.LINEAR_MIPMAP_NEAREST;if(a===b.LinearMipMapLinearFilter)return A.LINEAR_MIPMAP_LINEAR;if(a===b.UnsignedByteType)return A.UNSIGNED_BYTE;if(a===b.UnsignedShort4444Type)return A.UNSIGNED_SHORT_4_4_4_4;if(a===b.UnsignedShort5551Type)return A.UNSIGNED_SHORT_5_5_5_1;if(a===b.UnsignedShort565Type)return A.UNSIGNED_SHORT_5_6_5;if(a===b.ByteType)return A.BYTE;
if(a===b.ShortType)return A.SHORT;if(a===b.UnsignedShortType)return A.UNSIGNED_SHORT;if(a===b.IntType)return A.INT;if(a===b.UnsignedIntType)return A.UNSIGNED_INT;if(a===b.FloatType)return A.FLOAT;c=ja.get("OES_texture_half_float");if(null!==c&&a===b.HalfFloatType)return c.HALF_FLOAT_OES;if(a===b.AlphaFormat)return A.ALPHA;if(a===b.RGBFormat)return A.RGB;if(a===b.RGBAFormat)return A.RGBA;if(a===b.LuminanceFormat)return A.LUMINANCE;if(a===b.LuminanceAlphaFormat)return A.LUMINANCE_ALPHA;if(a===b.DepthFormat)return A.DEPTH_COMPONENT;
if(a===b.AddEquation)return A.FUNC_ADD;if(a===b.SubtractEquation)return A.FUNC_SUBTRACT;if(a===b.ReverseSubtractEquation)return A.FUNC_REVERSE_SUBTRACT;if(a===b.ZeroFactor)return A.ZERO;if(a===b.OneFactor)return A.ONE;if(a===b.SrcColorFactor)return A.SRC_COLOR;if(a===b.OneMinusSrcColorFactor)return A.ONE_MINUS_SRC_COLOR;if(a===b.SrcAlphaFactor)return A.SRC_ALPHA;if(a===b.OneMinusSrcAlphaFactor)return A.ONE_MINUS_SRC_ALPHA;if(a===b.DstAlphaFactor)return A.DST_ALPHA;if(a===b.OneMinusDstAlphaFactor)return A.ONE_MINUS_DST_ALPHA;
if(a===b.DstColorFactor)return A.DST_COLOR;if(a===b.OneMinusDstColorFactor)return A.ONE_MINUS_DST_COLOR;if(a===b.SrcAlphaSaturateFactor)return A.SRC_ALPHA_SATURATE;c=ja.get("WEBGL_compressed_texture_s3tc");if(null!==c){if(a===b.RGB_S3TC_DXT1_Format)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT1_Format)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT3_Format)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===b.RGBA_S3TC_DXT5_Format)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}c=ja.get("WEBGL_compressed_texture_pvrtc");
if(null!==c){if(a===b.RGB_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===b.RGB_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===b.RGBA_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===b.RGBA_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}c=ja.get("WEBGL_compressed_texture_etc1");if(null!==c&&a===b.RGB_ETC1_Format)return c.COMPRESSED_RGB_ETC1_WEBGL;c=ja.get("EXT_blend_minmax");if(null!==c){if(a===b.MinEquation)return c.MIN_EXT;
if(a===b.MaxEquation)return c.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",b.REVISION);a=a||{};var H=void 0!==a.canvas?a.canvas:document.createElement("canvas"),S=void 0!==a.context?a.context:null,C=void 0!==a.alpha?a.alpha:!1,Q=void 0!==a.depth?a.depth:!0,J=void 0!==a.stencil?a.stencil:!0,K=void 0!==a.antialias?a.antialias:!1,G=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,P=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,U=[],W=[],aa=-1,T=[],oa=-1,sa=new Float32Array(8),
da=[],Ja=[];this.domElement=H;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMapping=b.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;var ka=this,ta=null,Aa=null,Ba=null,pa=-1,Ca="",wa=null,Ea=
new b.Vector4,Fa=null,Z=new b.Vector4,Y=0,qa=new b.Color(0),ca=0,ea=H.width,$=H.height,ia=1,la=new b.Vector4(0,0,ea,$),ba=!1,ma=new b.Vector4(0,0,ea,$),ga=new b.Frustum,La=!1,xa=!1,va=!1,ua=0,na={type:"4fv",value:null,needsUpdate:!1},ya=null,Ma=0,Xa=new b.Matrix3,Ya=new b.Sphere,Za=new b.Plane,Pa=new b.Matrix4,ra=new b.Vector3,fa={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],
hemi:[],shadows:[]},Ia={geometries:0,textures:0},Da={calls:0,vertices:0,faces:0,points:0};this.info={render:Da,memory:Ia,programs:null};var A;try{C={alpha:C,depth:Q,stencil:J,antialias:K,premultipliedAlpha:G,preserveDrawingBuffer:P};A=S||H.getContext("webgl",C)||H.getContext("experimental-webgl",C);if(null===A){if(null!==H.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===A.getShaderPrecisionFormat&&(A.getShaderPrecisionFormat=
function(){return{rangeMin:1,rangeMax:1,precision:1}});H.addEventListener("webglcontextlost",f,!1)}catch(Sa){console.error("THREE.WebGLRenderer: "+Sa)}var Qa="undefined"!==typeof WebGL2RenderingContext&&A instanceof WebGL2RenderingContext,ja=new b.WebGLExtensions(A);ja.get("WEBGL_depth_texture");ja.get("OES_texture_float");ja.get("OES_texture_float_linear");ja.get("OES_texture_half_float");ja.get("OES_texture_half_float_linear");ja.get("OES_standard_derivatives");ja.get("ANGLE_instanced_arrays");
ja.get("OES_element_index_uint")&&(b.BufferGeometry.MaxIndex=4294967296);var za=new b.WebGLCapabilities(A,ja,a),V=new b.WebGLState(A,ja,D),ha=new b.WebGLProperties,Ka=new b.WebGLObjects(A,ha,this.info),Na=new b.WebGLPrograms(this,za),Oa=new b.WebGLLights;this.info.programs=Na.programs;var Va=new b.WebGLBufferRenderer(A,ja,Da),Wa=new b.WebGLIndexedBufferRenderer(A,ja,Da);d();this.context=A;this.capabilities=za;this.extensions=ja;this.properties=ha;this.state=V;var Ta=new b.WebGLShadowMap(this,fa,Ka);
this.shadowMap=Ta;var $a=new b.SpritePlugin(this,da),ab=new b.LensFlarePlugin(this,Ja);this.getContext=function(){return A};this.getContextAttributes=function(){return A.getContextAttributes()};this.forceContextLoss=function(){ja.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ja.get("EXT_texture_filter_anisotropic");return a=null!==b?A.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return za.precision};
this.getPixelRatio=function(){return ia};this.setPixelRatio=function(a){void 0!==a&&(ia=a,this.setSize(ma.z,ma.w,!1))};this.getSize=function(){return{width:ea,height:$}};this.setSize=function(a,b,c){ea=a;$=b;H.width=a*ia;H.height=b*ia;!1!==c&&(H.style.width=a+"px",H.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){V.viewport(ma.set(a,b,c,d))};this.setScissor=function(a,b,c,d){V.scissor(la.set(a,b,c,d))};this.setScissorTest=function(a){V.setScissorTest(ba=a)};this.getClearColor=
function(){return qa};this.setClearColor=function(a,b){qa.set(a);ca=void 0!==b?b:1;c(qa.r,qa.g,qa.b,ca)};this.getClearAlpha=function(){return ca};this.setClearAlpha=function(a){ca=a;c(qa.r,qa.g,qa.b,ca)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=A.COLOR_BUFFER_BIT;if(void 0===b||b)d|=A.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=A.STENCIL_BUFFER_BIT;A.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,
!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=e;this.dispose=function(){H.removeEventListener("webglcontextlost",f,!1)};this.renderBufferImmediate=function(a,c,d){V.initAttributes();var e=ha.get(a);a.hasPositions&&!e.position&&(e.position=A.createBuffer());a.hasNormals&&!e.normal&&(e.normal=A.createBuffer());a.hasUvs&&!e.uv&&(e.uv=A.createBuffer());a.hasColors&&!e.color&&(e.color=A.createBuffer());c=c.getAttributes();a.hasPositions&&(A.bindBuffer(A.ARRAY_BUFFER,
e.position),A.bufferData(A.ARRAY_BUFFER,a.positionArray,A.DYNAMIC_DRAW),V.enableAttribute(c.position),A.vertexAttribPointer(c.position,3,A.FLOAT,!1,0,0));if(a.hasNormals){A.bindBuffer(A.ARRAY_BUFFER,e.normal);if("MeshPhongMaterial"!==d.type&&"MeshStandardMaterial"!==d.type&&"MeshPhysicalMaterial"!==d.type&&d.shading===b.FlatShading)for(var f=0,h=3*a.count;f<h;f+=9){var g=a.normalArray,l=(g[f+0]+g[f+3]+g[f+6])/3,k=(g[f+1]+g[f+4]+g[f+7])/3,m=(g[f+2]+g[f+5]+g[f+8])/3;g[f+0]=l;g[f+1]=k;g[f+2]=m;g[f+3]=
l;g[f+4]=k;g[f+5]=m;g[f+6]=l;g[f+7]=k;g[f+8]=m}A.bufferData(A.ARRAY_BUFFER,a.normalArray,A.DYNAMIC_DRAW);V.enableAttribute(c.normal);A.vertexAttribPointer(c.normal,3,A.FLOAT,!1,0,0)}a.hasUvs&&d.map&&(A.bindBuffer(A.ARRAY_BUFFER,e.uv),A.bufferData(A.ARRAY_BUFFER,a.uvArray,A.DYNAMIC_DRAW),V.enableAttribute(c.uv),A.vertexAttribPointer(c.uv,2,A.FLOAT,!1,0,0));a.hasColors&&d.vertexColors!==b.NoColors&&(A.bindBuffer(A.ARRAY_BUFFER,e.color),A.bufferData(A.ARRAY_BUFFER,a.colorArray,A.DYNAMIC_DRAW),V.enableAttribute(c.color),
A.vertexAttribPointer(c.color,3,A.FLOAT,!1,0,0));V.disableUnusedAttributes();A.drawArrays(A.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,c,d,e,f,h){y(e);var g=w(a,c,e,f),l=!1;a=d.id+"_"+g.id+"_"+e.wireframe;a!==Ca&&(Ca=a,l=!0);c=f.morphTargetInfluences;if(void 0!==c){a=[];for(var k=0,l=c.length;k<l;k++){var m=c[k];a.push([m,k])}a.sort(v);8<a.length&&(a.length=8);for(var p=d.morphAttributes,k=0,l=a.length;k<l;k++)m=a[k],sa[k]=m[0],0!==m[0]?(c=m[1],!0===e.morphTargets&&p.position&&
d.addAttribute("morphTarget"+k,p.position[c]),!0===e.morphNormals&&p.normal&&d.addAttribute("morphNormal"+k,p.normal[c])):(!0===e.morphTargets&&d.removeAttribute("morphTarget"+k),!0===e.morphNormals&&d.removeAttribute("morphNormal"+k));g.getUniforms().setValue(A,"morphTargetInfluences",sa);l=!0}c=d.index;k=d.attributes.position;!0===e.wireframe&&(c=Ka.getWireframeAttribute(d));null!==c?(a=Wa,a.setIndex(c)):a=Va;if(l){a:{var l=void 0,n;if(d instanceof b.InstancedBufferGeometry&&(n=ja.get("ANGLE_instanced_arrays"),
null===n)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");break a}void 0===l&&(l=0);V.initAttributes();var m=d.attributes,g=g.getAttributes(),p=e.defaultAttributeValues,t;for(t in g){var s=g[t];if(0<=s){var u=m[t];if(void 0!==u){var q=A.FLOAT,r=u.array,x=u.normalized;r instanceof Float32Array?q=A.FLOAT:r instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):
r instanceof Uint16Array?q=A.UNSIGNED_SHORT:r instanceof Int16Array?q=A.SHORT:r instanceof Uint32Array?q=A.UNSIGNED_INT:r instanceof Int32Array?q=A.INT:r instanceof Int8Array?q=A.BYTE:r instanceof Uint8Array&&(q=A.UNSIGNED_BYTE);var r=u.itemSize,z=Ka.getAttributeBuffer(u);if(u instanceof b.InterleavedBufferAttribute){var E=u.data,J=E.stride,u=u.offset;E instanceof b.InstancedInterleavedBuffer?(V.enableAttributeAndDivisor(s,E.meshPerAttribute,n),void 0===d.maxInstancedCount&&(d.maxInstancedCount=E.meshPerAttribute*
E.count)):V.enableAttribute(s);A.bindBuffer(A.ARRAY_BUFFER,z);A.vertexAttribPointer(s,r,q,x,J*E.array.BYTES_PER_ELEMENT,(l*J+u)*E.array.BYTES_PER_ELEMENT)}else u instanceof b.InstancedBufferAttribute?(V.enableAttributeAndDivisor(s,u.meshPerAttribute,n),void 0===d.maxInstancedCount&&(d.maxInstancedCount=u.meshPerAttribute*u.count)):V.enableAttribute(s),A.bindBuffer(A.ARRAY_BUFFER,z),A.vertexAttribPointer(s,r,q,x,0,l*r*u.array.BYTES_PER_ELEMENT)}else if(void 0!==p&&(q=p[t],void 0!==q))switch(q.length){case 2:A.vertexAttrib2fv(s,
q);break;case 3:A.vertexAttrib3fv(s,q);break;case 4:A.vertexAttrib4fv(s,q);break;default:A.vertexAttrib1fv(s,q)}}}V.disableUnusedAttributes()}null!==c&&A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,Ka.getAttributeBuffer(c))}n=Infinity;null!==c?n=c.count:void 0!==k&&(n=k.count);t=d.drawRange.start;c=d.drawRange.count;k=null!==h?h.start:0;l=null!==h?h.count:Infinity;h=Math.max(0,t,k);n=Math.min(0+n,t+c,k+l)-1;n=Math.max(0,n-h+1);if(f instanceof b.Mesh)if(!0===e.wireframe)V.setLineWidth(e.wireframeLinewidth*(null===
Aa?ia:1)),a.setMode(A.LINES);else switch(f.drawMode){case b.TrianglesDrawMode:a.setMode(A.TRIANGLES);break;case b.TriangleStripDrawMode:a.setMode(A.TRIANGLE_STRIP);break;case b.TriangleFanDrawMode:a.setMode(A.TRIANGLE_FAN)}else f instanceof b.Line?(e=e.linewidth,void 0===e&&(e=1),V.setLineWidth(e*(null===Aa?ia:1)),f instanceof b.LineSegments?a.setMode(A.LINES):a.setMode(A.LINE_STRIP)):f instanceof b.Points&&a.setMode(A.POINTS);d instanceof b.InstancedBufferGeometry?0<d.maxInstancedCount&&a.renderInstances(d,
h,n):a.render(h,n)};this.render=function(a,c,d,e){if(!1===c instanceof b.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var f=a.fog;Ca="";pa=-1;wa=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);Pa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);ga.setFromMatrix(Pa);U.length=0;oa=aa=-1;da.length=0;Ja.length=0;var h=this.clippingPlanes;La=0!==ka.clippingPlanes.length||
ka.localClippingEnabled||0!==Ma||xa;xa=ka.localClippingEnabled;ya=B(h,c,0);Ma=null!==h?h.length:0;s(a,c);W.length=aa+1;T.length=oa+1;!0===ka.sortObjects&&(W.sort(q),T.sort(p));La&&(va=!0,B(null));for(var h=U,g=0,l=0,k=h.length;l<k;l++){var m=h[l];m.castShadow&&(fa.shadows[g++]=m)}fa.shadows.length=g;Ta.render(a,c);for(var h=U,n=m=0,t=0,u,r,v,w=c.matrixWorldInverse,E=0,y=0,J=0,K=0,g=0,l=h.length;g<l;g++)if(k=h[g],u=k.color,r=k.intensity,v=k.distance,k instanceof b.AmbientLight)m+=u.r*r,n+=u.g*r,t+=
u.b*r;else if(k instanceof b.DirectionalLight){var G=Oa.get(k);G.color.copy(k.color).multiplyScalar(k.intensity);G.direction.setFromMatrixPosition(k.matrixWorld);ra.setFromMatrixPosition(k.target.matrixWorld);G.direction.sub(ra);G.direction.transformDirection(w);if(G.shadow=k.castShadow)G.shadowBias=k.shadow.bias,G.shadowRadius=k.shadow.radius,G.shadowMapSize=k.shadow.mapSize;fa.directionalShadowMap[E]=k.shadow.map;fa.directionalShadowMatrix[E]=k.shadow.matrix;fa.directional[E++]=G}else if(k instanceof
b.SpotLight){G=Oa.get(k);G.position.setFromMatrixPosition(k.matrixWorld);G.position.applyMatrix4(w);G.color.copy(u).multiplyScalar(r);G.distance=v;G.direction.setFromMatrixPosition(k.matrixWorld);ra.setFromMatrixPosition(k.target.matrixWorld);G.direction.sub(ra);G.direction.transformDirection(w);G.coneCos=Math.cos(k.angle);G.penumbraCos=Math.cos(k.angle*(1-k.penumbra));G.decay=0===k.distance?0:k.decay;if(G.shadow=k.castShadow)G.shadowBias=k.shadow.bias,G.shadowRadius=k.shadow.radius,G.shadowMapSize=
k.shadow.mapSize;fa.spotShadowMap[J]=k.shadow.map;fa.spotShadowMatrix[J]=k.shadow.matrix;fa.spot[J++]=G}else if(k instanceof b.PointLight){G=Oa.get(k);G.position.setFromMatrixPosition(k.matrixWorld);G.position.applyMatrix4(w);G.color.copy(k.color).multiplyScalar(k.intensity);G.distance=k.distance;G.decay=0===k.distance?0:k.decay;if(G.shadow=k.castShadow)G.shadowBias=k.shadow.bias,G.shadowRadius=k.shadow.radius,G.shadowMapSize=k.shadow.mapSize;fa.pointShadowMap[y]=k.shadow.map;void 0===fa.pointShadowMatrix[y]&&
(fa.pointShadowMatrix[y]=new b.Matrix4);ra.setFromMatrixPosition(k.matrixWorld).negate();fa.pointShadowMatrix[y].identity().setPosition(ra);fa.point[y++]=G}else k instanceof b.HemisphereLight&&(G=Oa.get(k),G.direction.setFromMatrixPosition(k.matrixWorld),G.direction.transformDirection(w),G.direction.normalize(),G.skyColor.copy(k.color).multiplyScalar(r),G.groundColor.copy(k.groundColor).multiplyScalar(r),fa.hemi[K++]=G);fa.ambient[0]=m;fa.ambient[1]=n;fa.ambient[2]=t;fa.directional.length=E;fa.spot.length=
J;fa.point.length=y;fa.hemi.length=K;fa.hash=E+","+y+","+J+","+K+","+fa.shadows.length;La&&(va=!1,z());Da.calls=0;Da.vertices=0;Da.faces=0;Da.points=0;void 0===d&&(d=null);this.setRenderTarget(d);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);a.overrideMaterial?(e=a.overrideMaterial,x(W,c,f,e),x(T,c,f,e)):(V.setBlending(b.NoBlending),x(W,c,f),x(T,c,f));$a.render(a,c);ab.render(a,c,Z);d&&(a=d.texture,a.generateMipmaps&&F(d)&&a.minFilter!==b.NearestFilter&&
a.minFilter!==b.LinearFilter&&(a=d instanceof b.WebGLRenderTargetCube?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D,d=ha.get(d.texture).__webglTexture,V.bindTexture(a,d),A.generateMipmap(a),V.bindTexture(a,null)));V.setDepthTest(!0);V.setDepthWrite(!0);V.setColorWrite(!0)}};this.setFaceCulling=function(a,c){a===b.CullFaceNone?V.disable(A.CULL_FACE):(c===b.FrontFaceDirectionCW?A.frontFace(A.CW):A.frontFace(A.CCW),a===b.CullFaceBack?A.cullFace(A.BACK):a===b.CullFaceFront?A.cullFace(A.FRONT):A.cullFace(A.FRONT_AND_BACK),
V.enable(A.CULL_FACE))};var Ua=!1;this.setTexture=function(a,b){Ua||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),Ua=!0);I(a,b)};this.allocTextureUnit=function(){var a=Y;a>=za.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+za.maxTextures);Y+=1;return a};this.setTexture2D=I;this.setTextureCube=function(a,c){if(a instanceof b.CubeTexture||Array.isArray(a.image)&&6===a.image.length){var d=ha.get(a);
if(6===a.image.length)if(0<a.version&&d.__version!==a.version){d.__image__webglTextureCube||(a.addEventListener("dispose",h),d.__image__webglTextureCube=A.createTexture(),Ia.textures++);V.activeTexture(A.TEXTURE0+c);V.bindTexture(A.TEXTURE_CUBE_MAP,d.__image__webglTextureCube);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var e=a instanceof b.CompressedTexture,f=a.image[0]instanceof b.DataTexture,g=[],k=0;6>k;k++)g[k]=!ka.autoScaleCubemaps||e||f?f?a.image[k].image:a.image[k]:L(a.image[k],za.maxCubemapSize);
var l=F(g[0]),m=D(a.format),p=D(a.type);N(A.TEXTURE_CUBE_MAP,a,l);for(k=0;6>k;k++)if(e)for(var n,t=g[k].mipmaps,s=0,u=t.length;s<u;s++)n=t[s],a.format!==b.RGBAFormat&&a.format!==b.RGBFormat?-1<V.getCompressedTextureFormats().indexOf(m)?V.compressedTexImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+k,s,m,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):V.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+k,s,m,n.width,n.height,0,
m,p,n.data);else f?V.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,m,g[k].width,g[k].height,0,m,p,g[k].data):V.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,m,m,p,g[k]);a.generateMipmaps&&l&&A.generateMipmap(A.TEXTURE_CUBE_MAP);d.__version=a.version;if(a.onUpdate)a.onUpdate(a)}else V.activeTexture(A.TEXTURE0+c),V.bindTexture(A.TEXTURE_CUBE_MAP,d.__image__webglTextureCube)}else d=a.texture,V.activeTexture(A.TEXTURE0+c),V.bindTexture(A.TEXTURE_CUBE_MAP,ha.get(d).__webglTexture)};this.getCurrentRenderTarget=
function(){return Aa};this.setRenderTarget=function(a){if((Aa=a)&&void 0===ha.get(a).__webglFramebuffer){var c=ha.get(a),d=ha.get(a.texture);a.addEventListener("dispose",g);d.__webglTexture=A.createTexture();Ia.textures++;var e=a instanceof b.WebGLRenderTargetCube,f=b.Math.isPowerOfTwo(a.width)&&b.Math.isPowerOfTwo(a.height);if(e){c.__webglFramebuffer=[];for(var h=0;6>h;h++)c.__webglFramebuffer[h]=A.createFramebuffer()}else c.__webglFramebuffer=A.createFramebuffer();if(e){V.bindTexture(A.TEXTURE_CUBE_MAP,
d.__webglTexture);N(A.TEXTURE_CUBE_MAP,a.texture,f);for(h=0;6>h;h++)O(c.__webglFramebuffer[h],a,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+h);a.texture.generateMipmaps&&f&&A.generateMipmap(A.TEXTURE_CUBE_MAP);V.bindTexture(A.TEXTURE_CUBE_MAP,null)}else V.bindTexture(A.TEXTURE_2D,d.__webglTexture),N(A.TEXTURE_2D,a.texture,f),O(c.__webglFramebuffer,a,A.COLOR_ATTACHMENT0,A.TEXTURE_2D),a.texture.generateMipmaps&&f&&A.generateMipmap(A.TEXTURE_2D),V.bindTexture(A.TEXTURE_2D,null);if(a.depthBuffer){c=
ha.get(a);d=a instanceof b.WebGLRenderTargetCube;if(a.depthTexture){if(d)throw Error("target.depthTexture not supported in Cube render targets");if(a instanceof b.WebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");A.bindFramebuffer(A.FRAMEBUFFER,c.__webglFramebuffer);if(!(a.depthTexture instanceof b.DepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");ha.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===
a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0);ka.setTexture(a.depthTexture,0);c=ha.get(a.depthTexture).__webglTexture;A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,c,0)}else if(d)for(c.__webglDepthbuffer=[],d=0;6>d;d++)A.bindFramebuffer(A.FRAMEBUFFER,c.__webglFramebuffer[d]),c.__webglDepthbuffer[d]=A.createRenderbuffer(),M(c.__webglDepthbuffer[d],a);else A.bindFramebuffer(A.FRAMEBUFFER,
c.__webglFramebuffer),c.__webglDepthbuffer=A.createRenderbuffer(),M(c.__webglDepthbuffer,a);A.bindFramebuffer(A.FRAMEBUFFER,null)}}c=a instanceof b.WebGLRenderTargetCube;a?(d=ha.get(a),d=c?d.__webglFramebuffer[a.activeCubeFace]:d.__webglFramebuffer,Ea.copy(a.scissor),Fa=a.scissorTest,Z.copy(a.viewport)):(d=null,Ea.copy(la).multiplyScalar(ia),Fa=ba,Z.copy(ma).multiplyScalar(ia));Ba!==d&&(A.bindFramebuffer(A.FRAMEBUFFER,d),Ba=d);V.scissor(Ea);V.setScissorTest(Fa);V.viewport(Z);c&&(c=ha.get(a.texture),
A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,c.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,c,d,e,f,h){if(!1===a instanceof b.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var g=ha.get(a).__webglFramebuffer;if(g){var k=!1;g!==Ba&&(A.bindFramebuffer(A.FRAMEBUFFER,g),k=!0);try{var l=a.texture;l.format!==b.RGBAFormat&&D(l.format)!==
A.getParameter(A.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):l.type===b.UnsignedByteType||D(l.type)===A.getParameter(A.IMPLEMENTATION_COLOR_READ_TYPE)||l.type===b.FloatType&&ja.get("WEBGL_color_buffer_float")||l.type===b.HalfFloatType&&ja.get("EXT_color_buffer_half_float")?A.checkFramebufferStatus(A.FRAMEBUFFER)===A.FRAMEBUFFER_COMPLETE?0<c&&c<=a.width-e&&0<d&&d<=a.height-f&&A.readPixels(c,
d,e,f,D(l.format),D(l.type),h):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{k&&A.bindFramebuffer(A.FRAMEBUFFER,Ba)}}}}};b.WebGLRenderTarget=function(a,c,d){this.uuid=b.Math.generateUUID();this.width=a;this.height=c;this.scissor=new b.Vector4(0,0,a,c);this.scissorTest=!1;this.viewport=
new b.Vector4(0,0,a,c);d=d||{};void 0===d.minFilter&&(d.minFilter=b.LinearFilter);this.texture=new b.Texture(void 0,void 0,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding);this.depthBuffer=void 0!==d.depthBuffer?d.depthBuffer:!0;this.stencilBuffer=void 0!==d.stencilBuffer?d.stencilBuffer:!0;this.depthTexture=null};b.WebGLRenderTarget.prototype={constructor:b.WebGLRenderTarget,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();
this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.WebGLRenderTarget.prototype);b.WebGLRenderTargetCube=function(a,
c,d){b.WebGLRenderTarget.call(this,a,c,d);this.activeMipMapLevel=this.activeCubeFace=0};b.WebGLRenderTargetCube.prototype=Object.create(b.WebGLRenderTarget.prototype);b.WebGLRenderTargetCube.prototype.constructor=b.WebGLRenderTargetCube;b.WebGLBufferRenderer=function(a,c,d){var e;this.setMode=function(a){e=a};this.render=function(b,c){a.drawArrays(e,b,c);d.calls++;d.vertices+=c;e===a.TRIANGLES&&(d.faces+=c/3)};this.renderInstances=function(f){var h=c.get("ANGLE_instanced_arrays");if(null===h)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{var g=f.attributes.position,k=0,k=g instanceof b.InterleavedBufferAttribute?g.data.count:g.count;h.drawArraysInstancedANGLE(e,0,k,f.maxInstancedCount);d.calls++;d.vertices+=k*f.maxInstancedCount;e===a.TRIANGLES&&(d.faces+=f.maxInstancedCount*k/3)}}};b.WebGLIndexedBufferRenderer=function(a,b,d){var e,f,h;this.setMode=function(a){e=a};this.setIndex=function(d){d.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(f=a.UNSIGNED_INT,h=4):(f=a.UNSIGNED_SHORT,h=2)};this.render=function(b,
c){a.drawElements(e,c,f,b*h);d.calls++;d.vertices+=c;e===a.TRIANGLES&&(d.faces+=c/3)};this.renderInstances=function(g,k,r){var v=b.get("ANGLE_instanced_arrays");null===v?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(v.drawElementsInstancedANGLE(e,r,f,k*h,g.maxInstancedCount),d.calls++,d.vertices+=r*g.maxInstancedCount,e===a.TRIANGLES&&(d.faces+=g.maxInstancedCount*r/3))}};b.WebGLExtensions=function(a){var b=
{};this.get=function(d){if(void 0!==b[d])return b[d];var e;switch(d){case "WEBGL_depth_texture":a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");case "EXT_texture_filter_anisotropic":e=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":e=a.getExtension("WEBGL_compressed_texture_s3tc")||
a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":e=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":e=a.getExtension("WEBGL_compressed_texture_etc1");break;default:e=a.getExtension(d)}null===e&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return b[d]=e}};b.WebGLCapabilities=
function(a,b,d){function e(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=e;this.precision=void 0!==d.precision?d.precision:"highp";this.logarithmicDepthBuffer=
void 0!==d.logarithmicDepthBuffer?d.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=
a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;d=e(this.precision);d!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",d,"instead."),this.precision=d);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))};b.WebGLGeometries=function(a,c,d){function e(a){var b=
a.target;a=h[b.id];null!==a.index&&f(a.index);var g=a.attributes,k;for(k in g)f(g[k]);b.removeEventListener("dispose",e);delete h[b.id];k=c.get(b);k.wireframe&&f(k.wireframe);c.delete(b);b=c.get(a);b.wireframe&&f(b.wireframe);c.delete(a);d.memory.geometries--}function f(d){var e;e=d instanceof b.InterleavedBufferAttribute?c.get(d.data).__webglBuffer:c.get(d).__webglBuffer;void 0!==e&&(a.deleteBuffer(e),d instanceof b.InterleavedBufferAttribute?c.delete(d.data):c.delete(d))}var h={};this.get=function(a){var c=
a.geometry;if(void 0!==h[c.id])return h[c.id];c.addEventListener("dispose",e);var f;c instanceof b.BufferGeometry?f=c:c instanceof b.Geometry&&(void 0===c._bufferGeometry&&(c._bufferGeometry=(new b.BufferGeometry).setFromObject(a)),f=c._bufferGeometry);h[c.id]=f;d.memory.geometries++;return f}};b.WebGLLights=function(){var a={};this.get=function(c){if(void 0!==a[c.id])return a[c.id];var d;switch(c.type){case "DirectionalLight":d={direction:new b.Vector3,color:new b.Color,shadow:!1,shadowBias:0,shadowRadius:1,
shadowMapSize:new b.Vector2};break;case "SpotLight":d={position:new b.Vector3,direction:new b.Vector3,color:new b.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new b.Vector2};break;case "PointLight":d={position:new b.Vector3,color:new b.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new b.Vector2};break;case "HemisphereLight":d={direction:new b.Vector3,skyColor:new b.Color,groundColor:new b.Color}}return a[c.id]=
d}};b.WebGLObjects=function(a,c,d){function e(d,e){var f=d instanceof b.InterleavedBufferAttribute?d.data:d,h=c.get(f);void 0===h.__webglBuffer?(h.__webglBuffer=a.createBuffer(),a.bindBuffer(e,h.__webglBuffer),a.bufferData(e,f.array,f.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),h.version=f.version):h.version!==f.version&&(a.bindBuffer(e,h.__webglBuffer),!1===f.dynamic||-1===f.updateRange.count?a.bufferSubData(e,0,f.array):0===f.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(e,f.updateRange.offset*f.array.BYTES_PER_ELEMENT,f.array.subarray(f.updateRange.offset,f.updateRange.offset+f.updateRange.count)),f.updateRange.count=0),h.version=f.version)}function f(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var h=new b.WebGLGeometries(a,c,d);this.getAttributeBuffer=function(a){return a instanceof b.InterleavedBufferAttribute?c.get(a.data).__webglBuffer:c.get(a).__webglBuffer};this.getWireframeAttribute=
function(d){var h=c.get(d);if(void 0!==h.wireframe)return h.wireframe;var g=[],k=d.index,q=d.attributes;d=q.position;if(null!==k)for(var q={},k=k.array,p=0,l=k.length;p<l;p+=3){var t=k[p+0],s=k[p+1],r=k[p+2];f(q,t,s)&&g.push(t,s);f(q,s,r)&&g.push(s,r);f(q,r,t)&&g.push(r,t)}else for(k=q.position.array,p=0,l=k.length/3-1;p<l;p+=3)t=p+0,s=p+1,r=p+2,g.push(t,s,s,r,r,t);g=new b.BufferAttribute(new (65535<d.count?Uint32Array:Uint16Array)(g),1);e(g,a.ELEMENT_ARRAY_BUFFER);return h.wireframe=g};this.update=
function(c){var d=h.get(c);c.geometry instanceof b.Geometry&&d.updateFromObject(c);c=d.index;var f=d.attributes;null!==c&&e(c,a.ELEMENT_ARRAY_BUFFER);for(var g in f)e(f[g],a.ARRAY_BUFFER);c=d.morphAttributes;for(g in c)for(var f=c[g],k=0,p=f.length;k<p;k++)e(f[k],a.ARRAY_BUFFER);return d}};b.WebGLProgram=function(){function a(a){switch(a){case b.LinearEncoding:return["Linear","( value )"];case b.sRGBEncoding:return["sRGB","( value )"];case b.RGBEEncoding:return["RGBE","( value )"];case b.RGBM7Encoding:return["RGBM",
"( value, 7.0 )"];case b.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case b.RGBDEncoding:return["RGBD","( value, 256.0 )"];case b.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function d(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function e(a,c){var d;switch(c){case b.LinearToneMapping:d="Linear";
break;case b.ReinhardToneMapping:d="Reinhard";break;case b.Uncharted2ToneMapping:d="Uncharted2";break;case b.CineonToneMapping:d="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+c);}return"vec3 "+a+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function f(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":
"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(g).join("\n")}function h(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function g(a){return""!==a}function k(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,
b.numHemiLights)}function r(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,c){var d=b.ShaderChunk[c];if(void 0===d)throw Error("Can not resolve #include <"+c+">");return r(d)})}function v(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]");return a})}var q=0;return function(a,l,t,s){var x=a.context,y=t.extensions,w=t.defines,n=t.__webglShader.vertexShader,
B=t.__webglShader.fragmentShader,z="SHADOWMAP_TYPE_BASIC";s.shadowMapType===b.PCFShadowMap?z="SHADOWMAP_TYPE_PCF":s.shadowMapType===b.PCFSoftShadowMap&&(z="SHADOWMAP_TYPE_PCF_SOFT");var N="ENVMAP_TYPE_CUBE",I="ENVMAP_MODE_REFLECTION",L="ENVMAP_BLENDING_MULTIPLY";if(s.envMap){switch(t.envMap.mapping){case b.CubeReflectionMapping:case b.CubeRefractionMapping:N="ENVMAP_TYPE_CUBE";break;case b.CubeUVReflectionMapping:case b.CubeUVRefractionMapping:N="ENVMAP_TYPE_CUBE_UV";break;case b.EquirectangularReflectionMapping:case b.EquirectangularRefractionMapping:N=
"ENVMAP_TYPE_EQUIREC";break;case b.SphericalReflectionMapping:N="ENVMAP_TYPE_SPHERE"}switch(t.envMap.mapping){case b.CubeRefractionMapping:case b.EquirectangularRefractionMapping:I="ENVMAP_MODE_REFRACTION"}switch(t.combine){case b.MultiplyOperation:L="ENVMAP_BLENDING_MULTIPLY";break;case b.MixOperation:L="ENVMAP_BLENDING_MIX";break;case b.AddOperation:L="ENVMAP_BLENDING_ADD"}}var F=0<a.gammaFactor?a.gammaFactor:1,y=f(y,s,a.extensions),O=h(w),M=x.createProgram();t instanceof b.RawShaderMaterial?z=
w="":(w=["precision "+s.precision+" float;","precision "+s.precision+" int;","#define SHADER_NAME "+t.__webglShader.name,O,s.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+F,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+I:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":
"",s.displacementMap&&s.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&!1===s.flatShading?"#define USE_MORPHNORMALS":
"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+s.numClippingPlanes,s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+z:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;",
"uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;",
"\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(g).join("\n"),z=[y,"precision "+s.precision+" float;","precision "+s.precision+" int;","#define SHADER_NAME "+t.__webglShader.name,O,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"","#define GAMMA_FACTOR "+
F,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+N:"",s.envMap?"#define "+I:"",s.envMap?"#define "+L:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?
"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+s.numClippingPlanes,s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+z:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":
"",s.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",s.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",s.toneMapping!==b.NoToneMapping?"#define TONE_MAPPING":"",s.toneMapping!==b.NoToneMapping?b.ShaderChunk.tonemapping_pars_fragment:"",s.toneMapping!==b.NoToneMapping?e("toneMapping",s.toneMapping):"",s.outputEncoding||s.mapEncoding||s.envMapEncoding||s.emissiveMapEncoding?
b.ShaderChunk.encodings_pars_fragment:"",s.mapEncoding?c("mapTexelToLinear",s.mapEncoding):"",s.envMapEncoding?c("envMapTexelToLinear",s.envMapEncoding):"",s.emissiveMapEncoding?c("emissiveMapTexelToLinear",s.emissiveMapEncoding):"",s.outputEncoding?d("linearToOutputTexel",s.outputEncoding):"",s.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(g).join("\n"));n=r(n,s);n=k(n,s);B=r(B,s);B=k(B,s);!1===t instanceof b.ShaderMaterial&&(n=v(n),B=v(B));B=z+B;n=b.WebGLShader(x,x.VERTEX_SHADER,
w+n);B=b.WebGLShader(x,x.FRAGMENT_SHADER,B);x.attachShader(M,n);x.attachShader(M,B);void 0!==t.index0AttributeName?x.bindAttribLocation(M,0,t.index0AttributeName):!0===s.morphTargets&&x.bindAttribLocation(M,0,"position");x.linkProgram(M);s=x.getProgramInfoLog(M);N=x.getShaderInfoLog(n);I=x.getShaderInfoLog(B);F=L=!0;if(!1===x.getProgramParameter(M,x.LINK_STATUS))L=!1,console.error("THREE.WebGLProgram: shader error: ",x.getError(),"gl.VALIDATE_STATUS",x.getProgramParameter(M,x.VALIDATE_STATUS),"gl.getProgramInfoLog",
s,N,I);else if(""!==s)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",s);else if(""===N||""===I)F=!1;F&&(this.diagnostics={runnable:L,material:t,programLog:s,vertexShader:{log:N,prefix:w},fragmentShader:{log:I,prefix:z}});x.deleteShader(n);x.deleteShader(B);var R;this.getUniforms=function(){void 0===R&&(R=new b.WebGLUniforms(x,M,a));return R};var D;this.getAttributes=function(){if(void 0===D){for(var a={},b=x.getProgramParameter(M,x.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=x.getActiveAttrib(M,
c).name;a[d]=x.getAttribLocation(M,d)}D=a}return D};this.destroy=function(){x.deleteProgram(M);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=q++;this.code=l;this.usedTimes=1;this.program=M;this.vertexShader=n;this.fragmentShader=B;return this}}();
b.WebGLPrograms=function(a,c){function d(a,c){var d;a?a instanceof b.Texture?d=a.encoding:a instanceof b.WebGLRenderTarget&&(d=a.texture.encoding):d=b.LinearEncoding;d===b.LinearEncoding&&c&&(d=b.GammaEncoding);return d}var e=[],f={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},
h="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(e,h,g,k,q){var p=f[e.type],l;c.floatVertexTextures&&q&&q.skeleton&&q.skeleton.useVertexTexture?l=1024:(l=Math.floor((c.maxVertexUniforms-20)/4),void 0!==q&&q instanceof b.SkinnedMesh&&(l=Math.min(q.skeleton.bones.length,l),l<q.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+q.skeleton.bones.length+", this GPU supports just "+l+" (try OpenGL instead of ANGLE)")));var t=a.getPrecision();null!==e.precision&&(t=c.getMaxPrecision(e.precision),t!==e.precision&&
console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",t,"instead."));return{shaderID:p,precision:t,supportsVertexTextures:c.vertexTextures,outputEncoding:d(a.getCurrentRenderTarget(),a.gammaOutput),map:!!e.map,mapEncoding:d(e.map,a.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:d(e.envMap,a.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===b.CubeUVReflectionMapping||e.envMap.mapping===b.CubeUVRefractionMapping),lightMap:!!e.lightMap,
aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:d(e.emissiveMap,a.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:g,useFog:e.fog,fogExp:g instanceof b.FogExp2,flatShading:e.shading===b.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,skinning:e.skinning,
maxBones:l,useVertexTexture:c.floatVertexTextures&&q&&q.skeleton&&q.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numHemiLights:h.hemi.length,numClippingPlanes:k,shadowMapEnabled:a.shadowMap.enabled&&q.receiveShadow&&0<h.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,
premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===b.DoubleSide,flipSided:e.side===b.BackSide,depthPacking:void 0!==e.depthPacking?e.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<h.length;d++)c.push(b[h[d]]);return c.join()};this.acquireProgram=function(c,d,f){for(var h,g=0,k=e.length;g<
k;g++){var l=e[g];if(l.code===f){h=l;++h.usedTimes;break}}void 0===h&&(h=new b.WebGLProgram(a,f,c,d),e.push(h));return h};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e};b.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var d=a[b];void 0===d&&(d={},a[b]=d);return d};this.delete=function(b){delete a[b.uuid]};this.clear=function(){a={}}};b.WebGLShader=function(){function a(a){a=a.split("\n");for(var b=
0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}return function(b,d,e){var f=b.createShader(d);b.shaderSource(f,e);b.compileShader(f);!1===b.getShaderParameter(f,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(f)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",d===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(f),a(e));return f}}();b.WebGLShadowMap=function(a,c,d){function e(c,d,e,f){var h=c.geometry,g=null,g=s,k=c.customDepthMaterial;
e&&(g=x,k=c.customDistanceMaterial);k?g=k:(c=c instanceof b.SkinnedMesh&&d.skinning,k=0,void 0!==h.morphTargets&&0<h.morphTargets.length&&d.morphTargets&&(k|=1),c&&(k|=2),g=g[k]);a.localClippingEnabled&&!0===d.clipShadows&&0!==d.clippingPlanes.length&&(k=g.uuid,h=d.uuid,c=y[k],void 0===c&&(c={},y[k]=c),k=c[h],void 0===k&&(k=g.clone(),c[h]=k),g=k);g.visible=d.visible;g.wireframe=d.wireframe;g.side=d.side;g.clipShadows=d.clipShadows;g.clippingPlanes=d.clippingPlanes;g.wireframeLinewidth=d.wireframeLinewidth;
g.linewidth=d.linewidth;e&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(f);return g}function f(a,c,d){if(!1!==a.visible){a.layers.test(c.layers)&&(a instanceof b.Mesh||a instanceof b.Line||a instanceof b.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===k.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,a.matrixWorld),t.push(a));a=a.children;for(var e=0,h=a.length;e<h;e++)f(a[e],c,d)}}var h=a.context,g=a.state,k=new b.Frustum,
r=new b.Matrix4,v=c.shadows,q=new b.Vector2,p=new b.Vector3,l=new b.Vector3,t=[],s=Array(4),x=Array(4),y={},w=[new b.Vector3(1,0,0),new b.Vector3(-1,0,0),new b.Vector3(0,0,1),new b.Vector3(0,0,-1),new b.Vector3(0,1,0),new b.Vector3(0,-1,0)],n=[new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,0,1),new b.Vector3(0,0,-1)],B=[new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4];c=new b.MeshDepthMaterial;c.depthPacking=
b.RGBADepthPacking;c.clipping=!0;for(var z=b.ShaderLib.distanceRGBA,N=b.UniformsUtils.clone(z.uniforms),I=0;4!==I;++I){var L=0!==(I&1),F=0!==(I&2),O=c.clone();O.morphTargets=L;O.skinning=F;s[I]=O;L=new b.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:N,vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,morphTargets:L,skinning:F,clipping:!0});x[I]=L}var M=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=b.PCFShadowMap;this.cullFace=b.CullFaceFront;this.render=function(c,
s){if(!1!==M.enabled&&(!1!==M.autoUpdate||!1!==M.needsUpdate)&&0!==v.length){g.clearColor(1,1,1,1);g.disable(h.BLEND);g.enable(h.CULL_FACE);h.frontFace(h.CCW);h.cullFace(M.cullFace===b.CullFaceFront?h.FRONT:h.BACK);g.setDepthTest(!0);g.setScissorTest(!1);for(var x,z,y=0,I=v.length;y<I;y++){var J=v[y],K=J.shadow,G=K.camera;q.copy(K.mapSize);if(J instanceof b.PointLight){x=6;z=!0;var F=q.x,L=q.y;B[0].set(2*F,L,F,L);B[1].set(0,L,F,L);B[2].set(3*F,L,F,L);B[3].set(F,L,F,L);B[4].set(3*F,0,F,L);B[5].set(F,
0,F,L);q.x*=4;q.y*=2}else x=1,z=!1;null===K.map&&(K.map=new b.WebGLRenderTarget(q.x,q.y,{minFilter:b.NearestFilter,magFilter:b.NearestFilter,format:b.RGBAFormat}),G.updateProjectionMatrix());K instanceof b.SpotLightShadow&&K.update(J);F=K.map;K=K.matrix;l.setFromMatrixPosition(J.matrixWorld);G.position.copy(l);a.setRenderTarget(F);a.clear();for(F=0;F<x;F++){z?(p.copy(G.position),p.add(w[F]),G.up.copy(n[F]),G.lookAt(p),g.viewport(B[F])):(p.setFromMatrixPosition(J.target.matrixWorld),G.lookAt(p));G.updateMatrixWorld();
G.matrixWorldInverse.getInverse(G.matrixWorld);K.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);K.multiply(G.projectionMatrix);K.multiply(G.matrixWorldInverse);r.multiplyMatrices(G.projectionMatrix,G.matrixWorldInverse);k.setFromMatrix(r);t.length=0;f(c,s,G);for(var L=0,N=t.length;L<N;L++){var X=t[L],T=d.update(X),O=X.material;if(O instanceof b.MultiMaterial)for(var sa=T.groups,O=O.materials,da=0,Ja=sa.length;da<Ja;da++){var ka=sa[da],ta=O[ka.materialIndex];!0===ta.visible&&(ta=e(X,ta,z,l),a.renderBufferDirect(G,
null,T,ta,X,ka))}else ta=e(X,O,z,l),a.renderBufferDirect(G,null,T,ta,X,null)}}}x=a.getClearColor();z=a.getClearAlpha();a.setClearColor(x,z);g.enable(h.BLEND);M.cullFace===b.CullFaceFront&&h.cullFace(h.BACK);M.needsUpdate=!1}}};b.WebGLState=function(a,c,d){var e=this,f=new b.Vector4,h=a.getParameter(a.MAX_VERTEX_ATTRIBS),g=new Uint8Array(h),k=new Uint8Array(h),r=new Uint8Array(h),v={},q=null,p=null,l=null,t=null,s=null,x=null,y=null,w=null,n=!1,B=null,z=null,N=null,I=null,L=null,F=null,O=null,M=null,
R=null,D=null,H=null,S=null,C=null,Q=null,J=null,K=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),G=void 0,P={},U=new b.Vector4,W=null,aa=null,T=new b.Vector4,oa=new b.Vector4;this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);this.enable(a.CULL_FACE);this.enable(a.BLEND);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var a=
0,b=g.length;a<b;a++)g[a]=0};this.enableAttribute=function(b){g[b]=1;0===k[b]&&(a.enableVertexAttribArray(b),k[b]=1);0!==r[b]&&(c.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(b,0),r[b]=0)};this.enableAttributeAndDivisor=function(b,c,d){g[b]=1;0===k[b]&&(a.enableVertexAttribArray(b),k[b]=1);r[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),r[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=k.length;b<c;b++)k[b]!==g[b]&&(a.disableVertexAttribArray(b),k[b]=0)};this.enable=function(b){!0!==
v[b]&&(a.enable(b),v[b]=!0)};this.disable=function(b){!1!==v[b]&&(a.disable(b),v[b]=!1)};this.getCompressedTextureFormats=function(){if(null===q&&(q=[],c.get("WEBGL_compressed_texture_pvrtc")||c.get("WEBGL_compressed_texture_s3tc")||c.get("WEBGL_compressed_texture_etc1")))for(var b=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<b.length;d++)q.push(b[d]);return q};this.setBlending=function(c,e,f,h,g,k,m,q){c===b.NoBlending?this.disable(a.BLEND):this.enable(a.BLEND);if(c!==p||q!==n)c===b.AdditiveBlending?
q?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):c===b.SubtractiveBlending?q?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):c===b.MultiplyBlending?q?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.SRC_COLOR,
a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):q?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),p=c,n=q;if(c===b.CustomBlending){g=g||e;k=k||f;m=m||h;if(e!==l||g!==x)a.blendEquationSeparate(d(e),d(g)),l=e,x=g;if(f!==t||h!==s||k!==y||m!==w)a.blendFuncSeparate(d(f),
d(h),d(k),d(m)),t=f,s=h,y=k,w=m}else w=y=x=s=t=l=null};this.setDepthFunc=function(c){if(B!==c){if(c)switch(c){case b.NeverDepth:a.depthFunc(a.NEVER);break;case b.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case b.LessDepth:a.depthFunc(a.LESS);break;case b.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case b.EqualDepth:a.depthFunc(a.EQUAL);break;case b.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case b.GreaterDepth:a.depthFunc(a.GREATER);break;case b.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);
B=c}};this.setDepthTest=function(b){b?this.enable(a.DEPTH_TEST):this.disable(a.DEPTH_TEST)};this.setDepthWrite=function(b){z!==b&&(a.depthMask(b),z=b)};this.setColorWrite=function(b){N!==b&&(a.colorMask(b,b,b,b),N=b)};this.setStencilFunc=function(b,c,d){if(L!==b||F!==c||O!==d)a.stencilFunc(b,c,d),L=b,F=c,O=d};this.setStencilOp=function(b,c,d){if(M!==b||R!==c||D!==d)a.stencilOp(b,c,d),M=b,R=c,D=d};this.setStencilTest=function(b){b?this.enable(a.STENCIL_TEST):this.disable(a.STENCIL_TEST)};this.setStencilWrite=
function(b){I!==b&&(a.stencilMask(b),I=b)};this.setFlipSided=function(b){H!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),H=b)};this.setLineWidth=function(b){b!==S&&(a.lineWidth(b),S=b)};this.setPolygonOffset=function(b,c,d){b?this.enable(a.POLYGON_OFFSET_FILL):this.disable(a.POLYGON_OFFSET_FILL);!b||C===c&&Q===d||(a.polygonOffset(c,d),C=c,Q=d)};this.getScissorTest=function(){return J};this.setScissorTest=function(b){(J=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=
function(b){void 0===b&&(b=a.TEXTURE0+K-1);G!==b&&(a.activeTexture(b),G=b)};this.bindTexture=function(b,c){void 0===G&&e.activeTexture();var d=P[G];void 0===d&&(d={type:void 0,texture:void 0},P[G]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(b,c,
d,e){f.set(b,c,d,e);!1===U.equals(f)&&(a.clearColor(b,c,d,e),U.copy(f))};this.clearDepth=function(b){W!==b&&(a.clearDepth(b),W=b)};this.clearStencil=function(b){aa!==b&&(a.clearStencil(b),aa=b)};this.scissor=function(b){!1===T.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),T.copy(b))};this.viewport=function(b){!1===oa.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),oa.copy(b))};this.reset=function(){for(var b=0;b<k.length;b++)1===k[b]&&(a.disableVertexAttribArray(b),k[b]=0);v={};q=null;G=void 0;P={};H=I=z=N=p=null}};
b.WebGLUniforms=function(){var a=[],b=[],d=function(b,c,d){var e=b[0];if(0>=e||0<e)return b;var f=c*d,h=a[f];void 0===h&&(h=new Float32Array(f),a[f]=h);if(0!==c)for(e.toArray(h,0),e=1,f=0;e!==c;++e)f+=d,b[e].toArray(h,f);return h},e=function(a,d){var e=b[d];void 0===e&&(e=new Int32Array(d),b[d]=e);for(var f=0;f!==d;++f)e[f]=a.allocTextureUnit();return e},f=function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},g=function(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,
b.x,b.y)},k=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},r=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},v=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},q=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},p=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},l=function(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,
d);b&&c.setTexture2D(b,d)},t=function(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);b&&c.setTextureCube(b,d)},s=function(a,b){a.uniform2iv(this.addr,b)},x=function(a,b){a.uniform3iv(this.addr,b)},y=function(a,b){a.uniform4iv(this.addr,b)},w=function(a){switch(a){case 5126:return f;case 35664:return g;case 35665:return k;case 35666:return r;case 35674:return v;case 35675:return q;case 35676:return p;case 35678:return l;case 35680:return t;case 5124:case 35670:return h;case 35667:case 35671:return s;
case 35668:case 35672:return x;case 35669:case 35673:return y}},n=function(a,b){a.uniform1fv(this.addr,b)},B=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,d(b,this.size,2))},N=function(a,b){a.uniform3fv(this.addr,d(b,this.size,3))},I=function(a,b){a.uniform4fv(this.addr,d(b,this.size,4))},L=function(a,b){a.uniformMatrix2fv(this.addr,!1,d(b,this.size,4))},F=function(a,b){a.uniformMatrix3fv(this.addr,!1,d(b,this.size,9))},O=function(a,b){a.uniformMatrix4fv(this.addr,
!1,d(b,this.size,16))},M=function(a,b,c){var d=b.length,f=e(c,d);a.uniform1iv(this.addr,f);for(a=0;a!==d;++a){var h=b[a];h&&c.setTexture2D(h,f[a])}},R=function(a,b,c){var d=b.length,f=e(c,d);a.uniform1iv(this.addr,f);for(a=0;a!==d;++a){var h=b[a];h&&c.setTextureCube(h,f[a])}},D=function(a){switch(a){case 5126:return n;case 35664:return z;case 35665:return N;case 35666:return I;case 35674:return L;case 35675:return F;case 35676:return O;case 35678:return M;case 35680:return R;case 5124:case 35670:return B;
case 35667:case 35671:return s;case 35668:case 35672:return x;case 35669:case 35673:return y}},H=function(a,b,c){this.id=a;this.addr=c;this.setValue=w(b.type)},S=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=D(b.type)},C=function(a){this.id=a;this.seq=[];this.map={}};C.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var Q=/([\w\d_]+)(\])?(\[|\.)?/g,J=function(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,
a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),h=this,g=e.name,k=g.length;for(Q.lastIndex=0;;){var l=Q.exec(g),m=Q.lastIndex,p=l[1],n=l[3];"]"===l[2]&&(p|=0);if(void 0===n||"["===n&&m+2===k){g=h;e=void 0===n?new H(p,e,f):new S(p,e,f);g.seq.push(e);g.map[e.id]=e;break}else n=h.map[p],void 0===n&&(n=new C(p),p=h,h=n,p.seq.push(h),p.map[h.id]=h),h=n}}};J.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};
J.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};J.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};J.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var h=b[e],g=c[h.id];!1!==g.needsUpdate&&h.setValue(a,g.value,d)}};J.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};J.splitDynamic=function(a,b){for(var c=null,d=a.length,e=0,f=0;f!==d;++f){var h=a[f],g=
b[h.id];g&&!0===g.dynamic?(null===c&&(c=[]),c.push(h)):(e<f&&(a[e]=h),++e)}e<d&&(a.length=e);return c};J.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var h=b[a[e].id],g=h.onUpdateCallback;void 0!==g&&g.call(h,c,d)}};return J}();b.LensFlarePlugin=function(a,c){var d,e,f,h,g,k,r,v,q,p,l=a.context,t=a.state,s,x,y,w,n,B;this.render=function(z,N,I){if(0!==c.length){z=new b.Vector3;var L=I.w/I.z,F=.5*I.z,O=.5*I.w,M=16/I.w,R=new b.Vector2(M*L,M),D=new b.Vector3(1,1,0),H=new b.Vector2(1,
1),S=new b.Box2;S.min.set(0,0);S.max.set(I.z-16,I.w-16);if(void 0===w){var M=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),C=new Uint16Array([0,1,2,0,2,3]);s=l.createBuffer();x=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,s);l.bufferData(l.ARRAY_BUFFER,M,l.STATIC_DRAW);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,x);l.bufferData(l.ELEMENT_ARRAY_BUFFER,C,l.STATIC_DRAW);n=l.createTexture();B=l.createTexture();t.bindTexture(l.TEXTURE_2D,n);l.texImage2D(l.TEXTURE_2D,0,l.RGB,16,16,0,l.RGB,l.UNSIGNED_BYTE,
null);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);t.bindTexture(l.TEXTURE_2D,B);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,16,16,0,l.RGBA,l.UNSIGNED_BYTE,null);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,
l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);var M=y={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},C=l.createProgram(),Q=l.createShader(l.FRAGMENT_SHADER),
J=l.createShader(l.VERTEX_SHADER),K="precision "+a.getPrecision()+" float;\n";l.shaderSource(Q,K+M.fragmentShader);l.shaderSource(J,K+M.vertexShader);l.compileShader(Q);l.compileShader(J);l.attachShader(C,Q);l.attachShader(C,J);l.linkProgram(C);w=C;q=l.getAttribLocation(w,"position");p=l.getAttribLocation(w,"uv");d=l.getUniformLocation(w,"renderType");e=l.getUniformLocation(w,"map");f=l.getUniformLocation(w,"occlusionMap");h=l.getUniformLocation(w,"opacity");g=l.getUniformLocation(w,"color");k=l.getUniformLocation(w,
"scale");r=l.getUniformLocation(w,"rotation");v=l.getUniformLocation(w,"screenPosition")}l.useProgram(w);t.initAttributes();t.enableAttribute(q);t.enableAttribute(p);t.disableUnusedAttributes();l.uniform1i(f,0);l.uniform1i(e,1);l.bindBuffer(l.ARRAY_BUFFER,s);l.vertexAttribPointer(q,2,l.FLOAT,!1,16,0);l.vertexAttribPointer(p,2,l.FLOAT,!1,16,8);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,x);t.disable(l.CULL_FACE);t.setDepthWrite(!1);C=0;for(Q=c.length;C<Q;C++)if(M=16/I.w,R.set(M*L,M),J=c[C],z.set(J.matrixWorld.elements[12],
J.matrixWorld.elements[13],J.matrixWorld.elements[14]),z.applyMatrix4(N.matrixWorldInverse),z.applyProjection(N.projectionMatrix),D.copy(z),H.x=I.x+D.x*F+F-8,H.y=I.y+D.y*O+O-8,!0===S.containsPoint(H)){t.activeTexture(l.TEXTURE0);t.bindTexture(l.TEXTURE_2D,null);t.activeTexture(l.TEXTURE1);t.bindTexture(l.TEXTURE_2D,n);l.copyTexImage2D(l.TEXTURE_2D,0,l.RGB,H.x,H.y,16,16,0);l.uniform1i(d,0);l.uniform2f(k,R.x,R.y);l.uniform3f(v,D.x,D.y,D.z);t.disable(l.BLEND);t.enable(l.DEPTH_TEST);l.drawElements(l.TRIANGLES,
6,l.UNSIGNED_SHORT,0);t.activeTexture(l.TEXTURE0);t.bindTexture(l.TEXTURE_2D,B);l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,H.x,H.y,16,16,0);l.uniform1i(d,1);t.disable(l.DEPTH_TEST);t.activeTexture(l.TEXTURE1);t.bindTexture(l.TEXTURE_2D,n);l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0);J.positionScreen.copy(D);J.customUpdateCallback?J.customUpdateCallback(J):J.updateLensFlares();l.uniform1i(d,2);t.enable(l.BLEND);for(var K=0,G=J.lensFlares.length;K<G;K++){var P=J.lensFlares[K];.001<P.opacity&&.001<P.scale&&
(D.x=P.x,D.y=P.y,D.z=P.z,M=P.size*P.scale/I.w,R.x=M*L,R.y=M,l.uniform3f(v,D.x,D.y,D.z),l.uniform2f(k,R.x,R.y),l.uniform1f(r,P.rotation),l.uniform1f(h,P.opacity),l.uniform3f(g,P.color.r,P.color.g,P.color.b),t.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),a.setTexture2D(P.texture,1),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0))}}t.enable(l.CULL_FACE);t.enable(l.DEPTH_TEST);t.setDepthWrite(!0);a.resetGLState()}}};b.SpritePlugin=function(a,c){var d,e,f,h,g,k,r,v,q,p,l,t,s,x,y,w,n;
function B(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var z=a.context,N=a.state,I,L,F,O,M=new b.Vector3,R=new b.Quaternion,D=new b.Vector3;this.render=function(H,S){if(0!==c.length){if(void 0===F){var C=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),Q=new Uint16Array([0,1,2,0,2,3]);I=z.createBuffer();L=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,I);z.bufferData(z.ARRAY_BUFFER,C,z.STATIC_DRAW);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,
L);z.bufferData(z.ELEMENT_ARRAY_BUFFER,Q,z.STATIC_DRAW);var C=z.createProgram(),Q=z.createShader(z.VERTEX_SHADER),J=z.createShader(z.FRAGMENT_SHADER);z.shaderSource(Q,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
z.shaderSource(J,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
z.compileShader(Q);z.compileShader(J);z.attachShader(C,Q);z.attachShader(C,J);z.linkProgram(C);F=C;w=z.getAttribLocation(F,"position");n=z.getAttribLocation(F,"uv");d=z.getUniformLocation(F,"uvOffset");e=z.getUniformLocation(F,"uvScale");f=z.getUniformLocation(F,"rotation");h=z.getUniformLocation(F,"scale");g=z.getUniformLocation(F,"color");k=z.getUniformLocation(F,"map");r=z.getUniformLocation(F,"opacity");v=z.getUniformLocation(F,"modelViewMatrix");q=z.getUniformLocation(F,"projectionMatrix");p=
z.getUniformLocation(F,"fogType");l=z.getUniformLocation(F,"fogDensity");t=z.getUniformLocation(F,"fogNear");s=z.getUniformLocation(F,"fogFar");x=z.getUniformLocation(F,"fogColor");y=z.getUniformLocation(F,"alphaTest");C=document.createElement("canvas");C.width=8;C.height=8;Q=C.getContext("2d");Q.fillStyle="white";Q.fillRect(0,0,8,8);O=new b.Texture(C);O.needsUpdate=!0}z.useProgram(F);N.initAttributes();N.enableAttribute(w);N.enableAttribute(n);N.disableUnusedAttributes();N.disable(z.CULL_FACE);N.enable(z.BLEND);
z.bindBuffer(z.ARRAY_BUFFER,I);z.vertexAttribPointer(w,2,z.FLOAT,!1,16,0);z.vertexAttribPointer(n,2,z.FLOAT,!1,16,8);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,L);z.uniformMatrix4fv(q,!1,S.projectionMatrix.elements);N.activeTexture(z.TEXTURE0);z.uniform1i(k,0);Q=C=0;(J=H.fog)?(z.uniform3f(x,J.color.r,J.color.g,J.color.b),J instanceof b.Fog?(z.uniform1f(t,J.near),z.uniform1f(s,J.far),z.uniform1i(p,1),Q=C=1):J instanceof b.FogExp2&&(z.uniform1f(l,J.density),z.uniform1i(p,2),Q=C=2)):(z.uniform1i(p,0),Q=C=0);
for(var J=0,K=c.length;J<K;J++){var G=c[J];G.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,G.matrixWorld);G.z=-G.modelViewMatrix.elements[14]}c.sort(B);for(var P=[],J=0,K=c.length;J<K;J++){var G=c[J],U=G.material;z.uniform1f(y,U.alphaTest);z.uniformMatrix4fv(v,!1,G.modelViewMatrix.elements);G.matrixWorld.decompose(M,R,D);P[0]=D.x;P[1]=D.y;G=0;H.fog&&U.fog&&(G=Q);C!==G&&(z.uniform1i(p,G),C=G);null!==U.map?(z.uniform2f(d,U.map.offset.x,U.map.offset.y),z.uniform2f(e,U.map.repeat.x,U.map.repeat.y)):
(z.uniform2f(d,0,0),z.uniform2f(e,1,1));z.uniform1f(r,U.opacity);z.uniform3f(g,U.color.r,U.color.g,U.color.b);z.uniform1f(f,U.rotation);z.uniform2fv(h,P);N.setBlending(U.blending,U.blendEquation,U.blendSrc,U.blendDst);N.setDepthTest(U.depthTest);N.setDepthWrite(U.depthWrite);U.map?a.setTexture2D(U.map,0):a.setTexture2D(O,0);z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0)}N.enable(z.CULL_FACE);a.resetGLState()}}};b.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
b.RenderableFace=function(){this.id=0;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.normalModel=new b.Vector3;this.vertexNormalsModel=[new b.Vector3,new b.Vector3,new b.Vector3];this.vertexNormalsLength=0;this.color=new b.Color;this.material=null;this.uvs=[new b.Vector2,new b.Vector2,new b.Vector2];this.renderOrder=this.z=0};b.RenderableVertex=function(){this.position=new b.Vector3;this.positionWorld=new b.Vector3;this.positionScreen=new b.Vector4;
this.visible=!0};b.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};b.RenderableLine=function(){this.id=0;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.vertexColors=[new b.Color,new b.Color];this.material=null;this.renderOrder=this.z=0};b.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new b.Vector2;this.material=null;this.renderOrder=0};b.Projector=
function(){function a(){if(p===t){var a=new b.RenderableVertex;l.push(a);t++;p++;return a}return l[p++]}function c(){if(x===w){var a=new b.RenderableFace;y.push(a);w++;x++;return a}return y[x++]}function d(){if(B===N){var a=new b.RenderableLine;z.push(a);N++;B++;return a}return z[B++]}function e(){if(L===O){var a=new b.RenderableSprite;F.push(a);O++;L++;return a}return F[L++]}function f(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}
function h(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,h=-a.z+a.w,g=-b.z+b.w;if(0<=e&&0<=f&&0<=h&&0<=g)return!0;if(0>e&&0>f||0>h&&0>g)return!1;0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>h?c=Math.max(c,h/(h-g)):0>g&&(d=Math.min(d,h/(h-g)));if(d<c)return!1;a.lerp(b,c);b.lerp(a,1-d);return!0}var g,k,r=[],v=0,q,p,l=[],t=0,s,x,y=[],w=0,n,B,z=[],N=0,I,L,F=[],O=0,M={objects:[],lights:[],elements:[]},R=new b.Vector3,D=new b.Vector4,H=new b.Box3(new b.Vector3(-1,-1,-1),new b.Vector3(1,1,1)),S=new b.Box3,
C=Array(3),Q=new b.Matrix4,J=new b.Matrix4,K,G=new b.Matrix4,P=new b.Matrix3,U=new b.Frustum,W=new b.Vector4,aa=new b.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var T=new function(){function e(a){var b=
a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(K);c.copy(b).applyMatrix4(J);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z}function f(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;C[0]=a.positionScreen;C[1]=b.positionScreen;C[2]=c.positionScreen;return H.intersectsBox(S.setFromPoints(C))}function h(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*
(b.positionScreen.x-a.positionScreen.x)}var g=[],k=[],p=null,m=null,t=new b.Matrix3;return{setObject:function(a){p=a;m=p.material;t.getNormalMatrix(p.matrixWorld);g.length=0;k.length=0},projectVertex:e,checkTriangleVisibility:f,checkBackfaceCulling:h,pushVertex:function(b,c,d){q=a();q.position.set(b,c,d);e(q)},pushNormal:function(a,b,c){g.push(a,b,c)},pushUv:function(a,b){k.push(a,b)},pushLine:function(a,b){var c=l[a],e=l[b];n=d();n.id=p.id;n.v1.copy(c);n.v2.copy(e);n.z=(c.positionScreen.z+e.positionScreen.z)/
2;n.renderOrder=p.renderOrder;n.material=p.material;M.elements.push(n)},pushTriangle:function(a,d,e){var n=l[a],q=l[d],r=l[e];if(!1!==f(n,q,r)&&(m.side===b.DoubleSide||!0===h(n,q,r))){s=c();s.id=p.id;s.v1.copy(n);s.v2.copy(q);s.v3.copy(r);s.z=(n.positionScreen.z+q.positionScreen.z+r.positionScreen.z)/3;s.renderOrder=p.renderOrder;s.normalModel.fromArray(g,3*a);s.normalModel.applyMatrix3(t).normalize();for(n=0;3>n;n++)q=s.vertexNormalsModel[n],q.fromArray(g,3*arguments[n]),q.applyMatrix3(t).normalize(),
s.uvs[n].fromArray(k,2*arguments[n]);s.vertexNormalsLength=3;s.material=p.material;M.elements.push(s)}}}};this.projectScene=function(t,q,w,z){L=B=x=0;M.elements.length=0;!0===t.autoUpdate&&t.updateMatrixWorld();null===q.parent&&q.updateMatrixWorld();Q.copy(q.matrixWorldInverse.getInverse(q.matrixWorld));J.multiplyMatrices(q.projectionMatrix,Q);U.setFromMatrix(J);k=0;M.objects.length=0;M.lights.length=0;t.traverseVisible(function(a){if(a instanceof b.Light)M.lights.push(a);else if((a instanceof b.Mesh||
a instanceof b.Line||a instanceof b.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===U.intersectsObject(a))){if(k===v){var c=new b.RenderableObject;r.push(c);v++;k++;g=c}else g=r[k++];g.id=a.id;g.object=a;R.setFromMatrixPosition(a.matrixWorld);R.applyProjection(J);g.z=R.z;g.renderOrder=a.renderOrder;M.objects.push(g)}});!0===w&&M.objects.sort(f);t=0;for(w=M.objects.length;t<w;t++){var y=M.objects[t].object,F=y.geometry;T.setObject(y);K=y.matrixWorld;p=0;if(y instanceof b.Mesh)if(F instanceof
b.BufferGeometry){var H=F.attributes,y=F.groups;if(void 0!==H.position){for(var N=H.position.array,C=0,O=N.length;C<O;C+=3)T.pushVertex(N[C],N[C+1],N[C+2]);if(void 0!==H.normal)for(var X=H.normal.array,C=0,O=X.length;C<O;C+=3)T.pushNormal(X[C],X[C+1],X[C+2]);if(void 0!==H.uv)for(H=H.uv.array,C=0,O=H.length;C<O;C+=2)T.pushUv(H[C],H[C+1]);if(null!==F.index)if(N=F.index.array,0<y.length)for(t=0;t<y.length;t++)for(O=y[t],C=O.start,O=O.start+O.count;C<O;C+=3)T.pushTriangle(N[C],N[C+1],N[C+2]);else for(C=
0,O=N.length;C<O;C+=3)T.pushTriangle(N[C],N[C+1],N[C+2]);else for(C=0,O=N.length/3;C<O;C+=3)T.pushTriangle(C,C+1,C+2)}}else{if(F instanceof b.Geometry){var S=F.vertices,C=F.faces,O=F.faceVertexUvs[0];P.getNormalMatrix(K);for(var N=y.material,H=N instanceof b.MultiMaterial,X=!0===H?y.material:null,Y=0,Z=S.length;Y<Z;Y++){var $=S[Y];R.copy($);if(!0===N.morphTargets)for(var ga=F.morphTargets,ca=y.morphTargetInfluences,ea=0,Ha=ga.length;ea<Ha;ea++){var ia=ca[ea];if(0!==ia){var la=ga[ea].vertices[Y];R.x+=
(la.x-$.x)*ia;R.y+=(la.y-$.y)*ia;R.z+=(la.z-$.z)*ia}}T.pushVertex(R.x,R.y,R.z)}S=0;for(Y=C.length;S<Y;S++)if(Z=C[S],N=!0===H?X.materials[Z.materialIndex]:y.material,void 0!==N&&(ca=N.side,F=l[Z.a],$=l[Z.b],ga=l[Z.c],!1!==T.checkTriangleVisibility(F,$,ga))){ea=T.checkBackfaceCulling(F,$,ga);if(ca!==b.DoubleSide){if(ca===b.FrontSide&&!1===ea)continue;if(ca===b.BackSide&&!0===ea)continue}s=c();s.id=y.id;s.v1.copy(F);s.v2.copy($);s.v3.copy(ga);s.normalModel.copy(Z.normal);!1!==ea||ca!==b.BackSide&&ca!==
b.DoubleSide||s.normalModel.negate();s.normalModel.applyMatrix3(P).normalize();Ha=Z.vertexNormals;ia=0;for(la=Math.min(Ha.length,3);ia<la;ia++){var ba=s.vertexNormalsModel[ia];ba.copy(Ha[ia]);!1!==ea||ca!==b.BackSide&&ca!==b.DoubleSide||ba.negate();ba.applyMatrix3(P).normalize()}s.vertexNormalsLength=Ha.length;ca=O[S];if(void 0!==ca)for(ea=0;3>ea;ea++)s.uvs[ea].copy(ca[ea]);s.color=Z.color;s.material=N;s.z=(F.positionScreen.z+$.positionScreen.z+ga.positionScreen.z)/3;s.renderOrder=y.renderOrder;M.elements.push(s)}}}else if(y instanceof
b.Line)if(F instanceof b.BufferGeometry){if(H=F.attributes,void 0!==H.position){N=H.position.array;C=0;for(O=N.length;C<O;C+=3)T.pushVertex(N[C],N[C+1],N[C+2]);if(null!==F.index)for(N=F.index.array,C=0,O=N.length;C<O;C+=2)T.pushLine(N[C],N[C+1]);else for(H=y instanceof b.LineSegments?2:1,C=0,O=N.length/3-1;C<O;C+=H)T.pushLine(C,C+1)}}else{if(F instanceof b.Geometry&&(G.multiplyMatrices(J,K),S=y.geometry.vertices,0!==S.length))for(F=a(),F.positionScreen.copy(S[0]).applyMatrix4(G),H=y instanceof b.LineSegments?
2:1,Y=1,Z=S.length;Y<Z;Y++)F=a(),F.positionScreen.copy(S[Y]).applyMatrix4(G),0<(Y+1)%H||($=l[p-2],W.copy(F.positionScreen),aa.copy($.positionScreen),!0===h(W,aa)&&(W.multiplyScalar(1/W.w),aa.multiplyScalar(1/aa.w),n=d(),n.id=y.id,n.v1.positionScreen.copy(W),n.v2.positionScreen.copy(aa),n.z=Math.max(W.z,aa.z),n.renderOrder=y.renderOrder,n.material=y.material,y.material.vertexColors===b.VertexColors&&(n.vertexColors[0].copy(y.geometry.colors[Y]),n.vertexColors[1].copy(y.geometry.colors[Y-1])),M.elements.push(n)))}else y instanceof
b.Sprite&&(D.set(K.elements[12],K.elements[13],K.elements[14],1),D.applyMatrix4(J),C=1/D.w,D.z*=C,-1<=D.z&&1>=D.z&&(I=e(),I.id=y.id,I.x=D.x*C,I.y=D.y*C,I.z=D.z,I.renderOrder=y.renderOrder,I.object=y,I.rotation=y.rotation,I.scale.x=y.scale.x*Math.abs(I.x-(D.x+q.projectionMatrix.elements[0])/(D.w+q.projectionMatrix.elements[12])),I.scale.y=y.scale.y*Math.abs(I.y-(D.y+q.projectionMatrix.elements[5])/(D.w+q.projectionMatrix.elements[13])),I.material=y.material,M.elements.push(I)))}!0===z&&M.elements.sort(f);
return M}};b.SpriteCanvasMaterial=function(a){b.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new b.Color(16777215);this.program=function(a,b){};this.setValues(a)};b.SpriteCanvasMaterial.prototype=Object.create(b.Material.prototype);b.SpriteCanvasMaterial.prototype.constructor=b.SpriteCanvasMaterial;b.SpriteCanvasMaterial.prototype.clone=function(){var a=new b.SpriteCanvasMaterial;a.copy(this);a.color.copy(this.color);a.program=this.program;return a};b.CanvasRenderer=function(a){function c(a,
b,c,d){r(b);v(c);q(d);p(a.getStyle());H.stroke();ma.expandByScalar(2*b)}function d(a){l(a.getStyle());H.fill()}function e(a){if(0===a.version||a instanceof b.CompressedTexture||a instanceof b.DataTexture)return{canvas:void 0,version:a.version};var c=a.image;if(!1===c.complete)return{canvas:void 0,version:0};var d=document.createElement("canvas");d.width=c.width;d.height=c.height;var e=d.getContext("2d");e.setTransform(1,0,0,-1,0,c.height);e.drawImage(c,0,0);var c=a.wrapS===b.RepeatWrapping,e=a.wrapT===
b.RepeatWrapping,f="no-repeat";!0===c&&!0===e?f="repeat":!0===c?f="repeat-x":!0===e&&(f="repeat-y");d=H.createPattern(d,f);if(a.onUpdate)a.onUpdate(a);return{canvas:d,version:a.version}}function f(a,b,c,d,f,h,g,k,p,m,n,t,s){var q=Fa[s.id];if(void 0===q||q.version!==s.version)q=e(s),Fa[s.id]=q;if(void 0!==q.canvas){l(q.canvas);var q=s.offset.x/s.repeat.x,r=s.offset.y/s.repeat.y,u=s.image.width*s.repeat.x;s=s.image.height*s.repeat.y;g=(g+q)*u;k=(k+r)*s;c-=a;d-=b;f-=a;h-=b;p=(p+q)*u-g;m=(m+r)*s-k;n=
(n+q)*u-g;t=(t+r)*s-k;s=p*t-n*m;0!==s&&(q=1/s,s=(t*c-m*f)*q,m=(t*d-m*h)*q,c=(p*f-n*c)*q,d=(p*h-n*d)*q,a=a-s*g-c*k,b=b-m*g-d*k,H.save(),H.transform(s,m,c,d,a,b),H.fill(),H.restore())}else l("rgba( 0, 0, 0, 1)"),H.fill()}function h(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c/=Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}function g(a){Q!==a&&(Q=H.globalAlpha=a)}function k(a){J!==a&&(a===b.NormalBlending?H.globalCompositeOperation="source-over":a===b.AdditiveBlending?H.globalCompositeOperation=
"lighter":a===b.SubtractiveBlending&&(H.globalCompositeOperation="darker"),J=a)}function r(a){P!==a&&(P=H.lineWidth=a)}function v(a){U!==a&&(U=H.lineCap=a)}function q(a){W!==a&&(W=H.lineJoin=a)}function p(a){K!==a&&(K=H.strokeStyle=a)}function l(a){G!==a&&(G=H.fillStyle=a)}function t(a){aa.length!==a.length&&(H.setLineDash(a),aa=a)}console.log("THREE.CanvasRenderer",b.REVISION);a=a||{};var s=this,x,y,w,n=new b.Projector,B=void 0!==a.canvas?a.canvas:document.createElement("canvas"),z=B.width,N=B.height,
I=Math.floor(z/2),L=Math.floor(N/2),F=0,O=0,M=z,R=N,D=1,H=B.getContext("2d",{alpha:!0===a.alpha}),S=new b.Color(0),C=!0===a.alpha?0:1,Q=1,J=0,K=null,G=null,P=null,U=null,W=null,aa=[],T,Y,$;new b.RenderableVertex;new b.RenderableVertex;var da,ga,ka,ta,Aa,Ba,pa=new b.Color;new b.Color;new b.Color;new b.Color;new b.Color;var Ca=new b.Color,wa=new b.Color,Ea=new b.Color,Fa={},Z,Ga,qa,ca,ea,Ha,ia,la=new b.Box2,ba=new b.Box2,ma=new b.Box2,Ra=new b.Color,La=new b.Color,xa=new b.Color,va=new b.Vector3,ua=
new b.Vector3,na=new b.Vector3,ya=new b.Matrix3;void 0===H.setLineDash&&(H.setLineDash=function(){});this.domElement=B;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return H};this.getContextAttributes=function(){return H.getContextAttributes()};this.getPixelRatio=function(){return D};this.setPixelRatio=function(a){void 0!==a&&(D=a)};this.setSize=function(a,
b,c){z=a*D;N=b*D;B.width=z;B.height=N;I=Math.floor(z/2);L=Math.floor(N/2);!1!==c&&(B.style.width=a+"px",B.style.height=b+"px");la.min.set(-I,-L);la.max.set(I,L);ba.min.set(-I,-L);ba.max.set(I,L);Q=1;J=0;W=U=P=G=K=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){F=a*D;O=b*D;M=c*D;R=d*D};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(a,b){S.set(a);C=void 0!==b?b:1;ba.min.set(-I,-L);ba.max.set(I,L)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,b)};this.getClearColor=function(){return S};this.getClearAlpha=function(){return C};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===ba.isEmpty()&&(ba.intersect(la),ba.expandByScalar(2),ba.min.x+=I,ba.min.y=-ba.min.y+L,ba.max.x+=I,ba.max.y=-ba.max.y+L,1>C&&H.clearRect(ba.min.x|0,ba.max.y|0,ba.max.x-ba.min.x|0,ba.min.y-ba.max.y|0),0<C&&(k(b.NormalBlending),g(1),l("rgba("+Math.floor(255*S.r)+","+Math.floor(255*S.g)+","+Math.floor(255*S.b)+","+C+")"),H.fillRect(ba.min.x|
0,ba.max.y|0,ba.max.x-ba.min.x|0,ba.min.y-ba.max.y|0)),ba.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,J){if(!1===J instanceof b.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();s.info.render.vertices=0;s.info.render.faces=0;H.setTransform(M/z,0,0,-R/N,F,N-O);H.translate(I,L);x=n.projectScene(a,J,this.sortObjects,this.sortElements);
y=x.elements;w=x.lights;ya.getNormalMatrix(J.matrixWorldInverse);Ra.setRGB(0,0,0);La.setRGB(0,0,0);xa.setRGB(0,0,0);for(var C=0,D=w.length;C<D;C++){var B=w[C],G=B.color;B instanceof b.AmbientLight?Ra.add(G):B instanceof b.DirectionalLight?La.add(G):B instanceof b.PointLight&&xa.add(G)}C=0;for(D=y.length;C<D;C++){var K=y[C],Q=K.material;if(void 0!==Q&&0!==Q.opacity){ma.makeEmpty();if(K instanceof b.RenderableSprite){T=K;T.x*=I;T.y*=L;var B=T,P=K,G=Q;g(G.opacity);k(G.blending);var A=P.scale.x*I,P=P.scale.y*
L,K=.5*Math.sqrt(A*A+P*P);ma.min.set(B.x-K,B.y-K);ma.max.set(B.x+K,B.y+K);if(G instanceof b.SpriteMaterial){var S=G.map;if(null!==S){K=Fa[S.id];if(void 0===K||K.version!==S.version)K=e(S),Fa[S.id]=K;if(void 0!==K.canvas){l(K.canvas);var U=S.image,K=U.width*S.offset.x,Q=U.height*S.offset.y,W=U.width*S.repeat.x,S=U.height*S.repeat.y,U=A/W,aa=P/S;H.save();H.translate(B.x,B.y);0!==G.rotation&&H.rotate(G.rotation);H.translate(-A/2,-P/2);H.scale(U,aa);H.translate(-K,-Q);H.fillRect(K,Q,W,S);H.restore()}}else l(G.color.getStyle()),
H.save(),H.translate(B.x,B.y),0!==G.rotation&&H.rotate(G.rotation),H.scale(A,-P),H.fillRect(-.5,-.5,1,1),H.restore()}else G instanceof b.SpriteCanvasMaterial&&(p(G.color.getStyle()),l(G.color.getStyle()),H.save(),H.translate(B.x,B.y),0!==G.rotation&&H.rotate(G.rotation),H.scale(A,P),G.program(H),H.restore())}else if(K instanceof b.RenderableLine){if(T=K.v1,Y=K.v2,T.positionScreen.x*=I,T.positionScreen.y*=L,Y.positionScreen.x*=I,Y.positionScreen.y*=L,ma.setFromPoints([T.positionScreen,Y.positionScreen]),
!0===la.intersectsBox(ma))if(B=T,G=Y,A=K,P=Q,g(P.opacity),k(P.blending),H.beginPath(),H.moveTo(B.positionScreen.x,B.positionScreen.y),H.lineTo(G.positionScreen.x,G.positionScreen.y),P instanceof b.LineBasicMaterial){r(P.linewidth);v(P.linecap);q(P.linejoin);if(P.vertexColors!==b.VertexColors)p(P.color.getStyle());else if(K=A.vertexColors[0].getStyle(),A=A.vertexColors[1].getStyle(),K===A)p(K);else{try{var V=H.createLinearGradient(B.positionScreen.x,B.positionScreen.y,G.positionScreen.x,G.positionScreen.y);
V.addColorStop(0,K);V.addColorStop(1,A)}catch(ha){V=K}p(V)}H.stroke();ma.expandByScalar(2*P.linewidth)}else P instanceof b.LineDashedMaterial&&(r(P.linewidth),v(P.linecap),q(P.linejoin),p(P.color.getStyle()),t([P.dashSize,P.gapSize]),H.stroke(),ma.expandByScalar(2*P.linewidth),t([]))}else if(K instanceof b.RenderableFace){T=K.v1;Y=K.v2;$=K.v3;if(-1>T.positionScreen.z||1<T.positionScreen.z)continue;if(-1>Y.positionScreen.z||1<Y.positionScreen.z)continue;if(-1>$.positionScreen.z||1<$.positionScreen.z)continue;
T.positionScreen.x*=I;T.positionScreen.y*=L;Y.positionScreen.x*=I;Y.positionScreen.y*=L;$.positionScreen.x*=I;$.positionScreen.y*=L;0<Q.overdraw&&(h(T.positionScreen,Y.positionScreen,Q.overdraw),h(Y.positionScreen,$.positionScreen,Q.overdraw),h($.positionScreen,T.positionScreen,Q.overdraw));ma.setFromPoints([T.positionScreen,Y.positionScreen,$.positionScreen]);if(!0===la.intersectsBox(ma)){G=T;A=Y;P=$;B=Q;s.info.render.vertices+=3;s.info.render.faces++;g(B.opacity);k(B.blending);da=G.positionScreen.x;
ga=G.positionScreen.y;ka=A.positionScreen.x;ta=A.positionScreen.y;Aa=P.positionScreen.x;Ba=P.positionScreen.y;var Q=da,W=ga,S=ka,U=ta,aa=Aa,Ka=Ba;H.beginPath();H.moveTo(Q,W);H.lineTo(S,U);H.lineTo(aa,Ka);H.closePath();if((B instanceof b.MeshLambertMaterial||B instanceof b.MeshPhongMaterial)&&null===B.map){Ca.copy(B.color);wa.copy(B.emissive);B.vertexColors===b.FaceColors&&Ca.multiply(K.color);pa.copy(Ra);ua.copy(G.positionWorld).add(A.positionWorld).add(P.positionWorld).divideScalar(3);G=ua;A=K.normalModel;
P=pa;K=0;for(Q=w.length;K<Q;K++)W=w[K],Ea.copy(W.color),W instanceof b.DirectionalLight?(S=va.setFromMatrixPosition(W.matrixWorld).normalize(),U=A.dot(S),0>=U||(U*=W.intensity,P.add(Ea.multiplyScalar(U)))):W instanceof b.PointLight&&(S=va.setFromMatrixPosition(W.matrixWorld),U=A.dot(va.subVectors(S,G).normalize()),0>=U||(U*=0==W.distance?1:1-Math.min(G.distanceTo(S)/W.distance,1),0!=U&&(U*=W.intensity,P.add(Ea.multiplyScalar(U)))));pa.multiply(Ca).add(wa);!0===B.wireframe?c(pa,B.wireframeLinewidth,
B.wireframeLinecap,B.wireframeLinejoin):d(pa)}else B instanceof b.MeshBasicMaterial||B instanceof b.MeshLambertMaterial||B instanceof b.MeshPhongMaterial?null!==B.map?B.map.mapping===b.UVMapping&&(Z=K.uvs,f(da,ga,ka,ta,Aa,Ba,Z[0].x,Z[0].y,Z[1].x,Z[1].y,Z[2].x,Z[2].y,B.map)):null!==B.envMap?B.envMap.mapping===b.SphericalReflectionMapping&&(na.copy(K.vertexNormalsModel[0]).applyMatrix3(ya),Ga=.5*na.x+.5,qa=.5*na.y+.5,na.copy(K.vertexNormalsModel[1]).applyMatrix3(ya),ca=.5*na.x+.5,ea=.5*na.y+.5,na.copy(K.vertexNormalsModel[2]).applyMatrix3(ya),
Ha=.5*na.x+.5,ia=.5*na.y+.5,f(da,ga,ka,ta,Aa,Ba,Ga,qa,ca,ea,Ha,ia,B.envMap)):(pa.copy(B.color),B.vertexColors===b.FaceColors&&pa.multiply(K.color),!0===B.wireframe?c(pa,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):d(pa)):(B instanceof b.MeshNormalMaterial?(na.copy(K.normalModel).applyMatrix3(ya),pa.setRGB(na.x,na.y,na.z).multiplyScalar(.5).addScalar(.5)):pa.setRGB(1,1,1),!0===B.wireframe?c(pa,B.wireframeLinewidth,B.wireframeLinecap,B.wireframeLinejoin):d(pa))}}ba.union(ma)}}H.setTransform(1,
0,0,1,0,0)}}};b.TrackballControls=function(a,c){function d(a){!1!==l.enabled&&(window.removeEventListener("keydown",d),y=x,x===t.NONE)&&(a.keyCode!==l.keys[t.ROTATE]||l.noRotate?a.keyCode!==l.keys[t.ZOOM]||l.noZoom?a.keyCode!==l.keys[t.PAN]||l.noPan||(x=t.PAN):x=t.ZOOM:x=t.ROTATE)}function e(a){!1!==l.enabled&&(x=y,window.addEventListener("keydown",d,!1))}function f(a){!1!==l.enabled&&(a.preventDefault(),a.stopPropagation(),x===t.NONE&&(x=a.button),x!==t.ROTATE||l.noRotate?x!==t.ZOOM||l.noZoom?x!==
t.PAN||l.noPan||(M.copy(C(a.pageX,a.pageY)),R.copy(M)):(I.copy(C(a.pageX,a.pageY)),L.copy(I)):(B.copy(Q(a.pageX,a.pageY)),n.copy(B)),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",g,!1),l.dispatchEvent(H))}function h(a){!1!==l.enabled&&(a.preventDefault(),a.stopPropagation(),x!==t.ROTATE||l.noRotate?x!==t.ZOOM||l.noZoom?x!==t.PAN||l.noPan||R.copy(C(a.pageX,a.pageY)):L.copy(C(a.pageX,a.pageY)):(n.copy(B),B.copy(Q(a.pageX,a.pageY))))}function g(a){!1!==l.enabled&&(a.preventDefault(),
a.stopPropagation(),x=t.NONE,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",g),l.dispatchEvent(S))}function k(a){if(!1!==l.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);I.y+=.01*b;l.dispatchEvent(H);l.dispatchEvent(S)}}function r(a){if(!1!==l.enabled){switch(a.touches.length){case 1:x=t.TOUCH_ROTATE;B.copy(Q(a.touches[0].pageX,a.touches[0].pageY));n.copy(B);break;default:x=t.TOUCH_ZOOM_PAN;var b=
a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;O=F=Math.sqrt(b*b+c*c);M.copy(C((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));R.copy(M)}l.dispatchEvent(H)}}function v(a){if(!1!==l.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:n.copy(B);B.copy(Q(a.touches[0].pageX,a.touches[0].pageY));break;default:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;O=Math.sqrt(b*b+
c*c);R.copy(C((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2))}}function q(a){if(!1!==l.enabled){switch(a.touches.length){case 0:x=t.NONE;break;case 1:x=t.TOUCH_ROTATE,B.copy(Q(a.touches[0].pageX,a.touches[0].pageY)),n.copy(B)}l.dispatchEvent(S)}}function p(a){a.preventDefault()}var l=this,t={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};
this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new b.Vector3;var s=new b.Vector3,x=t.NONE,y=t.NONE,w=new b.Vector3,n=new b.Vector2,B=new b.Vector2,z=new b.Vector3,N=0,I=new b.Vector2,L=new b.Vector2,F=0,O=0,M=new b.Vector2,R=new b.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();
var D={type:"change"},H={type:"start"},S={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=
function(a){if("function"==typeof this[a.type])this[a.type](a)};var C=function(){var a=new b.Vector2;return function(b,c){a.set((b-l.screen.left)/l.screen.width,(c-l.screen.top)/l.screen.height);return a}}(),Q=function(){var a=new b.Vector2;return function(b,c){a.set((b-.5*l.screen.width-l.screen.left)/(.5*l.screen.width),(l.screen.height+2*(l.screen.top-c))/l.screen.width);return a}}();this.rotateCamera=function(){var a=new b.Vector3,c=new b.Quaternion,d=new b.Vector3,e=new b.Vector3,f=new b.Vector3,
h=new b.Vector3,g;return function(){h.set(B.x-n.x,B.y-n.y,0);(g=h.length())?(w.copy(l.object.position).sub(l.target),d.copy(w).normalize(),e.copy(l.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(B.y-n.y),f.setLength(B.x-n.x),h.copy(e.add(f)),a.crossVectors(h,w).normalize(),g*=l.rotateSpeed,c.setFromAxisAngle(a,g),w.applyQuaternion(c),l.object.up.applyQuaternion(c),z.copy(a),N=g):!l.staticMoving&&N&&(N*=Math.sqrt(1-l.dynamicDampingFactor),w.copy(l.object.position).sub(l.target),
c.setFromAxisAngle(z,N),w.applyQuaternion(c),l.object.up.applyQuaternion(c));n.copy(B)}}();this.zoomCamera=function(){var a;x===t.TOUCH_ZOOM_PAN?(a=F/O,F=O,w.multiplyScalar(a)):(a=1+(L.y-I.y)*l.zoomSpeed,1!==a&&0<a&&(w.multiplyScalar(a),l.staticMoving?I.copy(L):I.y+=(L.y-I.y)*this.dynamicDampingFactor))};this.panCamera=function(){var a=new b.Vector2,c=new b.Vector3,d=new b.Vector3;return function(){a.copy(R).sub(M);a.lengthSq()&&(a.multiplyScalar(w.length()*l.panSpeed),d.copy(w).cross(l.object.up).setLength(a.x),
d.add(c.copy(l.object.up).setLength(a.y)),l.object.position.add(d),l.target.add(d),l.staticMoving?M.copy(R):M.add(a.subVectors(R,M).multiplyScalar(l.dynamicDampingFactor)))}}();this.checkDistances=function(){l.noZoom&&l.noPan||(w.lengthSq()>l.maxDistance*l.maxDistance&&(l.object.position.addVectors(l.target,w.setLength(l.maxDistance)),I.copy(L)),w.lengthSq()<l.minDistance*l.minDistance&&(l.object.position.addVectors(l.target,w.setLength(l.minDistance)),I.copy(L)))};this.update=function(){w.subVectors(l.object.position,
l.target);l.noRotate||l.rotateCamera();l.noZoom||l.zoomCamera();l.noPan||l.panCamera();l.object.position.addVectors(l.target,w);l.checkDistances();l.object.lookAt(l.target);1E-6<s.distanceToSquared(l.object.position)&&(l.dispatchEvent(D),s.copy(l.object.position))};this.reset=function(){y=x=t.NONE;l.target.copy(l.target0);l.object.position.copy(l.position0);l.object.up.copy(l.up0);w.subVectors(l.object.position,l.target);l.object.lookAt(l.target);l.dispatchEvent(D);s.copy(l.object.position)};this.dispose=
function(){this.domElement.removeEventListener("contextmenu",p,!1);this.domElement.removeEventListener("mousedown",f,!1);this.domElement.removeEventListener("mousewheel",k,!1);this.domElement.removeEventListener("MozMousePixelScroll",k,!1);this.domElement.removeEventListener("touchstart",r,!1);this.domElement.removeEventListener("touchend",q,!1);this.domElement.removeEventListener("touchmove",v,!1);document.removeEventListener("mousemove",h,!1);document.removeEventListener("mouseup",g,!1);window.removeEventListener("keydown",
d,!1);window.removeEventListener("keyup",e,!1)};this.domElement.addEventListener("contextmenu",p,!1);this.domElement.addEventListener("mousedown",f,!1);this.domElement.addEventListener("mousewheel",k,!1);this.domElement.addEventListener("MozMousePixelScroll",k,!1);this.domElement.addEventListener("touchstart",r,!1);this.domElement.addEventListener("touchend",q,!1);this.domElement.addEventListener("touchmove",v,!1);window.addEventListener("keydown",d,!1);window.addEventListener("keyup",e,!1);this.handleResize();
this.update()};b.TrackballControls.prototype=Object.create(b.EventDispatcher.prototype);b.TrackballControls.prototype.constructor=b.TrackballControls;b.SphereGeometry=function(a,c,d,e,f,h,g){b.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:e,phiLength:f,thetaStart:h,thetaLength:g};this.fromBufferGeometry(new b.SphereBufferGeometry(a,c,d,e,f,h,g))};b.SphereGeometry.prototype=Object.create(b.Geometry.prototype);b.SphereGeometry.prototype.constructor=
b.SphereGeometry;b.SphereBufferGeometry=function(a,c,d,e,f,h,g){b.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:e,phiLength:f,thetaStart:h,thetaLength:g};a=a||50;c=Math.max(3,Math.floor(c)||8);d=Math.max(2,Math.floor(d)||6);e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;h=void 0!==h?h:0;g=void 0!==g?g:Math.PI;for(var k=h+g,r=(c+1)*(d+1),v=new b.BufferAttribute(new Float32Array(3*r),3),q=new b.BufferAttribute(new Float32Array(3*
r),3),r=new b.BufferAttribute(new Float32Array(2*r),2),p=0,l=[],t=new b.Vector3,s=0;s<=d;s++){for(var x=[],y=s/d,w=0;w<=c;w++){var n=w/c,B=-a*Math.cos(e+n*f)*Math.sin(h+y*g),z=a*Math.cos(h+y*g),N=a*Math.sin(e+n*f)*Math.sin(h+y*g);t.set(B,z,N).normalize();v.setXYZ(p,B,z,N);q.setXYZ(p,t.x,t.y,t.z);r.setXY(p,n,1-y);x.push(p);p++}l.push(x)}e=[];for(s=0;s<d;s++)for(w=0;w<c;w++)f=l[s][w+1],g=l[s][w],p=l[s+1][w],t=l[s+1][w+1],(0!==s||0<h)&&e.push(f,g,t),(s!==d-1||k<Math.PI)&&e.push(g,p,t);this.setIndex(new (65535<
v.count?b.Uint32Attribute:b.Uint16Attribute)(e,1));this.addAttribute("position",v);this.addAttribute("normal",q);this.addAttribute("uv",r);this.boundingSphere=new b.Sphere(new b.Vector3,a)};b.SphereBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.SphereBufferGeometry.prototype.constructor=b.SphereBufferGeometry;b.CylinderGeometry=function(a,c,d,e,f,g,k,r){b.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:e,heightSegments:f,
openEnded:g,thetaStart:k,thetaLength:r};this.fromBufferGeometry(new b.CylinderBufferGeometry(a,c,d,e,f,g,k,r));this.mergeVertices()};b.CylinderGeometry.prototype=Object.create(b.Geometry.prototype);b.CylinderGeometry.prototype.constructor=b.CylinderGeometry;b.CylinderBufferGeometry=function(a,c,d,e,f,g,k,r){function y(d){var f,g,h;h=new b.Vector2;var p=new b.Vector3,n=0,q=!0===d?a:c,D=!0===d?1:-1;g=X;for(f=1;f<=e;f++)t.setXYZ(X,0,B*D,0),s.setXYZ(X,0,D,0),!0===d?(h.x=f/e,h.y=0):(h.x=(f-1)/e,h.y=1),
x.setXY(X,h.x,h.y),X++;h=X;for(f=0;f<=e;f++){var E=f/e;p.x=q*Math.sin(E*r+k);p.y=B*D;p.z=q*Math.cos(E*r+k);t.setXYZ(X,p.x,p.y,p.z);s.setXYZ(X,0,D,0);x.setXY(X,E,!0===d?1:0);X++}for(f=0;f<e;f++)p=g+f,q=h+f,!0===d?(l.setX(w,q),w++,l.setX(w,q+1)):(l.setX(w,q+1),w++,l.setX(w,q)),w++,l.setX(w,p),w++,n+=3;v.addGroup(z,n,!0===d?1:2);z+=n}b.BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:k,
thetaLength:r};var v=this;a=void 0!==a?a:20;c=void 0!==c?c:20;d=void 0!==d?d:100;e=Math.floor(e)||8;f=Math.floor(f)||1;g=void 0!==g?g:!1;k=void 0!==k?k:0;r=void 0!==r?r:2*Math.PI;var q=function(){var a=(e+1)*(f+1);!1===g&&(a+=2*(e+1)+2*e);return a}(),p=function(){var a=e*f*6;!1===g&&(a+=6*e);return a}(),l=new b.BufferAttribute(new (65535<p?Uint32Array:Uint16Array)(p),1),t=new b.BufferAttribute(new Float32Array(3*q),3),s=new b.BufferAttribute(new Float32Array(3*q),3),x=new b.BufferAttribute(new Float32Array(2*
q),2),X=0,w=0,n=[],B=d/2,z=0;(function(){var g,h,p=new b.Vector3,q=new b.Vector3,y=0,E=(c-a)/d;for(h=0;h<=f;h++){var R=[],D=h/f,H=D*(c-a)+a;for(g=0;g<=e;g++){var S=g/e;q.x=H*Math.sin(S*r+k);q.y=-D*d+B;q.z=H*Math.cos(S*r+k);t.setXYZ(X,q.x,q.y,q.z);p.copy(q);if(0===a&&0===h||0===c&&h===f)p.x=Math.sin(S*r+k),p.z=Math.cos(S*r+k);p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*E).normalize();s.setXYZ(X,p.x,p.y,p.z);x.setXY(X,S,1-D);R.push(X);X++}n.push(R)}for(g=0;g<e;g++)for(h=0;h<f;h++)p=n[h+1][g],q=n[h+1][g+1],E=
n[h][g+1],l.setX(w,n[h][g]),w++,l.setX(w,p),w++,l.setX(w,E),w++,l.setX(w,p),w++,l.setX(w,q),w++,l.setX(w,E),w++,y+=6;v.addGroup(z,y,0);z+=y})();!1===g&&(0<a&&y(!0),0<c&&y(!1));this.setIndex(l);this.addAttribute("position",t);this.addAttribute("normal",s);this.addAttribute("uv",x)};b.CylinderBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.CylinderBufferGeometry.prototype.constructor=b.CylinderBufferGeometry;b.ArrowHelper=function(){var a=new b.Geometry;a.vertices.push(new b.Vector3(0,
0,0),new b.Vector3(0,1,0));var c=new b.CylinderGeometry(0,.5,1,5,1);c.translate(0,-.5,0);return function(d,e,f,g,k,r){b.Object3D.call(this);void 0===g&&(g=16776960);void 0===f&&(f=1);void 0===k&&(k=.2*f);void 0===r&&(r=.2*k);this.position.copy(e);this.line=new b.Line(a,new b.LineBasicMaterial({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new b.Mesh(c,new b.MeshBasicMaterial({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(d);this.setLength(f,
k,r)}}();b.ArrowHelper.prototype=Object.create(b.Object3D.prototype);b.ArrowHelper.prototype.constructor=b.ArrowHelper;b.ArrowHelper.prototype.setDirection=function(){var a=new b.Vector3,c;return function(b){.99999<b.y?this.quaternion.set(0,0,0,1):-.99999>b.y?this.quaternion.set(1,0,0,0):(a.set(b.z,0,-b.x).normalize(),c=Math.acos(b.y),this.quaternion.setFromAxisAngle(a,c))}}();b.ArrowHelper.prototype.setLength=function(a,b,d){void 0===b&&(b=.2*a);void 0===d&&(d=.2*b);this.line.scale.set(1,Math.max(0,
a-b),1);this.line.updateMatrix();this.cone.scale.set(d,b,d);this.cone.position.y=a;this.cone.updateMatrix()};b.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};g.THREE=b})},function(ga,$,Y){(function(r){(function(g,k){k($)})(this,function(g){var k={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*
a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},
InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===
a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*
a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-k.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*k.Bounce.In(2*a):.5*k.Bounce.Out(2*a-1)+.5}}},y="undefined"===typeof self&&"undefined"!==typeof r&&r.hrtime?function(){var a=r.hrtime();return 1E3*a[0]+a[1]/1E6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?
self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},b=function(){function a(){this._tweens={};this._tweensAddedDuringUpdate={}}a.prototype.getAll=function(){var a=this;return Object.keys(this._tweens).map(function(b){return a._tweens[b]})};a.prototype.removeAll=function(){this._tweens={}};a.prototype.add=function(a){this._tweens[a.getId()]=a;this._tweensAddedDuringUpdate[a.getId()]=a};a.prototype.remove=function(a){delete this._tweens[a.getId()];
delete this._tweensAddedDuringUpdate[a.getId()]};a.prototype.update=function(a,b){void 0===a&&(a=y());void 0===b&&(b=!1);var c=Object.keys(this._tweens);if(0===c.length)return!1;for(;0<c.length;){this._tweensAddedDuringUpdate={};for(var d=0;d<c.length;d++){var e=this._tweens[c[d]],f=!b;e&&!1===e.update(a,f)&&!b&&delete this._tweens[c[d]]}c=Object.keys(this._tweensAddedDuringUpdate)}return!0};return a}(),a={Linear:function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e),g=a.Utils.Linear;return 0>c?g(b[0],
b[1],e):1<c?g(b[d],b[d-1],d-e):g(b[f],b[f+1>d?d:f+1],e-f)},Bezier:function(b,c){for(var d=0,e=b.length-1,f=Math.pow,g=a.Utils.Bernstein,h=0;h<=e;h++)d+=f(1-c,e-h)*f(c,h)*b[h]*g(e,h);return d},CatmullRom:function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e),g=a.Utils.CatmullRom;return b[0]===b[d]?(0>c&&(f=Math.floor(e=d*(1+c))),g(b[(f-1+d)%d],b[f],b[(f+1)%d],b[(f+2)%d],e-f)):0>c?b[0]-(g(b[0],b[0],b[1],b[1],-e)-b[0]):1<c?b[d]-(g(b[d],b[d],b[d-1],b[d-1],e-d)-b[d]):g(b[f?f-1:0],b[f],b[d<f+1?d:f+1],b[d<
f+2?d:f+2],e-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(b,c){var d=a.Utils.Factorial;return d(b)/d(c)/d(b-c)},Factorial:function(){var a=[1];return function(b){var c=1;if(a[b])return a[b];for(var d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}}},c=function(){function a(){}a.nextId=function(){return a._nextId++};a._nextId=0;return a}(),d=new b,e=function(){function b(e,f){void 0===
f&&(f=d);this._object=e;this._group=f;this._isPaused=!1;this._pauseStart=0;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1E3;this._repeat=this._initialRepeat=0;this._reversed=this._isPlaying=this._yoyo=!1;this._startTime=this._delayTime=0;this._easingFunction=k.Linear.None;this._interpolationFunction=a.Linear;this._chainedTweens=[];this._onStartCallbackFired=!1;this._id=c.nextId();this._goToEnd=this._isChainStopped=!1}b.prototype.getId=function(){return this._id};
b.prototype.isPlaying=function(){return this._isPlaying};b.prototype.isPaused=function(){return this._isPaused};b.prototype.to=function(a,b){this._valuesEnd=Object.create(a);void 0!==b&&(this._duration=b);return this};b.prototype.duration=function(a){this._duration=a;return this};b.prototype.start=function(a){if(this._isPlaying)return this;this._group&&this._group.add(this);this._repeat=this._initialRepeat;if(this._reversed){this._reversed=!1;for(var b in this._valuesStartRepeat)this._swapEndStartRepeatValues(b),
this._valuesStart[b]=this._valuesStartRepeat[b]}this._isPlaying=!0;this._isChainStopped=this._onStartCallbackFired=this._isPaused=!1;this._startTime=void 0!==a?"string"===typeof a?y()+parseFloat(a):a:y();this._startTime+=this._delayTime;this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat);return this};b.prototype._setupProperties=function(a,b,c,d){for(var e in c){var f=a[e],g=Array.isArray(f),h=g?"array":typeof f,k=!g&&Array.isArray(c[e]);if("undefined"!==
h&&"function"!==h){if(k){var m=c[e];if(0===m.length)continue;m=m.map(this._handleRelativeValue.bind(this,f));c[e]=[f].concat(m)}if("object"!==h&&!g||!f||k)"undefined"===typeof b[e]&&(b[e]=f),g||(b[e]*=1),d[e]=k?c[e].slice().reverse():b[e]||0;else{b[e]=g?[]:{};for(var p in f)b[e][p]=f[p];d[e]=g?[]:{};this._setupProperties(f,b[e],c[e],d[e])}}}};b.prototype.stop=function(){this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens());if(!this._isPlaying)return this;this._group&&this._group.remove(this);
this._isPaused=this._isPlaying=!1;this._onStopCallback&&this._onStopCallback(this._object);return this};b.prototype.end=function(){this._goToEnd=!0;this.update(Infinity);return this};b.prototype.pause=function(a){void 0===a&&(a=y());if(this._isPaused||!this._isPlaying)return this;this._isPaused=!0;this._pauseStart=a;this._group&&this._group.remove(this);return this};b.prototype.resume=function(a){void 0===a&&(a=y());if(!this._isPaused||!this._isPlaying)return this;this._isPaused=!1;this._startTime+=
a-this._pauseStart;this._pauseStart=0;this._group&&this._group.add(this);return this};b.prototype.stopChainedTweens=function(){for(var a=0,b=this._chainedTweens.length;a<b;a++)this._chainedTweens[a].stop();return this};b.prototype.group=function(a){this._group=a;return this};b.prototype.delay=function(a){this._delayTime=a;return this};b.prototype.repeat=function(a){this._repeat=this._initialRepeat=a;return this};b.prototype.repeatDelay=function(a){this._repeatDelayTime=a;return this};b.prototype.yoyo=
function(a){this._yoyo=a;return this};b.prototype.easing=function(a){this._easingFunction=a;return this};b.prototype.interpolation=function(a){this._interpolationFunction=a;return this};b.prototype.chain=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._chainedTweens=a;return this};b.prototype.onStart=function(a){this._onStartCallback=a;return this};b.prototype.onUpdate=function(a){this._onUpdateCallback=a;return this};b.prototype.onRepeat=function(a){this._onRepeatCallback=
a;return this};b.prototype.onComplete=function(a){this._onCompleteCallback=a;return this};b.prototype.onStop=function(a){this._onStopCallback=a;return this};b.prototype.update=function(a,b){void 0===a&&(a=y());void 0===b&&(b=!0);if(this._isPaused)return!0;var c,d;d=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(a>d)return!1;b&&this.start(a)}this._goToEnd=!1;if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),
this._onStartCallbackFired=!0);d=(a-this._startTime)/this._duration;d=0===this._duration||1<d?1:d;var e=this._easingFunction(d);this._updateProperties(this._object,this._valuesStart,this._valuesEnd,e);this._onUpdateCallback&&this._onUpdateCallback(this._object,d);if(1===d)if(0<this._repeat){isFinite(this._repeat)&&this._repeat--;for(c in this._valuesStartRepeat)this._yoyo||"string"!==typeof this._valuesEnd[c]||(this._valuesStartRepeat[c]+=parseFloat(this._valuesEnd[c])),this._yoyo&&this._swapEndStartRepeatValues(c),
this._valuesStart[c]=this._valuesStartRepeat[c];this._yoyo&&(this._reversed=!this._reversed);this._startTime=void 0!==this._repeatDelayTime?a+this._repeatDelayTime:a+this._delayTime;this._onRepeatCallback&&this._onRepeatCallback(this._object)}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);c=0;for(d=this._chainedTweens.length;c<d;c++)this._chainedTweens[c].start(this._startTime+this._duration);return this._isPlaying=!1}return!0};b.prototype._updateProperties=function(a,b,c,d){for(var e in c)if(void 0!==
b[e]){var f=b[e]||0,g=c[e],h=Array.isArray(a[e]),k=Array.isArray(g);!h&&k?a[e]=this._interpolationFunction(g,d):"object"===typeof g&&g?this._updateProperties(a[e],f,g,d):(g=this._handleRelativeValue(f,g),"number"===typeof g&&(a[e]=f+(g-f)*d))}};b.prototype._handleRelativeValue=function(a,b){return"string"!==typeof b?b:"+"===b.charAt(0)||"-"===b.charAt(0)?a+parseFloat(b):parseFloat(b)};b.prototype._swapEndStartRepeatValues=function(a){var b=this._valuesStartRepeat[a],c=this._valuesEnd[a];this._valuesStartRepeat[a]=
"string"===typeof c?this._valuesStartRepeat[a]+parseFloat(c):this._valuesEnd[a];this._valuesEnd[a]=b};return b}(),f=c.nextId,h=d.getAll.bind(d),m=d.removeAll.bind(d),u=d.add.bind(d),E=d.remove.bind(d),v=d.update.bind(d),q={Easing:k,Group:b,Interpolation:a,now:y,Sequence:c,nextId:f,Tween:e,VERSION:"18.6.4",getAll:h,removeAll:m,add:u,remove:E,update:v};g.Easing=k;g.Group=b;g.Interpolation=a;g.Sequence=c;g.Tween=e;g.VERSION="18.6.4";g.add=u;g.default=q;g.getAll=h;g.nextId=f;g.now=y;g.remove=E;g.removeAll=
m;g.update=v;Object.defineProperty(g,"__esModule",{value:!0})})}).call($,Y(7))},function(ga,$){function Y(){throw Error("setTimeout has not been defined");}function r(){throw Error("clearTimeout has not been defined");}function g(a){if(e===setTimeout)return setTimeout(a,0);if((e===Y||!e)&&setTimeout)return e=setTimeout,setTimeout(a,0);try{return e(a,0)}catch(b){try{return e.call(null,a,0)}catch(c){return e.call(this,a,0)}}}function k(a){if(f===clearTimeout)return clearTimeout(a);if((f===r||!f)&&clearTimeout)return f=
clearTimeout,clearTimeout(a);try{return f(a)}catch(b){try{return f.call(null,a)}catch(c){return f.call(this,a)}}}function y(){E&&v&&(E=!1,v.length?u=v.concat(u):q=-1,u.length&&b())}function b(){if(!E){var a=g(y);E=!0;for(var b=u.length;b;){v=u;for(u=[];++q<b;)v&&v[q].run();q=-1;b=u.length}v=null;E=!1;k(a)}}function a(a,b){this.fun=a;this.array=b}function c(){}var d=ga.exports={},e,f;try{e="function"===typeof setTimeout?setTimeout:Y}catch(h){e=Y}try{f="function"===typeof clearTimeout?clearTimeout:
r}catch(m){f=r}var u=[],E=!1,v,q=-1;d.nextTick=function(c){var d=Array(arguments.length-1);if(1<arguments.length)for(var e=1;e<arguments.length;e++)d[e-1]=arguments[e];u.push(new a(c,d));1!==u.length||E||g(b)};a.prototype.run=function(){this.fun.apply(null,this.array)};d.title="browser";d.browser=!0;d.env={};d.argv=[];d.version="";d.versions={};d.on=c;d.addListener=c;d.once=c;d.off=c;d.removeListener=c;d.removeAllListeners=c;d.emit=c;d.prependListener=c;d.prependOnceListener=c;d.listeners=function(a){return[]};
d.binding=function(a){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(a){throw Error("process.chdir is not supported");};d.umask=function(){return 0}}]);
</script>
</body>
</html>
