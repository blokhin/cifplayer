<!--
Materials Informatics HTML5 Player --- in-browser ultra-fast and
lightweight renderer of the crystallographic data
Author: Evgeny Blokhin / Tilde Materials Informatics
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
<title>Materials Informatics Web-viewer</title>
<style>
body{margin:0;padding:0;overflow:hidden;font-family:Georgia,serif;}
html, body{height:100%;}
#player{z-index:2;position:fixed;}
#infopanel{position:fixed;top:8px;left:8px;width:150px;height:150px;text-align:left;z-index:3;line-height:22px;font-size:0.9em;color:#888;}
#landing{display:none;position:fixed;left:0;top:0;right:0;bottom:0;height:auto;z-index:5;background:#fff;margin:0;text-align:center;font-size:1.25em;padding:10px;line-height:1.8em;}
#landing a{color:#666;text-decoration:none;border-bottom:1px solid #999;}
h1{margin:10px auto 35px;font-size:1.4em;color:#999;font-weight:normal;}
#legend{width:290px;margin:20px auto 0;border-radius:15px;background:#f0f0f0;color:#666;padding:5px;}
#triangle{width:0;height:0;margin:-2px auto 20px;border-left:20px solid transparent;border-right:20px solid transparent;border-top:20px solid #f0f0f0;}
#notifybox{display:none;z-index:7;position:fixed;top:4px;left:4px;width:500px;background:#333;color:#fff;font-weight:bold;border-radius:5px;}
#cross{float:right;width:24px;height:24px;font-size:10px;text-align:center;cursor:pointer;background:url(data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///1VVVf///yH5BAEAAAMALAAAAAAQABAAAAIjnI+py6L+BDRy0gqxHVqvLjGcJ3Yl+IEhQpLX+m7wMYv2PRQAOw==) center center no-repeat;}
#message{margin:20px;}
#fileapi{color:#999;}
#versionbox{display:none;z-index:6;position:fixed;bottom:2px;right:2px;font-size:0.9em;color:#999;}
#cmdbox{display:none;z-index:4;position:fixed;bottom:2px;left:4px;cursor:pointer;font-size:1.1em;color:#999;border-bottom:1px solid #999;}
@media screen and (min-width:1200px){
#cmdbox{display:block;}
#versionbox{display:block;}
}
</style>
<script type="text/javascript">
'use strict';(function(a){var b;"undefined"===typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b={},define(function(){return b})):b="undefined"!==typeof window?window:a:b=exports;(function(a){if(!b)var b=1E-6;if(!e)var e="undefined"!==typeof Float32Array?Float32Array:Array;if(!g)var g=Math.random;var k={setMatrixArrayType:function(f){e=f}};"undefined"!==typeof a&&(a.glMatrix=k);var h={create:function(){var f=new e(2);f[0]=0;f[1]=0;return f},clone:function(f){var r=
new e(2);r[0]=f[0];r[1]=f[1];return r},fromValues:function(f,r){var a=new e(2);a[0]=f;a[1]=r;return a},copy:function(f,r){f[0]=r[0];f[1]=r[1];return f},set:function(f,r,a){f[0]=r;f[1]=a;return f},add:function(f,r,a){f[0]=r[0]+a[0];f[1]=r[1]+a[1];return f},subtract:function(f,r,a){f[0]=r[0]-a[0];f[1]=r[1]-a[1];return f}};h.sub=h.subtract;h.multiply=function(f,r,a){f[0]=r[0]*a[0];f[1]=r[1]*a[1];return f};h.mul=h.multiply;h.divide=function(f,r,a){f[0]=r[0]/a[0];f[1]=r[1]/a[1];return f};h.div=h.divide;
h.min=function(f,r,a){f[0]=Math.min(r[0],a[0]);f[1]=Math.min(r[1],a[1]);return f};h.max=function(f,r,a){f[0]=Math.max(r[0],a[0]);f[1]=Math.max(r[1],a[1]);return f};h.scale=function(f,r,a){f[0]=r[0]*a;f[1]=r[1]*a;return f};h.scaleAndAdd=function(f,r,a,b){f[0]=r[0]+a[0]*b;f[1]=r[1]+a[1]*b;return f};h.distance=function(f,r){var a=r[0]-f[0],b=r[1]-f[1];return Math.sqrt(a*a+b*b)};h.dist=h.distance;h.squaredDistance=function(f,r){var a=r[0]-f[0],b=r[1]-f[1];return a*a+b*b};h.sqrDist=h.squaredDistance;h.length=
function(f){var r=f[0];f=f[1];return Math.sqrt(r*r+f*f)};h.len=h.length;h.squaredLength=function(f){var r=f[0];f=f[1];return r*r+f*f};h.sqrLen=h.squaredLength;h.negate=function(f,r){f[0]=-r[0];f[1]=-r[1];return f};h.normalize=function(f,r){var a=r[0],b=r[1],a=a*a+b*b;0<a&&(a=1/Math.sqrt(a),f[0]=r[0]*a,f[1]=r[1]*a);return f};h.dot=function(f,r){return f[0]*r[0]+f[1]*r[1]};h.cross=function(f,r,a){r=r[0]*a[1]-r[1]*a[0];f[0]=f[1]=0;f[2]=r;return f};h.lerp=function(f,r,a,b){var c=r[0];r=r[1];f[0]=c+b*
(a[0]-c);f[1]=r+b*(a[1]-r);return f};h.random=function(f,r){r=r||1;var a=2*g()*Math.PI;f[0]=Math.cos(a)*r;f[1]=Math.sin(a)*r;return f};h.transformMat2=function(f,r,a){var b=r[0];r=r[1];f[0]=a[0]*b+a[2]*r;f[1]=a[1]*b+a[3]*r;return f};h.transformMat2d=function(f,r,a){var b=r[0];r=r[1];f[0]=a[0]*b+a[2]*r+a[4];f[1]=a[1]*b+a[3]*r+a[5];return f};h.transformMat3=function(f,r,a){var b=r[0];r=r[1];f[0]=a[0]*b+a[3]*r+a[6];f[1]=a[1]*b+a[4]*r+a[7];return f};h.transformMat4=function(f,r,a){var b=r[0];r=r[1];f[0]=
a[0]*b+a[4]*r+a[12];f[1]=a[1]*b+a[5]*r+a[13];return f};h.forEach=function(){var f=h.create();return function(a,H,b,c,p,d){H||(H=2);b||(b=0);for(c=c?Math.min(c*H+b,a.length):a.length;b<c;b+=H)f[0]=a[b],f[1]=a[b+1],p(f,f,d),a[b]=f[0],a[b+1]=f[1];return a}}();h.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};"undefined"!==typeof a&&(a.vec2=h);var m={create:function(){var f=new e(3);f[0]=0;f[1]=0;f[2]=0;return f},clone:function(f){var a=new e(3);a[0]=f[0];a[1]=f[1];a[2]=f[2];return a},fromValues:function(f,
a,b){var t=new e(3);t[0]=f;t[1]=a;t[2]=b;return t},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f},set:function(f,a,b,t){f[0]=a;f[1]=b;f[2]=t;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];return f},subtract:function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];return f}};m.sub=m.subtract;m.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];return f};m.mul=m.multiply;m.divide=function(f,a,b){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];
return f};m.div=m.divide;m.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);return f};m.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);return f};m.scale=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;return f};m.scaleAndAdd=function(f,a,b,t){f[0]=a[0]+b[0]*t;f[1]=a[1]+b[1]*t;f[2]=a[2]+b[2]*t;return f};m.distance=function(f,a){var b=a[0]-f[0],t=a[1]-f[1],c=a[2]-f[2];return Math.sqrt(b*b+t*t+c*c)};m.dist=
m.distance;m.squaredDistance=function(f,a){var b=a[0]-f[0],t=a[1]-f[1],c=a[2]-f[2];return b*b+t*t+c*c};m.sqrDist=m.squaredDistance;m.length=function(f){var a=f[0],b=f[1];f=f[2];return Math.sqrt(a*a+b*b+f*f)};m.len=m.length;m.squaredLength=function(f){var a=f[0],b=f[1];f=f[2];return a*a+b*b+f*f};m.sqrLen=m.squaredLength;m.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};m.normalize=function(f,a){var b=a[0],t=a[1],c=a[2],b=b*b+t*t+c*c;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=
a[2]*b);return f};m.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]};m.cross=function(f,a,b){var t=a[0],c=a[1];a=a[2];var p=b[0],d=b[1];b=b[2];f[0]=c*b-a*d;f[1]=a*p-t*b;f[2]=t*d-c*p;return f};m.lerp=function(f,a,b,t){var c=a[0],p=a[1];a=a[2];f[0]=c+t*(b[0]-c);f[1]=p+t*(b[1]-p);f[2]=a+t*(b[2]-a);return f};m.random=function(f,a){a=a||1;var b=2*g()*Math.PI,t=2*g()-1,c=Math.sqrt(1-t*t)*a;f[0]=Math.cos(b)*c;f[1]=Math.sin(b)*c;f[2]=t*a;return f};m.transformMat4=function(f,a,b){var t=a[0],c=a[1];
a=a[2];f[0]=b[0]*t+b[4]*c+b[8]*a+b[12];f[1]=b[1]*t+b[5]*c+b[9]*a+b[13];f[2]=b[2]*t+b[6]*c+b[10]*a+b[14];return f};m.transformMat3=function(f,a,b){var t=a[0],c=a[1];a=a[2];f[0]=t*b[0]+c*b[3]+a*b[6];f[1]=t*b[1]+c*b[4]+a*b[7];f[2]=t*b[2]+c*b[5]+a*b[8];return f};m.transformQuat=function(f,a,b){var t=a[0],c=a[1],p=a[2];a=b[0];var d=b[1],e=b[2];b=b[3];var g=b*t+d*p-e*c,l=b*c+e*t-a*p,h=b*p+a*c-d*t,t=-a*t-d*c-e*p;f[0]=g*b+t*-a+l*-e-h*-d;f[1]=l*b+t*-d+h*-a-g*-e;f[2]=h*b+t*-e+g*-d-l*-a;return f};m.forEach=
function(){var f=m.create();return function(a,b,t,c,d,e){b||(b=3);t||(t=0);for(c=c?Math.min(c*b+t,a.length):a.length;t<c;t+=b)f[0]=a[t],f[1]=a[t+1],f[2]=a[t+2],d(f,f,e),a[t]=f[0],a[t+1]=f[1],a[t+2]=f[2];return a}}();m.str=function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"};"undefined"!==typeof a&&(a.vec3=m);var l={create:function(){var f=new e(4);f[0]=0;f[1]=0;f[2]=0;f[3]=0;return f},clone:function(f){var a=new e(4);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];return a},fromValues:function(f,a,b,t){var c=
new e(4);c[0]=f;c[1]=a;c[2]=b;c[3]=t;return c},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f},set:function(f,a,b,t,c){f[0]=a;f[1]=b;f[2]=t;f[3]=c;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];f[3]=a[3]+b[3];return f},subtract:function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];f[3]=a[3]-b[3];return f}};l.sub=l.subtract;l.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];f[3]=a[3]*b[3];return f};l.mul=l.multiply;l.divide=
function(f,a,b){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];f[3]=a[3]/b[3];return f};l.div=l.divide;l.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);f[3]=Math.min(a[3],b[3]);return f};l.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);f[3]=Math.max(a[3],b[3]);return f};l.scale=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;return f};l.scaleAndAdd=function(f,a,b,t){f[0]=a[0]+b[0]*t;f[1]=
a[1]+b[1]*t;f[2]=a[2]+b[2]*t;f[3]=a[3]+b[3]*t;return f};l.distance=function(f,a){var b=a[0]-f[0],t=a[1]-f[1],c=a[2]-f[2],d=a[3]-f[3];return Math.sqrt(b*b+t*t+c*c+d*d)};l.dist=l.distance;l.squaredDistance=function(f,a){var b=a[0]-f[0],t=a[1]-f[1],c=a[2]-f[2],d=a[3]-f[3];return b*b+t*t+c*c+d*d};l.sqrDist=l.squaredDistance;l.length=function(f){var a=f[0],b=f[1],t=f[2];f=f[3];return Math.sqrt(a*a+b*b+t*t+f*f)};l.len=l.length;l.squaredLength=function(f){var a=f[0],b=f[1],t=f[2];f=f[3];return a*a+b*b+t*
t+f*f};l.sqrLen=l.squaredLength;l.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];f[3]=-a[3];return f};l.normalize=function(f,a){var b=a[0],t=a[1],c=a[2],d=a[3],b=b*b+t*t+c*c+d*d;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b,f[3]=a[3]*b);return f};l.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]+f[3]*a[3]};l.lerp=function(f,a,b,c){var d=a[0],p=a[1],e=a[2];a=a[3];f[0]=d+c*(b[0]-d);f[1]=p+c*(b[1]-p);f[2]=e+c*(b[2]-e);f[3]=a+c*(b[3]-a);return f};l.random=function(f,a){a=a||
1;f[0]=g();f[1]=g();f[2]=g();f[3]=g();l.normalize(f,f);l.scale(f,f,a);return f};l.transformMat4=function(f,a,b){var c=a[0],d=a[1],p=a[2];a=a[3];f[0]=b[0]*c+b[4]*d+b[8]*p+b[12]*a;f[1]=b[1]*c+b[5]*d+b[9]*p+b[13]*a;f[2]=b[2]*c+b[6]*d+b[10]*p+b[14]*a;f[3]=b[3]*c+b[7]*d+b[11]*p+b[15]*a;return f};l.transformQuat=function(f,a,b){var c=a[0],d=a[1],p=a[2];a=b[0];var e=b[1],g=b[2];b=b[3];var l=b*c+e*p-g*d,h=b*d+g*c-a*p,m=b*p+a*d-e*c,c=-a*c-e*d-g*p;f[0]=l*b+c*-a+h*-g-m*-e;f[1]=h*b+c*-e+m*-a-l*-g;f[2]=m*b+c*
-g+l*-e-h*-a;return f};l.forEach=function(){var f=l.create();return function(a,b,c,d,p,e){b||(b=4);c||(c=0);for(d=d?Math.min(d*b+c,a.length):a.length;c<d;c+=b)f[0]=a[c],f[1]=a[c+1],f[2]=a[c+2],f[3]=a[c+3],p(f,f,e),a[c]=f[0],a[c+1]=f[1],a[c+2]=f[2],a[c+3]=f[3];return a}}();l.str=function(f){return"vec4("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"};"undefined"!==typeof a&&(a.vec4=l);k={create:function(){var f=new e(4);f[0]=1;f[1]=0;f[2]=0;f[3]=1;return f},clone:function(f){var a=new e(4);a[0]=f[0];a[1]=
f[1];a[2]=f[2];a[3]=f[3];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=1;return f},transpose:function(f,a){if(f===a){var b=a[1];f[1]=a[2];f[2]=b}else f[0]=a[0],f[1]=a[2],f[2]=a[1],f[3]=a[3];return f},invert:function(a,b){var c=b[0],t=b[1],d=b[2],p=b[3],e=c*p-d*t;if(!e)return null;e=1/e;a[0]=p*e;a[1]=-t*e;a[2]=-d*e;a[3]=c*e;return a},adjoint:function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},determinant:function(a){return a[0]*
a[3]-a[2]*a[1]},multiply:function(a,b,c){var t=b[0],d=b[1],p=b[2];b=b[3];var e=c[0],g=c[1],l=c[2];c=c[3];a[0]=t*e+d*l;a[1]=t*g+d*c;a[2]=p*e+b*l;a[3]=p*g+b*c;return a}};k.mul=k.multiply;k.rotate=function(a,b,c){var t=b[0],d=b[1],p=b[2];b=b[3];var e=Math.sin(c);c=Math.cos(c);a[0]=t*c+d*e;a[1]=t*-e+d*c;a[2]=p*c+b*e;a[3]=p*-e+b*c;return a};k.scale=function(a,b,c){var d=b[1],e=b[2],p=b[3],g=c[0];c=c[1];a[0]=b[0]*g;a[1]=d*c;a[2]=e*g;a[3]=p*c;return a};k.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+
a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.mat2=k);k={create:function(){var a=new e(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},clone:function(a){var b=new e(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},invert:function(a,b){var c=b[0],d=b[1],e=b[2],p=b[3],g=b[4],l=b[5],h=c*p-d*e;if(!h)return null;
h=1/h;a[0]=p*h;a[1]=-d*h;a[2]=-e*h;a[3]=c*h;a[4]=(e*l-p*g)*h;a[5]=(d*g-c*l)*h;return a},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var d=b[0],e=b[1],p=b[2],g=b[3],l=b[4];b=b[5];var h=c[0],m=c[1],k=c[2],n=c[3],q=c[4];c=c[5];a[0]=d*h+e*k;a[1]=d*m+e*n;a[2]=p*h+g*k;a[3]=p*m+g*n;a[4]=h*l+k*b+q;a[5]=m*l+n*b+c;return a}};k.mul=k.multiply;k.rotate=function(a,b,c){var d=b[0],e=b[1],p=b[2],g=b[3],l=b[4];b=b[5];var h=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*h;a[1]=-d*h+e*c;a[2]=
p*c+g*h;a[3]=-p*h+c*g;a[4]=c*l+h*b;a[5]=c*b-h*l;return a};k.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=b[0]*d;a[1]=b[1]*c;a[2]=b[2]*d;a[3]=b[3]*c;a[4]=b[4]*d;a[5]=b[5]*c;return a};k.translate=function(a,b,c){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4]+c[0];a[5]=b[5]+c[1];return a};k.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};"undefined"!==typeof a&&(a.mat2d=k);var q={create:function(){var a=new e(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;
a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new e(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},
transpose:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var c=b[0],d=b[1],e=b[2],p=b[3],g=b[4],l=b[5],h=b[6],m=b[7],k=b[8],n=k*g-l*m,q=-k*p+l*h,s=m*p-g*h,v=c*n+d*q+e*s;if(!v)return null;v=1/v;a[0]=n*v;a[1]=(-k*d+e*m)*v;a[2]=(l*d-e*g)*v;a[3]=q*v;a[4]=(k*c-e*h)*v;a[5]=(-l*c+e*p)*v;a[6]=s*v;a[7]=(-m*c+d*h)*v;a[8]=(g*c-d*p)*
v;return a},adjoint:function(a,b){var c=b[0],d=b[1],e=b[2],p=b[3],g=b[4],l=b[5],h=b[6],m=b[7],k=b[8];a[0]=g*k-l*m;a[1]=e*m-d*k;a[2]=d*l-e*g;a[3]=l*h-p*k;a[4]=c*k-e*h;a[5]=e*p-c*l;a[6]=p*m-g*h;a[7]=d*h-c*m;a[8]=c*g-d*p;return a},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],p=a[7],g=a[8];return a[0]*(g*c-d*p)+a[1]*(-g*b+d*e)+a[2]*(p*b-c*e)},multiply:function(a,b,c){var d=b[0],e=b[1],p=b[2],g=b[3],l=b[4],h=b[5],m=b[6],k=b[7];b=b[8];var n=c[0],q=c[1],s=c[2],v=c[3],x=c[4],z=c[5],B=c[6],D=c[7];
c=c[8];a[0]=n*d+q*g+s*m;a[1]=n*e+q*l+s*k;a[2]=n*p+q*h+s*b;a[3]=v*d+x*g+z*m;a[4]=v*e+x*l+z*k;a[5]=v*p+x*h+z*b;a[6]=B*d+D*g+c*m;a[7]=B*e+D*l+c*k;a[8]=B*p+D*h+c*b;return a}};q.mul=q.multiply;q.translate=function(a,b,c){var d=b[0],e=b[1],p=b[2],g=b[3],l=b[4],h=b[5],m=b[6],k=b[7];b=b[8];var n=c[0];c=c[1];a[0]=d;a[1]=e;a[2]=p;a[3]=g;a[4]=l;a[5]=h;a[6]=n*d+c*g+m;a[7]=n*e+c*l+k;a[8]=n*p+c*h+b;return a};q.rotate=function(a,b,c){var d=b[0],e=b[1],p=b[2],g=b[3],l=b[4],h=b[5],m=b[6],k=b[7];b=b[8];var n=Math.sin(c);
c=Math.cos(c);a[0]=c*d+n*g;a[1]=c*e+n*l;a[2]=c*p+n*h;a[3]=c*g-n*d;a[4]=c*l-n*e;a[5]=c*h-n*p;a[6]=m;a[7]=k;a[8]=b;return a};q.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};q.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};q.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],p=b[3],g=c+c,l=d+d,h=e+e,m=c*g,k=c*l,c=c*h,n=d*l,d=d*h,e=
e*h,g=p*g,l=p*l,p=p*h;a[0]=1-(n+e);a[3]=k+p;a[6]=c-l;a[1]=k-p;a[4]=1-(m+e);a[7]=d+g;a[2]=c+l;a[5]=d-g;a[8]=1-(m+n);return a};q.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],p=b[3],g=b[4],l=b[5],h=b[6],m=b[7],k=b[8],n=b[9],q=b[10],s=b[11],v=b[12],x=b[13],z=b[14],B=b[15],D=c*l-d*g,G=c*h-e*g,E=c*m-p*g,F=d*h-e*l,N=d*m-p*l,O=e*m-p*h,P=k*x-n*v,Q=k*z-q*v,k=k*B-s*v,R=n*z-q*x,n=n*B-s*x,q=q*B-s*z,s=D*q-G*n+E*R+F*k-N*Q+O*P;if(!s)return null;s=1/s;a[0]=(l*q-h*n+m*R)*s;a[1]=(h*k-g*q-m*Q)*s;a[2]=(g*n-l*
k+m*P)*s;a[3]=(e*n-d*q-p*R)*s;a[4]=(c*q-e*k+p*Q)*s;a[5]=(d*k-c*n-p*P)*s;a[6]=(x*O-z*N+B*F)*s;a[7]=(z*E-v*O-B*G)*s;a[8]=(v*N-x*E+B*D)*s;return a};q.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};"undefined"!==typeof a&&(a.mat3=q);var s={create:function(){var a=new e(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new e(16);
b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=
0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],p=b[6],g=b[7],l=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=p;a[11]=b[14];a[12]=e;a[13]=g;a[14]=l}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},invert:function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=b[4],h=b[5],m=b[6],k=b[7],n=b[8],q=b[9],s=
b[10],u=b[11],v=b[12],x=b[13],z=b[14],B=b[15],D=c*h-d*l,G=c*m-e*l,E=c*k-g*l,F=d*m-e*h,N=d*k-g*h,O=e*k-g*m,P=n*x-q*v,Q=n*z-s*v,R=n*B-u*v,S=q*z-s*x,T=q*B-u*x,U=s*B-u*z,L=D*U-G*T+E*S+F*R-N*Q+O*P;if(!L)return null;L=1/L;a[0]=(h*U-m*T+k*S)*L;a[1]=(e*T-d*U-g*S)*L;a[2]=(x*O-z*N+B*F)*L;a[3]=(s*N-q*O-u*F)*L;a[4]=(m*R-l*U-k*Q)*L;a[5]=(c*U-e*R+g*Q)*L;a[6]=(z*E-v*O-B*G)*L;a[7]=(n*O-s*E+u*G)*L;a[8]=(l*T-h*R+k*P)*L;a[9]=(d*R-c*T-g*P)*L;a[10]=(v*N-x*E+B*D)*L;a[11]=(q*E-n*N-u*D)*L;a[12]=(h*Q-l*S-m*P)*L;a[13]=(c*
S-d*Q+e*P)*L;a[14]=(x*G-v*F-z*D)*L;a[15]=(n*F-q*G+s*D)*L;return a},adjoint:function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=b[4],h=b[5],m=b[6],k=b[7],n=b[8],q=b[9],s=b[10],u=b[11],v=b[12],x=b[13],z=b[14],B=b[15];a[0]=h*(s*B-u*z)-q*(m*B-k*z)+x*(m*u-k*s);a[1]=-(d*(s*B-u*z)-q*(e*B-g*z)+x*(e*u-g*s));a[2]=d*(m*B-k*z)-h*(e*B-g*z)+x*(e*k-g*m);a[3]=-(d*(m*u-k*s)-h*(e*u-g*s)+q*(e*k-g*m));a[4]=-(l*(s*B-u*z)-n*(m*B-k*z)+v*(m*u-k*s));a[5]=c*(s*B-u*z)-n*(e*B-g*z)+v*(e*u-g*s);a[6]=-(c*(m*B-k*z)-l*(e*B-g*z)+v*(e*
k-g*m));a[7]=c*(m*u-k*s)-l*(e*u-g*s)+n*(e*k-g*m);a[8]=l*(q*B-u*x)-n*(h*B-k*x)+v*(h*u-k*q);a[9]=-(c*(q*B-u*x)-n*(d*B-g*x)+v*(d*u-g*q));a[10]=c*(h*B-k*x)-l*(d*B-g*x)+v*(d*k-g*h);a[11]=-(c*(h*u-k*q)-l*(d*u-g*q)+n*(d*k-g*h));a[12]=-(l*(q*z-s*x)-n*(h*z-m*x)+v*(h*s-m*q));a[13]=c*(q*z-s*x)-n*(d*z-e*x)+v*(d*s-e*q);a[14]=-(c*(h*z-m*x)-l*(d*z-e*x)+v*(d*m-e*h));a[15]=c*(h*s-m*q)-l*(d*s-e*q)+n*(d*m-e*h);return a},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],l=a[5],h=a[6],m=a[7],k=a[8],n=a[9],
q=a[10],s=a[11],u=a[12],v=a[13],x=a[14];a=a[15];return(b*l-c*g)*(q*a-s*x)-(b*h-d*g)*(n*a-s*v)+(b*m-e*g)*(n*x-q*v)+(c*h-d*l)*(k*a-s*u)-(c*m-e*l)*(k*x-q*u)+(d*m-e*h)*(k*v-n*u)},multiply:function(a,b,c){var d=b[0],e=b[1],g=b[2],l=b[3],h=b[4],m=b[5],k=b[6],n=b[7],q=b[8],s=b[9],u=b[10],v=b[11],x=b[12],z=b[13],B=b[14];b=b[15];var D=c[0],G=c[1],E=c[2],F=c[3];a[0]=D*d+G*h+E*q+F*x;a[1]=D*e+G*m+E*s+F*z;a[2]=D*g+G*k+E*u+F*B;a[3]=D*l+G*n+E*v+F*b;D=c[4];G=c[5];E=c[6];F=c[7];a[4]=D*d+G*h+E*q+F*x;a[5]=D*e+G*m+E*
s+F*z;a[6]=D*g+G*k+E*u+F*B;a[7]=D*l+G*n+E*v+F*b;D=c[8];G=c[9];E=c[10];F=c[11];a[8]=D*d+G*h+E*q+F*x;a[9]=D*e+G*m+E*s+F*z;a[10]=D*g+G*k+E*u+F*B;a[11]=D*l+G*n+E*v+F*b;D=c[12];G=c[13];E=c[14];F=c[15];a[12]=D*d+G*h+E*q+F*x;a[13]=D*e+G*m+E*s+F*z;a[14]=D*g+G*k+E*u+F*B;a[15]=D*l+G*n+E*v+F*b;return a}};s.mul=s.multiply;s.translate=function(a,b,c){var d=c[0],e=c[1];c=c[2];var g,l,h,m,k,n,q,s,u,v,x,z;b===a?(a[12]=b[0]*d+b[4]*e+b[8]*c+b[12],a[13]=b[1]*d+b[5]*e+b[9]*c+b[13],a[14]=b[2]*d+b[6]*e+b[10]*c+b[14],a[15]=
b[3]*d+b[7]*e+b[11]*c+b[15]):(g=b[0],l=b[1],h=b[2],m=b[3],k=b[4],n=b[5],q=b[6],s=b[7],u=b[8],v=b[9],x=b[10],z=b[11],a[0]=g,a[1]=l,a[2]=h,a[3]=m,a[4]=k,a[5]=n,a[6]=q,a[7]=s,a[8]=u,a[9]=v,a[10]=x,a[11]=z,a[12]=g*d+k*e+u*c+b[12],a[13]=l*d+n*e+v*c+b[13],a[14]=h*d+q*e+x*c+b[14],a[15]=m*d+s*e+z*c+b[15]);return a};s.scale=function(a,b,c){var d=c[0],e=c[1];c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*
c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};s.rotate=function(a,c,e,g){var l=g[0],p=g[1];g=g[2];var h=Math.sqrt(l*l+p*p+g*g),m,k,n,q,s,I,u,v,x,z,B,D,G,E,F,N,O,P,Q,R;if(Math.abs(h)<b)return null;h=1/h;l*=h;p*=h;g*=h;m=Math.sin(e);k=Math.cos(e);n=1-k;e=c[0];h=c[1];q=c[2];s=c[3];I=c[4];u=c[5];v=c[6];x=c[7];z=c[8];B=c[9];D=c[10];G=c[11];E=l*l*n+k;F=p*l*n+g*m;N=g*l*n-p*m;O=l*p*n-g*m;P=p*p*n+k;Q=g*p*n+l*m;R=l*g*n+p*m;l=p*g*n-l*m;p=g*g*n+k;a[0]=e*E+I*F+z*N;a[1]=h*E+u*F+B*N;a[2]=q*E+v*F+D*
N;a[3]=s*E+x*F+G*N;a[4]=e*O+I*P+z*Q;a[5]=h*O+u*P+B*Q;a[6]=q*O+v*P+D*Q;a[7]=s*O+x*P+G*Q;a[8]=e*R+I*l+z*p;a[9]=h*R+u*l+B*p;a[10]=q*R+v*l+D*p;a[11]=s*R+x*l+G*p;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};s.rotateX=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[4],g=b[5],l=b[6],h=b[7],m=b[8],k=b[9],n=b[10],q=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=e*c+m*d;a[5]=g*c+k*d;a[6]=l*c+n*d;a[7]=h*c+q*d;a[8]=m*c-
e*d;a[9]=k*c-g*d;a[10]=n*c-l*d;a[11]=q*c-h*d;return a};s.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],g=b[1],l=b[2],h=b[3],m=b[8],k=b[9],n=b[10],q=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c-m*d;a[1]=g*c-k*d;a[2]=l*c-n*d;a[3]=h*c-q*d;a[8]=e*d+m*c;a[9]=g*d+k*c;a[10]=l*d+n*c;a[11]=h*d+q*c;return a};s.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],g=b[1],l=b[2],h=b[3],m=b[4],k=b[5],n=b[6],q=
b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c+m*d;a[1]=g*c+k*d;a[2]=l*c+n*d;a[3]=h*c+q*d;a[4]=m*c-e*d;a[5]=k*c-g*d;a[6]=n*c-l*d;a[7]=q*c-h*d;return a};s.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],g=b[2],l=b[3],h=d+d,m=e+e,k=g+g;b=d*h;var n=d*m,d=d*k,q=e*m,e=e*k,g=g*k,h=l*h,m=l*m,l=l*k;a[0]=1-(q+g);a[1]=n+l;a[2]=d-m;a[3]=0;a[4]=n-l;a[5]=1-(b+g);a[6]=e+h;a[7]=0;a[8]=d+m;a[9]=e-h;a[10]=1-(b+q);a[11]=0;a[12]=c[0];a[13]=
c[1];a[14]=c[2];a[15]=1;return a};s.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=c+c,h=d+d,m=e+e,k=c*l,n=c*h,c=c*m,q=d*h,d=d*m,e=e*m,l=g*l,h=g*h,g=g*m;a[0]=1-(q+e);a[1]=n+g;a[2]=c-h;a[3]=0;a[4]=n-g;a[5]=1-(k+e);a[6]=d+l;a[7]=0;a[8]=c+h;a[9]=d-l;a[10]=1-(k+q);a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};s.frustum=function(a,b,c,d,e,g,l){var h=1/(c-b),m=1/(e-d),k=1/(g-l);a[0]=2*g*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*g*m;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(e+d)*m;a[10]=(l+g)*k;a[11]=-1;
a[12]=0;a[13]=0;a[14]=l*g*2*k;a[15]=0;return a};s.perspective=function(a,b,c,d,e){b=1/Math.tan(b/2);var g=1/(d-e);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+d)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*e*d*g;a[15]=0;return a};s.ortho=function(a,b,c,d,e,g,l){var h=1/(b-c),m=1/(d-e),k=1/(g-l);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*m;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(b+c)*h;a[13]=(e+d)*m;a[14]=(l+g)*k;a[15]=1;return a};s.lookAt=function(a,c,e,
g){var l,h,m,k,n,q,A,w,I=c[0],u=c[1];c=c[2];m=g[0];k=g[1];h=g[2];A=e[0];g=e[1];l=e[2];if(Math.abs(I-A)<b&&Math.abs(u-g)<b&&Math.abs(c-l)<b)return s.identity(a);e=I-A;g=u-g;A=c-l;w=1/Math.sqrt(e*e+g*g+A*A);e*=w;g*=w;A*=w;l=k*A-h*g;h=h*e-m*A;m=m*g-k*e;(w=Math.sqrt(l*l+h*h+m*m))?(w=1/w,l*=w,h*=w,m*=w):m=h=l=0;k=g*m-A*h;n=A*l-e*m;q=e*h-g*l;(w=Math.sqrt(k*k+n*n+q*q))?(w=1/w,k*=w,n*=w,q*=w):q=n=k=0;a[0]=l;a[1]=k;a[2]=e;a[3]=0;a[4]=h;a[5]=n;a[6]=g;a[7]=0;a[8]=m;a[9]=q;a[10]=A;a[11]=0;a[12]=-(l*I+h*u+m*c);
a[13]=-(k*I+n*u+q*c);a[14]=-(e*I+g*u+A*c);a[15]=1;return a};s.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};"undefined"!==typeof a&&(a.mat4=s);var n={create:function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};n.rotationTo=function(){var a=m.create(),b=m.fromValues(1,0,0),c=m.fromValues(0,1,0);return function(d,e,g){var l=m.dot(e,g);if(-.999999>
l)return m.cross(a,b,e),1E-6>m.length(a)&&m.cross(a,c,e),m.normalize(a,a),n.setAxisAngle(d,a,Math.PI),d;if(.999999<l)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;m.cross(a,e,g);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+l;return n.normalize(d,d)}}();n.setAxes=function(){var a=q.create();return function(b,c,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=c[0];a[5]=c[1];a[8]=c[2];return n.normalize(b,n.fromMat3(b,a))}}();n.clone=l.clone;n.fromValues=l.fromValues;n.copy=l.copy;n.set=l.set;n.identity=
function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};n.setAxisAngle=function(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a};n.add=l.add;n.multiply=function(a,b,c){var d=b[0],e=b[1],g=b[2];b=b[3];var l=c[0],h=c[1],m=c[2];c=c[3];a[0]=d*c+b*l+e*m-g*h;a[1]=e*c+b*h+g*l-d*m;a[2]=g*c+b*m+d*h-e*l;a[3]=b*c-d*l-e*h-g*m;return a};n.mul=n.multiply;n.scale=l.scale;n.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],g=b[2];b=b[3];var l=Math.sin(c);c=Math.cos(c);a[0]=d*
c+b*l;a[1]=e*c+g*l;a[2]=g*c-e*l;a[3]=b*c-d*l;return a};n.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],g=b[2];b=b[3];var l=Math.sin(c);c=Math.cos(c);a[0]=d*c-g*l;a[1]=e*c+b*l;a[2]=g*c+d*l;a[3]=b*c-e*l;return a};n.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],g=b[2];b=b[3];var l=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*l;a[1]=e*c-d*l;a[2]=g*c+b*l;a[3]=b*c-g*l;return a};n.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]=c;a[1]=d;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return a};n.dot=
l.dot;n.lerp=l.lerp;n.slerp=function(a,b,c,d){var e=b[0],g=b[1],l=b[2];b=b[3];var h=c[0],m=c[1],k=c[2];c=c[3];var n,q,s;q=e*h+g*m+l*k+b*c;0>q&&(q=-q,h=-h,m=-m,k=-k,c=-c);1E-6<1-q?(n=Math.acos(q),s=Math.sin(n),q=Math.sin((1-d)*n)/s,d=Math.sin(d*n)/s):q=1-d;a[0]=q*e+d*h;a[1]=q*g+d*m;a[2]=q*l+d*k;a[3]=q*b+d*c;return a};n.invert=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],l=c*c+d*d+e*e+g*g,l=l?1/l:0;a[0]=-c*l;a[1]=-d*l;a[2]=-e*l;a[3]=g*l;return a};n.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=
-b[2];a[3]=b[3];return a};n.length=l.length;n.len=n.length;n.squaredLength=l.squaredLength;n.sqrLen=n.squaredLength;n.normalize=l.normalize;n.fromMat3=function(){var a="undefined"!==typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d=c[0]+c[4]+c[8];if(0<d)d=Math.sqrt(d+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var e=0;c[4]>c[0]&&(e=1);c[8]>c[3*e+e]&&(e=2);var g=a[e],l=a[g],d=Math.sqrt(c[3*e+e]-c[3*g+g]-c[3*l+l]+1);b[e]=.5*d;d=.5/d;b[3]=
(c[3*l+g]-c[3*g+l])*d;b[g]=(c[3*g+e]+c[3*e+g])*d;b[l]=(c[3*l+e]+c[3*e+l])*d}return b}}();n.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=n)})(b)})(this);"use strict";String.prototype.startswith=function(a){return 0===this.indexOf(a)};String.prototype.endswith=function(a,b){var c=this.toString();if(void 0===b||b>c.length)b=c.length;b-=a.length;c=c.indexOf(a,b);return-1!==c&&c===b};
String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};
var MatinfIO=function(a,b){function c(a){if(0<a.indexOf("_cell_angle_gamma ")&&0<a.indexOf("loop_"))return"CIF";a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");return 6<a.length&&("direct"==a[6].toLowerCase().substr(0,6)||"direct"==a[7].toLowerCase().substr(0,6))?"POSCAR":"unknown"}function d(c,d,e,g,f,h){if(!(c&&d&&e&&g&&f&&h))return b.error("Error: invalid cell definition!"),!1;g=g*Math.PI/180;f=f*Math.PI/180;h=h*Math.PI/180;var m=[0,0,1],k=[1,0,0],m=a.divide(m,a.norm(m)),k=a.subtract(k,
a.multiply(a.dot(k,m),m)),k=a.divide(k,a.norm(k)),K=a.cross(m,k);c=a.multiply(c,[1,0,0]);d=a.multiply(d,[a.cos(h),a.sin(h),0]);var p=a.cos(f);g=a.divide(a.subtract(a.cos(g),a.multiply(a.cos(f),a.cos(h))),a.sin(h));f=a.sqrt(a.subtract(a.subtract(1,a.multiply(p,p)),a.multiply(g,g)));e=a.multiply(e,[p,g,f]);return a.multiply([c,d,e],[k,K,m])}function e(a){a.symops&&b.warning("Warning! Reading of symmetry operations is not yet implemented, expect error now.");var c;c=6==Object.keys(a.cell).length?d(a.cell.a,
a.cell.b,a.cell.c,a.cell.alpha,a.cell.beta,a.cell.gamma):a.cell;var e=[],g=[],f=[],h=[],e=c[0].map(function(a,b){return c.map(function(a){return a[b]})}),g=g.concat.apply(g,e),m=0,k=a.atoms.length;if(a.types)for(m;m<k;m++)h.push([a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]);else{var K=[],e={};for(m;m<k;m++)-1==Object.keys(e).indexOf(a.atoms[m].symbol)?e[a.atoms[m].symbol]=[[a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]]:e[a.atoms[m].symbol].push([a.atoms[m].x,a.atoms[m].y,a.atoms[m].z]);var m=1,p;for(p in e){for(k=
0;k<e[p].length;k++)h.push(e[p][k]),K.push(m);m++}}f=f.concat.apply(f,h);h=!1;h=(a.sg_name?a.sg_name:"")+(a.ng_name?" ("+a.ng_name+")":"");return{cell:g,atoms:f,types:K||a.types,symlabel:h}}function g(a){var c=[],d=[],e=[];a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");var f={cell:{},atoms:[]},g=!1,k=!1,t=!1,K="",p="",p=[],C="a b c alpha beta gamma".split(" "),J=["_atom_site_label","_atom_site_type_symbol","_atom_site_fract_x","_atom_site_fract_y","_atom_site_fract_z"],y=["label","symbol",
"x","y","z"],M=[0,1],A=[],w;for(w in m)A.push(J.length),J.push(w);w=0;var I=a.length;for(w;w<I;w++)if(!a[w].startswith("#"))if(p=a[w].toLowerCase().trim()){k=!1;if(p.startswith("data_"))k=!0,g=!1,e=[],t=!1,K=p.substr(5);else if(p.startswith("_cell_")){g=!1;p=p.split(" ");k=p[0].split("_");k=k[k.length-1];-1!==C.indexOf(k)&&p[p.length-1]&&(f.cell[k]=parseFloat(p[p.length-1]));continue}else if(p.startswith("_symmetry_space_group_name_h-m")||p.startswith("_space_group.patterson_name_h-m")){g=!1;f.sg_name=
a[w].substr(31).replace(/"/g,"").replace(/'/g,"").trim();continue}else if(p.startswith("_space_group.it_number")||p.startswith("_space_group_it_number")||p.startswith("_symmetry_int_tables_number")){g=!1;p=p.split(" ");f.ng_name=p[p.length-1].trim();continue}else{if(p.startswith("_cif_error"))return b.error(p.substr(12,p.length-13)),!1;if(p.startswith("loop_")){g=!0;e=[];t=!1;continue}}if(g)if(p.startswith("_symmetry_equiv")||p.startswith("_space_group"))t=!0;else if(p.startswith("_"))e.push(p);else if(t)d.push(p.replace(/"/g,
"").replace(/'/g,""));else{var k={overlays:{}},p=p.replace(/\t/g," ").split(" ").filter(function(a){return a?!0:!1}),u=0,v=e.length;for(u;u<v;u++){var x=J.indexOf(e[u]);-1!=x&&(-1<M.indexOf(x)?p[u]=p[u].charAt(0).toUpperCase()+p[u].slice(1).toLowerCase():p[u]=parseFloat(p[u]),-1<A.indexOf(x)?k.overlays[J[x]]=p[u]:k[y[x]]=p[u])}void 0!==k.x&&void 0!==k.y&&void 0!==k.z&&(k.label&&(k.overlays.label=k.label,k.symbol||(k.symbol=k.label.replace(/[0-9]/g,""))),!h.JmolColors[k.symbol]&&2<k.symbol.length&&
(k.symbol=k.symbol.substr(0,k.symbol.length-1)),!h.JmolColors[k.symbol]&&1<k.symbol.length&&(k.symbol=k.symbol.substr(0,k.symbol.length-1)),k.symbol&&f.atoms.push(k))}else k&&f.atoms.length&&(f.info=K,1<d.length&&(f.symops=d),c.push(f),f={cell:{},atoms:[]},d=[])}else g=!1,e=[],t=!1;f.cell.gamma&&(f.info=K,1<d.length&&(f.symops=d),c.push(f));if(c.length)return c[c.length-1];b.error("Error: unexpected CIF format!");return!1}function k(c){c=c.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");var d=
[],e=[],g=1,f=[],m=[],k=[],t=[],K=["x","y","z","symbol"],p=0,C=0,J=c.length,y=[],M=0,y=[],A=[];p;a:for(;p<J;p++)if(0==p){y=c[p].split(" ").filter(function(a){return a?!0:!1});A=Object.keys(h.AseRadii);for(C=0;C<y.length;C++)if(-1==A.indexOf(y[C]))continue a;m=y}else if(1==p)g=parseFloat(c[p]);else if(-1!==[2,3,4].indexOf(p))d.push(c[p].split(" ").filter(function(a){return a?!0:!1}).map(Number));else if(5==p)if(y=c[p].split(" ").filter(function(a){return a?!0:!1}),y[0].isnumeric())for(f=y.map(Number),
C=0;C<f.length;C++)for(y=0;y<f[C];y++)t.push(C+1);else m=y;else if(6==p){if("direct"==c[p].toLowerCase().substr(0,6))continue a;y=c[p].split(" ").filter(function(a){return a?!0:!1});if(y[0].isnumeric())for(f=y.map(Number),C=0;C<f.length;C++)for(y=0;y<f[C];y++)t.push(C+1);else m=y}else if(6<p){if(7==p){if(m.length)for(C=0;C<m.length;C++)for(y=0;y<f[C];y++)k.push(m[C]);if("direct"==c[p].toLowerCase().substr(0,6))continue a}A={};y=c[p].replace("#","").replace("!","").split(" ").filter(function(a){return a?
!0:!1});if(!y.length)break;else if(3==y.length)k.length?y.push(k[M]):y.push("Xx");else if(3>y.length)return b.error("Error: invalid atom definition!"),!1;for(C=0;4>C;C++)A[K[C]]=3>C?parseFloat(y[C]):y[C];A.symbol=A.symbol.replace(/\W+/,"").replace(/\d+/,"");A.symbol.length||(A.symbol="Xx");e.push(A);M++}d=a.multiply(d,g);if(e.length)return{cell:d,atoms:e,types:t};b.error("Error: unexpected POSCAR format!");return!1}var h={JmolColors:{D:"#FFFFC0",H:"#FFFFFF",He:"#D9FFFF",Li:"#CC80FF",Be:"#C2FF00",
B:"#FFB5B5",C:"#909090",N:"#3050F8",O:"#FF0D0D",F:"#90E050",Ne:"#B3E3F5",Na:"#AB5CF2",Mg:"#8AFF00",Al:"#BFA6A6",Si:"#F0C8A0",P:"#FF8000",S:"#FFFF30",Cl:"#1FF01F",Ar:"#80D1E3",K:"#8F40D4",Ca:"#3DFF00",Sc:"#E6E6E6",Ti:"#BFC2C7",V:"#A6A6AB",Cr:"#8A99C7",Mn:"#9C7AC7",Fe:"#E06633",Co:"#F090A0",Ni:"#50D050",Cu:"#C88033",Zn:"#7D80B0",Ga:"#C28F8F",Ge:"#668F8F",As:"#BD80E3",Se:"#FFA100",Br:"#A62929",Kr:"#5CB8D1",Rb:"#702EB0",Sr:"#00FF00",Y:"#94FFFF",Zr:"#94E0E0",Nb:"#73C2C9",Mo:"#54B5B5",Tc:"#3B9E9E",Ru:"#248F8F",
Rh:"#0A7D8C",Pd:"#006985",Ag:"#C0C0C0",Cd:"#FFD98F",In:"#A67573",Sn:"#668080",Sb:"#9E63B5",Te:"#D47A00",I:"#940094",Xe:"#429EB0",Cs:"#57178F",Ba:"#00C900",La:"#70D4FF",Ce:"#FFFFC7",Pr:"#D9FFC7",Nd:"#C7FFC7",Pm:"#A3FFC7",Sm:"#8FFFC7",Eu:"#61FFC7",Gd:"#45FFC7",Tb:"#30FFC7",Dy:"#1FFFC7",Ho:"#00FF9C",Er:"#00E675",Tm:"#00D452",Yb:"#00BF38",Lu:"#00AB24",Hf:"#4DC2FF",Ta:"#4DA6FF",W:"#2194D6",Re:"#267DAB",Os:"#266696",Ir:"#175487",Pt:"#D0D0E0",Au:"#FFD123",Hg:"#B8B8D0",Tl:"#A6544D",Pb:"#575961",Bi:"#9E4FB5",
Po:"#AB5C00",At:"#754F45",Rn:"#428296",Fr:"#420066",Ra:"#007D00",Ac:"#70ABFA",Th:"#00BAFF",Pa:"#00A1FF",U:"#008FFF",Np:"#0080FF",Pu:"#006BFF",Am:"#545CF2",Cm:"#785CE3",Bk:"#8A4FE3",Cf:"#A136D4",Es:"#B31FD4",Fm:"#B31FBA",Md:"#B30DA6",No:"#BD0D87",Lr:"#C70066",Rf:"#CC0059",Db:"#D1004F",Sg:"#D90045",Bh:"#E00038",Hs:"#E6002E",Mt:"#EB0026"},AseRadii:{X:.66,H:.31,He:.28,Li:1.28,Be:.96,B:.84,C:.76,N:.71,O:.66,F:.57,Ne:.58,Na:1.66,Mg:1.41,Al:1.21,Si:1.11,P:1.07,S:1.05,Cl:1.02,Ar:1.06,K:2.03,Ca:1.76,Sc:1.7,
Ti:1.6,V:1.53,Cr:1.39,Mn:1.39,Fe:1.32,Co:1.26,Ni:1.24,Cu:1.32,Zn:1.22,Ga:1.22,Ge:1.2,As:1.19,Se:1.2,Br:1.2,Kr:1.16,Rb:2.2,Sr:1.95,Y:1.9,Zr:1.75,Nb:1.64,Mo:1.54,Tc:1.47,Ru:1.46,Rh:1.42,Pd:1.39,Ag:1.45,Cd:1.44,In:1.42,Sn:1.39,Sb:1.39,Te:1.38,I:1.39,Xe:1.4,Cs:2.44,Ba:2.15,La:2.07,Ce:2.04,Pr:2.03,Nd:2.01,Pm:1.99,Sm:1.98,Eu:1.98,Gd:1.96,Tb:1.94,Dy:1.92,Ho:1.92,Er:1.89,Tm:1.9,Yb:1.87,Lu:1.87,Hf:1.75,Ta:1.7,W:1.62,Re:1.51,Os:1.44,Ir:1.41,Pt:1.36,Au:1.36,Hg:1.32,Tl:1.45,Pb:1.46,Bi:1.48,Po:1.4,At:1.5,Rn:1.5,
Fr:2.6,Ra:2.21,Ac:2.15,Th:2.06,Pa:2,U:1.96,Np:1.9,Pu:1.87,Am:1.8,Cm:1.69,Bk:3,Cf:3,Es:3,Fm:3,Md:3,No:3,Lr:3,Rf:3,Db:3,Sg:3,Bh:3,Hs:3,Mt:3}},m={_atom_site_occupancy:"site occupancies",_atom_site_charge:"formal charges",label:"labels"};return{to_player:function(e){var q;switch(c(e)){case "CIF":q=g(e);break;case "POSCAR":q=k(e);break;default:b.error("Error: file format cannot be recognized!")}if(!q)return!1;e=q;var s=!1;6==Object.keys(e.cell).length?(q=d(e.cell.a,e.cell.b,e.cell.c,e.cell.alpha,e.cell.beta,
e.cell.gamma),s=e.cell):q=e.cell;e.atoms.length||b.warning("Note: no atomic coordinates");var s={atoms:[],cell:q,descr:s,overlayed:{},info:e.info},n,f,r,H={},t=0,K=e.atoms.length,p={};for(t;t<K;t++){var C=[e.atoms[t].x,e.atoms[t].y,e.atoms[t].z],J=C.join(",");if(p.hasOwnProperty(J))for(r in s.atoms[p[J]].overlays)n="S"==r?"+"+e.atoms[t].symbol:"N"==r?", "+(t+1):"_atom_site_occupancy"==r?"+"+e.atoms[t].overlays[r]:" "+e.atoms[t].overlays[r],s.atoms[p[J]].overlays[r]+=n;else{n=h.JmolColors[e.atoms[t].symbol]?
h.JmolColors[e.atoms[t].symbol]:"0xffff00";f=h.AseRadii[e.atoms[t].symbol]?h.AseRadii[e.atoms[t].symbol]:.66;H={S:e.atoms[t].symbol,N:t+1};for(r in e.atoms[t].overlays)H[r]=e.atoms[t].overlays[r];C=a.multiply(C,q);s.atoms.push({x:C[0],y:C[1],z:C[2],c:n,r:f,overlays:H});p[J]=s.atoms.length-1}}for(var y in H)"S"!==y&&"N"!==y&&(s.overlayed[y]=m[y]);return s},to_flatten:function(a){var d;switch(c(a)){case "CIF":d=g(a);break;case "POSCAR":d=k(a);break;default:b.error("Error: file format cannot be recognized!")}return d?
e(d):!1},version:"0.0.3.2"}};"undefined"!==typeof module&&module.exports?module.exports=MatinfIO:"function"===typeof require&&"function"===typeof require.specified&&define(function(){return MatinfIO});
(function(a,b){function c(){if(!g){g=!0;for(var a=0;a<e.length;a++)e[a].fn.call(window,e[a].ctx);e=[]}}function d(){"complete"===document.readyState&&c()}b=b||window;var e=[],g=!1,k=!1;b[a||"docReady"]=function(a,b){g?setTimeout(function(){a(b)},1):(e.push({fn:a,ctx:b}),"complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(c,1):k||(document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):(document.attachEvent("onreadystatechange",
d),window.attachEvent("onload",c)),k=!0))}})("docReady",window);glMatrix.setMatrixArrayType(Array);vec3.fromXYZ=function(a){var b=Array(3);b[0]=a.x;b[1]=a.y;b[2]=a.z;return b};vec3.toXYZ=function(a){return{x:a[0],y:a[1],z:a[2]}};vec4.fromXYZ=function(a,b){var c=Array(4);c[0]=a.x;c[1]=a.y;c[2]=a.z;c[3]=b;return c};
mat4.fromYPR=function(a,b,c){var d=Array(16),e=Math.sin(c);c=Math.cos(c);var g=Math.sin(b);b=Math.cos(b);var k=Math.sin(a);a=Math.cos(a);d[0]=a*c;d[4]=-(a*e);d[8]=k;d[1]=g*k*c+b*e;d[5]=b*c-g*k*e;d[9]=-(g*a);d[2]=g*e-b*k*c;d[6]=g*c+b*k*e;d[10]=b*a;d[3]=0;d[7]=0;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};
quat.fromYPR=function(a,b,c){var d=.5*c;c=Math.sin(d);var d=Math.cos(d),e=.5*b;b=Math.sin(e);var e=Math.cos(e),g=.5*a;a=Math.sin(g);var g=Math.cos(g),k=Array(4);k[0]=g*b*d+a*e*c;k[1]=a*e*d-g*b*c;k[2]=g*e*c-a*b*d;k[3]=g*e*d+a*b*c;return k};if("undefined"===typeof Phoria||!Phoria){var Phoria={};Phoria.RADIANS=Math.PI/180;Phoria.TWOPI=2*Math.PI;Phoria.ONEOPI=1/Math.PI;Phoria.PIO2=Math.PI/2;Phoria.PIO4=Math.PI/4;Phoria.EPSILON=1E-6}
(function(){Phoria.Util={};Phoria.Util.extend=function(a,b,c){var d=function(){},e;d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.superclass=b.prototype;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b);if(c)for(e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])};Phoria.Util.augment=function(a,b){for(var c in b.prototype)"undefined"===typeof a.prototype[c]&&(a.prototype[c]=b.prototype[c])};Phoria.Util.merge=function(a,b){var c=Array.isArray(b),
d=c&&[]||{};c?(a=a||[],d=d.concat(a),b.forEach(function(b,c){d[c]="object"===typeof b?Phoria.Util.merge(a[c],b):b})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){d[b]=a[b]}),Object.keys(b).forEach(function(c){d[c]="object"===typeof b[c]&&b[c]?a&&a[c]?Phoria.Util.merge(a[c],b[c]):b[c]:b[c]}));return d};Phoria.Util.combine=function(a,b){Array.isArray(b)&&Array.isArray(a)?(a.length<b.length&&(a.length=b.length),b.forEach(function(b,d){"object"===typeof b?(a[d]=a[d]||{},Phoria.Util.combine(a[d],
b)):a[d]=b})):Object.keys(b).forEach(function(c){"object"===typeof b[c]&&b[c]?(a[c]=a[c]||(Array.isArray(b[c])?[]:{}),Phoria.Util.combine(a[c],b[c])):a[c]=b[c]})};Phoria.Util.clone=function(a){var b=null,c={},d;for(d in a)b=a[d],Array.isArray(b)?c[d]=[].concat(b):c[d]=b;return c};Phoria.Util.isIdentity=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};Phoria.Util.calcNormalVector=
function(a,b,c,d,e,g){a=vec4.fromValues(b*g-c*e,-(g*a-d*c),a*e-b*d,0);return vec3.normalize(a,a)};Phoria.Util.thetaTo=function(a,b){return Math.acos(vec3.dot(a,b)/(Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])*Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])))};Phoria.Util.averagePolyVertex=function(a,b){for(var c=0,d=0,e=0,g=0;c<a.length;c++)d+=b[a[c]][0],e+=b[a[c]][1],g+=b[a[c]][2];return vec3.fromValues(d/a.length,e/a.length,g/a.length)};Phoria.Util.averageObjectZ=function(a){for(var b=0,c=0;c<a.length;c++)b+=
a[c][3];return b/a.length};Phoria.Util.populateBuffer=function(a,b){for(var c=Array(a),d=0;d<a;d++)c[d]=b(d);return c};Phoria.Util.sortPolygons=function(a,b){for(var c=0,d;c<a.length;c++)d=a[c].vertices,a[c]._avz=3===d.length?.333333*(b[d[0]][2]+b[d[1]][2]+b[d[2]][2]):.25*(b[d[0]][2]+b[d[1]][2]+b[d[2]][2]+b[d[3]][2]);a.sort(function(a,b){return a._avz<b._avz?-1:1})};Phoria.Util.sortEdges=function(a,b){for(var c=0;c<a.length;c++)a[c]._avz=.5*(b[a[c].a][2]+b[a[c].b][2]);a.sort(function(a,b){return a._avz<
b._avz?-1:1})};Phoria.Util.sortPoints=function(a,b){(function d(a,b,k,h){if(k<h){var m=k+h>>1,l=b[m][2],q=k,s=b[m];b[m]=b[h];b[h]=s;s=a[m];a[m]=a[h];a[h]=s;for(m=k;m<h;m++)b[m][2]>l&&(s=a[m],a[m]=a[q],a[q]=s,s=b[m],b[m]=b[q],b[q]=s,q++);s=a[q];a[q]=a[h];a[h]=s;s=b[q];b[q]=b[h];b[h]=s;d(a,b,k,q-1);d(a,b,q+1,h)}})(b,a,0,a.length-1)};Phoria.Util.generateTesselatedPlane=function(a,b,c,d,e){c=[];for(var g=[],k=[],h=d/b,m=d/a,l=0,q=0,s,n=d/2;q<=a;q++){s=-d/2;for(var f=0;f<=b;f++){c.push({x:s,y:0,z:n});
0!==f&&g.push({a:l,b:l-1});0!==q&&g.push({a:l,b:l-b-1});if(0!==q&&0!==f){var r={vertices:[l-b-1,l,l-1,l-b-2]};e&&(r.uvs=[1/b*f,1/a*(q-1),1/b*f,1/a*q,1/b*(f-1),1/a*q,1/b*(f-1),1/a*(q-1)]);k.push(r)}s+=h;l++}n-=m}return{points:c,edges:g,polygons:k}};Phoria.Util.generateUnitCube=function(a){a=a||1;return{points:[{x:-1*a,y:1*a,z:-1*a},{x:1*a,y:1*a,z:-1*a},{x:1*a,y:-1*a,z:-1*a},{x:-1*a,y:-1*a,z:-1*a},{x:-1*a,y:1*a,z:1*a},{x:1*a,y:1*a,z:1*a},{x:1*a,y:-1*a,z:1*a},{x:-1*a,y:-1*a,z:1*a}],edges:[{a:0,b:1},
{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[1,5,6,2]},{vertices:[5,4,7,6]},{vertices:[4,0,3,7]},{vertices:[4,5,1,0]},{vertices:[3,2,6,7]}]}};Phoria.Util.generatePyramid=function(a){a=a||1;return{points:[{x:-1*a,y:0,z:-1*a},{x:-1*a,y:0,z:1*a},{x:1*a,y:0,z:1*a},{x:1*a,y:0*a,z:-1*a},{x:0,y:1.5*a,z:0}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:0,b:4},{a:1,b:4},{a:2,b:4},{a:3,b:4}],polygons:[{vertices:[0,
1,4]},{vertices:[1,2,4]},{vertices:[2,3,4]},{vertices:[3,0,4]},{vertices:[3,2,1,0]}]}};Phoria.Util.generateIcosahedron=function(a){var b=a||1,c=(1+Math.sqrt(5))/2;a=c/Math.sqrt(1+c*c)*b;b*=1/Math.sqrt(1+c*c);return{points:[{x:a,y:b,z:0},{x:-a,y:b,z:0},{x:-a,y:-b,z:0},{x:a,y:-b,z:0},{x:b,y:0,z:a},{x:b,y:0,z:-a},{x:-b,y:0,z:-a},{x:-b,y:0,z:a},{x:0,y:a,z:b},{x:0,y:-a,z:b},{x:0,y:-a,z:-b},{x:0,y:a,z:-b}],edges:[{a:4,b:8},{a:8,b:7},{a:7,b:4},{a:7,b:9},{a:9,b:4},{a:5,b:6},{a:6,b:11},{a:11,b:5},{a:5,b:10},
{a:10,b:6},{a:0,b:4},{a:4,b:3},{a:3,b:0},{a:3,b:5},{a:5,b:0},{a:2,b:7},{a:7,b:1},{a:1,b:2},{a:1,b:6},{a:6,b:2},{a:8,b:0},{a:0,b:11},{a:11,b:8},{a:11,b:1},{a:1,b:8},{a:9,b:10},{a:10,b:3},{a:3,b:9},{a:9,b:2},{a:2,b:10}],polygons:[{vertices:[4,8,7]},{vertices:[4,7,9]},{vertices:[5,6,11]},{vertices:[5,10,6]},{vertices:[0,4,3]},{vertices:[0,3,5]},{vertices:[2,7,1]},{vertices:[2,1,6]},{vertices:[8,0,11]},{vertices:[8,11,1]},{vertices:[9,10,3]},{vertices:[9,2,10]},{vertices:[8,4,0]},{vertices:[11,0,5]},
{vertices:[4,9,3]},{vertices:[5,3,10]},{vertices:[7,8,1]},{vertices:[6,1,11]},{vertices:[7,2,9]},{vertices:[6,10,2]}]}};Phoria.Util.subdivide=function(a,b){for(var c=[],d=[],e=function(a){var b=a.x*a.x+a.y*a.y+a.z*a.z,b=1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b},g=function(a,b,g){var h={x:0,y:0,z:0},k={x:0,y:0,z:0},f={x:0,y:0,z:0};h.x=a.x+b.x;h.y=a.y+b.y;h.z=a.z+b.z;k.x=b.x+g.x;k.y=b.y+g.y;k.z=b.z+g.z;f.x=g.x+a.x;f.y=g.y+a.y;f.z=g.z+a.z;e(h);e(k);e(f);var r=c.length;c.push(a,b,g,h,k,f);d.push({vertices:[r+
0,r+3,r+5]});d.push({vertices:[r+1,r+4,r+3]});d.push({vertices:[r+2,r+5,r+4]});d.push({vertices:[r+3,r+4,r+5]})},k=0,h;k<b.length;k++)h=b[k].vertices,3===h.length?g.call(this,a[h[0]],a[h[1]],a[h[2]]):4===h.length&&(g.call(this,a[h[0]],a[h[1]],a[h[2]]),g.call(this,a[h[2]],a[h[3]],a[h[0]]));return{points:c,polygons:d}};Phoria.Util.generateCylinder=function(a,b,c){for(var d=[],e=[],g=[],k=2*Math.PI/c,h=0,m=0;h<=c;h++)if(d.push({x:Math.cos(m)*a,z:Math.sin(m)*a,y:b/2}),d.push({x:Math.cos(m)*a,z:Math.sin(m)*
a,y:-b/2}),m+=k,0!==h&&(e.push({vertices:[2*h-2,2*h,2*h+1,2*h-1]}),g.push({a:2*h,b:2*h-2},{a:2*h-2,b:2*h-1},{a:2*h+1,b:2*h-1}),h===c-1)){for(var l=[],q=c;0<=q;q--)l.push(2*q);e.push({vertices:l});l=[];for(q=0;q<c;q++)l.push(2*q+1);e.push({vertices:l})}return{points:d,edges:g,polygons:e}};Phoria.Util.generateCuboid=function(a){var b=a.scalex||1,c=a.scaley||1;a=a.scalez||1;return{points:[{x:-1*b,y:1*c,z:-1*a},{x:1*b,y:1*c,z:-1*a},{x:1*b,y:-1*c,z:-1*a},{x:-1*b,y:-1*c,z:-1*a},{x:-1*b,y:1*c,z:1*a},{x:1*
b,y:1*c,z:1*a},{x:1*b,y:-1*c,z:1*a},{x:-1*b,y:-1*c,z:1*a}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[0,4,5,1]},{vertices:[1,5,6,2]},{vertices:[2,6,7,3]},{vertices:[4,0,3,7]},{vertices:[5,4,7,6]}]}};Phoria.Util.generateSphere=function(a,b,c,d){for(var e=[],g=[],k=[],h=[],m=0;m<=b;++m)for(var l=0;l<=c;++l){var q=m*Math.PI/b,s=2*l*Math.PI/c,n=Math.sin(q),f=Math.sin(s),q=Math.cos(q),
s=Math.cos(s)*n,n=f*n;d&&h.push({u:l/c,v:m/b});e.push({x:a*s,y:a*q,z:a*n})}for(m=0;m<b;++m)for(l=0;l<c;++l)a=m*(c+1)+l,n=a+c+1,0===m?(f={vertices:[a+1,n+1,n]},d&&(f.uvs=[h[a+1].u,h[a+1].v,h[n+1].u,h[n+1].v,h[n].u,h[n].v]),k.push(f),g.push({a:a,b:n})):m===b-1?(f={vertices:[a+1,n,a]},d&&(f.uvs=[h[a+1].u,h[a+1].v,h[n].u,h[n].v,h[a].u,h[a].v]),k.push(f),g.push({a:a,b:n})):(f={vertices:[a+1,n+1,n,a]},d&&(f.uvs=[h[a+1].u,h[a+1].v,h[n+1].u,h[n+1].v,h[n].u,h[n].v,h[a].u,h[a].v]),k.push(f),g.push({a:a,b:n}),
g.push({a:n,b:n+1}));return{points:e,edges:g,polygons:k}};Phoria.Util.generateRadialGradientBitmap=function(a,b,c){var d=document.createElement("canvas"),e=a<<1;d.width=d.height=e;var g=d.getContext("2d");a=g.createRadialGradient(a,a,a>>1,a,a,a);a.addColorStop(0,b);a.addColorStop(1,c);g.fillStyle=a;g.fillRect(0,0,e,e);b=new Image;b.src=d.toDataURL("image/png");return b};Phoria.Util.request=function(a){var b=new XMLHttpRequest,c=a.data||"";a.responseContentType&&b.overrideMimeType&&b.overrideMimeType(a.responseContentType);
b.open(a.method?a.method:"GET",a.url);a.requestContentType&&b.setRequestHeader("Accept",a.requestContentType);b.onreadystatechange=function(){4===b.readyState&&(200===b.status?a.fnSuccess&&a.fnSuccess.call(this,b.responseText,b.status):a.fnFailure?a.fnFailure.call(this,b.responseText,b.status):alert(b.status+"\n\n"+b.responseText))};try{"POST"===a.method||"PUT"===a.method?b.send(c):b.send(null)}catch(d){alert(d.message)}};Phoria.Util.importGeometryWavefront=function(a){var b=[],c=[],d=[],e=/\s+/,
g=a.scale||1,k,h,m,l,q,s;k=h=m=l=q=s=0;Phoria.Util.request({url:a.url,fnSuccess:function(n){var f=n.split("\n");for(n=0;n<f.length;n++){var r=f[n].split(e);switch(r[0]){case "v":var H=parseFloat(r[1])*g,t=parseFloat(r[2])*g,r=parseFloat(r[3])*g;b.push({x:H,y:t,z:r});H<k?k=H:H>l&&(l=H);t<h?h=t:t>q&&(q=t);r<m?m=r:r>s&&(s=r);break;case "vt":H=parseFloat(r[1]);r=parseFloat(r[2]);d.push([H,r]);break;case "f":r.splice(0,1);for(var t=[],H=[],K=0,p,C;K<r.length;K++)p=r[a.reorder?r.length-K-1:K],0!==p.length&&
(C=p.split("/"),t.push(parseInt(C[0])-1),1<C.length&&-1===p.indexOf("//")&&(p=parseInt(C[1])-1,d.length>p&&H.push(d[p][0],d[p][1])));r={vertices:t};c.push(r);0!==H.length&&(r.uvs=H)}}if(a.center)for(f=(k+l)/2,r=(h+q)/2,H=(m+s)/2,n=0;n<b.length;n++)b[n].x-=f,b[n].y-=r,b[n].z-=H;if(a.scaleTo)for(n=l-k,r=q-h,H=s-m,f=0,f=r>n?H>r?1/(H/a.scaleTo):1/(r/a.scaleTo):H>n?1/(H/a.scaleTo):1/(n/a.scaleTo),n=0;n<b.length;n++)b[n].x*=f,b[n].y*=f,b[n].z*=f;a.fnSuccess&&a.fnSuccess.call(this,{points:b,polygons:c})},
fnFailure:function(b){a.fnFailure&&a.fnFailure.call(this,b)}})};Phoria.Util.calculatePolarFromPlanar=function(a){var b=new vec3.create;b[0]=vec3.length(a);b[1]=Math.acos(a[2]/b[0]);b[2]=0!==a[0]?0<a[0]?Math.atan(a[1]/a[0]):Math.PI+Math.atan(a[1]/a[0]):0<a[1]?Math.PI/2:3*Math.PI/2;return b};Phoria.Util.calculatePlanarFromPolar=function(a){return new vec3.fromValues(Math.round(a[0]*Math.sin(a[1])*Math.cos(a[2])*100)/100,Math.round(a[0]*Math.sin(a[1])*Math.sin(a[2])*100)/100,Math.round(a[0]*Math.cos(a[1])*
100)/100)};Phoria.Util.planeLineIntersection=function(a,b,c,d){var e=vec3.dot(c,a);if(0!==e){var g=new vec3.create;vec3.subtract(g,b,d);a=vec3.dot(a,g)/e;b=vec3.create();vec3.scaleAndAdd(b,d,c,a);return b}return null};Phoria.Util.intersectionInsidePolygon=function(a,b,c){for(var d=vec3.fromValues(Math.abs(a._worldnormal[0]),Math.abs(a._worldnormal[1]),Math.abs(a._worldnormal[2])),e=0,g=vec2.fromValues(1,1),k=0;k<a.vertices.length;k++){var h,m,l;d[2]>=d[0]&&d[2]>=d[1]?(h=vec2.fromValues(b[a.vertices[k]][0],
b[a.vertices[k]][1]),m,m=k<a.vertices.length-1?vec2.fromValues(b[a.vertices[k+1]][0],b[a.vertices[k+1]][1]):vec2.fromValues(b[a.vertices[0]][0],b[a.vertices[0]][1]),l=vec2.fromValues(c[0],c[1])):d[1]>d[0]?(h=vec2.fromValues(b[a.vertices[k]][2],b[a.vertices[k]][0]),m,m=k<a.vertices.length-1?vec2.fromValues(b[a.vertices[k+1]][2],b[a.vertices[k+1]][0]):vec2.fromValues(b[a.vertices[0]][2],b[a.vertices[0]][0]),l=vec2.fromValues(c[2],c[0])):(h=vec2.fromValues(b[a.vertices[k]][1],b[a.vertices[k]][2]),m,
m=k<a.vertices.length-1?vec2.fromValues(b[a.vertices[k+1]][1],b[a.vertices[k+1]][2]):vec2.fromValues(b[a.vertices[0]][1],b[a.vertices[0]][2]),l=vec2.fromValues(c[1],c[2]));Phoria.Util.sectionLineIntersect2D(h,m,l,g)&&e++}return 1===e%2};Phoria.Util.sectionLineIntersect2D=function(a,b,c,d){var e=vec2.create();vec2.subtract(e,b,a);var g=vec3.create();vec2.cross(g,e,d);if(0===g[2])return!1;g=(c[0]*d[1]-c[1]*d[0]-a[0]*d[1]+a[1]*d[0])/g[2];c=0!==d[0]?(a[0]+g*e[0]-c[0])/d[0]:(a[1]+g*e[1]-c[1])/d[1];d=vec2.create();
vec2.scaleAndAdd(d,a,e,g);g=e=!1;0<=c&&(a[0]>b[0]?d[0]<=a[0]&&d[0]>=b[0]&&(e=!0):d[0]>=a[0]&&d[0]<=b[0]&&(e=!0),a[1]>b[1]?d[1]<=a[1]&&d[1]>=b[1]&&(g=!0):d[1]>=a[1]&&d[1]<=b[1]&&(g=!0));return e&&g}})();
(function(){Phoria.Preloader=function(){this.images=[];return this};Phoria.Preloader.prototype={images:null,callback:null,counter:0,addImage:function(a,b){var c=this;a.url=b;a.onload=function(){c.counter++;c.counter===c.images.length&&c.callback.call(c)};this.images.push(a)},onLoadCallback:function(a){this.counter=0;this.callback=a;a=0;for(var b=this.images.length;a<b;a++)this.images[a].src=this.images[a].url}}})();
(function(){Phoria.BaseEntity=function(){this.matrix=mat4.create();this.children=[];return this};Phoria.BaseEntity.create=function(a,b){b||(b=new Phoria.BaseEntity);a.id&&(b.id=a.id);a.matrix&&(b.matrix=a.matrix);a.children&&(b.children=a.children);if(a.onBeforeScene)b.onBeforeScene(a.onBeforeScene);if(a.onScene)b.onScene(a.onScene);void 0!==a.disabled&&(b.disabled=a.disabled);return b};Phoria.BaseEntity.prototype={id:null,children:null,matrix:null,disabled:!1,onBeforeSceneHandlers:null,onSceneHandlers:null,
onBeforeScene:function(a){null===this.onBeforeSceneHandlers&&(this.onBeforeSceneHandlers=[]);this.onBeforeSceneHandlers=this.onBeforeSceneHandlers.concat(a)},onScene:function(a){null===this.onSceneHandlers&&(this.onSceneHandlers=[]);this.onSceneHandlers=this.onSceneHandlers.concat(a)},identity:function(){mat4.identity(this.matrix);return this},invert:function(){mat4.invert(this.matrix,this.matrix);return this},multiply:function(a){mat4.multiply(this.matrix,this.matrix,a);return this},scale:function(a){mat4.scale(this.matrix,
this.matrix,a);return this},scaleN:function(a){mat4.scale(this.matrix,this.matrix,vec3.fromValues(a,a,a));return this},rotate:function(a,b){mat4.rotate(this.matrix,this.matrix,a,b);return this},rotateX:function(a){mat4.rotateX(this.matrix,this.matrix,a);return this},rotateY:function(a){mat4.rotateY(this.matrix,this.matrix,a);return this},rotateZ:function(a){mat4.rotateZ(this.matrix,this.matrix,a);return this},rotateYPR:function(a,b,c){a=mat4.fromYPR(a,b,c);mat4.multiply(this.matrix,this.matrix,a)},
translate:function(a){mat4.translate(this.matrix,this.matrix,a);return this},translateX:function(a){mat4.translate(this.matrix,this.matrix,vec3.fromValues(a,0,0));return this},translateY:function(a){mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,a,0));return this},translateZ:function(a){mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,0,a));return this},determinant:function(){return mat4.determinant(this.matrix)},transpose:function(){mat4.transpose(this.matrix,this.matrix);return this}}})();
Phoria.CLIP_ARRAY_TYPE="undefined"!==typeof Uint32Array?Uint32Array:Array;
(function(){Phoria.Entity=function(){Phoria.Entity.superclass.constructor.call(this);this.points=[];this.edges=[];this.polygons=[];this.textures=[];this.style=Phoria.Entity.createStyle();return this};Phoria.Entity.create=function(a,b){b||(b=new Phoria.Entity);Phoria.BaseEntity.create(a,b);a.points&&(b.points=a.points);a.polygons&&(b.polygons=a.polygons);a.edges&&(b.edges=a.edges);a.style&&Phoria.Util.combine(b.style,a.style);if(a.onRender)b.onRender(a.onRender);b.generatePolygonNormals();return b};
Phoria.Entity.createStyle=function(a){var b={color:[128,128,128],diffuse:1,specular:0,drawmode:"solid",shademode:"lightsource",fillmode:"inflate",objectsortmode:"sorted",geometrysortmode:"automatic",linewidth:1,linescale:0,opacity:1,doublesided:!1};a&&Phoria.Util.combine(b,a);return b};Phoria.Util.extend(Phoria.Entity,Phoria.BaseEntity,{points:null,edges:null,polygons:null,style:null,textures:null,onRenderHandlers:null,_worldcoords:null,_cameracoords:null,_coords:null,_clip:null,_averagez:0,_sorted:!0,
onRender:function(a){null===this.onRenderHandlers&&(this.onRenderHandlers=[]);this.onRenderHandlers=this.onRenderHandlers.concat(a)},generatePolygonNormals:function(){if(this.polygons)for(var a=this.points,b=this.polygons,c=0,d,e,g,k,h,m;c<b.length;c++)d=b[c].vertices,e=a[d[1]].x-a[d[0]].x,g=a[d[1]].y-a[d[0]].y,k=a[d[1]].z-a[d[0]].z,h=a[d[2]].x-a[d[0]].x,m=a[d[2]].y-a[d[0]].y,d=a[d[2]].z-a[d[0]].z,b[c].normal=Phoria.Util.calcNormalVector(e,g,k,h,m,d)},initCoordinateBuffers:function(){var a=this.points.length;
if(null===this._worldcoords||this._worldcoords.length<a){this._worldcoords=Array(a);for(var b=0;b<a;b++)this._worldcoords[b]=vec4.create()}if(null===this._cameracoords||this._cameracoords.length<a)for(this._cameracoords=Array(a),b=0;b<a;b++)this._cameracoords[b]=vec4.create();if(null===this._coords||this._coords.length<a)for(this._coords=Array(a),b=0;b<a;b++)this._coords[b]=vec4.create();if(null===this._clip||this._clip.length<a)this._clip=new Phoria.CLIP_ARRAY_TYPE(a)},getScreenBounds:function(){for(var a=
1E4,b=1E4,c=-1E4,d=-1E4,e=0,g;e<this._coords.length;e++)g=this._coords[e],g[0]<a&&(a=g[0]),g[0]>c&&(c=g[0]),g[1]<b&&(b=g[1]),g[1]>d&&(d=g[1]);return{minx:a,miny:b,maxx:c,maxy:d}},getWorldBounds:function(){for(var a=1E4,b=1E4,c=1E4,d=-1E4,e=-1E4,g=-1E4,k=0,h;k<this._worldcoords.length;k++)h=this._worldcoords[k],h[0]<a&&(a=h[0]),h[0]>d&&(d=h[0]),h[1]<b&&(b=h[1]),h[1]>e&&(e=h[1]),h[2]<c&&(c=h[2]),h[2]>g&&(g=h[2]);return{minx:a,miny:b,maxx:d,maxy:e,minz:c,maxz:g}}});Phoria.Entity.debug=function(a,b){for(var c=
"Phoria.Debug"+(a.id?" "+a.id:""),d=null,e=0;e<a.children.length;e++)if(a.children[e].id===c){d=a.children[e];break}null===d&&(d=new Phoria.Entity,d.id=c,d.points=[{x:0,y:0,z:0}],d.style={drawmode:"point",shademode:"callback",geometrysortmode:"none",objectsortmode:"front"},d.config={},d.onRender(function(b,c,e){b.fillStyle="#333";b.font="14pt Helvetica";this.config.showId&&(b.fillText(a.id?a.id:"unknown - set Entity 'id' property",c,e),e+=16);if(this.config.showPosition){var m=a.worldposition?a.worldposition:
d._worldcoords[0];b.fillText("{x:"+m[0].toFixed(2)+", y:"+m[1].toFixed(2)+", z:"+m[2].toFixed(2)+"}",c,e)}}),a.children.push(d),c=function(a,b,c){a=new Phoria.Entity;a.points=[{x:0,y:0,z:0},{x:2*b[0],y:2*b[1],z:2*b[2]}];a.edges=[{a:0,b:1}];a.style={drawmode:"wireframe",shademode:"plain",geometrysortmode:"none",objectsortmode:"front",linewidth:2,color:c};a.disabled=!0;return a},d.children.push(c("X",vec3.fromValues(1,0,0),[255,0,0])),d.children.push(c("Y",vec3.fromValues(0,1,0),[0,255,0])),d.children.push(c("Z",
vec3.fromValues(0,0,1),[0,0,255])));Phoria.Util.combine(d.config,b);for(e=0;e<d.children.length;e++)d.children[e].disabled=!d.config.showAxis}})();(function(){Phoria.PositionalAspect={};Phoria.PositionalAspect.prototype={position:null,worldposition:null,updatePosition:function(a){var b=vec4.fromXYZ(this.position,1);vec4.transformMat4(b,b,a);this.worldposition=b}}})();
(function(){Phoria.PhysicsEntity=function(){Phoria.PhysicsEntity.superclass.constructor.call(this);this.velocity={x:0,y:0,z:0};this.position={x:0,y:0,z:0};this._force={x:0,y:0,z:0};this._acceleration=null;this.gravity=!0;this.onBeforeScene(this.applyPhysics);this.onScene(this.transformToScene);return this};Phoria.PhysicsEntity.create=function(a){var b=new Phoria.PhysicsEntity;Phoria.Entity.create(a,b);a.velocity&&(b.velocity=a.velocity);a.position&&(b.position=a.position);a.force&&(b._force=a.force);
void 0!==a.gravity&&(b.gravity=a.gravity);return b};Phoria.Util.extend(Phoria.PhysicsEntity,Phoria.Entity,{velocity:null,gravity:!1,_force:null,_acceleration:null,impulse:function(a){this._acceleration=a},force:function(a){this._force=a},applyPhysics:function(a){a=1E3/60/1E3;a*=a;this._acceleration&&(this.velocity.x+=this._acceleration.x*a,this.velocity.y+=this._acceleration.y*a,this.velocity.z+=this._acceleration.z*a,this._acceleration=null);this._force&&(this.velocity.x+=this._force.x*a,this.velocity.y+=
this._force.y*a,this.velocity.z+=this._force.z*a);this.gravity&&(this.velocity.x+=Phoria.PhysicsEntity.GRAVITY.x*a,this.velocity.y+=Phoria.PhysicsEntity.GRAVITY.y*a,this.velocity.z+=Phoria.PhysicsEntity.GRAVITY.z*a);this.translate(vec3.fromXYZ(this.velocity))},transformToScene:function(a,b){this.updatePosition(b)}});Phoria.Util.augment(Phoria.PhysicsEntity,Phoria.PositionalAspect)})();Phoria.PhysicsEntity.GRAVITY={x:0,y:-9.8,z:0};
(function(){Phoria.EmitterEntity=function(){Phoria.EmitterEntity.superclass.constructor.call(this);this.position={x:0,y:0,z:0};this.positionRnd={x:0,y:0,z:0};this.velocity={x:0,y:1,z:0};this.velocityRnd={x:0,y:0,z:0};this.maximum=1E3;this.gravity=!0;var a=Phoria.Entity.createStyle();a.drawmode="point";a.shademode="plain";a.geometrysortmode="none";a.linewidth=5;a.linescale=2;this.style=a;this.textures=[];this._lastEmitTime=Date.now();this.onScene(this.emitParticles);return this};Phoria.EmitterEntity.create=
function(a){var b=new Phoria.EmitterEntity;Phoria.BaseEntity.create(a,b);a.position&&(b.position=a.position);a.positionRnd&&(b.positionRnd=a.positionRnd);a.rate&&(b.rate=a.rate);a.maximum&&(b.maximum=a.maximum);a.velocity&&(b.velocity=a.velocity);a.velocityRnd&&(b.velocityRnd=a.velocityRnd);a.lifetime&&(b.lifetime=a.lifetime);a.lifetimeRnd&&(b.lifetimeRnd=a.lifetimeRnd);void 0!==a.gravity&&(b.gravity=a.gravity);a.style&&Phoria.Util.combine(b.style,a.style);if(a.onParticle)b.onParticle(a.onParticle);
return b};Phoria.Util.extend(Phoria.EmitterEntity,Phoria.BaseEntity,{style:null,rate:0,maximum:0,velocity:null,velocityRnd:null,lifetime:0,lifetimeRnd:0,gravity:!1,_lastEmitTime:0,onParticleHandlers:null,onParticle:function(a){null===this.onParticleHandlers&&(this.onParticleHandlers=[]);this.onParticleHandlers=this.onParticleHandlers.concat(a)},emitParticles:function(a,b,c){this.updatePosition(b);a=Date.now();for(b=0;b<this.children.length;b++)c=this.children[b],c._gravetime&&a>c._gravetime&&this.children.splice(b,
1);b=Math.floor(this.rate/1E3*(a-this._lastEmitTime));if(0<b){for(c=0;c<b&&(0===this.maximum||this.children.length<this.maximum);c++){var d={x:this.position.x,y:this.position.y,z:this.position.z};d.x+=Math.random()*this.positionRnd.x-.5*this.positionRnd.x;d.y+=Math.random()*this.positionRnd.y-.5*this.positionRnd.y;d.z+=Math.random()*this.positionRnd.z-.5*this.positionRnd.z;var e={x:this.velocity.x,y:this.velocity.y,z:this.velocity.z};e.x+=Math.random()*this.velocityRnd.x-.5*this.velocityRnd.x;e.y+=
Math.random()*this.velocityRnd.y-.5*this.velocityRnd.y;e.z+=Math.random()*this.velocityRnd.z-.5*this.velocityRnd.z;var g=new Phoria.PhysicsEntity;g.position=d;g.points=[d];g.velocity=e;g.gravity=this.gravity;g.style=this.style;g.textures=this.textures;0!==this.lifetime&&(g._gravetime=Math.floor(a+this.lifetime+this.lifetimeRnd*Math.random()-.5*this.lifetimeRnd));if(null!==this.onParticleHandlers)for(d=0;d<this.onParticleHandlers.length;d++)this.onParticleHandlers[d].call(this,g);this.children.push(g)}this._lastEmitTime=
a}}});Phoria.Util.augment(Phoria.EmitterEntity,Phoria.PositionalAspect)})();(function(){Phoria.BaseLight=function(){Phoria.BaseLight.superclass.constructor.call(this);this.color=[1,1,1];this.intensity=1;return this};Phoria.Util.extend(Phoria.BaseLight,Phoria.BaseEntity,{color:null,intensity:0})})();
(function(){Phoria.DistantLight=function(){Phoria.DistantLight.superclass.constructor.call(this);this.direction={x:0,y:0,z:1};this.onScene(this.transformToScene);return this};Phoria.DistantLight.create=function(a){var b=new Phoria.DistantLight;Phoria.BaseEntity.create(a,b);a.color&&(b.color=a.color);a.intensity&&(b.intensity=a.intensity);a.direction&&(b.direction=vec3.toXYZ(vec3.normalize(b.direction,vec3.fromXYZ(a.direction))));return b};Phoria.Util.extend(Phoria.DistantLight,Phoria.BaseLight,{direction:null,
worlddirection:null,transformToScene:function(){this.worlddirection=vec3.fromValues(-this.direction.x,-this.direction.y,-this.direction.z)}})})();
(function(){Phoria.PointLight=function(){Phoria.PointLight.superclass.constructor.call(this);this.position={x:0,y:0,z:-1};this.attenuation=.1;this.attenuationFactor="linear";this.onScene(this.transformToScene);return this};Phoria.PointLight.create=function(a){var b=new Phoria.PointLight;Phoria.BaseEntity.create(a,b);a.color&&(b.color=a.color);a.intensity&&(b.intensity=a.intensity);a.position&&(b.position=a.position);a.attenuation&&(b.attenuation=a.attenuation);a.attenuationFactor&&(b.attenuationFactor=
a.attenuationFactor);return b};Phoria.Util.extend(Phoria.PointLight,Phoria.BaseLight,{attenuation:0,attenuationFactor:null,transformToScene:function(a,b,c){this.updatePosition(b)}});Phoria.Util.augment(Phoria.PointLight,Phoria.PositionalAspect)})();
(function(){Phoria.Renderer=function(){};Phoria.Renderer.prototype={sort:!0,sortObjects:function(a){if(this.sort){for(var b=0,c;b<a.renderlist.length;b++)switch(c=a.renderlist[b],c.style.objectsortmode){case "sorted":break;case "front":c._averagez=Number.MIN_VALUE;break;default:c._averagez=Number.MAX_VALUE}a.renderlist.sort(function(a,b){return a._averagez<b._averagez?1:-1})}},calcNormalBrightness:function(a,b,c,d){for(var e=[0,0,0],g=c.lights,k=0,h,m;k<g.length;k++){h=g[k];if(h instanceof Phoria.DistantLight){var l=
vec3.dot(b,h.worlddirection);if(0>=l)continue;m=l*h.intensity*d.style.diffuse}else if(h instanceof Phoria.PointLight){var q=vec3.subtract(vec3.create(),a,h.worldposition),s=vec3.length(q);vec3.normalize(q,q);l=vec3.dot(b,vec3.negate(q,q));if(0>=l)continue;switch(h.attenuationFactor){default:case "none":m=h.attenuation;break;case "linear":m=h.attenuation*s;break;case "squared":m=h.attenuation*s*s}0!==d.style.specular&&(q=vec3.add(vec3.create(),q,c._cameraPosition),q=vec3.dot(b,vec3.normalize(q,q)),
q=Math.pow(q,d.style.specular)*h.intensity/m,e[0]+=q*h.color[0],e[1]+=q*h.color[1],e[2]+=q*h.color[2]);m=d.style.diffuse*l*h.intensity/m}e[0]+=m*h.color[0];e[1]+=m*h.color[1];e[2]+=m*h.color[2]}return e},calcPositionBrightness:function(a,b){for(var c=[0,0,0],d=0,e,g;d<b.length;d++){e=b[d];if(e instanceof Phoria.DistantLight)g=e.intensity;else if(e instanceof Phoria.PointLight){g=vec3.subtract(vec3.create(),a,e.worldposition);var k=vec3.length(g);vec3.normalize(g,g);switch(e.attenuationFactor){case "linear":g=
e.attenuation*k;break;case "squared":g=e.attenuation*k*k;break;default:case "none":g=e.attenuation}g=e.intensity/(2*g)}c[0]+=g*e.color[0];c[1]+=g*e.color[1];c[2]+=g*e.color[2]}return c},inflatePolygon:function(a,b,c){c=c||.5;for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=[b[a[e]][0],b[a[e]][1]];e=0;a=a.length;for(var g,k,h,m;e<a;e++)b=e<a-1?e+1:0,g=d[e][0],k=d[e][1],h=d[b][0],m=d[b][1],g=h-g,k=m-k,m=g*g+k*k,0===m&&m===Phoria.EPSILON,m=c/Math.sqrt(m),g*=m,k*=m,d[e][0]-=g,d[e][1]-=k,d[b][0]+=g,d[b][1]+=
k;return d},inflatePolygonFull:function(a,b,c){c=c||.5;for(var d=[],e=Array(a.length),g=0,k=a.length,h,m,l,q,s,n,f;g<k;g++)h=b[a[g]][0],m=b[a[g]][1],g<k-1?(l=b[a[g+1]][0],q=b[a[g+1]][1]):(l=b[a[0]][0],q=b[a[0]][1]),s=q-m,n=-(l-h),f=Math.sqrt(s*s+n*n),s/=f,n/=f,s*=c,n*=c,d.push({x:h+s,y:m+n}),d.push({x:l+s,y:q+n});g=0;for(k=a.length;g<k;g++){c=0===g?this.intersection(d[2*(k-1)],d[2*(k-1)+1],d[0],d[1]):this.intersection(d[2*(g-1)],d[2*(g-1)+1],d[2*g],d[2*g+1]);if(1.5<Math.abs(c[0]-b[a[g]][0])||1.5<
Math.abs(c[1]-b[a[g]][1]))c[0]=b[a[g]][0],c[1]=b[a[g]][1];e[g]=c}return e},intersection:function(a,b,c,d){var e=c.x-d.x;d=c.y-d.y;c=(e*(c.y-a.y)-d*(c.x-a.x))/((b.y-a.y)*e-(b.x-a.x)*d);return[a.x+c*(b.x-a.x),a.y+c*(b.y-a.y)]}}})();
(function(){Phoria.CanvasRenderer=function(a){Phoria.CanvasRenderer.superclass.constructor.call(this);this.canvas=a;this.ctx=a.getContext("2d");return this};Phoria.Util.extend(Phoria.CanvasRenderer,Phoria.Renderer,{canvas:null,ctx:null,render:function(a,b){this.sortObjects(a);var c=this.ctx;b?b.call(this,c):c.clearRect(0,0,this.canvas.width,this.canvas.height);for(var d=0,e;d<a.renderlist.length;d++){e=a.renderlist[d];c.save();e.style.compositeOperation&&(c.globalCompositeOperation=e.style.compositeOperation);
switch(e.style.drawmode){case "solid":if("fillstroke"===e.style.fillmode||"hiddenline"===e.style.fillmode)c.lineWidth=1;for(var g=0;g<e.polygons.length;g++)this.renderPolygon(c,e,a,e.polygons[g]);break;case "wireframe":c.lineWidth=e.style.linewidth;c.globalAlpha=e.style.opacity;if("plain"===e.style.shademode){c.strokeStyle="rgb("+e.style.color[0]+","+e.style.color[1]+","+e.style.color[2]+")";c.beginPath();for(g=0;g<e.edges.length;g++)this.renderEdge(c,e,a,e.edges[g]);c.closePath();c.stroke()}else for(g=
0;g<e.edges.length;g++)this.renderEdge(c,e,a,e.edges[g]);break;case "point":if("sprite"===e.style.shademode&&void 0!==e.style.sprite){if(!e.textures)throw Error("Entity has shademode 'sprite' but no textures defined on parent emitter.");if(e.style.sprite>e.textures.length-1)throw Error("Entity has shademode 'sprite' index but references missing texture on parent emitter.");}c.globalAlpha=e.style.opacity;var k=e._coords;"plain"===e.style.shademode&&(c.fillStyle="rgb("+e.style.color[0]+","+e.style.color[1]+
","+e.style.color[2]+")");for(g=0;g<k.length;g++)this.renderPoint(c,e,a,k[g],g)}c.restore()}},renderPoint:function(a,b,c,d,e){if(!b._clip[e]){var g=b.style.linewidth;0!==b.style.linescale&&(g=b.style.linewidth*b.style.linescale*c._perspectiveScale/b._coords[e][3]);switch(b.style.shademode){case "plain":a.beginPath();a.arc(d[0],d[1],g,0,Phoria.TWOPI,!0);a.closePath();a.fill();break;case "sprite":void 0!==b.style.sprite&&a.drawImage(b.textures[b.style.sprite],d[0]-g,d[1]-g,g+g,g+g);break;case "callback":if(null!==
b.onRenderHandlers)for(c=0;c<b.onRenderHandlers.length;c++)b.onRenderHandlers[c].call(b,a,d[0],d[1],g);break;case "lightsource":c=this.calcPositionBrightness(b._worldcoords[e],c.lights),a.fillStyle="rgb("+Math.min(Math.ceil(c[0]*b.style.color[0]),255)+","+Math.min(Math.ceil(c[1]*b.style.color[1]),255)+","+Math.min(Math.ceil(c[2]*b.style.color[2]),255)+")",a.beginPath(),a.arc(d[0],d[1],g,0,Phoria.TWOPI,!0),a.closePath(),a.fill()}}},renderEdge:function(a,b,c,d){if(!(b._clip[d.a]&b._clip[d.b])){var e=
b._coords;0!==b.style.linescale&&(a.lineWidth=b.style.linewidth*b.style.linescale/(.5*(b._coords[d.a][3]+b._coords[d.b][3]))*c._perspectiveScale);if("lightsource"===b.style.shademode){var g=b._worldcoords[d.a],k=b._worldcoords[d.b],g=vec3.fromValues(.5*(g[0]+k[0]),.5*(g[1]+k[1]),.5*(g[2]+k[2]));c=this.calcPositionBrightness(g,c.lights);a.beginPath();a.strokeStyle="rgb("+Math.min(Math.ceil(c[0]*b.style.color[0]),255)+","+Math.min(Math.ceil(c[1]*b.style.color[1]),255)+","+Math.min(Math.ceil(c[2]*b.style.color[2]),
255)+")";a.moveTo(e[d.a][0],e[d.a][1]);a.lineTo(e[d.b][0],e[d.b][1]);a.closePath();a.stroke()}else a.moveTo(e[d.a][0],e[d.a][1]),a.lineTo(e[d.b][0],e[d.b][1])}},renderPolygon:function(a,b,c,d){for(var e=b._coords,g=b._clip,k=d.vertices,h=d.color?d.color:b.style.color,m=null,l,q=0,s=d.opacity?d.opacity:b.style.opacity,n=1,f=0;f<k.length;f++)n&=g[k[f]];if(!(n||!b.style.doublesided&&0>e[k[0]][0]*e[k[1]][1]-e[k[1]][0]*e[k[0]][1]+(e[k[1]][0]*e[k[2]][1]-e[k[2]][0]*e[k[1]][1])+(e[k[2]][0]*e[k[0]][1]-e[k[0]][0]*
e[k[2]][1]))){switch(b.style.shademode){case "plain":void 0===b.style.texture&&void 0===d.texture&&(m=h[0]+","+h[1]+","+h[2]);break;case "lightsource":l=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(k,b._worldcoords),d._worldnormal,c,b);if(d.emit||b.style.emit)q=d.emit?d.emit:b.style.emit;m=Math.min(Math.ceil(l[0]*h[0]+h[0]*q),255)+","+Math.min(Math.ceil(l[1]*h[1]+h[1]*q),255)+","+Math.min(Math.ceil(l[2]*h[2]+h[1]*q),255)}a.save();if(void 0!==b.style.texture||void 0!==d.texture){var r=b.textures[void 0!==
d.texture?d.texture:b.style.texture];b=function(b,c,d,e,f,g,h){var k=b[0][0],l=b[0][1],m=b[1][0],n=b[1][1],q=b[2][0];b=b[2][1];a.beginPath();a.moveTo(k,l);a.lineTo(m,n);a.lineTo(q,b);a.closePath();a.clip();var v=v=1/(c*(h-f)-e*h+g*f+(e-g)*d);a.transform(-(d*(q-m)-f*q+h*m+(f-h)*k)*v,(f*b+d*(n-b)-h*n+(h-f)*l)*v,(c*(q-m)-e*q+g*m+(e-g)*k)*v,-(e*b+c*(n-b)-g*n+(g-e)*l)*v,(c*(h*m-f*q)+d*(e*q-g*m)+(g*f-e*h)*k)*v,(c*(h*n-f*b)+d*(e*b-g*n)+(g*f-e*h)*l)*v);a.globalAlpha=s;a.drawImage(r,0,0)};null!==m&&(l=.3*
l[0]+.6*l[1]+.1*l[2],1<l&&(l=1),a.fillStyle="rgba("+m+","+(1-l).toFixed(3)+")");if(3===k.length)c=f=0,g=r.width,h=0,q=r.width,n=r.height,void 0!==d.uvs&&(f=r.width*d.uvs[0],c=r.height*d.uvs[1],g=r.width*d.uvs[2],h=r.height*d.uvs[3],q=r.width*d.uvs[4],n=r.height*d.uvs[5]),l=this.inflatePolygon(k,e,.5),b.call(this,l,f,c,g,h,q,n),null!==m&&a.fill();else if(4===k.length&&(c=f=0,g=r.width,h=0,q=r.width,n=r.height,void 0!==d.uvs&&(f=r.width*d.uvs[0],c=r.height*d.uvs[1],g=r.width*d.uvs[2],h=r.height*d.uvs[3],
q=r.width*d.uvs[4],n=r.height*d.uvs[5]),a.save(),l=this.inflatePolygon(k.slice(0,3),e,.5),b.call(this,l,f,c,g,h,q,n),a.restore(),f=r.width,c=r.height,g=0,h=r.height,n=q=0,void 0!==d.uvs&&(f=r.width*d.uvs[4],c=r.height*d.uvs[5],g=r.width*d.uvs[6],h=r.height*d.uvs[7],q=r.width*d.uvs[0],n=r.height*d.uvs[1]),a.save(),d=Array(3),d[0]=k[2],d[1]=k[3],d[2]=k[0],l=this.inflatePolygon(d,e,.5),b.call(this,l,f,c,g,h,q,n),a.restore(),null!==m)){l=this.inflatePolygon(k,e,.75);a.beginPath();a.moveTo(l[0][0],l[0][1]);
f=1;for(e=l.length;f<e;f++)a.lineTo(l[f][0],l[f][1]);a.closePath();a.globalAlpha=s;a.fill()}}else{if("inflate"===b.style.fillmode)for(l=this.inflatePolygon(k,e,.5),a.beginPath(),a.moveTo(l[0][0],l[0][1]),f=1,e=k.length;f<e;f++)a.lineTo(l[f][0],l[f][1]);else for(a.beginPath(),a.moveTo(e[k[0]][0],e[k[0]][1]),f=1;f<k.length;f++)a.lineTo(e[k[f]][0],e[k[f]][1]);a.closePath();m="rgba("+m+","+s+")";switch(b.style.fillmode){case "fill":a.fillStyle=m;a.fill();break;case "filltwice":a.fillStyle=m;a.fill();
a.fill();break;case "inflate":a.fillStyle=m;a.fill();break;case "fillstroke":a.fillStyle=m;a.fill();a.strokeStyle=m;a.stroke();break;case "hiddenline":a.strokeStyle=m,a.stroke()}}a.restore()}}})})();
(function(){Phoria.SoftwareRenderer=function(a){Phoria.SoftwareRenderer.superclass.constructor.call(this);this.canvas=a;this.ctx=a.getContext("2d");this._imagedata=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this._data=this._imagedata.data;return this};Phoria.Util.extend(Phoria.SoftwareRenderer,Phoria.Renderer,{canvas:null,ctx:null,_imagedata:null,_data:null,render:function(a){this.sortObjects(a);this.clearCanvasRect(0,0,this.canvas.width,this.canvas.height);for(var b=0,c;b<a.renderlist.length;b++)switch(c=
a.renderlist[b],c.style.drawmode){case "solid":for(var d=0,e=0;e<c.polygons.length;e++)this.renderPolygon(null,c,a,c.polygons[e])&&d++}this.ctx.putImageData(this._imagedata,0,0,0,0,this.canvas.width,this.canvas.height)},clearCanvasRect:function(a,b,c,d){for(var e=4*(a+b*this.canvas.width-1)+3,g=4*(this.canvas.width-(c-a)),k=this._data;b<d;b++){for(var h=a;h<c;h++)k[e+=4]=0;e+=g}},renderPolygon:function(a,b,c,d){a=b._coords;for(var e=b._clip,g=d.vertices,k=d.color?d.color:b.style.color,h=1,m=0;m<g.length;m++)h&=
e[g[m]];if(h)return!1;if(b.style.doublesided||!(0>a[g[0]][0]*a[g[1]][1]-a[g[1]][0]*a[g[0]][1]+(a[g[1]][0]*a[g[2]][1]-a[g[2]][0]*a[g[1]][1])+(a[g[2]][0]*a[g[0]][1]-a[g[0]][0]*a[g[2]][1]))){var l;switch(b.style.shademode){case "plain":l=Array(3);l[0]=k[0];l[1]=k[1];l[2]=k[2];break;case "lightsource":l=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(g,b._worldcoords),d._worldnormal,c,b),l[0]=Math.ceil(Math.min(l[0]*k[0],255)),l[1]=Math.ceil(Math.min(l[1]*k[1],255)),l[2]=Math.ceil(Math.min(l[2]*
k[2],255))}this.drawTriangle(a[g[2]][0],a[g[2]][1],a[g[1]][0],a[g[1]][1],a[g[0]][0],a[g[0]][1],l[0],l[1],l[2]);4===g.length&&this.drawTriangle(a[g[0]][0],a[g[0]][1],a[g[3]][0],a[g[3]][1],a[g[2]][0],a[g[2]][1],l[0],l[1],l[2]);return!0}},drawTriangle:function(a,b,c,d,e,g,k,h,m){a=Math.round(16*a);c=Math.round(16*c);e=Math.round(16*e);b=Math.round(16*b);d=Math.round(16*d);g=Math.round(16*g);var l=a-c,q=c-e,s=e-a,n=b-d,f=d-g,r=g-b,H=l<<4,t=q<<4,K=s<<4,p=n<<4,C=f<<4,J=r<<4,y=this.canvas.width,M=this.canvas.height,
A=this._data,w=Math.max(Math.min(a,c,e)+15>>4,0),I=Math.min(Math.max(a,c,e)+15>>4,y),u=Math.max(Math.min(b,d,g)+15>>4,0),M=Math.min(Math.max(b,d,g)+15>>4,M);if(!(I<=w||M<=u))for(a=n*a-l*b,c=f*c-q*d,e=r*e-s*g,(0>n||0==n&&0<l)&&a++,(0>f||0==f&&0<q)&&c++,(0>r||0==r&&0<s)&&e++,l=a+l*(u<<4)-n*(w<<4),q=c+q*(u<<4)-f*(w<<4),s=e+s*(u<<4)-r*(w<<4),n=u;n<M;n++){u=l;r=q;f=s;for(e=w;e<I;e++)0<u&&0<r&&0<f&&(g=e+n*y<<2,A[g]=k,A[g+1]=h,A[g+2]=m,A[g+3]=255),u-=p,r-=C,f-=J;l+=H;q+=t;s+=K}}})})();
(function(){Phoria.Scene=function(){this.camera={up:{x:0,y:1,z:0},lookat:{x:0,y:0,z:0},position:{x:0,y:0,z:-10}};this.perspective={fov:35,aspect:1,near:1,far:1E4};this.viewport={x:0,y:0,width:1024,height:1024};this.graph=[];this.triggerHandlers=[];return this};Phoria.Scene.create=function(a){var b=new Phoria.Scene;a.camera&&(b.camera=Phoria.Util.merge(b.camera,a.camera));a.perspective&&(b.perspective=Phoria.Util.merge(b.perspective,a.perspective));a.viewport&&(b.viewport=Phoria.Util.merge(b.viewport,
a.viewport));a.graph&&(b.graph=a.graph);if(a.onCamera)b.onCamera(a.onCamera);return b};Phoria.Scene.createFromJSON=function(a){if((a=JSON.parse(a))&&a.graph){var b=function(a){for(var d=0,e;d<a.length;d++){e=a[d];for(var g in e)e.hasOwnProperty(g)&&(g.indexOf("on"),"children"===g&&e[g]instanceof Array&&b(e[g]))}};b(a.graph)}return null};Phoria.Scene.toJSON=function(a){for(var b in a)a.hasOwnProperty(b)&&0===b.indexOf("_")&&delete a[b];if(a.graph){var c=function(a){for(var b=0,g;b<a.length;b++){g=
a[b];for(var k in g)if(g.hasOwnProperty(k))switch(0===k.indexOf("on")&&g[k]instanceof Array&&(g[k]=g[k].toString()),0===k.indexOf("_")&&delete g[k],k){case "textures":delete g[k];break;case "children":g[k]instanceof Array&&c(g[k])}}};c(a.graph)}return JSON.stringify(a)};Phoria.Scene.prototype={camera:null,perspective:null,graph:null,viewport:null,renderlist:null,lights:null,triggerHandlers:null,onCameraHandlers:null,_entities:null,_lastTime:0,_cameraPosition:null,_perspectiveScale:0,findEntity:function(a){return this._entities[a]},
onCamera:function(a){null===this.onCameraHandlers&&(this.onCameraHandlers=[]);this.onCameraHandlers=this.onCameraHandlers.concat(a)},modelView:function(){var a=Date.now(),b=(a-this._lastTime)/1E3;this._lastTime=a;var c=this.viewport.x,d=this.viewport.y,e=.5*this.viewport.width,g=.5*this.viewport.height;this._cameraPosition=vec4.fromValues(this.camera.position.x,this.camera.position.y,this.camera.position.z,0);var k=mat4.create(),a=vec4.fromValues(this.camera.lookat.x,this.camera.lookat.y,this.camera.lookat.z,
0),h=vec4.fromValues(this.camera.up.x,this.camera.up.y,this.camera.up.z,0);if(null!==this.onCameraHandlers)for(var m=0;m<this.onCameraHandlers.length;m++)this.onCameraHandlers[m].call(this,this._cameraPosition,a,h);mat4.lookAt(k,this._cameraPosition,a,h);var l=mat4.create();mat4.perspective(l,-this.perspective.fov*Phoria.RADIANS,this.perspective.aspect,this.perspective.near,this.perspective.far);this._perspectiveScale=(256-this.perspective.fov)/16;var q=[],s=[],n={},f=function(a,h){for(var m=0,p,
r;m<a.length;m++)if(p=a[m],!p.disabled){p.id&&(n[p.id]=p);if(null!==p.onBeforeSceneHandlers)for(r=0;r<p.onBeforeSceneHandlers.length;r++)p.onBeforeSceneHandlers[r].call(p,this,b);var J=p.matrix;h&&(J=J?mat4.multiply(mat4.create(),J,h):h);if(null!==p.onSceneHandlers)for(r=0;r<p.onSceneHandlers.length;r++)p.onSceneHandlers[r].call(p,this,J,b);if(p instanceof Phoria.BaseLight)s.push(p);else if(p instanceof Phoria.Entity){r=p.points.length;p.initCoordinateBuffers();var y=0,M=0;"point"===p.style.drawmode&&
(M=0===p.style.linescale?.5*p.style.linewidth:p.style.linewidth*p.style.linescale/this._perspectiveScale*.5);for(var A=0,w,I,u=0;A<r;A++)w=p.points[A],w=vec4.set(p._worldcoords[A],w.x,w.y,w.z,1),J&&vec4.transformMat4(p._worldcoords[A],w,J),vec4.transformMat4(p._cameracoords[A],p._worldcoords[A],k),vec4.transformMat4(p._coords[A],p._cameracoords[A],l),w=p._coords[A],I=w[3],0===I&&(I=Phoria.EPSILON),y+=p._clip[A]=w[0]>I+M||w[0]<-I-M||w[1]>I+M||w[1]<-I-M||w[2]>I||w[2]<-I?1:0,w[0]/=I,w[1]/=I,w[0]=e*w[0]+
c+e,w[1]=g*w[1]+d+g,u+=w[2];p._averagez=1<r?u/r:u;if(y!==r){switch(p.style.geometrysortmode){default:case "automatic":case "sorted":if("sorted"===p.style.geometrysortmode||"solid"===p.style.drawmode||"lightsource"===p.style.shademode)switch(p.style.drawmode){case "solid":Phoria.Util.sortPolygons(p.polygons,p._cameracoords);break;case "wireframe":Phoria.Util.sortEdges(p.edges,p._cameracoords);break;case "point":Phoria.Util.sortPoints(p._coords,p._worldcoords)}}if("solid"===p.style.drawmode&&0!==p.polygons.length)switch(r=
mat4.invert(mat4.create(),J?J:mat4.create()),mat4.transpose(r,r),p.style.shademode){case "lightsource":for(y=0;y<p.polygons.length;y++)p.polygons[y]._worldnormal||(p.polygons[y]._worldnormal=vec4.create()),M=p.polygons[y].normal,A=p.polygons[y]._worldnormal,vec3.transformMat4(A,M,r),vec3.normalize(A,A)}q.push(p)}}p.children&&0!==p.children.length&&f.call(this,p.children,J)}};f.call(this,this.graph,null);this.renderlist=q;this.lights=s;this._entities=n;for(var m=0,r=this.triggerHandlers.length;m<r;m++)this.triggerHandlers[m].trigger.call(this,
this._cameraPosition,a,h)&&(this.triggerHandlers.splice(m,1),r--)}}})();
(function(){Phoria.View={};Phoria.View.events={};Phoria.View.addMouseEvents=function(a,b){if(a.id){var c={velocityH:0,velocityLastH:0,positionX:0,clickPositionX:0,velocityV:0,velocityLastV:0,positionY:0,clickPositionY:0};Phoria.View.events[a.id]=c;c.onMouseMove=function(a){c.positionX=a.clientX;c.velocityH=c.velocityLastH+.5*(c.positionX-c.clickPositionX);c.positionY=a.clientY;c.velocityV=c.velocityLastV+.5*(c.positionY-c.clickPositionY)};c.onMouseUp=function(b){a.removeEventListener("mousemove",
c.onMouseMove,!1)};c.onMouseOut=function(b){a.removeEventListener("mousemove",c.onMouseMove,!1)};c.onMouseDown=function(b){b.preventDefault();a.addEventListener("mousemove",c.onMouseMove,!1);c.clickPositionX=b.clientX;c.velocityLastH=c.velocityH;c.clickPositionY=b.clientY;c.velocityLastV=c.velocityV};a.addEventListener("mousedown",c.onMouseDown,!1);a.addEventListener("mouseup",c.onMouseUp,!1);a.addEventListener("mouseout",c.onMouseOut,!1);b&&a.addEventListener("click",b,!1);return c}};Phoria.View.removeMouseEvents=
function(a,b){if(a.id){var c=Phoria.View.events[a.id];c&&(a.removeEventListener("mousemove",c.onMouseMove,!1),a.removeEventListener("mousedown",c.onMouseDown,!1),a.removeEventListener("mouseup",c.onMouseUp,!1),a.removeEventListener("mouseout",c.onMouseOut,!1),b&&a.removeEventListener("click",b,!1),Phoria.View.events[a.id]=null)}};Phoria.View.getMouse=function(a){return Phoria.View.events[a.id]};Phoria.View.calculateClickPointAndVector=function(a,b,c){var d=vec3.fromValues(a.camera.lookat.x,a.camera.lookat.y,
a.camera.lookat.z),e=vec3.subtract(vec3.create(),a._cameraPosition,d),g=a.viewport.height/2/(vec3.length(e)*Math.tan(a.perspective.fov/180*Math.PI/2));c=vec2.fromValues(b-a.viewport.width/2,c-a.viewport.height/2);vec2.subtract(c,c,new vec2.fromValues(8,8));b=vec2.create();vec2.scale(b,c,1/g);g=vec3.fromValues(a.camera.up.x,a.camera.up.y,a.camera.up.z);a=vec3.create();vec3.cross(a,e,g);vec3.normalize(a,a);g=vec3.scaleAndAdd(vec3.create(),d,a,b[0]);c=vec3.create();vec3.cross(c,a,e);vec3.normalize(c,
c);vec3.scale(c,c,b[1]);vec3.subtract(g,g,c);d=vec3.add(vec3.create(),d,e);return{clickPoint:g,clickVector:vec3.subtract(vec3.create(),g,d)}};Phoria.View.getIntersectedObjects=function(a,b,c){for(var d=[],e,g,k,h=a.renderlist,m=0;m<h.length;m++)if(e=h[m],"solid"===e.style.drawmode)for(var l=0;l<e.polygons.length;l++)g=vec3.clone(e.polygons[l]._worldnormal),k=vec3.clone(e._worldcoords[e.polygons[l].vertices[0]]),g=Phoria.Util.planeLineIntersection(g,k,c,b),null!==g&&Phoria.Util.intersectionInsidePolygon(e.polygons[l],
e._worldcoords,g)&&d.push({entity:e,polygonIndex:l,intersectionPoint:g});for(b=0;b<d.length;b++)d[b].distance=vec3.distance(a._cameraPosition,d[b].intersectionPoint);for(b=0;b<d.length-1;b++)for(a=b+1;a<d.length;a++)d[b].distance>=d[a].distance&&(c=d[a],d[a]=d[b],d[b]=c);return d}})();"use strict";var player={version:"0.20.0",rendered:!1,container:null,scene:null,renderer:null,obj3d:!1};player.local_supported=window.File&&window.FileReader&&window.FileList&&window.Blob;player.sample="data_example\n_cell_length_a 24\n_cell_length_b 5.91\n_cell_length_c 5.85\n_cell_angle_alpha 90\n_cell_angle_beta 90\n_cell_angle_gamma 90\n_symmetry_space_group_name_H-M 'P1'\nloop_\n_symmetry_equiv_pos_as_xyz\nx,y,z\nloop_\n_atom_site_label\n_atom_site_type_symbol\n_atom_site_fract_x\n_atom_site_fract_y\n_atom_site_fract_z\n_atom_site_charge\nO1 O 0.425 0.262 0.009 -2.0\nO2 O -0.425 0.262 0.009 -2.0\nH3 H 0.444 0.258 0.154 1.0\nH4 H -0.444 0.258 0.154 1.0\nH5 H 0.396 0.124 0.012 1.0\nH6 H -0.396 0.124 0.012 1.0\nO7 O 0.425 0.236 0.510 -2.0\nO8 O -0.425 0.236 0.510 -2.0\nH9 H 0.444 0.239 0.656 1.0\nH10 H -0.444 0.239 0.656 1.0\nH11 H 0.396 0.374 0.512 1.0\nH12 H -0.396 0.374 0.512 1.0\nSr13 Sr 0.342 0.964 0.467 2.0\nSr14 Sr -0.342 0.964 0.467 2.0\nSr15 Sr 0.342 0.535 0.967 2.0\nSr16 Sr -0.342 0.535 0.967 2.0\nO17 O 0.348 0.971 0.019 -2.0\nO18 O -0.348 0.971 0.019 -2.0\nO19 O 0.348 0.528 0.519 -2.0\nO20 O -0.348 0.528 0.519 -2.0\nO21 O 0.263 0.803 0.701 -2.0\nO22 O -0.263 0.803 0.701 -2.0\nO23 O 0.264 0.695 0.200 -2.0\nO24 O -0.264 0.695 0.200 -2.0\nZr25 Zr 0.261 0.000 0.998 4.0\nZr26 Zr -0.261 0.000 0.998 4.0\nZr27 Zr 0.261 0.499 0.498 4.0\nZr28 Zr -0.261 0.499 0.498 4.0\nO29 O 0.257 0.304 0.806 -2.0\nO30 O -0.257 0.304 0.806 -2.0\nO31 O 0.257 0.195 0.306 -2.0\nO32 O -0.257 0.195 0.306 -2.0\nSr33 Sr 0.173 0.993 0.524 2.0\nSr34 Sr -0.173 0.993 0.524 2.0\nSr35 Sr 0.173 0.506 0.024 2.0\nSr36 Sr -0.173 0.506 0.024 2.0\nO37 O 0.173 0.947 0.986 -2.0\nO38 O -0.173 0.947 0.986 -2.0\nO39 O 0.173 0.551 0.486 -2.0\nO40 O -0.173 0.551 0.486 -2.0\nO41 O 0.098 0.204 0.295 -2.0\nO42 O -0.098 0.204 0.295 -2.0\nO43 O 0.098 0.295 0.795 -2.0\nO44 O -0.098 0.295 0.795 -2.0\nZr45 Zr 0.086 0.004 0.998 4.0\nZr46 Zr -0.086 0.004 0.998 4.0\nZr47 Zr 0.086 0.495 0.498 4.0\nZr48 Zr -0.086 0.495 0.498 4.0\nO49 O 0.074 0.709 0.211 -2.0\nO50 O -0.074 0.709 0.211 -2.0\nO51 O 0.074 0.790 0.711 -2.0\nO52 O -0.074 0.790 0.711 -2.0\nSr53 Sr 0 0.991 0.467 2.0\nSr54 Sr 0 0.508 0.967 2.0\nO55 O 0 0.076 0.020 -2.0\nO56 O 0 0.423 0.520 -2.0";
function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});function isScalar(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isVector(a){return Array.isArray(a)&&!Array.isArray(a[0])?!0:!1}function isMatrix(a){return Array.isArray(a)&&Array.isArray(a[0])?!0:!1}
var Mimpl={norm:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},divide:function(a,b){if(isScalar(a)&&isScalar(b))return parseFloat(a)/parseFloat(b);isScalar(a)?a=[a,a,a]:isScalar(b)&&(b=[b,b,b]);return vec3.divide([0,0,0],a,b)},subtract:function(a,b){if(isScalar(a)&&isScalar(b))return a-b;isScalar(a)?a=[a,a,a]:isScalar(b)&&(b=[b,b,b]);return vec3.subtract([0,0,0],a,b)},dot:function(a,b){return vec3.dot(a,b)},cross:function(a,b){isScalar(a)?a=[a,a,a]:isScalar(b)&&(b=[b,b,b]);return vec3.cross([0,
0,0],a,b)},multiply:function(a,b){if(isScalar(a)&&isScalar(b))return a*b;if(isScalar(a)&&isVector(b))return vec3.multiply([0,0,0],[a,a,a],b);if(isVector(a)&&isScalar(b))return vec3.multiply([0,0,0],a,[b,b,b]);if(isVector(a)&&isVector(b))return vec3.multiply([0,0,0],a,b);if(isMatrix(a)&&isScalar(b))return[[a[0][0]*b,a[0][1]*b,a[0][2]*b],[a[1][0]*b,a[1][1]*b,a[1][2]*b],[a[2][0]*b,a[2][1]*b,a[2][2]*b]];if(isMatrix(a)&&isMatrix(b)){var c=mat3.multiply([0,0,0,0,0,0,0,0,0],[a[0][0],a[0][1],a[0][2],a[1][0],
a[1][1],a[1][2],a[2][0],a[2][1],a[2][2]],[b[0][0],b[0][1],b[0][2],b[1][0],b[1][1],b[1][2],b[2][0],b[2][1],b[2][2]]);return[[c[0],c[1],c[2]],[c[3],c[4],c[5]],[c[6],c[7],c[8]]]}return isVector(a)&&isMatrix(b)?[a[0]*b[0][0]+a[1]*b[1][0]+a[2]*b[2][0],a[0]*b[0][1]+a[1]*b[1][1]+a[2]*b[2][1],a[0]*b[0][2]+a[1]*b[1][2]+a[2]*b[2][2]]:null},cos:Math.cos,sin:Math.sin,sqrt:Math.sqrt};
function cancel_event(a){a=a||window.event;a.cancelBubble?a.cancelBubble=!0:(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())}var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1E3/60)};
function notify(a){if(window.parent&&window.parent.wmgui&&window.parent.wmgui.notify)window.parent.wmgui.notify(a);else{var b=document.getElementById("notifybox"),c=document.getElementById("message");b.style.display="block";c.innerHTML="";setTimeout(function(){c.innerHTML=a},250)}}function create_box(a,b){var c=document.createElement("div");c.setAttribute("id",a);b&&(c.innerHTML=b);document.body.appendChild(c);return c}
function draw_3d_line(a,b,c){c||(c=[225,225,225]);player.scene.graph.push(Phoria.Entity.create({points:[{x:1.25*a[0],y:1.25*a[1],z:1.25*a[2]},{x:1.25*b[0],y:1.25*b[1],z:1.25*b[2]}],edges:[{a:0,b:1}],style:{color:c,drawmode:"wireframe",shademode:"plain",fillmode:"fill",geometrysortmode:"none",objectsortmode:"sorted",linewidth:.75}}))}
function init(){player.container=document.getElementById("player");var a=window.innerWidth,b=window.innerHeight;player.container.setAttribute("width",a);player.container.setAttribute("height",b);player.scene=new Phoria.Scene;player.scene.camera.position={x:0,y:0,z:-30};player.scene.camera.lookat={x:0,y:0,z:0};player.scene.perspective.aspect=a/b;player.scene.viewport.width=a;player.scene.viewport.height=b;player.renderer=new Phoria.CanvasRenderer(player.container);render()}
function render(){var a=player.scene.graph.length,b=player.container.getContext("2d");for(a;0<a;a--)player.scene.graph.pop();b.clearRect(0,0,player.container.width,player.container.height);(a=document.getElementById("infopanel"))&&a.parentNode.removeChild(a);player.obj3d.descr&&create_box("infopanel","<span style=color:#900><i>a</i>="+(Math.round(1E3*parseFloat(player.obj3d.descr.a))/1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#090><i>b</i>="+(Math.round(1E3*parseFloat(player.obj3d.descr.b))/
1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#09f><i>c</i>="+(Math.round(1E3*parseFloat(player.obj3d.descr.c))/1E3).toFixed(3)+"&#8491;</span><br /><i>&#945;</i>="+(Math.round(100*parseFloat(player.obj3d.descr.alpha))/100).toFixed(2)+"&deg;<br /><i>&#946;</i>="+(Math.round(100*parseFloat(player.obj3d.descr.beta))/100).toFixed(2)+"&deg;<br /><i>&#947;</i>="+(Math.round(100*parseFloat(player.obj3d.descr.gamma))/100).toFixed(2)+"&deg;<br />");if(player.obj3d.cell.length){for(var c,b=[],a=0;3>
a;a++){var d=parseFloat(player.obj3d.cell[a][0]),e=parseFloat(player.obj3d.cell[a][1]),g=parseFloat(player.obj3d.cell[a][2]);b.push([d,e,g]);0==a?c=[255,0,0]:1==a?c=[0,255,0]:2==a&&(c=[0,225,255]);draw_3d_line([0,0,0],[d,e,g],c)}a=[b[0][0]+b[1][0],b[0][1]+b[1][1],b[0][2]+b[1][2]];c=[b[0][0]+b[2][0],b[0][1]+b[2][1],b[0][2]+b[2][2]];d=[a[0]+b[2][0],a[1]+b[2][1],a[2]+b[2][2]];e=[b[1][0]+b[2][0],b[1][1]+b[2][1],b[1][2]+b[2][2]];draw_3d_line(b[0],a);draw_3d_line(b[0],c);draw_3d_line(b[1],e);draw_3d_line(b[1],
a);draw_3d_line(b[2],e);draw_3d_line(b[2],c);draw_3d_line(a,d);draw_3d_line(c,d);draw_3d_line(d,e)}b={};a=0;c=player.obj3d.atoms.length;for(a;a<c;a++){d=player.obj3d.atoms[a].overlays.S;b[d]||(e=1.25>player.obj3d.atoms[a].r?[7,9]:[9,10],b[d]=Phoria.Util.generateSphere(player.obj3d.atoms[a].r,e[0],e[1]));var e=parseFloat(1.25*player.obj3d.atoms[a].x),g=parseFloat(1.25*player.obj3d.atoms[a].y),k=parseFloat(1.25*player.obj3d.atoms[a].z),h=hexToRgb(player.obj3d.atoms[a].c),d=Phoria.Entity.create({id:d,
points:b[d].points,polygons:b[d].polygons,style:{color:h,diffuse:.5}});player.scene.graph.push(d);d.translateX(e).translateY(g).translateZ(k);Phoria.Entity.debug(d,{showId:!0})}a=Phoria.Entity.create({points:[{x:0,y:0,z:-30}],style:{color:[255,255,255],drawmode:"point",shademode:"plain",linewidth:5,linescale:2}});player.scene.graph.push(a);b=Phoria.PointLight.create({position:{x:0,y:0,z:-30},intensity:1,attenuation:.01});a.children.push(b);a=Phoria.Entity.create({points:[{x:0,y:0,z:200}],style:{color:[255,
255,255],drawmode:"point",shademode:"plain",linewidth:5,linescale:2}});player.scene.graph.push(a);b=Phoria.PointLight.create({position:{x:0,y:0,z:200},intensity:3.5,attenuation:.01});a.children.push(b);if(!player.rendered){var m=null,l=null,q=Phoria.View.addMouseEvents(player.container,function(){var a=Phoria.View.calculateClickPointAndVector(player.scene,q.clickPositionX,q.clickPositionY),a=Phoria.View.getIntersectedObjects(player.scene,a.clickPoint,a.clickVector);null!==m&&(m.style.color=m.oldcolor,
m.style.emit=0,m=null);0!==a.length&&(a=a[0].entity,a.oldcolor=a.style.color,a.style.color=[255,255,255],a.style.emit=.5,m=a,clearInterval(l),l=setTimeout(function(){null!==m&&(m.style.color=m.oldcolor,m.style.emit=0,m=null)},300))});player.scene.onCamera(function(a,b,c){b=mat4.create();mat4.rotateY(b,b,Math.sin(Date.now()/2E4)*Phoria.RADIANS*360);vec4.transformMat4(a,a,b)})}player.rendered=!0;var s=function(){player.scene.modelView();player.renderer.render(player.scene);requestAnimationFrame(s)};
requestAnimationFrame(s)}function url_redraw_react(){var a=document.location.hash.substr(1);if(-1==a.indexOf("://"))return player.rendered||display_landing(),notify("Error: not a valid url!");ajax_download(a)}function display_landing(){player.local_supported?document.getElementById("landing").style.display="block":play_demo()}function play_demo(a){cancel_event(a);accept_data(player.sample,!1)}
function direct_download(){var a=document.location.hash.substr(1);-1!=a.indexOf("://")&&window.open(a,"d_"+Math.random())}function ajax_download(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&(200==b.status?accept_data(b.responseText,!0):(notify("Error: HTTP "+b.status+" status received during retrieving data from the server"),player.rendered||display_landing()))};b.open("GET",a);b.send(1)}
function accept_data(a,b){player.obj3d=MatinfIO.to_player(a);player.obj3d?(document.getElementById("landing").style.display="none",player.rendered?render():init(),player.obj3d.info&&(document.title=player.obj3d.info)):player.rendered||display_landing()}
function handleFileSelect(a){cancel_event(a);if(1<a.dataTransfer.files.length)return notify("Error: only one file at the time may be rendered!");a=a.dataTransfer.files[0];if(!a||!a.size)return notify("Error: file cannot be read (unaccessible?)");var b=new FileReader;b.onloadend=function(a){accept_data(a.target.result,!1)};b.abort=function(){notify("Error: file reading has been cancelled!")};b.onerror=function(a){notify("Error: file reading has been cancelled: "+a.target.error.name)};b.readAsText(a)}
function handleDragOver(a){cancel_event(a);a.dataTransfer.dropEffect="copy"}
docReady(function(){var a=create_box("notifybox",'<div id="cross"></div><div id="message"></div>');document.getElementById("cross").onclick=function(){a.style.display="none"};create_box("versionbox","v"+player.version);create_box("cmdbox","Load new").onclick=display_landing;create_box("landing",'<h1>Materials Informatics Web-viewer</h1><div id="legend">Choose a <b>CIF</b> or <b>POSCAR</b> file (drag <b><i>&</i></b> drop is supported). Files are processed offline in the browser, no remote server is used. <a href="/" id="play_demo">Example</a>.</div><div id="triangle"></div><input type="file" id="fileapi" />');document.getElementById("play_demo").onclick=
play_demo;MatinfIO=MatinfIO(Mimpl,{warning:notify,error:notify});window.addEventListener("hashchange",url_redraw_react,!1);if(player.local_supported){window.addEventListener("dragover",handleDragOver,!1);window.addEventListener("drop",handleFileSelect,!1);var b=document.getElementById("fileapi"),c=new FileReader;b.onchange=function(){if(!this.files[0]||!this.files[0].size)return notify("Error: file cannot be read (unaccessible?)");c.currentFilename=this.files[0].name;c.readAsText(this.files[0])};
c.onloadend=function(a){accept_data(a.target.result,!1)}}window.parent&&window.parent.playerdata?(b="object"===typeof window.parent.playerdata&&document.location.search?window.parent.playerdata[document.location.search.substr(1)]:window.parent.playerdata,accept_data(b,!1)):document.location.hash.length?url_redraw_react():display_landing()});
</script>
</head>
<body>
<canvas id="player"></canvas>
</body>
</html>
