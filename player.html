<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" />
<title>3d-crystals web-viewer</title>
<style>
body{margin:0;padding:0;overflow:hidden;font-family:Palatino;}
html, body{height:100%;text-size-adjust:100%;}
#player{z-index:2;position:fixed;cursor:move;}
#infopanel{position:fixed;top:20px;left:8px;width:150px;height:150px;text-align:left;z-index:3;line-height:22px;font-size:0.9em;color:#888;}
#exitpanel{position:fixed;top:6px;right:6px;width:24px;height:24px;z-index:3;cursor:pointer;background:url(data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///1VVVf///yH5BAEAAAMALAAAAAAQABAAAAIjnI+py6L+BDRy0gqxHVqvLjGcJ3Yl+IEhQpLX+m7wMYv2PRQAOw==) center center no-repeat;}
#zoompanel{position:fixed;top:90px;right:6px;width:50px;height:102px;z-index:3;cursor:pointer;background:no-repeat url(data:image/gif;base64,R0lGODlhMgBmAKEBAAAAAP///8zMzP///yH5BAEKAAMALAAAAAAyAGYAAAL+nI+py+0uopzi2UtzvhxNLHXWJ4YiY55Gqg6sRzVvNx+bHKk5FPNV+cOReMBR77EzgoY+0LK2SOI4N2MQdfVBo9mEFHlUTqlhcNd2xjLFXLTmDWd+Ye64vepK5+v3/nWOxudnR4clOAhX2Ea2Bjb2BPioEMnVSGTIuDVJqQljiSmpRblpBqnnNZp3Kki2ZNW5khq7qgoL62bW+akmunqLqocHLFvZctiyq1VLu/m7zKcj7DlTljmoRoyd2Gs8zczaHb78La6dXd6cjC6kvl7p7D4LH19LH21cbT+8rT/+fk7jVruA5DyVm2ewG8BQAd0t3BMPIMJSrexle9iQjcWCVBiLXOoHkSG9LR1PcCqoMFgQRH4UkZLHkl/Il+Ni4jl5yKYclTl1SsEJ0+dOkRuJjlSJMtqpkow+9uPIlKLTo7QmWmkaUWJSqU/QDRwmLt+rlGJzoYxRlh2xKmnVvniTbmvNOGrDETIr12tbkP749sobVprfY4P/Aba7F+RXxT8KAAA7);}
#optionpanel{position:fixed;bottom:4px;left:0;width:100%;height:20px;z-index:3;text-align:center;font-size:1.1em;}
#optionpanel input{margin:4px 2px 0 2px;cursor:pointer;}
#optionpanel label{line-height:22px;vertical-align:top;cursor:pointer;color:#666;}
#landing{display:none;position:fixed;left:0;top:0;right:0;bottom:0;height:auto;z-index:8;background:#fff;margin:0;text-align:center;font-size:1.25em;padding:20px;line-height:1.6em;}
#landing a{color:#666;text-decoration:none;border-bottom:1px solid #999;}
h1{margin:20px auto 35px;font-size:1.5em;color:#999;}
#legend{width:290px;margin:20px auto 0;border-radius:15px;background:#f0f0f0;color:#666;padding:5px;}
#triangle{width:0;height:0;margin:-2px auto 20px;border-left:20px solid transparent;border-right:20px solid transparent;border-top:20px solid #f0f0f0;}
#notifybox{display:none;z-index:9;position:fixed;top:4px;left:4px;width:500px;background:#333;color:#fff;font-weight:bold;border-radius:5px;}
#cross{float:right;width:24px;height:24px;cursor:pointer;background:url(data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///1VVVf///yH5BAEAAAMALAAAAAAQABAAAAIjnI+py6L+BDRy0gqxHVqvLjGcJ3Yl+IEhQpLX+m7wMYv2PRQAOw==) center center no-repeat;}
#message{margin:20px;}
#fileapi{color:#999;}
#demobox{display:none;position:fixed;z-index:7;top:2px;left:50%;width:500px;height:20px;margin-left:-250px;font-size:0.7em;text-align:center;line-height:20px;}
#preloader{z-index:1;position:fixed;top:50%;left:50%;margin-left:-63px;width:125px;height:60px;font-size:10px;}
#preloader > div {height:100%;width:15px;display:inline-block;margin:0 5px;background:#666;-webkit-animation:stretchdelay 1.2s infinite ease-in-out;animation:stretchdelay 1.2s infinite ease-in-out;}
#preloader > div.rect1 {background:#6d55ae;}
#preloader > div.rect2 {background:#ffb302;-webkit-animation-delay:-1.1s;animation-delay:-1.1s;}
#preloader > div.rect3 {background:#f44c4d;-webkit-animation-delay:-1.0s;animation-delay:-1.0s;}
#preloader > div.rect4 {background:#acc2b3;-webkit-animation-delay:-0.9s;animation-delay:-0.9s;}
#preloader > div.rect5 {background:#6d55ae;-webkit-animation-delay:-0.8s;animation-delay:-0.8s;}
@-webkit-keyframes stretchdelay {
0%, 40%, 100% { -webkit-transform: scaleY(0.4) }
20% { -webkit-transform: scaleY(1.0) }}
@keyframes stretchdelay {
0%, 40%, 100% {
transform: scaleY(0.4);
-webkit-transform: scaleY(0.4);
} 20% {
transform: scaleY(1.0);
-webkit-transform: scaleY(1.0);
}}
@media all and (max-width:570px){#demobox{visibility:hidden;}}
</style>
</head>
<body>
<div id="preloader"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>
<div id="demobox">You are using demo version. Space group is not shown.</div>
<script type="text/javascript">
'use strict';var player=function(Z){function aa(x){if(ga[x])return ga[x].exports;var h=ga[x]={exports:{},id:x,loaded:!1};Z[x].call(h.exports,h,h.exports,aa);h.loaded=!0;return h.exports}var ga={};aa.m=Z;aa.c=ga;aa.p="";return aa(0)}([function(Z,aa,ga){!function(){var x=[ga(1),ga(3),ga(5)];(function(h,l,v){function b(a){a=a||window.event;a.cancelBubble?a.cancelBubble=!0:(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())}function a(a){if(t.mpds_integration)window.parent.wmgui.notify(a),
window.parent.close_vibox();else{var d=document.getElementById("notifybox"),b=document.getElementById("message");d.style.display="block";b.innerHTML="";setTimeout(function(){b.innerHTML=a},250)}}function d(a){t.mpds_integration?window.parent.wmgui.notify(a):alert(a)}function c(a,d){var b=document.createElement("div");b.setAttribute("id",a);d&&(b.innerHTML=d);document.body.appendChild(b);return b}function e(a,d,b){b||(b=14540253);var c=new A.Geometry;c.vertices.push(new A.Vector3(a[0],a[1],a[2]));
c.vertices.push(new A.Vector3(d[0],d[1],d[2]));a=new A.LineBasicMaterial({color:b});t.atombox.add(new A.Line(c,a))}function f(a){var d=document.createElement("canvas"),b=d.getContext("2d"),c=3.5*b.measureText(a).width;d.width=c;d.height=30;b.font="normal 30px Palatino";b.textAlign="center";b.textBaseline="middle";b.fillStyle="W"==t.colorset?"#000":"#fff";b.fillText(a,d.width/2,d.height/2);a=new A.Texture(d);a.needsUpdate=!0;a=new A.SpriteMaterial({map:a,depthTest:!1});a=new A.Sprite(a);a.renderOrder=
1;d=new A.Object3D;a.scale.set(c,30,1);d.add(a);d.name="label";return d}function g(){t.loaded=!0;t.container=c("player");t.scene=new A.Scene;t.camera=new A.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,2E4);t.camera.position.set(0,0,1800);var a=new A.AmbientLight(10066329);t.scene.add(a);a=new A.PointLight(6710886,1);a.position.set(1500,1500,1500);t.scene.add(a);t.renderer=t.webgl?new A.WebGLRenderer({antialias:!0,alpha:!0}):new A.CanvasRenderer;"W"==t.colorset?t.renderer.setClearColor(16777215,
1):t.renderer.setClearColor(0,1);t.renderer.setPixelRatio(window.devicePixelRatio);t.renderer.setSize(window.innerWidth,window.innerHeight);t.container.appendChild(t.renderer.domElement);c("zoompanel").onclick=function(a){b(a);a=a.pageY?a.pageY:a.clientY;var d=document.getElementById("zoompanel").offsetTop;t.camera.fov-=7.5*(50>a-d?1:-1);t.camera.updateProjectionMatrix()};t.mpds_integration&&(c("exitpanel").onclick=function(){window.parent.close_vibox()});t.controls=new A.TrackballControls(t.camera);
t.controls.rotateSpeed=7.5;t.controls.staticMoving=!0;m()}function m(){var a=t.scene.getObjectByName("atombox");if(a){t.scene.remove(a);for(var d=a.children.length-1;0<=d;d--){var b=a.children[d];b.geometry&&b.geometry.dispose();b.material&&b.material.dispose();b.dispose&&b.dispose()}t.controls.reset()}t.atombox=new A.Object3D;(a=document.getElementById("infopanel"))&&a.parentNode.removeChild(a);t.obj3d.descr&&(a=t.obj3d.mpds_data?"":t.obj3d.descr.symlabel?"<i>SG</i> "+t.obj3d.descr.symlabel:"",c("infopanel",
"<span style=color:#900><i>a</i>="+(Math.round(1E3*parseFloat(t.obj3d.descr.a))/1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#090><i>b</i>="+(Math.round(1E3*parseFloat(t.obj3d.descr.b))/1E3).toFixed(3)+"&#8491;</span><br /><span style=color:#09f><i>c</i>="+(Math.round(1E3*parseFloat(t.obj3d.descr.c))/1E3).toFixed(3)+"&#8491;</span><br /><i>&#945;</i>="+(Math.round(100*parseFloat(t.obj3d.descr.alpha))/100).toFixed(2)+"&deg;<br /><i>&#946;</i>="+(Math.round(100*parseFloat(t.obj3d.descr.beta))/
100).toFixed(2)+"&deg;<br /><i>&#947;</i>="+(Math.round(100*parseFloat(t.obj3d.descr.gamma))/100).toFixed(2)+"&deg;<br />"+a));(a=document.getElementById("optionpanel"))&&a.parentNode.removeChild(a);a=c("optionpanel","<input type=radio name=optionpanel class=optionpanel id=optionpanel_empty /><label for=optionpanel_empty>none</label>  <input type=radio name=optionpanel class=optionpanel id=optionpanel_S checked=checked /><label for=optionpanel_S>elements</label>");if(Object.keys(t.obj3d.overlayed).length)for(var m in t.obj3d.overlayed)a.innerHTML+=
"  <input type=radio name=optionpanel class=optionpanel id=optionpanel_"+m+" /><label for=optionpanel_"+m+">"+t.obj3d.overlayed[m]+"</label>",t.available_overlays.push(m);a=document.getElementsByClassName("optionpanel");for(m=a.length-1;0<=m;m--)a[m].onclick=function(){var a=this.id.replace("optionpanel_","");if(-1!==t.available_overlays.indexOf(a)){for(var d=t.scene.getObjectByName("atombox"),d=d.children,b=d.filter(function(a){return"label"==a.name}),c=0,e=b.length;c<e;c++)t.atombox.remove(b[c]),
t.scene.remove(b[c]);if("empty"!==a){d=d.filter(function(a){return"atom"==a.name});e=d.length;for(c=0;c<e;c++)b=f(d[c].overlays[a]),b.position.set(d[c].position.x,d[c].position.y,d[c].position.z),t.atombox.add(b);t.current_overlay=a}}t.renderer.render(t.scene,t.camera)};t.current_overlay=t.default_overlay;d=t.webgl?{w:10,h:8}:{w:8,h:6};m=0;for(a=t.obj3d.atoms.length;m<a;m++){var b=parseInt(100*t.obj3d.atoms[m].x),k=parseInt(100*t.obj3d.atoms[m].y),g=parseInt(100*t.obj3d.atoms[m].z),p=new A.Mesh(new A.SphereBufferGeometry(65*
t.obj3d.atoms[m].r,d.w,d.h),new A.MeshLambertMaterial({color:t.obj3d.atoms[m].c,overdraw:.75}));p.position.set(b,k,g);p.name="atom";p.overlays=t.obj3d.atoms[m].overlays;t.atombox.add(p);"empty"!==t.current_overlay&&(p=f(p.overlays[t.current_overlay]),p.position.set(b,k,g),t.atombox.add(p))}if(t.obj3d.cell.length){var q,a=[];for(m=0;3>m;m++)d=Math.round(1E3*parseFloat(t.obj3d.cell[m][0]))/10,b=Math.round(1E3*parseFloat(t.obj3d.cell[m][1]))/10,k=Math.round(1E3*parseFloat(t.obj3d.cell[m][2]))/10,a.push([d,
b,k]),0==m?q=10027008:1==m?q=39168:2==m&&(q=39423),t.atombox.add(new A.ArrowHelper((new A.Vector3(d,b,k)).normalize(),new A.Vector3(0,0,0),Math.sqrt(d*d+b*b+k*k),q,75,10));m=[a[0][0]+a[1][0],a[0][1]+a[1][1],a[0][2]+a[1][2]];d=[a[0][0]+a[2][0],a[0][1]+a[2][1],a[0][2]+a[2][2]];b=[m[0]+a[2][0],m[1]+a[2][1],m[2]+a[2][2]];k=[a[1][0]+a[2][0],a[1][1]+a[2][1],a[1][2]+a[2][2]];q=[];q.push([a[0],m]);q.push([a[0],d]);q.push([a[1],k]);q.push([a[1],m]);q.push([a[2],k]);q.push([a[2],d]);q.push([m,b]);q.push([d,
b]);q.push([b,k]);m=0;for(a=q.length;m<a;m++)e(q[m][0],q[m][1])}t.atombox.name="atombox";t.scene.add(t.atombox);y()}function p(){t.loaded&&(t.camera.aspect=window.innerWidth/window.innerHeight,t.camera.updateProjectionMatrix(),t.renderer.setSize(window.innerWidth,window.innerHeight),t.controls.handleResize(),y())}function y(){B(y);t.renderer.render(t.scene,t.camera);t.controls.update()}function C(){var d=document.location.hash.substr(1);if(-1==d.indexOf("://"))return t.loaded||q(),a("Error: not a valid url!");
k(d)}function q(){if(t.local_supported){var a=document.getElementById("landing");"B"==t.colorset&&(a.style.background="#222");a.style.display="block"}else u()}function u(a){b(a);n(t.sample,!1)}function k(d){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&(200==b.status?n(b.responseText,!0):(a("Error: HTTP "+b.status+" status received during retrieving data from the server"),t.loaded||q()))};b.open("GET",d);b.send(1)}
function n(a,d){t.obj3d=h.to_player(a);t.obj3d?(document.getElementById("landing").style.display="none",t.loaded?m():g(),t.obj3d.info&&(document.title=t.obj3d.info),document.getElementById("demobox").style.display=t.obj3d.mpds_data&&t.obj3d.mpds_demo?"block":"none"):t.loaded||q()}function r(d){b(d);if(1<d.dataTransfer.files.length)return a("Error: only one file at the time may be rendered!");d=d.dataTransfer.files[0];if(!d||!d.size)return a("Error: file cannot be read (unaccessible?)");var c=new FileReader;
c.onloadend=function(a){n(a.target.result,!1)};c.abort=function(){a("Error: file reading has been cancelled!")};c.onerror=function(d){a("Error: file reading has been cancelled: "+d.target.error.name)};c.readAsText(d)}function s(a){b(a);a.dataTransfer.dropEffect="copy"}var t={version:"0.17.0",loaded:!1,container:null,stats:null,camera:null,scene:null,renderer:null,controls:null,atombox:null,available_overlays:["empty","S","N"],default_overlay:"S"};t.current_overlay=t.default_overlay;t.obj3d=!1;t.local_supported=
window.File&&window.FileReader&&window.FileList&&window.Blob;t.mpds_integration=window.parent&&window.parent.wmgui;t.webgl=function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(d){return!1}}();t.colorset="W";t.sample="data_example\n_cell_length_a 24\n_cell_length_b 5.91\n_cell_length_c 5.85\n_cell_angle_alpha 90\n_cell_angle_beta 90\n_cell_angle_gamma 90\n_symmetry_space_group_name_H-M 'P1'\nloop_\n_symmetry_equiv_pos_as_xyz\nx,y,z\nloop_\n_atom_site_label\n_atom_site_type_symbol\n_atom_site_fract_x\n_atom_site_fract_y\n_atom_site_fract_z\n_atom_site_charge\nO1 O 0.425 0.262 0.009 -2.0\nO2 O -0.425 0.262 0.009 -2.0\nH3 H 0.444 0.258 0.154 1.0\nH4 H -0.444 0.258 0.154 1.0\nH5 H 0.396 0.124 0.012 1.0\nH6 H -0.396 0.124 0.012 1.0\nO7 O 0.425 0.236 0.510 -2.0\nO8 O -0.425 0.236 0.510 -2.0\nH9 H 0.444 0.239 0.656 1.0\nH10 H -0.444 0.239 0.656 1.0\nH11 H 0.396 0.374 0.512 1.0\nH12 H -0.396 0.374 0.512 1.0\nSr13 Sr 0.342 0.964 0.467 2.0\nSr14 Sr -0.342 0.964 0.467 2.0\nSr15 Sr 0.342 0.535 0.967 2.0\nSr16 Sr -0.342 0.535 0.967 2.0\nO17 O 0.348 0.971 0.019 -2.0\nO18 O -0.348 0.971 0.019 -2.0\nO19 O 0.348 0.528 0.519 -2.0\nO20 O -0.348 0.528 0.519 -2.0\nO21 O 0.263 0.803 0.701 -2.0\nO22 O -0.263 0.803 0.701 -2.0\nO23 O 0.264 0.695 0.200 -2.0\nO24 O -0.264 0.695 0.200 -2.0\nZr25 Zr 0.261 0.000 0.998 4.0\nZr26 Zr -0.261 0.000 0.998 4.0\nZr27 Zr 0.261 0.499 0.498 4.0\nZr28 Zr -0.261 0.499 0.498 4.0\nO29 O 0.257 0.304 0.806 -2.0\nO30 O -0.257 0.304 0.806 -2.0\nO31 O 0.257 0.195 0.306 -2.0\nO32 O -0.257 0.195 0.306 -2.0\nSr33 Sr 0.173 0.993 0.524 2.0\nSr34 Sr -0.173 0.993 0.524 2.0\nSr35 Sr 0.173 0.506 0.024 2.0\nSr36 Sr -0.173 0.506 0.024 2.0\nO37 O 0.173 0.947 0.986 -2.0\nO38 O -0.173 0.947 0.986 -2.0\nO39 O 0.173 0.551 0.486 -2.0\nO40 O -0.173 0.551 0.486 -2.0\nO41 O 0.098 0.204 0.295 -2.0\nO42 O -0.098 0.204 0.295 -2.0\nO43 O 0.098 0.295 0.795 -2.0\nO44 O -0.098 0.295 0.795 -2.0\nZr45 Zr 0.086 0.004 0.998 4.0\nZr46 Zr -0.086 0.004 0.998 4.0\nZr47 Zr 0.086 0.495 0.498 4.0\nZr48 Zr -0.086 0.495 0.498 4.0\nO49 O 0.074 0.709 0.211 -2.0\nO50 O -0.074 0.709 0.211 -2.0\nO51 O 0.074 0.790 0.711 -2.0\nO52 O -0.074 0.790 0.711 -2.0\nSr53 Sr 0 0.991 0.467 2.0\nSr54 Sr 0 0.508 0.967 2.0\nO55 O 0 0.076 0.020 -2.0\nO56 O 0 0.423 0.520 -2.0";
var A=v.THREE||v,B=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1E3/60)};(function(){t.webgl=!0;var b=c("notifybox",'<div id="cross"></div><div id="message"></div>');document.getElementById("cross").onclick=function(){b.style.display="none"};c("landing",'<h1>3d-crystals web-viewer</h1><div id="legend">Choose a <b>CIF</b>, <b>POSCAR</b>, or <b>OPTIMADE JSON</b> file (drag and drop is supported). Files are processed offline in the browser, no remote server is used. <a href=/ id="play_demo">Example</a>.</div><div id="triangle"></div><input type="file" id="fileapi" />');
document.getElementById("play_demo").onclick=u;h=h(l,{warning:d,error:a});window.addEventListener("resize",p,!1);window.addEventListener("hashchange",C,!1);if(t.local_supported){window.addEventListener("dragover",s,!1);window.addEventListener("drop",r,!1);var e=document.getElementById("fileapi"),f=new FileReader;e.onchange=function(){if(!this.files[0]||!this.files[0].size)return a("Error: file cannot be read (unaccessible?)");f.currentFilename=this.files[0].name;f.readAsText(this.files[0])};f.onloadend=
function(a){n(a.target.result,!1)}}window.parent&&window.parent.playerdata?(e="object"===typeof window.parent.playerdata&&document.location.search?window.parent.playerdata[document.location.search.substr(1)]:window.parent.playerdata,n(e,!1)):document.location.hash.length?C():q()})()}).apply(null,x)}()},function(Z,aa,ga){"use strict";String.prototype.startswith=function(x){return 0===this.indexOf(x)};String.prototype.endswith=function(x,h){var l=this.toString();if(void 0===h||h>l.length)h=l.length;
h-=x.length;l=l.indexOf(x,h);return-1!==l&&l===h};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};aa=function(x,h){function l(a){if(0<a.indexOf("_cell_angle_gamma ")&&0<a.indexOf("loop_"))return"CIF";if(0<a.indexOf('"links"')&&0<a.indexOf('"immutable_id"')&&0<a.indexOf('"cartesian_site_positions"'))return"OPTIMADE";a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");for(var d=6;9>d&&a[d];d++)if("direct"==
a[d].trim().toLowerCase().substr(0,6))return"POSCAR";return"unknown"}function v(a,d,b,c,e,f){if(!(a&&d&&b&&c&&e&&f))return h.error("Error: invalid cell definition!"),!1;c=c*Math.PI/180;e=e*Math.PI/180;f=f*Math.PI/180;var k=[0,0,1],g=[1,0,0],k=x.divide(k,x.norm(k)),g=x.subtract(g,x.multiply(x.dot(g,k),k)),g=x.divide(g,x.norm(g)),r=x.cross(k,g);a=x.multiply(a,[1,0,0]);d=x.multiply(d,[x.cos(f),x.sin(f),0]);var s=x.cos(e);c=x.divide(x.subtract(x.cos(c),x.multiply(x.cos(e),x.cos(f))),x.sin(f));e=x.sqrt(x.subtract(x.subtract(1,
x.multiply(s,s)),x.multiply(c,c)));b=x.multiply(b,[s,c,e]);return x.multiply([a,d,b],[g,r,k])}function b(a){var d,b=!1;if(6==Object.keys(a.cell).length){d=v(a.cell.a,a.cell.b,a.cell.c,a.cell.alpha,a.cell.beta,a.cell.gamma);var b=a.cell,c=a.sg_name||a.ng_name?(a.sg_name?a.sg_name:"")+(a.ng_name?" ("+a.ng_name+")":""):!1;c&&(b.symlabel=c)}else d=a.cell;a.atoms.length||h.warning("Note: no atomic coordinates supplied");for(var b={atoms:[],cell:d,descr:b,overlayed:{},info:a.info,mpds_data:a.mpds_data,
mpds_demo:a.mpds_demo},e,u,k,c={},n=0,r=a.atoms.length,s={},t={};n<r;n++){var A=[a.atoms[n].x,a.atoms[n].y,a.atoms[n].z],B=A.map(function(a){return a.toFixed(2)}).join(",");if(t.hasOwnProperty(B))for(k in e="",b.atoms[t[B]].overlays)"S"==k?-1==s[B].indexOf(a.atoms[n].symbol)&&(e=" "+a.atoms[n].symbol,s[B].push(a.atoms[n].symbol)):e="N"==k?", "+(n+1):"_atom_site_occupancy"==k?"+"+a.atoms[n].overlays[k]:" "+a.atoms[n].overlays[k],b.atoms[t[B]].overlays[k]+=e;else{e=f.JmolColors[a.atoms[n].symbol]?f.JmolColors[a.atoms[n].symbol]:
"0xffff00";u=f.AseRadii[a.atoms[n].symbol]?f.AseRadii[a.atoms[n].symbol]:.66;c={S:a.atoms[n].symbol,N:n+1};for(k in a.atoms[n].overlays)c[k]=a.atoms[n].overlays[k];A=a.cartesian?A:x.multiply(A,d);b.atoms.push({x:A[0],y:A[1],z:A[2],c:e,r:u,overlays:c});t[B]=b.atoms.length-1;s[B]=[a.atoms[n].symbol]}}for(var l in c)"S"!==l&&"N"!==l&&(b.overlayed[l]=g[l]);return b}function a(a){a.symops&&h.warning("Warning! Reading of symmetry operations is not yet implemented, expect error now.");var d;d=6==Object.keys(a.cell).length?
v(a.cell.a,a.cell.b,a.cell.c,a.cell.alpha,a.cell.beta,a.cell.gamma):a.cell;var b=[],c=[],e=[],f=[],b=d[0].map(function(a,b){return d.map(function(a){return a[b]})}),c=c.concat.apply(c,b),k=0,g=a.atoms.length;if(a.types)for(;k<g;k++)f.push([a.atoms[k].x,a.atoms[k].y,a.atoms[k].z]);else{for(var r=[],b={};k<g;k++)-1==Object.keys(b).indexOf(a.atoms[k].symbol)?b[a.atoms[k].symbol]=[[a.atoms[k].x,a.atoms[k].y,a.atoms[k].z]]:b[a.atoms[k].symbol].push([a.atoms[k].x,a.atoms[k].y,a.atoms[k].z]);var k=1,s;for(s in b){for(g=
0;g<b[s].length;g++)f.push(b[s][g]),r.push(k);k++}}e=e.concat.apply(e,f);return{cell:c,atoms:e,types:r||a.types,symlabel:a.sg_name||a.ng_name?(a.sg_name?a.sg_name:"")+(a.ng_name?" ("+a.ng_name+")":""):!1}}function d(a){var d=[],b=[],c=[];a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");var e={cell:{},atoms:[]},u=!1,k=!1,n=!1,r="",s="",t="",k=[],A="a b c alpha beta gamma".split(" "),B=["_atom_site_label","_atom_site_type_symbol","_atom_site_fract_x","_atom_site_fract_y","_atom_site_fract_z"],
l=["label","symbol","x","y","z"],z=[0,1],N=[],J;for(J in g)N.push(B.length),B.push(J);J=0;for(var E=a.length;J<E;J++)if(!a[J].startswith("#"))if(s=a[J].trim()){t=s.toLowerCase();k=!1;if(t.startswith("data_"))k=!0,u=!1,c=[],n=!1,r=s.substr(5);else if(t.startswith("_cell_")){u=!1;k=s.split(" ");s=k[0].split("_");s=s[s.length-1];-1!==A.indexOf(s)&&k[k.length-1]&&("a"==s&&(t=k[k.length-1].split("."),2==t[t.length-1].length&&(e.mpds_demo=!0)),e.cell[s]=parseFloat(k[k.length-1]));continue}else if(t.startswith("_symmetry_space_group_name_h-m")||
t.startswith("_space_group.patterson_name_h-m")){u=!1;e.sg_name=a[J].substr(31).replace(/"/g,"").replace(/'/g,"").trim();continue}else if(t.startswith("_space_group.it_number")||t.startswith("_space_group_it_number")||t.startswith("_symmetry_int_tables_number")){u=!1;k=s.split(" ");e.ng_name=k[k.length-1].trim();continue}else{if(t.startswith("_cif_error"))return h.error(s.substr(12,s.length-13)),!1;if(t.startswith("_pauling_file_entry")){e.mpds_data=!0;continue}else if(t.startswith("loop_")){u=!0;
c=[];n=!1;continue}}if(u)if(s.startswith("_symmetry_equiv")||s.startswith("_space_group"))n=!0;else if(s.startswith("_"))c.push(s);else if(n)b.push(s.replace(/"/g,"").replace(/'/g,""));else{for(var k=s.replace(/\t/g," ").split(" ").filter(function(a){return a?!0:!1}),s={overlays:{}},t=0,L=c.length;t<L;t++){var D=B.indexOf(c[t]);if(-1!=D){var v=z.indexOf(D);1==v?k[t]=k[t].charAt(0).toUpperCase()+k[t].slice(1).toLowerCase():0>v&&(k[t]=parseFloat(k[t]));-1<N.indexOf(D)?s.overlays[B[D]]=k[t]:s[l[D]]=
k[t]}}void 0!==s.x&&void 0!==s.y&&void 0!==s.z&&(s.label&&(s.overlays.label=s.label,s.symbol||(s.symbol=s.label.replace(/[0-9]/g,""))),!f.JmolColors[s.symbol]&&s.symbol&&1<s.symbol.length&&(s.symbol=s.symbol.substr(0,s.symbol.length-1)),s.symbol&&e.atoms.push(s))}else k&&e.atoms.length&&(e.info=r,1<b.length&&(e.symops=b),d.push(e),e={cell:{},atoms:[]},b=[])}else u=!1,c=[],n=!1;e.cell.gamma&&(e.info=r,1<b.length&&(e.symops=b),d.push(e));if(d.length)return d[d.length-1];h.error("Error: unexpected CIF format!");
return!1}function c(a){a=a.toString().replace(/(\r\n|\r)/gm,"\n").split("\n");var d=[],b=[],c=1,e=[],g=[],k=[],n=[],r=["x","y","z","symbol"],s=0,t=0,A=a.length,B=[],l=0,B=[],z=[];a:for(;s<A;s++)if(0==s){B=a[s].split(" ").filter(function(a){return a?!0:!1});z=Object.keys(f.AseRadii);for(t=0;t<B.length;t++)if(-1==z.indexOf(B[t]))continue a;g=B}else if(1==s)c=parseFloat(a[s]);else if(-1!==[2,3,4].indexOf(s))d.push(a[s].split(" ").filter(function(a){return a?!0:!1}).map(Number));else if(5==s)if(B=a[s].split(" ").filter(function(a){return a?
!0:!1}),B[0].isnumeric())for(e=B.map(Number),t=0;t<e.length;t++)for(B=0;B<e[t];B++)n.push(t+1);else g=B;else if(6==s){if("direct"==a[s].trim().toLowerCase().substr(0,6))continue a;B=a[s].split(" ").filter(function(a){return a?!0:!1});if(B[0].isnumeric())for(e=B.map(Number),t=0;t<e.length;t++)for(B=0;B<e[t];B++)n.push(t+1);else g=B}else if(6<s){if(9>s){if(g.length&&!k.length)for(t=0;t<g.length;t++)for(B=0;B<e[t];B++)k.push(g[t]);if(-1!==["direct","select"].indexOf(a[s].trim().toLowerCase().substr(0,
6)))continue a}z={};B=a[s].replace("#","").replace("!","").split(" ").filter(function(a){return a?!0:!1});if(!B.length)break;else if(3==B.length)k.length?B.push(k[l]):B.push("Xx");else if(3>B.length)return h.error("Error: invalid atom definition!"),!1;for(t=0;4>t;t++)z[r[t]]=3>t?parseFloat(B[t]):B[t];z.symbol=z.symbol.replace(/\W+/,"").replace(/\d+/,"");z.symbol.length||(z.symbol="Xx");b.push(z);l++}d=x.multiply(d,c);if(b.length)return{cell:d,atoms:b,types:n};h.error("Error: unexpected POSCAR format!");
return!1}function e(a){var d=JSON.parse(a),b=[];if(!d.data||!d.data.length||!d.data[0].attributes)return h.error("Error: unexpected OPTIMADE format!"),!1;d.data[0].attributes.cartesian_site_positions.forEach(function(a,c){b.push({x:a[0],y:a[1],z:a[2],symbol:d.data[0].attributes.species[c].chemical_symbols[0],overlays:d.data[0].attributes.species[c].name?{label:d.data[0].attributes.species[c].name}:{}})});return{cell:d.data[0].attributes.lattice_vectors,atoms:b,info:"id = "+d.data[0].id,cartesian:!0}}
var f={JmolColors:{D:"#FFFFC0",H:"#FFFFFF",He:"#D9FFFF",Li:"#CC80FF",Be:"#C2FF00",B:"#FFB5B5",C:"#909090",N:"#3050F8",O:"#FF0D0D",F:"#90E050",Ne:"#B3E3F5",Na:"#AB5CF2",Mg:"#8AFF00",Al:"#BFA6A6",Si:"#F0C8A0",P:"#FF8000",S:"#FFFF30",Cl:"#1FF01F",Ar:"#80D1E3",K:"#8F40D4",Ca:"#3DFF00",Sc:"#E6E6E6",Ti:"#BFC2C7",V:"#A6A6AB",Cr:"#8A99C7",Mn:"#9C7AC7",Fe:"#E06633",Co:"#F090A0",Ni:"#50D050",Cu:"#C88033",Zn:"#7D80B0",Ga:"#C28F8F",Ge:"#668F8F",As:"#BD80E3",Se:"#FFA100",Br:"#A62929",Kr:"#5CB8D1",Rb:"#702EB0",
Sr:"#00FF00",Y:"#94FFFF",Zr:"#94E0E0",Nb:"#73C2C9",Mo:"#54B5B5",Tc:"#3B9E9E",Ru:"#248F8F",Rh:"#0A7D8C",Pd:"#006985",Ag:"#C0C0C0",Cd:"#FFD98F",In:"#A67573",Sn:"#668080",Sb:"#9E63B5",Te:"#D47A00",I:"#940094",Xe:"#429EB0",Cs:"#57178F",Ba:"#00C900",La:"#70D4FF",Ce:"#FFFFC7",Pr:"#D9FFC7",Nd:"#C7FFC7",Pm:"#A3FFC7",Sm:"#8FFFC7",Eu:"#61FFC7",Gd:"#45FFC7",Tb:"#30FFC7",Dy:"#1FFFC7",Ho:"#00FF9C",Er:"#00E675",Tm:"#00D452",Yb:"#00BF38",Lu:"#00AB24",Hf:"#4DC2FF",Ta:"#4DA6FF",W:"#2194D6",Re:"#267DAB",Os:"#266696",
Ir:"#175487",Pt:"#D0D0E0",Au:"#FFD123",Hg:"#B8B8D0",Tl:"#A6544D",Pb:"#575961",Bi:"#9E4FB5",Po:"#AB5C00",At:"#754F45",Rn:"#428296",Fr:"#420066",Ra:"#007D00",Ac:"#70ABFA",Th:"#00BAFF",Pa:"#00A1FF",U:"#008FFF",Np:"#0080FF",Pu:"#006BFF",Am:"#545CF2",Cm:"#785CE3",Bk:"#8A4FE3",Cf:"#A136D4",Es:"#B31FD4",Fm:"#B31FBA",Md:"#B30DA6",No:"#BD0D87",Lr:"#C70066",Rf:"#CC0059",Db:"#D1004F",Sg:"#D90045",Bh:"#E00038",Hs:"#E6002E",Mt:"#EB0026"},AseRadii:{X:.66,H:.31,He:.28,Li:1.28,Be:.96,B:.84,C:.76,N:.71,O:.66,F:.57,
Ne:.58,Na:1.66,Mg:1.41,Al:1.21,Si:1.11,P:1.07,S:1.05,Cl:1.02,Ar:1.06,K:2.03,Ca:1.76,Sc:1.7,Ti:1.6,V:1.53,Cr:1.39,Mn:1.39,Fe:1.32,Co:1.26,Ni:1.24,Cu:1.32,Zn:1.22,Ga:1.22,Ge:1.2,As:1.19,Se:1.2,Br:1.2,Kr:1.16,Rb:2.2,Sr:1.95,Y:1.9,Zr:1.75,Nb:1.64,Mo:1.54,Tc:1.47,Ru:1.46,Rh:1.42,Pd:1.39,Ag:1.45,Cd:1.44,In:1.42,Sn:1.39,Sb:1.39,Te:1.38,I:1.39,Xe:1.4,Cs:2.44,Ba:2.15,La:2.07,Ce:2.04,Pr:2.03,Nd:2.01,Pm:1.99,Sm:1.98,Eu:1.98,Gd:1.96,Tb:1.94,Dy:1.92,Ho:1.92,Er:1.89,Tm:1.9,Yb:1.87,Lu:1.87,Hf:1.75,Ta:1.7,W:1.62,
Re:1.51,Os:1.44,Ir:1.41,Pt:1.36,Au:1.36,Hg:1.32,Tl:1.45,Pb:1.46,Bi:1.48,Po:1.4,At:1.5,Rn:1.5,Fr:2.6,Ra:2.21,Ac:2.15,Th:2.06,Pa:2,U:1.96,Np:1.9,Pu:1.87,Am:1.8,Cm:1.69,Bk:3,Cf:3,Es:3,Fm:3,Md:3,No:3,Lr:3,Rf:3,Db:3,Sg:3,Bh:3,Hs:3,Mt:3}},g={_atom_site_occupancy:"site occupancies",_atom_site_charge:"formal charges",label:"labels"};return{to_player:function(a){var f;switch(l(a)){case "CIF":f=d(a);break;case "POSCAR":f=c(a);break;case "OPTIMADE":f=e(a);break;default:h.error("Error: file format cannot be recognized!")}return f?
b(f):!1},to_flatten:function(b){var e;switch(l(b)){case "CIF":e=d(b);break;case "POSCAR":e=c(b);break;case "OPTIMADE":h.error("OPTIMADE not supported!");break;default:h.error("Error: file format cannot be recognized!")}return e?a(e):!1},version:"0.4.0"}};"undefined"!==typeof Z&&Z.exports?Z.exports=aa:"function"===typeof ga(2).specified&&!(void 0!==aa&&(Z.exports=aa))},function(Z,aa,ga){function x(l){return ga(h(l))}function h(h){var b;if(!(b=l[h]))throw Error("Cannot find module '"+h+"'.");return b}
var l={"./math.custom":3,"./math.custom.js":3,"./matinfio":1,"./matinfio.js":1,"./require":4,"./require.js":4,"./three.custom":5,"./three.custom.js":5};x.keys=function(){return Object.keys(l)};x.resolve=h;Z.exports=x;x.id=2},function(Z,aa,ga){(function(x,h){Z.exports=h()})(this,function(){return function(x){function h(v){if(l[v])return l[v].exports;var b=l[v]={exports:{},id:v,loaded:!1};x[v].call(b.exports,b,b.exports,h);b.loaded=!0;return b.exports}var l={};h.m=x;h.c=l;h.p="";return h(0)}([function(x,
h,l){h=l(1).create();h.import(l(15));h.import(l(24));h.import(l(27));h.import(l(29));h.import(l(30));h.import(l(31));h.import(l(58));h.import(l(47));h.import(l(65));h.import(l(68));h.import(l(69));x.exports=h},function(x,h,l){x.exports=l(2)},function(x,h,l){l(3);var v=l(4).isFactory,b=l(6),a=l(10),d=l(12),c=l(14);h.create=function(e){function f(a){if(!v(a))throw Error("Factory object with properties `type`, `name`, and `factory` expected");var d=g.indexOf(a);-1===d?(d=!0===a.math?a.factory(p.type,
y,f,p.typed,p):a.factory(p.type,y,f,p.typed),g.push(a),m.push(d)):d=m[d];return d}if("function"!==typeof Object.create)throw Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var g=[],m=[],p=a.mixin({});p.type={};p.expression={transform:{},mathWithTransform:{}};p.typed=b.create(p.type);var y={epsilon:1E-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};p["import"]=f(d);p.config=f(c);p.expression.mathWithTransform.config=
p.config;e&&p.config(e);return p}},function(x,h){Number.isFinite=Number.isFinite||function(l){return"number"===typeof l&&isFinite(l)};Number.isNaN=Number.isNaN||function(l){return l!==l}},function(x,h,l){function v(a){v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return v(a)}var b=l(5);h.clone=function d(c){var e=v(c);if("number"===e||"string"===
e||"boolean"===e||null===c||void 0===c)return c;if("function"===typeof c.clone)return c.clone();if(Array.isArray(c))return c.map(function(b){return d(b)});if(c instanceof Date)return new Date(c.valueOf());if(b(c))return c;if(c instanceof RegExp)throw new TypeError("Cannot clone "+c);return h.map(c,d)};h.map=function(d,b){var e={},f;for(f in d)h.hasOwnProperty(d,f)&&(e[f]=b(d[f]));return e};h.extend=function(d,b){for(var e in b)h.hasOwnProperty(b,e)&&(d[e]=b[e]);return d};h.deepExtend=function c(b,
f){if(Array.isArray(f))throw new TypeError("Arrays are not supported by deepExtend");for(var g in f)if(h.hasOwnProperty(f,g))if(f[g]&&f[g].constructor===Object)void 0===b[g]&&(b[g]={}),b[g].constructor===Object?c(b[g],f[g]):b[g]=f[g];else{if(Array.isArray(f[g]))throw new TypeError("Arrays are not supported by deepExtend");b[g]=f[g]}return b};h.deepEqual=function(b,e){var f,g;if(Array.isArray(b)){if(!Array.isArray(e)||b.length!==e.length)return!1;f=0;for(g=b.length;f<g;f++)if(!h.deepEqual(b[f],e[f]))return!1;
return!0}if(b instanceof Object){if(Array.isArray(e)||!(e instanceof Object))return!1;for(f in b)if(!h.deepEqual(b[f],e[f]))return!1;for(f in e)if(!h.deepEqual(b[f],e[f]))return!1;return!0}return b===e};h.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch(b){}return!1};h.lazy=function(b,e,f){if(h.canDefineProperty()){var g=!0,m;Object.defineProperty(b,e,{get:function(){g&&(m=f(),g=!1);return m},set:function(b){m=b;g=!1},configurable:!0,
enumerable:!0})}else b[e]=f()};h.traverse=function(b,e){var f=b;if(e)for(var g=e.split("."),m=0;m<g.length;m++){var p=g[m];p in f||(f[p]={});f=f[p]}return f};h.hasOwnProperty=function(b,e){return b&&Object.hasOwnProperty.call(b,e)};h.isFactory=function(b){return b&&"function"===typeof b.factory}},function(x,h){x.exports=function(l){return l&&l.constructor.prototype.isBigNumber||!1}},function(x,h,l){function v(a){v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:
function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return v(a)}var b=l(7),a=l(8).digits,d=l(5),c=l(9),e=function(){e=b.create;return b};h.create=function(b){b.isNumber=function(a){return"number"===typeof a};b.isComplex=function(a){return b.Complex&&a instanceof b.Complex||!1};b.isBigNumber=d;b.isFraction=function(a){return b.Fraction&&a instanceof b.Fraction||!1};b.isUnit=function(a){return a&&a.constructor.prototype.isUnit||!1};b.isString=
function(a){return"string"===typeof a};b.isArray=Array.isArray;b.isMatrix=c;b.isDenseMatrix=function(a){return a&&a.isDenseMatrix&&a.constructor.prototype.isMatrix||!1};b.isSparseMatrix=function(a){return a&&a.isSparseMatrix&&a.constructor.prototype.isMatrix||!1};b.isRange=function(a){return a&&a.constructor.prototype.isRange||!1};b.isIndex=function(a){return a&&a.constructor.prototype.isIndex||!1};b.isBoolean=function(a){return"boolean"===typeof a};b.isResultSet=function(a){return a&&a.constructor.prototype.isResultSet||
!1};b.isHelp=function(a){return a&&a.constructor.prototype.isHelp||!1};b.isFunction=function(a){return"function"===typeof a};b.isDate=function(a){return a instanceof Date};b.isRegExp=function(a){return a instanceof RegExp};b.isObject=function(a){return"object"===v(a)&&a.constructor===Object&&!b.isComplex(a)&&!b.isFraction(a)};b.isNull=function(a){return null===a};b.isUndefined=function(a){return void 0===a};b.isAccessorNode=function(a){return a&&a.isAccessorNode&&a.constructor.prototype.isNode||!1};
b.isArrayNode=function(a){return a&&a.isArrayNode&&a.constructor.prototype.isNode||!1};b.isAssignmentNode=function(a){return a&&a.isAssignmentNode&&a.constructor.prototype.isNode||!1};b.isBlockNode=function(a){return a&&a.isBlockNode&&a.constructor.prototype.isNode||!1};b.isConditionalNode=function(a){return a&&a.isConditionalNode&&a.constructor.prototype.isNode||!1};b.isConstantNode=function(a){return a&&a.isConstantNode&&a.constructor.prototype.isNode||!1};b.isFunctionAssignmentNode=function(a){return a&&
a.isFunctionAssignmentNode&&a.constructor.prototype.isNode||!1};b.isFunctionNode=function(a){return a&&a.isFunctionNode&&a.constructor.prototype.isNode||!1};b.isIndexNode=function(a){return a&&a.isIndexNode&&a.constructor.prototype.isNode||!1};b.isNode=function(a){return a&&a.isNode&&a.constructor.prototype.isNode||!1};b.isObjectNode=function(a){return a&&a.isObjectNode&&a.constructor.prototype.isNode||!1};b.isOperatorNode=function(a){return a&&a.isOperatorNode&&a.constructor.prototype.isNode||!1};
b.isParenthesisNode=function(a){return a&&a.isParenthesisNode&&a.constructor.prototype.isNode||!1};b.isRangeNode=function(a){return a&&a.isRangeNode&&a.constructor.prototype.isNode||!1};b.isSymbolNode=function(a){return a&&a.isSymbolNode&&a.constructor.prototype.isNode||!1};b.isChain=function(a){return a&&a.constructor.prototype.isChain||!1};var g=e();g.types=[{name:"number",test:b.isNumber},{name:"Complex",test:b.isComplex},{name:"BigNumber",test:b.isBigNumber},{name:"Fraction",test:b.isFraction},
{name:"Unit",test:b.isUnit},{name:"string",test:b.isString},{name:"Array",test:b.isArray},{name:"Matrix",test:b.isMatrix},{name:"DenseMatrix",test:b.isDenseMatrix},{name:"SparseMatrix",test:b.isSparseMatrix},{name:"Range",test:b.isRange},{name:"Index",test:b.isIndex},{name:"boolean",test:b.isBoolean},{name:"ResultSet",test:b.isResultSet},{name:"Help",test:b.isHelp},{name:"function",test:b.isFunction},{name:"Date",test:b.isDate},{name:"RegExp",test:b.isRegExp},{name:"null",test:b.isNull},{name:"undefined",
test:b.isUndefined},{name:"OperatorNode",test:b.isOperatorNode},{name:"ConstantNode",test:b.isConstantNode},{name:"SymbolNode",test:b.isSymbolNode},{name:"ParenthesisNode",test:b.isParenthesisNode},{name:"FunctionNode",test:b.isFunctionNode},{name:"FunctionAssignmentNode",test:b.isFunctionAssignmentNode},{name:"ArrayNode",test:b.isArrayNode},{name:"AssignmentNode",test:b.isAssignmentNode},{name:"BlockNode",test:b.isBlockNode},{name:"ConditionalNode",test:b.isConditionalNode},{name:"IndexNode",test:b.isIndexNode},
{name:"RangeNode",test:b.isRangeNode},{name:"Node",test:b.isNode},{name:"Object",test:b.isObject}];g.conversions=[{from:"number",to:"BigNumber",convert:function(d){if(15<a(d))throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+d+"). Use function bignumber(x) to convert to BigNumber.");return new b.BigNumber(d)}},{from:"number",to:"Complex",convert:function(a){return new b.Complex(a,0)}},{from:"number",to:"string",convert:function(a){return a+
""}},{from:"BigNumber",to:"Complex",convert:function(a){return new b.Complex(a.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(a){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.");}},{from:"Fraction",to:"Complex",convert:function(a){return new b.Complex(a.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(a){if((new b.Fraction(a)).valueOf()!==a)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+
a+"). Use function fraction(x) to convert to Fraction.");return new b.Fraction(a)}},{from:"string",to:"number",convert:function(a){var b=Number(a);if(isNaN(b))throw Error('Cannot convert "'+a+'" to a number');return b}},{from:"string",to:"BigNumber",convert:function(a){try{return new b.BigNumber(a)}catch(d){throw Error('Cannot convert "'+a+'" to BigNumber');}}},{from:"string",to:"Fraction",convert:function(a){try{return new b.Fraction(a)}catch(d){throw Error('Cannot convert "'+a+'" to Fraction');
}}},{from:"string",to:"Complex",convert:function(a){try{return new b.Complex(a)}catch(d){throw Error('Cannot convert "'+a+'" to Complex');}}},{from:"boolean",to:"number",convert:function(a){return+a}},{from:"boolean",to:"BigNumber",convert:function(a){return new b.BigNumber(+a)}},{from:"boolean",to:"Fraction",convert:function(a){return new b.Fraction(+a)}},{from:"boolean",to:"string",convert:function(a){return+a}},{from:"Array",to:"Matrix",convert:function(a){return new b.DenseMatrix(a)}},{from:"Matrix",
to:"Array",convert:function(a){return a.valueOf()}}];return g}},function(x,h,l){var v,b,a;"use strict";(function(d,c){!(b=[],v=c,a="function"===typeof v?v.apply(h,b):v,void 0!==a&&(x.exports=a))})(this,function(){function a(){return!0}function b(){return!1}function e(){}function f(){function g(a){var b=I(fa.types,function(b){return b.name===a});if(b)return b;if("any"===a)return W;b=I(fa.types,function(b){return b.name.toLowerCase()===a.toLowerCase()});throw new TypeError('Unknown type "'+a+'"'+(b?
'. Did you mean "'+b.name+'"?':""));}function m(a){var b=I(fa.types,function(b){return b.test(a)});if(b)return b.name;throw new TypeError("Value has unknown type. Value: "+a);}function p(a){return a.map(function(a){var b=a.types.map(t);return(a.restParam?"...":"")+b.join("|")}).join(",")}function y(a,b){var d=0===a.indexOf("..."),c=(d?3<a.length?a.slice(3):"any":a).split("|").map(x).filter(K).filter(G),e=E(b,c),c=c.map(function(a){var b=g(a);return{name:a,typeIndex:b===W?999:fa.types.indexOf(b),test:b.test,
conversion:null,conversionIndex:-1}}),e=e.map(function(a){var d=g(a.from);return{name:a.from,typeIndex:d===W?999:fa.types.indexOf(d),test:d.test,conversion:a,conversionIndex:b.indexOf(a)}});return{types:c.concat(e),restParam:d}}function C(a,b,d){var c=[];""!==a.trim()&&(c=a.split(",").map(x).map(function(a,b,c){var e=y(a,d);if(e.restParam&&b!==c.length-1)throw new SyntaxError('Unexpected rest parameter "'+a+'": only allowed for the last parameter');return e}));return c.some(H)?null:{params:c,fn:b}}
function q(a){return(a=a[a.length-1])?a.restParam:!1}function u(a){return a.types.some(function(a){return null!=a.conversion})}function k(b){if(b&&0!==b.types.length){if(1===b.types.length)return g(b.types[0].name).test;if(2===b.types.length){var c=g(b.types[0].name).test,e=g(b.types[1].name).test;return function(a){return c(a)||e(a)}}var f=b.types.map(function(a){return g(a.name).test});return function(a){for(var b=0;b<f.length;b++)if(f[b](a))return!0;return!1}}return a}function n(a){var b,d,c;if(q(a)){b=
a.slice(0,a.length-1).map(k);var e=b.length,f=k(a[a.length-1]);return function(a){for(var d=0;d<b.length;d++)if(!b[d](a[d]))return!1;a:{for(d=e;d<a.length;d++)if(!f(a[d])){d=!1;break a}d=!0}return d&&a.length>=e+1}}if(0===a.length)return function(a){return 0===a.length};if(1===a.length)return d=k(a[0]),function(a){return d(a[0])&&1===a.length};if(2===a.length)return d=k(a[0]),c=k(a[1]),function(a){return d(a[0])&&c(a[1])&&2===a.length};b=a.map(k);return function(a){for(var d=0;d<b.length;d++)if(!b[d](a[d]))return!1;
return a.length===b.length}}function r(a,b){var d;b<a.params.length?d=a.params[b]:q(a.params)?(d=a.params,d=d[d.length-1]):d=null;return d}function s(a,b,d){a=r(a,b);return(a?d?a.types.filter(A):a.types:[]).map(t)}function t(a){return a.name}function A(a){return null===a.conversion||void 0===a.conversion}function B(a,b){var d=F(S(a,function(a){return s(a,b,!1)}));return-1!==d.indexOf("any")?["any"]:d}function l(a,b,d){var c;a=a||"unnamed";var e;for(e=0;e<b.length;e++)if(c=d.filter(function(a){var d=
k(r(a,e));return(e<a.params.length||q(a.params))&&d(b[e])}),0===c.length){if(c=B(d,e),0<c.length){var f=m(b[e]);d=new TypeError("Unexpected type of argument in function "+a+" (expected: "+c.join(" or ")+", actual: "+f+", index: "+e+")");d.data={category:"wrongType",fn:a,index:e,actual:f,expected:c};return d}}else d=c;c=d.map(function(a){return q(a.params)?Infinity:a.params.length});if(b.length<Math.min.apply(null,c))return c=B(d,e),d=new TypeError("Too few arguments in function "+a+" (expected: "+
c.join(" or ")+", index: "+b.length+")"),d.data={category:"tooFewArgs",fn:a,index:b.length,expected:c},d;c=Math.max.apply(null,c);if(b.length>c)return d=new TypeError("Too many arguments in function "+a+" (expected: "+c+", actual: "+b.length+")"),d.data={category:"tooManyArgs",fn:a,index:b.length,expectedLength:c},d;d=new TypeError('Arguments of type "'+b.join(", ")+'" do not match any of the defined signatures of function '+a+".");d.data={category:"mismatch",actual:b.map(m)};return d}function z(a){for(var b=
999,d=0;d<a.types.length;d++)A(a.types[d])&&(b=Math.min(b,a.types[d].typeIndex));return b}function h(a){for(var b=999,d=0;d<a.types.length;d++)A(a.types[d])||(b=Math.min(b,a.types[d].conversionIndex));return b}function J(a,b){var d=Math.min(a.params.length,b.params.length),c,e;e=a.params.some(u)-b.params.some(u);if(0!==e)return e;for(c=0;c<d;c++)if(e=u(a.params[c])-u(b.params[c]),0!==e)return e;for(c=0;c<d;c++){e=a.params[c];var f=b.params[c],k=void 0,k=e.restParam-f.restParam;0!==k?e=k:(k=u(e)-u(f),
0!==k?e=k:(k=z(e)-z(f),e=0!==k?k:h(e)-h(f)));if(0!==e)return e}return a.params.length-b.params.length}function E(a,b){var d={};a.forEach(function(a){-1!==b.indexOf(a.from)||-1===b.indexOf(a.to)||d[a.from]||(d[a.from]=a)});return Object.keys(d).map(function(a){return d[a]})}function L(a,b){var d=b;if(a.some(u))var c=q(a),e=a.map(D),d=function(){for(var a=[],d=c?arguments.length-1:arguments.length,f=0;f<d;f++)a[f]=e[f](arguments[f]);c&&(a[d]=arguments[d].map(e[d]));return b.apply(null,a)};var f=d;if(q(a))var k=
a.length-1,f=function(){return d.apply(null,Array.prototype.slice.call(arguments,0,k).concat([Array.prototype.slice.call(arguments,k,void 0)]))};return f}function D(a){var b,d,c,e,f=[],k=[];a.types.forEach(function(a){a.conversion&&(f.push(g(a.conversion.from).test),k.push(a.conversion.convert))});switch(k.length){case 0:return function(a){return a};case 1:return b=f[0],c=k[0],function(a){return b(a)?c(a):a};case 2:return b=f[0],d=f[1],c=k[0],e=k[1],function(a){return b(a)?c(a):d(a)?e(a):a};default:return function(a){for(var b=
0;b<k.length;b++)if(f[b](a))return k[b](a);return a}}}function v(a){var b={};a.forEach(function(a){a.params.some(u)||T(a.params,!0).forEach(function(d){b[p(d)]=a.fn})});return b}function T(a,b){function d(a,c,e){if(c<a.length){var f=a[c],k=b?f.types.filter(A):f.types;f.restParam?(f=k.filter(A),k=f.length<k.length?[f,k]:[k]):k=k.map(function(a){return[a]});return S(k,function(b){return d(a,c+1,e.concat([b]))})}return[e.map(function(b,d){return{types:b,restParam:d===a.length-1&&q(a)}})]}return d(a,
0,[])}function O(a,d){if(0===Object.keys(d).length)throw new SyntaxError("No signatures provided");var f=[];Object.keys(d).map(function(a){return C(a,d[a],fa.conversions)}).filter(M).forEach(function(a){var b=I(f,function(b){a:{for(var d=Math.max(b.params.length,a.params.length),c=0;c<d;c++){var e=s(b,c,!0),f=s(a,c,!0);b:{for(var g=0;g<e.length;g++)if(-1!==f.indexOf(e[g])){e=!0;break b}e=!1}if(!e){b=!1;break a}}d=b.params.length;c=a.params.length;b=q(b.params);e=q(a.params);b=b?e?d===c:c>=d:e?d>=
c:d===c}return b});if(b)throw new TypeError('Conflicting signatures "'+p(b.params)+'" and "'+p(a.params)+'".');f.push(a)});var g=S(f,function(a){return(a?T(a.params,!1):[]).map(function(b){return{params:b,fn:a.fn}})}).filter(M);g.sort(J);var m=g[0]&&2>=g[0].params.length&&!q(g[0].params),y=g[1]&&2>=g[1].params.length&&!q(g[1].params),u=g[2]&&2>=g[2].params.length&&!q(g[2].params),r=g[3]&&2>=g[3].params.length&&!q(g[3].params),A=g[4]&&2>=g[4].params.length&&!q(g[4].params),t=g[5]&&2>=g[5].params.length&&
!q(g[5].params),z=m&&y&&u&&r&&A&&t,B=g.map(function(a){return n(a.params)}),h=m?k(g[0].params[0]):b,N=y?k(g[1].params[0]):b,E=u?k(g[2].params[0]):b,D=r?k(g[3].params[0]):b,H=A?k(g[4].params[0]):b,F=t?k(g[5].params[0]):b,Aa=m?k(g[0].params[1]):b,G=y?k(g[1].params[1]):b,R=u?k(g[2].params[1]):b,O=r?k(g[3].params[1]):b,X=A?k(g[4].params[1]):b,wa=t?k(g[5].params[1]):b,x=g.map(function(a){return L(a.params,a.fn)}),W=m?x[0]:e,va=y?x[1]:e,Ja=u?x[2]:e,sa=r?x[3]:e,K=A?x[4]:e,ca=t?x[5]:e,U=m?g[0].params.length:
-1,ra=y?g[1].params.length:-1,ea=u?g[2].params.length:-1,Ha=r?g[3].params.length:-1,Ea=A?g[4].params.length:-1,w=t?g[5].params.length:-1,Qa=z?6:0,Oa=g.length,ja=function(){for(var b=Qa;b<Oa;b++)if(B[b](arguments))return x[b].apply(null,arguments);throw l(a,arguments,g);},m=function(a,b){return arguments.length===U&&h(a)&&Aa(b)?W.apply(null,arguments):arguments.length===ra&&N(a)&&G(b)?va.apply(null,arguments):arguments.length===ea&&E(a)&&R(b)?Ja.apply(null,arguments):arguments.length===Ha&&D(a)&&O(b)?
sa.apply(null,arguments):arguments.length===Ea&&H(a)&&X(b)?K.apply(null,arguments):arguments.length===w&&F(a)&&wa(b)?ca.apply(null,arguments):ja.apply(null,arguments)};try{Object.defineProperty(m,"name",{value:a})}catch(za){}m.signatures=v(g);return m}function G(a){return-1===fa.ignore.indexOf(a)}function x(a){return a.trim()}function K(a){return!!a}function M(a){return null!==a}function H(a){return 0===a.types.length}function I(a,b){for(var d=0;d<a.length;d++)if(b(a[d]))return a[d]}function F(a){for(var b=
{},d=0;d<a.length;d++)b[a[d]]=!0;return Object.keys(b)}function S(a,b){return Array.prototype.concat.apply([],a.map(b))}function R(a){for(var b="",d=0;d<a.length;d++){var c=a[d];if(("object"===typeof c.signatures||"string"===typeof c.signature)&&""!==c.name)if(""===b)b=c.name;else if(b!==c.name)throw a=Error("Function names do not match (expected: "+b+", actual: "+c.name+")"),a.data={actual:c.name,expected:b},a;}return b}function X(a){function b(a,e){if(c.hasOwnProperty(a)&&e!==c[a])throw d=Error('Signature "'+
a+'" is defined twice'),d.data={signature:a},d;}for(var d,c={},e=0;e<a.length;e++){var f=a[e];if("object"===typeof f.signatures)for(var g in f.signatures)f.signatures.hasOwnProperty(g)&&(b(g,f.signatures[g]),c[g]=f.signatures[g]);else if("string"===typeof f.signature)b(f.signature,f),c[f.signature]=f;else throw d=new TypeError("Function is no typed-function (index: "+e+")"),d.data={index:e},d;}return c}var ca=[{name:"number",test:function(a){return"number"===typeof a}},{name:"string",test:function(a){return"string"===
typeof a}},{name:"boolean",test:function(a){return"boolean"===typeof a}},{name:"Function",test:function(a){return"function"===typeof a}},{name:"Array",test:Array.isArray},{name:"Date",test:function(a){return a instanceof Date}},{name:"RegExp",test:function(a){return a instanceof RegExp}},{name:"Object",test:function(a){return"object"===typeof a&&a.constructor===Object}},{name:"null",test:function(a){return null===a}},{name:"undefined",test:function(a){return void 0===a}}],W={name:"any",test:a},sa=
[],Aa=[],fa={types:ca,conversions:Aa,ignore:sa},fa=O("typed",{"string, Object":O,Object:function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(a[d]);b=R(b);return O(b,a)},"...Function":function(a){return O(R(a),X(a))},"string, ...Function":function(a,b){return O(a,X(b))}});fa.create=f;fa.types=ca;fa.conversions=Aa;fa.ignore=sa;fa.convert=function(a,b){var d=m(a);if(b===d)return a;for(var c=0;c<fa.conversions.length;c++){var e=fa.conversions[c];if(e.from===d&&e.to===b)return e.convert(a)}throw Error("Cannot convert from "+
d+" to "+b);};fa.find=function(a,b){if(!a.signatures)throw new TypeError("Function is no typed-function");var d;if("string"===typeof b){d=b.split(",");for(var c=0;c<d.length;c++)d[c]=d[c].trim()}else if(Array.isArray(b))d=b;else throw new TypeError("String array or a comma separated string expected");c=d.join(",");if(c=a.signatures[c])return c;throw new TypeError("Signature not found (signature: "+(a.name||"unnamed")+"("+d.join(", ")+"))");};fa.addType=function(a,b){if(!a||"string"!==typeof a.name||
"function"!==typeof a.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==b)for(var d=0;d<fa.types.length;d++)if("Object"===fa.types[d].name){fa.types.splice(d,0,a);return}fa.types.push(a)};fa.addConversion=function(a){if(!a||"string"!==typeof a.from||"string"!==typeof a.to||"function"!==typeof a.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");fa.conversions.push(a)};return fa}return f()})},
function(x,h,l){function v(a){for(var b=[],c=0;c<a;c++)b.push(0);return b}var b=l(4);h.isNumber=function(a){return"number"===typeof a};h.isInteger=function(a){return"boolean"===typeof a?!0:isFinite(a)?a===Math.round(a):!1};h.sign=Math.sign||function(a){return 0<a?1:0>a?-1:0};h.format=function(a,d){if("function"===typeof d)return d(a);if(Infinity===a)return"Infinity";if(-Infinity===a)return"-Infinity";if(isNaN(a))return"NaN";var c="auto",e;d&&(d.notation&&(c=d.notation),h.isNumber(d)?e=d:h.isNumber(d.precision)&&
(e=d.precision));switch(c){case "fixed":return h.toFixed(a,e);case "exponential":return h.toExponential(a,e);case "engineering":return h.toEngineering(a,e);case "auto":return d&&d.exponential&&(void 0!==d.exponential.lower||void 0!==d.exponential.upper)?(c=b.map(d,function(a){return a}),c.exponential=void 0,void 0!==d.exponential.lower&&(c.lowerExp=Math.round(Math.log(d.exponential.lower)/Math.LN10)),void 0!==d.exponential.upper&&(c.upperExp=Math.round(Math.log(d.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+
JSON.stringify(d)+" with "+JSON.stringify(c)),h.toPrecision(a,e,c)):h.toPrecision(a,e,d&&d).replace(/((\.\d*?)(0+))($|e)/,function(a,b,d,c,e){return"."!==d?d+e:e});default:throw Error('Unknown notation "'+c+'". Choose "auto", "exponential", or "fixed".');}};h.splitNumber=function(a){var b=String(a).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!b)throw new SyntaxError("Invalid number "+a);a=b[1];var c=b[2],e=parseFloat(b[4]||"0"),b=c.indexOf("."),e=e+(-1!==b?b-1:c.length-1),b=c.replace(".",
"").replace(/^0*/,function(a){e-=a.length;return""}).replace(/0*$/,"").split("").map(function(a){return parseInt(a)});0===b.length&&(b.push(0),e++);return{sign:a,coefficients:b,exponent:e}};h.toEngineering=function(a,b){if(isNaN(a)||!isFinite(a))return String(a);var c=h.roundDigits(h.splitNumber(a),b),e=c.exponent,f=c.coefficients,g=0===e%3?e:0>e?e-3-e%3:e-e%3;if(h.isNumber(b))b>f.length&&(f=f.concat(v(b-f.length)));else{var m=0<=e?e:Math.abs(g);f.length-1<m&&(f=f.concat(v(m-(f.length-1))))}for(var p=
Math.abs(e-g),m=1;0<=--p;)m++;p=f.slice(m).join("");p=h.isNumber(b)&&p.length||p.match(/[1-9]/)?"."+p:"";e=f.slice(0,m).join("")+p+"e"+(0<=e?"+":"")+g.toString();return c.sign+e};h.toFixed=function(a,b){if(isNaN(a)||!isFinite(a))return String(a);var c=h.splitNumber(a),c="number"===typeof b?h.roundDigits(c,c.exponent+1+b):c,e=c.coefficients,f=c.exponent+1,g=f+(b||0);e.length<g&&(e=e.concat(v(g-e.length)));0>f&&(e=v(-f+1).concat(e),f=1);f<e.length&&e.splice(f,0,0===f?"0.":".");return c.sign+e.join("")};
h.toExponential=function(a,b){if(isNaN(a)||!isFinite(a))return String(a);var c=h.splitNumber(a),c=b?h.roundDigits(c,b):c,e=c.coefficients,f=c.exponent;e.length<b&&(e=e.concat(v(b-e.length)));var g=e.shift();return c.sign+g+(0<e.length?"."+e.join(""):"")+"e"+(0<=f?"+":"")+f};h.toPrecision=function(a,b,c){if(isNaN(a)||!isFinite(a))return String(a);var e=c&&void 0!==c.lowerExp?c.lowerExp:-3;c=c&&void 0!==c.upperExp?c.upperExp:5;var f=h.splitNumber(a);if(f.exponent<e||f.exponent>=c)return h.toExponential(a,
b);a=b?h.roundDigits(f,b):f;e=a.coefficients;c=a.exponent;e.length<b&&(e=e.concat(v(b-e.length)));e=e.concat(v(c-e.length+1+(e.length<b?b-e.length:0)));e=v(-c).concat(e);b=0<c?c:0;b<e.length-1&&e.splice(b+1,0,".");return a.sign+e.join("")};h.roundDigits=function(a,b){for(var c={sign:a.sign,coefficients:a.coefficients,exponent:a.exponent},e=c.coefficients;0>=b;)e.unshift(0),c.exponent++,b++;if(e.length>b&&5<=e.splice(b,e.length-b)[0]){var f=b-1;for(e[f]++;10===e[f];)e.pop(),0===f&&(e.unshift(0),c.exponent++,
f++),f--,e[f]++}return c};h.digits=function(a){return a.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length};h.DBL_EPSILON=Number.EPSILON||2.220446049250313E-16;h.nearlyEqual=function(a,b,c){if(null===c||void 0===c)return a===b;if(a===b)return!0;if(isNaN(a)||isNaN(b))return!1;if(isFinite(a)&&isFinite(b)){var e=Math.abs(a-b);return e<h.DBL_EPSILON?!0:e<=Math.max(Math.abs(a),Math.abs(b))*c}return!1}},function(x,h){x.exports=function(l){return l&&l.constructor.prototype.isMatrix||!1}},
function(x,h,l){var v=l(11);h.mixin=function(b){var a=new v;b.on=a.on.bind(a);b.off=a.off.bind(a);b.once=a.once.bind(a);b.emit=a.emit.bind(a);return b}},function(x,h){function l(){}l.prototype={on:function(l,b,a){var d=this.e||(this.e={});(d[l]||(d[l]=[])).push({fn:b,ctx:a});return this},once:function(l,b,a){function d(){c.off(l,d);b.apply(a,arguments)}var c=this;d._=b;return this.on(l,d,a)},emit:function(l){var b=[].slice.call(arguments,1),a=((this.e||(this.e={}))[l]||[]).slice(),d=0,c=a.length;
for(d;d<c;d++)a[d].fn.apply(a[d].ctx,b);return this},off:function(l,b){var a=this.e||(this.e={}),d=a[l],c=[];if(d&&b)for(var e=0,f=d.length;e<f;e++)d[e].fn!==b&&d[e].fn._!==b&&c.push(d[e]);c.length?a[l]=c:delete a[l];return this}};x.exports=l;x.exports.TinyEmitter=l},function(x,h,l){function v(a){v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};
return v(a)}var b=l(4).lazy,a=l(4).isFactory,d=l(4).traverse,c=l(13);h.math=!0;h.name="import";h.factory=function(e,f,g,m,p){function y(b,d){var e=arguments.length;if(1!==e&&2!==e)throw new c("import",e,1,2);d||(d={});if(a(b))n(b,d);else if(Array.isArray(b))b.forEach(function(a){y(a,d)});else if("object"===v(b))for(var f in b)b.hasOwnProperty(f)&&(e=b[f],r(e)?C(f,e,d):a(b)?n(b,d):y(e,d));else if(!d.silent)throw new TypeError("Factory, Object, or Array expected");}function C(a,b,d){d.wrap&&"function"===
typeof b&&(b=k(b));if(s(p[a])&&s(b))b=d.override?m(a,b.signatures):m(p[a],b),p[a]=b,q(a,b),p.emit("import",a,function(){return b});else if(void 0===p[a]||d.override)p[a]=b,q(a,b),p.emit("import",a,function(){return b});else if(!d.silent)throw Error('Cannot import "'+a+'": already exists');}function q(a,b){b&&"function"===typeof b.transform?(p.expression.transform[a]=b.transform,t.hasOwnProperty(a)||(p.expression.mathWithTransform[a]=b.transform)):(delete p.expression.transform[a],t.hasOwnProperty(a)||
(p.expression.mathWithTransform[a]=b))}function u(a){delete p.expression.transform[a];t.hasOwnProperty(a)?delete p.expression.mathWithTransform[a]:p.expression.mathWithTransform[a]=p[a]}function k(a){var b=function(){for(var b=[],d=0,c=arguments.length;d<c;d++){var e=arguments[d];b[d]=e&&e.valueOf()}return a.apply(p,b)};a.transform&&(b.transform=a.transform);return b}function n(a,c){if("string"===typeof a.name){var e=a.name,f=e in p.expression.transform,k=a.path?d(p,a.path):p,y=k.hasOwnProperty(e)?
k[e]:void 0,q=function(){var b=g(a);if(b&&"function"===typeof b.transform)throw Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(s(y)&&s(b))return c.override||(b=m(y,b)),b;if(void 0===y||c.override)return b;if(!c.silent)throw Error('Cannot import "'+e+'": already exists');};if(!1!==a.lazy)b(k,e,q),f?u(e):("expression.transform"===a.path||void 0===a.path&&!t.hasOwnProperty(a.name))&&b(p.expression.mathWithTransform,
e,q);else if(k[e]=q(),f)u(e);else if("expression.transform"===a.path||void 0===a.path&&!t.hasOwnProperty(a.name))p.expression.mathWithTransform[e]=q();p.emit("import",e,q,a.path)}else g(a)}function r(a){return"function"===typeof a||"number"===typeof a||"string"===typeof a||"boolean"===typeof a||null===a||a&&e.isUnit(a)||a&&e.isComplex(a)||a&&e.isBigNumber(a)||a&&e.isFraction(a)||a&&e.isMatrix(a)||a&&Array.isArray(a)}function s(a){return"function"===typeof a&&"object"===v(a.signatures)}var t={expression:!0,
type:!0,docs:!0,error:!0,json:!0,chain:!0};return y};h.lazy=!0},function(x,h){function l(h,b,a,d){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");this.fn=h;this.count=b;this.min=a;this.max=d;this.message="Wrong number of arguments in function "+h+" ("+b+" provided, "+a+(void 0!==d&&null!==d?"-"+d:"")+" expected)";this.stack=Error().stack}l.prototype=Error();l.prototype.constructor=Error;l.prototype.name="ArgumentsError";l.prototype.isArgumentsError=
!0;x.exports=l},function(x,h,l){function v(a,b){return a.map(function(a){return a.toLowerCase()}).indexOf(b.toLowerCase())}function b(a,b,e){if(void 0!==a[b]&&-1===e.indexOf(a[b])){var f=v(e,a[b]);-1!==f?(console.warn('Warning: Wrong casing for configuration option "'+b+'", should be "'+e[f]+'" instead of "'+a[b]+'".'),a[b]=e[f]):console.warn('Warning: Unknown value "'+a[b]+'" for configuration option "'+b+'". Available options: '+e.map(JSON.stringify).join(", ")+".")}}var a=l(4);h.name="config";
h.math=!0;h.factory=function(d,c,e,f,g){function m(d){if(d){var e=a.map(c,a.clone);b(d,"matrix",p);b(d,"number",y);a.deepExtend(c,d);var f=a.map(c,a.clone);d=a.map(d,a.clone);g.emit("config",f,e,d);return f}return a.map(c,a.clone)}var p=["Matrix","Array"],y=["number","BigNumber","Fraction"];m.MATRIX=p;m.NUMBER=y;return m}},function(x,h,l){var v=l(16).string.isString;h.name="Matrix";h.path="type";h.factory=function(b,a,d,c){function e(){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");
}e.prototype.type="Matrix";e.prototype.isMatrix=!0;e.storage=function(a){if(!v(a))throw new TypeError("format must be a string value");var b=e._storage[a];if(!b)throw new SyntaxError("Unsupported matrix storage format: "+a);return b};e._storage={};e.prototype.storage=function(){throw Error("Cannot invoke storage on a Matrix interface");};e.prototype.datatype=function(){throw Error("Cannot invoke datatype on a Matrix interface");};e.prototype.create=function(a,b){throw Error("Cannot invoke create on a Matrix interface");
};e.prototype.subset=function(a,b,d){throw Error("Cannot invoke subset on a Matrix interface");};e.prototype.get=function(a){throw Error("Cannot invoke get on a Matrix interface");};e.prototype.set=function(a,b,d){throw Error("Cannot invoke set on a Matrix interface");};e.prototype.resize=function(a,b){throw Error("Cannot invoke resize on a Matrix interface");};e.prototype.reshape=function(a,b){throw Error("Cannot invoke reshape on a Matrix interface");};e.prototype.clone=function(){throw Error("Cannot invoke clone on a Matrix interface");
};e.prototype.size=function(){throw Error("Cannot invoke size on a Matrix interface");};e.prototype.map=function(a,b){throw Error("Cannot invoke map on a Matrix interface");};e.prototype.forEach=function(a){throw Error("Cannot invoke forEach on a Matrix interface");};e.prototype.toArray=function(){throw Error("Cannot invoke toArray on a Matrix interface");};e.prototype.valueOf=function(){throw Error("Cannot invoke valueOf on a Matrix interface");};e.prototype.format=function(a){throw Error("Cannot invoke format on a Matrix interface");
};e.prototype.toString=function(){throw Error("Cannot invoke toString on a Matrix interface");};return e}},function(x,h,l){h.array=l(17);h["boolean"]=l(22);h["function"]=l(23);h.number=l(8);h.object=l(4);h.string=l(18);h.emitter=l(10)},function(x,h,l){function v(a){return a&&a.__esModule?a:{"default":a}}function b(a){for(var b=[];Array.isArray(a);)b.push(a.length),a=a[0];return b}function a(b,d,c){var e=b.length;if(e!==d[c])throw new y["default"](e,d[c]);if(c<d.length-1){var f=c+1;for(c=0;c<e;c++){if(!Array.isArray(b[c]))throw new y["default"](d.length-
1,d.length,"<");a(b[c],d,f)}}else for(c=0;c<e;c++)if(Array.isArray(b[c]))throw new y["default"](d.length+1,d.length,">");}function d(a,b,c,e){var f,g=b[c],m=Math.min(a.length,g);a.length=g;if(c<b.length-1){var p=c+1;for(c=0;c<m;c++)f=a[c],Array.isArray(f)||(f=[f],a[c]=f),d(f,b,p,e);for(c=m;c<g;c++)f=[],a[c]=f,d(f,b,p,e)}else{for(c=0;c<m;c++)for(;Array.isArray(a[c]);)a[c]=a[c][0];for(c=m;c<g;c++)a[c]=e}}function c(a,b){for(var d=a,c,e=b.length-1;0<e;e--){var f=b[e];c=[];for(var g=d.length/f,m=0;m<
g;m++)c.push(d.slice(m*f,(m+1)*f));d=c}return d}function e(a,b,d){var c;if(d<b){var f=d+1;d=0;for(c=a.length;d<c;d++)a[d]=e(a[d],b,f)}else for(;Array.isArray(a);)a=a[0];return a}function f(a,b,d){var c;if(Array.isArray(a)){var e=d+1;d=0;for(c=a.length;d<c;d++)a[d]=f(a[d],b,e)}else for(;d<b;d++)a=[a];return a}function g(a){if(!Array.isArray(a))return a;var b=[];a.forEach(function n(a){Array.isArray(a)?a.forEach(n):b.push(a)});return b}Object.defineProperty(h,"__esModule",{value:!0});h.size=b;h.validate=
function(b,d){if(0===d.length){if(Array.isArray(b))throw new y["default"](b.length,0);}else a(b,d,0)};h.validateIndex=function(a,b){if(!m["default"].isNumber(a)||!m["default"].isInteger(a))throw new TypeError("Index must be an integer (value: "+a+")");if(0>a||"number"===typeof b&&a>=b)throw new C["default"](a,b);};h.resize=function(a,b,c){if(!Array.isArray(a)||!Array.isArray(b))throw new TypeError("Array expected");if(0===b.length)throw Error("Resizing to scalar is not supported");b.forEach(function(a){if(!m["default"].isNumber(a)||
!m["default"].isInteger(a)||0>a)throw new TypeError("Invalid size, must contain positive integers (size: "+p["default"].format(b)+")");});d(a,b,0,void 0!==c?c:0);return a};h.reshape=function(a,d){function e(a){return a.reduce(function(a,b){return a*b})}var f=g(a),m;if(!Array.isArray(a)||!Array.isArray(d))throw new TypeError("Array expected");if(0===d.length)throw new y["default"](0,e(b(a)),"!=");for(var p=1,C=0;C<d.length;C++)p*=d[C];if(f.length!==p)throw new y["default"](e(d),e(b(a)),"!=");try{m=
c(f,d)}catch(A){if(A instanceof y["default"])throw new y["default"](e(d),e(b(a)),"!=");throw A;}return m};h.squeeze=function(a,d){for(var c=d||b(a);Array.isArray(a)&&1===a.length;)a=a[0],c.shift();for(var f=c.length;1===c[f-1];)f--;f<c.length&&(a=e(a,f,0),c.length=f);return a};h.unsqueeze=function(a,d,c,e){e=e||b(a);if(c)for(var g=0;g<c;g++)a=[a],e.unshift(1);for(a=f(a,d,0);e.length<d;)e.push(1);return a};h.flatten=g;h.map=function(a,b){return Array.prototype.map.call(a,b)};h.forEach=function(a,b){Array.prototype.forEach.call(a,
b)};h.filter=function(a,d){if(1!==b(a).length)throw Error("Only one dimensional matrices supported");return Array.prototype.filter.call(a,d)};h.filterRegExp=function(a,d){if(1!==b(a).length)throw Error("Only one dimensional matrices supported");return Array.prototype.filter.call(a,function(a){return d.test(a)})};h.join=function(a,b){return Array.prototype.join.call(a,b)};h.identify=function(a){if(!Array.isArray(a))throw new TypeError("Array input expected");if(0===a.length)return a;var b=[],d=0;b[0]=
{value:a[0],identifier:0};for(var c=1;c<a.length;c++)a[c]===a[c-1]?d++:d=0,b.push({value:a[c],identifier:d});return b};h.generalize=function(a){if(!Array.isArray(a))throw new TypeError("Array input expected");if(0===a.length)return a;for(var b=[],d=0;d<a.length;d++)b.push(a[d].value);return b};var m=v(l(8)),p=v(l(18)),y=v(l(20)),C=v(l(21))},function(x,h,l){function v(a){v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===
typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return v(a)}function b(a,d){if(Array.isArray(a)){for(var c="[",m=a.length,p=0;p<m;p++)0!==p&&(c+=", "),c+=b(a[p],d);return c+"]"}return h.format(a,d)}var a=l(8).format,d=l(19).format,c=l(5);h.isString=function(a){return"string"===typeof a};h.endsWith=function(a,b){return a.substring(a.length-b.length,a.length)===b};h.format=function(e,f){if("number"===typeof e)return a(e,f);if(c(e))return d(e,f);if(e&&"object"===v(e)&&
"number"===typeof e.s&&"number"===typeof e.n&&"number"===typeof e.d)return f&&"decimal"===f.fraction?e.toString():e.s*e.n+"/"+e.d;if(Array.isArray(e))return b(e,f);if(h.isString(e))return'"'+e+'"';if("function"===typeof e)return e.syntax?String(e.syntax):"function";if(e&&"object"===v(e)){if("function"===typeof e.format)return e.format(f);if(e&&e.toString()!=={}.toString())return e.toString();var g=[],m;for(m in e)e.hasOwnProperty(m)&&g.push('"'+m+'": '+h.format(e[m],f));return"{"+g.join(", ")+"}"}return String(e)};
h.stringify=function(a){a=String(a);for(var b="",d=0;d<a.length;){var c=a.charAt(d);if("\\"===c){b+=c;d++;c=a.charAt(d);if(""===c||-1==='"\\/bfnrtu'.indexOf(c))b+="\\";b+=c}else b='"'===c?b+'\\"':b+c;d++}return'"'+b+'"'};h.escape=function(a){a=String(a);return a=a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(x,h,l){var v=l(4);h.format=function(b,a){if("function"===typeof a)return a(b);if(!b.isFinite())return b.isNaN()?"NaN":
b.gt(0)?"Infinity":"-Infinity";var d="auto",c;void 0!==a&&(a.notation&&(d=a.notation),"number"===typeof a?c=a:a.precision&&(c=a.precision));switch(d){case "fixed":return h.toFixed(b,c);case "exponential":return h.toExponential(b,c);case "engineering":return h.toEngineering(b,c);case "auto":if(a&&a.exponential&&(void 0!==a.exponential.lower||void 0!==a.exponential.upper))return c=v.map(a,function(a){return a}),c.exponential=void 0,void 0!==a.exponential.lower&&(c.lowerExp=Math.round(Math.log(a.exponential.lower)/
Math.LN10)),void 0!==a.exponential.upper&&(c.upperExp=Math.round(Math.log(a.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(a)+" with "+JSON.stringify(c)),h.format(b,c);var d=a&&void 0!==a.lowerExp?a.lowerExp:-3,e=a&&void 0!==a.upperExp?a.upperExp:5;if(b.isZero())return"0";
var f=b.e;return(f>=d&&f<e?b.toSignificantDigits(c).toFixed():h.toExponential(b,c)).replace(/((\.\d*?)(0+))($|e)/,function(a,b,d,c,e){return"."!==d?d+e:e});default:throw Error('Unknown notation "'+d+'". Choose "auto", "exponential", or "fixed".');}};h.toEngineering=function(b,a){var d=b.e,c=0===d%3?d:0>d?d-3-d%3:d-d%3,e=Math.abs(d-c);return b.mul(Math.pow(10,e-d)).toPrecision(a).toString()+"e"+(0<=d?"+":"")+c.toString()};h.toExponential=function(b,a){return void 0!==a?b.toExponential(a-1):b.toExponential()};
h.toFixed=function(b,a){return b.toFixed(a)}},function(x,h){function l(h,b,a){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");this.actual=h;this.expected=b;this.relation=a;this.message="Dimension mismatch ("+(Array.isArray(h)?"["+h.join(", ")+"]":h)+" "+(this.relation||"!=")+" "+(Array.isArray(b)?"["+b.join(", ")+"]":b)+")";this.stack=Error().stack}l.prototype=new RangeError;l.prototype.constructor=RangeError;l.prototype.name="DimensionError";l.prototype.isDimensionError=
!0;x.exports=l},function(x,h){function l(h,b,a){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");this.index=h;3>arguments.length?(this.min=0,this.max=b):(this.min=b,this.max=a);this.message=void 0!==this.min&&this.index<this.min?"Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?"Index out of range ("+this.index+" > "+(this.max-1)+")":"Index out of range ("+this.index+")";this.stack=Error().stack}l.prototype=
new RangeError;l.prototype.constructor=RangeError;l.prototype.name="IndexError";l.prototype.isIndexError=!0;x.exports=l},function(x,h){h.isBoolean=function(l){return"boolean"===typeof l}},function(x,h){function l(h){l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return l(h)}h.memoize=function(h,b){return function d(){"object"!==l(d.cache)&&
(d.cache={});for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];e=b?b(c):JSON.stringify(c);e in d.cache||(d.cache[e]=h.apply(h,c));return d.cache[e]}};h.maxArgumentCount=function(l){return Object.keys(l.signatures||{}).reduce(function(b,a){var d=(a.match(/,/g)||[]).length+1;return Math.max(b,d)},-1)};h.callWithRightArgumentCount=function(l,b,a){return Object.keys(l.signatures||{}).reduce(function(a,b){var e=(b.match(/,/g)||[]).length+1;return Math.max(a,e)},-1)}},function(x,h,l){var v=l(16),
b=l(20),a=v.string,d=v.array,c=v.object;x=v.number;var e=Array.isArray,f=x.isNumber,g=x.isInteger,m=a.isString,p=d.validateIndex;h.name="DenseMatrix";h.path="type";h.factory=function(y,C,q,u){function k(a,b){if(!(this instanceof k))throw new SyntaxError("Constructor must be called with the new operator");if(b&&!m(b))throw Error("Invalid datatype: "+b);if(y.isMatrix(a))"DenseMatrix"===a.type?(this._data=c.clone(a._data),this._size=c.clone(a._size)):(this._data=a.toArray(),this._size=a.size()),this._datatype=
b||a._datatype;else if(a&&e(a.data)&&e(a.size))this._data=a.data,this._size=a.size,this._datatype=b||a.datatype;else{if(e(a))this._data=h(a),this._size=d.size(this._data),d.validate(this._data,this._size);else{if(a)throw new TypeError("Unsupported type of data ("+v.types.type(a)+")");this._data=[];this._size=[0]}this._datatype=b}}function n(a,b,d,c){var e=c===d-1,f=b.dimension(c);return e?f.map(function(b){p(b,a.length);return a[b]}).valueOf():f.map(function(e){p(e,a.length);return n(a[e],b,d,c+1)}).valueOf()}
function r(a,e,f,g){if(!e||!0!==e.isIndex)throw new TypeError("Invalid index");var m=e.size(),k=e.isScalar(),p;y.isMatrix(f)?(p=f.size(),f=f.valueOf()):p=d.size(f);if(k){if(0!==p.length)throw new TypeError("Scalar expected");a.set(e.min(),f,g)}else{if(m.length<a._size.length)throw new b(m.length,a._size.length,"<");if(p.length<m.length){for(var r=k=0;1===m[k]&&1===p[k];)k++;for(;1===m[k];)r++,k++;f=d.unsqueeze(f,m.length,r,p)}if(!c.deepEqual(m,p))throw new b(m,p,">");p=e.max().map(function(a){return a+
1});A(a,p,g);s(a._data,e,f,m.length,0)}return a}function s(a,b,d,c,e){var f=e===c-1,g=b.dimension(e);f?g.forEach(function(b,c){p(b);a[b]=d[c[0]]}):g.forEach(function(f,g){p(f);s(a[f],b,d[g[0]],c,e+1)})}function t(a,b,c){if(0===b.length){for(a=a._data;e(a);)a=a[0];return a}a._size=b.slice(0);a._data=d.resize(a._data,a._size,c);return a}function A(a,b,d){for(var c=a._size.slice(0),e=!1;c.length<b.length;)c.push(0),e=!0;for(var f=0,g=b.length;f<g;f++)b[f]>c[f]&&(c[f]=b[f],e=!0);e&&t(a,c,d)}function h(a){for(var b=
0,d=a.length;b<d;b++){var c=a[b];e(c)?a[b]=h(c):c&&!0===c.isMatrix&&(a[b]=h(c.valueOf()))}return a}var P=q(l(25));C=q(l(15));k.prototype=new C;k.prototype.type="DenseMatrix";k.prototype.isDenseMatrix=!0;k.prototype.getDataType=function(){return P(this._data)};k.prototype.storage=function(){return"dense"};k.prototype.datatype=function(){return this._datatype};k.prototype.create=function(a,b){return new k(a,b)};k.prototype.subset=function(a,d,c){switch(arguments.length){case 1:var e;if(!y.isIndex(a))throw new TypeError("Invalid index");
if(a.isScalar())e=this.get(a.min());else{e=a.size();if(e.length!==this._size.length)throw new b(e.length,this._size.length);for(var f=a.min(),g=a.max(),m=0,C=this._size.length;m<C;m++)p(f[m],this._size[m]),p(g[m],this._size[m]);e=new k(n(this._data,a,e.length,0),this._datatype)}return e;case 2:case 3:return r(this,a,d,c);default:throw new SyntaxError("Wrong number of arguments");}};k.prototype.get=function(a){if(!e(a))throw new TypeError("Array expected");if(a.length!==this._size.length)throw new b(a.length,
this._size.length);for(var d=0;d<a.length;d++)p(a[d],this._size[d]);for(var d=this._data,c=0,f=a.length;c<f;c++){var g=a[c];p(g,d.length);d=d[g]}return d};k.prototype.set=function(a,d,c){if(!e(a))throw new TypeError("Array expected");if(a.length<this._size.length)throw new b(a.length,this._size.length,"<");var f,g;f=a.map(function(a){return a+1});A(this,f,c);var m=this._data;c=0;for(f=a.length-1;c<f;c++)g=a[c],p(g,m.length),m=m[g];g=a[a.length-1];p(g,m.length);m[g]=d;return this};k.prototype.resize=
function(a,b,d){if(!e(a))throw new TypeError("Array expected");d=d?this.clone():this;return t(d,a,b)};k.prototype.reshape=function(a,b){var c=b?this.clone():this;c._data=d.reshape(c._data,a);c._size=a.slice(0);return c};k.prototype.clone=function(){return new k({data:c.clone(this._data),size:c.clone(this._size),datatype:this._datatype})};k.prototype.size=function(){return this._size.slice(0)};k.prototype.map=function(a){var b=this;return new k({data:function E(d,c){return e(d)?d.map(function(a,b){return E(a,
c.concat(b))}):a(d,c,b)}(this._data,[]),size:c.clone(this._size),datatype:this._datatype})};k.prototype.forEach=function(a){var b=this;(function E(d,c){e(d)?d.forEach(function(a,b){E(a,c.concat(b))}):a(d,c,b)})(this._data,[])};k.prototype.toArray=function(){return c.clone(this._data)};k.prototype.valueOf=function(){return this._data};k.prototype.format=function(b){return a.format(this._data,b)};k.prototype.toString=function(){return a.format(this._data)};k.prototype.toJSON=function(){return{mathjs:"DenseMatrix",
data:this._data,size:this._size,datatype:this._datatype}};k.prototype.diagonal=function(a){if(a){if(y.isBigNumber(a)&&(a=a.toNumber()),!f(a)||!g(a))throw new TypeError("The parameter k must be an integer number");}else a=0;var b=0<a?a:0;a=0>a?-a:0;for(var d=Math.min(this._size[0]-a,this._size[1]-b),c=[],e=0;e<d;e++)c[e]=this._data[e+a][e+b];return new k({data:c,size:[d],datatype:this._datatype})};k.diagonal=function(a,b,c,p,r){if(!e(a))throw new TypeError("Array expected, size parameter");if(2!==
a.length)throw Error("Only two dimensions matrix are supported");a=a.map(function(a){y.isBigNumber(a)&&(a=a.toNumber());if(!f(a)||!g(a)||1>a)throw Error("Size values must be positive integers");return a});if(c){if(y.isBigNumber(c)&&(c=c.toNumber()),!f(c)||!g(c))throw new TypeError("The parameter k must be an integer number");}else c=0;p&&m(r)&&(p=u.convert(p,r));r=0<c?c:0;c=0>c?-c:0;var C=a[0],n=a[1],t=Math.min(C-c,n-r),q;if(e(b)){if(b.length!==t)throw Error("Invalid value array length");q=function(a){return b[a]}}else if(y.isMatrix(b)){q=
b.size();if(1!==q.length||q[0]!==t)throw Error("Invalid matrix length");q=function(a){return b.get([a])}}else q=function(){return b};p||(p=y.isBigNumber(q(0))?new y.BigNumber(0):0);var s=[];if(0<a.length)for(s=d.resize(s,a,p),a=0;a<t;a++)s[a+c][a+r]=q(a);return new k({data:s,size:[C,n]})};k.fromJSON=function(a){return new k(a)};k.prototype.swapRows=function(a,b){if(!(f(a)&&g(a)&&f(b)&&g(b)))throw Error("Row index must be positive integers");if(2!==this._size.length)throw Error("Only two dimensional matrix is supported");
p(a,this._size[0]);p(b,this._size[0]);k._swapRows(a,b,this._data);return this};k._swapRows=function(a,b,d){var c=d[a];d[a]=d[b];d[b]=c};y.Matrix._storage.dense=k;return y.Matrix._storage["default"]=k};h.lazy=!1},function(x,h,l){h.factory=function(h,b,a,d){function c(a){for(var b,d=0,p=0;p<a.length;p++){var y=a[p],C=Array.isArray(y);0===p&&C&&(d=y.length);if(C&&y.length!==d)return;y=C?c(y):e(y);if(void 0===b)b=y;else if(b!==y)return"mixed"}return b}var e=a(l(26));return c}},function(x,h){function l(h){l=
"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return l(h)}h.name="typeof";h.factory=function(h,b,a,d){b=d("_typeof",{any:function(a){var b=l(a);return"object"===b?null===a?"null":Array.isArray(a)?"Array":a instanceof Date?"Date":a instanceof RegExp?"RegExp":h.isBigNumber(a)?"BigNumber":h.isComplex(a)?"Complex":h.isFraction(a)?"Fraction":h.isMatrix(a)?
"Matrix":h.isUnit(a)?"Unit":h.isIndex(a)?"Index":h.isRange(a)?"Range":h.isResultSet(a)?"ResultSet":h.isNode(a)?a.type:h.isChain(a)?"Chain":h.isHelp(a)?"Help":"Object":"function"===b?"Function":b}});b.toTex=void 0;return b}},function(x,h,l){var v=l(28);h.name="sin";h.factory=function(b,a,d,c){var e=c("sin",{number:Math.sin,Complex:function(a){return a.sin()},BigNumber:function(a){return a.sin()},Unit:function(a){if(!a.hasBase(b.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");
return e(a.value)},"Array | Matrix":function(a){return v(a,e,!0)}});e.toTex={1:"\\sin\\left(${args[0]}\\right)"};return e}},function(x,h){x.exports=function v(b,a,d){return b&&"function"===typeof b.map?b.map(function(b){return v(b,a,d)}):a(b)}},function(x,h,l){var v=l(28);h.name="cos";h.factory=function(b,a,d,c){var e=c("cos",{number:Math.cos,Complex:function(a){return a.cos()},BigNumber:function(a){return a.cos()},Unit:function(a){if(!a.hasBase(b.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");
return e(a.value)},"Array | Matrix":function(a){return v(a,e)}});e.toTex={1:"\\cos\\left(${args[0]}\\right)"};return e}},function(x,h,l){var v=l(28);h.name="sqrt";h.factory=function(b,a,d,c){function e(d){return isNaN(d)?NaN:0<=d||a.predictable?Math.sqrt(d):(new b.Complex(d,0)).sqrt()}var f=c("sqrt",{number:e,Complex:function(a){return a.sqrt()},BigNumber:function(b){return!b.isNegative()||a.predictable?b.sqrt():e(b.toNumber())},"Array | Matrix":function(a){return v(a,f,!0)},Unit:function(a){return a.pow(.5)}});
f.toTex={1:"\\sqrt{${args[0]}}"};return f}},function(x,h,l){h.name="norm";h.factory=function(h,b,a,d){function c(a,b){var d=a.size();if(1===d.length){if(b===Number.POSITIVE_INFINITY||"inf"===b){var k=0;a.forEach(function(a){a=e(a);q(a,k)&&(k=a)},!0);return k}if(b===Number.NEGATIVE_INFINITY||"-inf"===b){var n;a.forEach(function(a){a=e(a);if(!n||u(a,n))n=a},!0);return n||0}if("fro"===b)return c(a,2);if("number"===typeof b&&!isNaN(b)){if(!C(b,0)){var h=0;a.forEach(function(a){h=f(g(e(a),b),h)},!0);return g(h,
1/b)}return Number.POSITIVE_INFINITY}throw Error("Unsupported parameter value");}if(2===d.length){if(1===b){var l=[],N=0;a.forEach(function(a,b){var d=b[1],c=f(l[d]||0,e(a));q(c,N)&&(N=c);l[d]=c},!0);return N}if(b===Number.POSITIVE_INFINITY||"inf"===b){var J=[],E=0;a.forEach(function(a,b){var d=b[0],c=f(J[d]||0,e(a));q(c,E)&&(E=c);J[d]=c},!0);return E}if("fro"===b){var L=0;a.forEach(function(a,b){L=f(L,y(a,m(a)))});return e(p(L))}if(2===b)throw Error("Unsupported parameter value, missing implementation of matrix singular value decomposition");
throw Error("Unsupported parameter value");}}var e=a(l(32)),f=a(l(33)),g=a(l(45)),m=a(l(52)),p=a(l(30)),y=a(l(47)),C=a(l(40)),q=a(l(53)),u=a(l(57)),k=a(l(34)),n=d("norm",{number:Math.abs,Complex:function(a){return a.abs()},BigNumber:function(a){return a.abs()},"boolean":function(a){return Math.abs(a)},Array:function(a){return c(k(a),2)},Matrix:function(a){return c(a,2)},"number | Complex | BigNumber | boolean, number | BigNumber | string":function(a){return n(a)},"Array, number | BigNumber | string":function(a,
b){return c(k(a),b)},"Matrix, number | BigNumber | string":function(a,b){return c(a,b)}});n.toTex={1:"\\left\\|${args[0]}\\right\\|",2:void 0};return n}},function(x,h,l){var v=l(28);h.name="abs";h.factory=function(b,a,d,c){var e=c("abs",{number:Math.abs,Complex:function(a){return a.abs()},BigNumber:function(a){return a.abs()},Fraction:function(a){return a.abs()},"Array | Matrix":function(a){return v(a,e,!0)},Unit:function(a){return a.abs()}});e.toTex={1:"\\left|${args[0]}\\right|"};return e}},function(x,
h,l){var v=l(4).extend;h.name="add";h.factory=function(b,a,d,c){var e=d(l(34)),f=d(l(35));b=l(36);var g=d(l(38)),m=d(l(39)),p=d(l(42)),y=d(l(43)),C=d(l(44)),q=c("add",v({"DenseMatrix, DenseMatrix":function(a,b){return y(a,b,f)},"DenseMatrix, SparseMatrix":function(a,b){return g(a,b,f,!1)},"SparseMatrix, DenseMatrix":function(a,b){return g(b,a,f,!0)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,f)},"Array, Array":function(a,b){return q(e(a),e(b)).valueOf()},"Array, Matrix":function(a,b){return q(e(a),
b)},"Matrix, Array":function(a,b){return q(a,e(b))},"DenseMatrix, any":function(a,b){return C(a,b,f,!1)},"SparseMatrix, any":function(a,b){return p(a,b,f,!1)},"any, DenseMatrix":function(a,b){return C(b,a,f,!0)},"any, SparseMatrix":function(a,b){return p(b,a,f,!0)},"Array, any":function(a,b){return C(e(a),b,f,!1).valueOf()},"any, Array":function(a,b){return C(e(b),a,f,!0).valueOf()},"any, any":f,"any, any, ...any":function(a,b,d){a=q(a,b);for(b=0;b<d.length;b++)a=q(a,d[b]);return a}},f.signatures));
q.toTex={2:"\\left(${args[0]}".concat(b.operators.add,"${args[1]}\\right)")};return q}},function(x,h){h.name="matrix";h.factory=function(h,v,b,a){function d(a,b,d){return new (h.Matrix.storage(b||"default"))(a,d)}v=a("matrix",{"":function(){return d([])},string:function(a){return d([],a)},"string, string":function(a,b){return d([],a,b)},Array:function(a){return d(a)},Matrix:function(a){return d(a,a.storage())},"Array | Matrix, string":d,"Array | Matrix, string, string":d});v.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",
1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"};return v}},function(x,h){h.factory=function(h,v,b,a){var d=a("add",{"number, number":function(a,b){return a+b},"Complex, Complex":function(a,b){return a.add(b)},"BigNumber, BigNumber":function(a,b){return a.plus(b)},"Fraction, Fraction":function(a,b){return a.add(b)},"Unit, Unit":function(a,b){if(null===a.value||void 0===a.value)throw Error("Parameter x contains a unit with undefined value");if(null===b.value||void 0===b.value)throw Error("Parameter y contains a unit with undefined value");
if(!a.equalBase(b))throw Error("Units do not match");var f=a.clone();f.value=d(f.value,b.value);f.fixPrefix=!1;return f}});return d}},function(x,h,l){var v=l(37);h.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",
Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega","true":"\\mathrm{True}","false":"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",
infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"};h.operators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",
bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"};h.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var b={deg:"^\\circ"};h.escape=function(a){return v(a,{preserveFormatting:!0})};h.toSymbol=function(a,d){return("undefined"===typeof d?0:d)?b.hasOwnProperty(a)?b[a]:"\\mathrm{"+h.escape(a)+"}":h.symbols.hasOwnProperty(a)?h.symbols[a]:h.escape(a)}},function(x,h){var l=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b],f;for(f in e)Object.prototype.hasOwnProperty.call(e,
f)&&(a[f]=e[f])}return a},v={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},b={"\u2013":"\\--","\u2014":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},a=function(a,b){return l({},a,b)};x.exports=function(d){for(var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=c.preserveFormatting,e=void 0===e?!1:e,c=c.escapeMapFn,f=String(d),g="",m=(void 0===c?a:c)(l({},v),e?
l({},b):{}),p=Object.keys(m),c=function(){var a=!1;p.forEach(function(b,d){!a&&f.length>=b.length&&f.slice(0,b.length)===b&&(g+=m[p[d]],f=f.slice(b.length,f.length),a=!0)});a||(g+=f.slice(0,1),f=f.slice(1,f.length))};f;)c();return g}},function(x,h,l){var v=l(20);h.name="algorithm01";h.factory=function(b,a,d,c){var e=b.DenseMatrix;return function(a,b,d,p){var y=a._data,C=a._size,q=a._datatype;a=b._values;var u=b._index,k=b._ptr,n=b._size,r=b._datatype;if(C.length!==n.length)throw new v(C.length,n.length);
if(C[0]!==n[0]||C[1]!==n[1])throw new RangeError("Dimension mismatch. Matrix A ("+C+") must match Matrix B ("+n+")");if(!a)throw Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");b=C[0];C=C[1];d=(q="string"===typeof q&&q===r?q:void 0)?c.find(d,[q,q]):d;for(var s=[],r=0;r<b;r++)s[r]=[];for(var t=[],A=[],n=0;n<C;n++){for(var h=n+1,l=k[n+1],z=k[n];z<l;z++)r=u[z],t[r]=p?d(a[z],y[r][n]):d(y[r][n],a[z]),A[r]=h;for(r=0;r<b;r++)s[r][n]=A[r]===h?t[r]:y[r][n]}return new e({data:s,
size:[b,C],datatype:q})}}},function(x,h,l){var v=l(20);h.name="algorithm04";h.factory=function(b,a,d,c){var e=d(l(40)),f=b.SparseMatrix;return function(a,b,d){var y=a._values,C=a._index,q=a._ptr,u=a._size,k=a._datatype;a=b._values;var n=b._index,r=b._ptr,s=b._size,t=b._datatype;if(u.length!==s.length)throw new v(u.length,s.length);if(u[0]!==s[0]||u[1]!==s[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+s+")");var A=u[0],u=u[1],h;b=e;var s=0,l=d;"string"===typeof k&&
k===t&&(h=k,b=c.find(e,[h,h]),s=c.convert(0,h),l=c.find(d,[h,h]));d=y&&a?[]:void 0;k=[];t=[];h=new f({values:d,index:k,ptr:t,size:[A,u],datatype:h});var A=y&&a?[]:void 0,z=y&&a?[]:void 0,N=[],J=[],E,L,D,Q;for(L=0;L<u;L++){t[L]=k.length;var T=L+1;E=q[L];Q=q[L+1];for(D=E;D<Q;D++)E=C[D],k.push(E),N[E]=T,A&&(A[E]=y[D]);E=r[L];Q=r[L+1];for(D=E;D<Q;D++)if(E=n[D],N[E]===T){if(A){var O=l(A[E],a[D]);b(O,s)?N[E]=null:A[E]=O}}else k.push(E),J[E]=T,z&&(z[E]=a[D]);if(A&&z)for(D=t[L];D<k.length;)E=k[D],N[E]===
T?(d[D]=A[E],D++):J[E]===T?(d[D]=z[E],D++):k.splice(D,1)}t[u]=k.length;return h}}},function(x,h,l){var v=l(8).nearlyEqual,b=l(41);h.factory=function(a,d,c,e){var f=e("equalScalar",{"boolean, boolean":function(a,b){return a===b},"number, number":function(a,b){return a===b||v(a,b,d.epsilon)},"BigNumber, BigNumber":function(a,c){return a.eq(c)||b(a,c,d.epsilon)},"Fraction, Fraction":function(a,b){return a.equals(b)},"Complex, Complex":function(a,b){return a.equals(b)},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");
return f(a.value,b.value)}});return f}},function(x,h){x.exports=function(h,v,b){if(null===b||void 0===b)return h.eq(v);if(h.eq(v))return!0;if(h.isNaN()||v.isNaN())return!1;if(h.isFinite()&&v.isFinite()){var a=h.minus(v).abs();if(a.isZero())return!0;h=h.constructor.max(h.abs(),v.abs());return a.lte(h.times(b))}return!1}},function(x,h){h.name="algorithm10";h.factory=function(h,v,b,a){var d=h.DenseMatrix;return function(b,e,f,g){var m=b._values,p=b._index,y=b._ptr,C=b._size,q=b._datatype;if(!m)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");
b=C[0];var C=C[1],u,k=f;"string"===typeof q&&(u=q,e=a.convert(e,u),k=a.find(f,[u,u]));f=[];u=new d({data:f,size:[b,C],datatype:u});for(var q=[],n=[],r=0;r<C;r++){for(var s=r+1,t=y[r+1],A=y[r];A<t;A++){var h=p[A];q[h]=m[A];n[h]=s}for(t=0;t<b;t++)0===r&&(f[t]=[]),f[t][r]=n[t]===s?g?k(e,q[t]):k(q[t],e):e}return u}}},function(x,h,l){var v=l(20);h.name="algorithm13";h.factory=function(b,a,d,c){function e(a,b,d,c,f,q){var u=[];if(b===d.length-1)for(b=0;b<c;b++)u[b]=a(f[b],q[b]);else for(var k=0;k<c;k++)u[k]=
e(a,b+1,d,d[b+1],f[k],q[k]);return u}var f=b.DenseMatrix;return function(a,b,d){var y=a._data,C=a._size;a=a._datatype;var q=b._data,u=b._size,k=b._datatype;b=[];if(C.length!==u.length)throw new v(C.length,u.length);for(var n=0;n<C.length;n++){if(C[n]!==u[n])throw new RangeError("Dimension mismatch. Matrix A ("+C+") must match Matrix B ("+u+")");b[n]=C[n]}var r,C=d;"string"===typeof a&&a===k&&(r=a,C=c.find(d,[r,r]));d=0<b.length?e(C,0,b,b[0],y,q):[];return new f({data:d,size:b,datatype:r})}}},function(x,
h,l){var v=l(4).clone;h.name="algorithm14";h.factory=function(b,a,d,c){function e(a,b,d,c,f,q,u){var k=[];if(b===d.length-1)for(b=0;b<c;b++)k[b]=u?a(q,f[b]):a(f[b],q);else for(var n=0;n<c;n++)k[n]=e(a,b+1,d,d[b+1],f[n],q,u);return k}var f=b.DenseMatrix;return function(a,b,d,y){var C=a._data,q=a._size;a=a._datatype;var u,k=d;"string"===typeof a&&(u=a,b=c.convert(b,u),k=c.find(d,[u,u]));b=0<q.length?e(k,0,q,q[0],C,b,y):[];return new f({data:b,size:v(q),datatype:u})}}},function(x,h,l){var v=l(8).isInteger,
b=l(17).size;h.name="pow";h.factory=function(a,d,c,e){function f(b,c){if(d.predictable&&!v(c)&&0>b)try{var e=u(c),f=k(e);if((c===f||1E-14>Math.abs((c-f)/c))&&1===e.d%2)return(0===e.n%2?1:-1)*Math.pow(-b,c)}catch(g){}return 1>b*b&&Infinity===c||1<b*b&&-Infinity===c?0:d.predictable&&(-1>b&&Infinity===c||-1<b&&0>b&&-Infinity===c)?NaN:v(c)||0<=b||d.predictable?Math.pow(b,c):(new a.Complex(b,0)).pow(c,0)}function g(a,d){if(!v(d)||0>d)throw new TypeError("For A^b, b must be a positive integer (value is "+
d+")");var c=b(a);if(2!==c.length)throw Error("For A^b, A must be 2 dimensional (A has "+c.length+" dimensions)");if(c[0]!==c[1])throw Error("For A^b, A must be square (size is "+c[0]+"x"+c[1]+")");for(var c=y(c[0]).valueOf(),e=a;1<=d;)1===(d&1)&&(c=C(e,c)),d>>=1,e=C(e,e);return c}function m(a,b){return q(g(a.valueOf(),b))}var p=l(36),y=c(l(46)),C=c(l(47)),q=c(l(34)),u=c(l(50)),k=c(l(51));c=e("pow",{"number, number":f,"Complex, Complex":function(a,b){return a.pow(b)},"BigNumber, BigNumber":function(b,
c){return c.isInteger()||0<=b||d.predictable?b.pow(c):(new a.Complex(b.toNumber(),0)).pow(c.toNumber(),0)},"Fraction, Fraction":function(a,b){if(1!==b.d){if(d.predictable)throw Error("Function pow does not support non-integer exponents for fractions.");return f(a.valueOf(),b.valueOf())}return a.pow(b)},"Array, number":g,"Array, BigNumber":function(a,b){return g(a,b.toNumber())},"Matrix, number":m,"Matrix, BigNumber":function(a,b){return m(a,b.toNumber())},"Unit, number | BigNumber":function(a,b){return a.pow(b)}});
c.toTex={2:"\\left(${args[0]}\\right)".concat(p.operators.pow,"{${args[1]}}")};return c}},function(x,h,l){var v=l(17),b=l(8).isInteger;h.name="identity";h.factory=function(a,d,c,e){function f(a,b){switch(a.length){case 0:return b?m(b):[];case 1:return g(a[0],a[0],b);case 2:return g(a[0],a[1],b);default:throw Error("Vector containing two values expected");}}function g(d,c,e){var f=a.isBigNumber(d)||a.isBigNumber(c)?a.BigNumber:null;a.isBigNumber(d)&&(d=d.toNumber());a.isBigNumber(c)&&(c=c.toNumber());
if(!b(d)||1>d)throw Error("Parameters in function identity must be positive integers");if(!b(c)||1>c)throw Error("Parameters in function identity must be positive integers");var g=f?new a.BigNumber(1):1,f=f?new f(0):0,m=[d,c];if(e)return a.Matrix.storage(e).diagonal(m,g,0,f);e=v.resize([],m,f);d=d<c?d:c;for(c=0;c<d;c++)e[c][c]=g;return e}var m=c(l(34));c=e("identity",{"":function(){return"Matrix"===d.matrix?m([]):[]},string:function(a){return m(a)},"number | BigNumber":function(a){return g(a,a,"Matrix"===
d.matrix?"default":void 0)},"number | BigNumber, string":function(a,b){return g(a,a,b)},"number | BigNumber, number | BigNumber":function(a,b){return g(a,b,"Matrix"===d.matrix?"default":void 0)},"number | BigNumber, number | BigNumber, string":function(a,b,d){return g(a,b,d)},Array:function(a){return f(a)},"Array, string":function(a,b){return f(a,b)},Matrix:function(a){return f(a.valueOf(),a.storage())},"Matrix, string":function(a,b){return f(a.valueOf(),b)}});c.toTex=void 0;return c}},function(x,
h,l){var v=l(4).extend,b=l(17);h.name="multiply";h.factory=function(a,d,c,e){function f(a,b){switch(a.length){case 1:switch(b.length){case 1:if(a[0]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(a[0]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+a[0]+") must match Matrix rows ("+b[0]+")");break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+b.length+" dimensions)");
}break;case 2:switch(b.length){case 1:if(a[1]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+a[1]+") must match Vector length ("+b[0]+")");break;case 2:if(a[1]!==b[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+a[1]+") must match Matrix B rows ("+b[0]+")");break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+b.length+" dimensions)");}break;default:throw Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+
a.length+" dimensions)");}}d=l(36);var g=c(l(34)),m=c(l(35)),p=c(l(48)),y=c(l(40)),C=c(l(49)),q=c(l(44)),u=a.DenseMatrix,k=a.SparseMatrix,n=e("multiply",v({"Array, Array":function(d,c){f(b.size(d),b.size(c));var e=n(g(d),g(c));return a.isMatrix(e)?e.valueOf():e},"Matrix, Matrix":function(a,b){var d=a.size(),c=b.size();f(d,c);if(1===d.length){if(1===c.length){var g=d[0];if(0===g)throw Error("Cannot multiply two empty vectors");var d=a._data,k=a._datatype,c=b._data,y=b._datatype,C=m,q=p;k&&y&&k===y&&
"string"===typeof k&&(C=e.find(m,[k,k]),q=e.find(p,[k,k]));k=q(d[0],c[0]);for(y=1;y<g;y++)k=C(k,q(d[y],c[y]));return k}if("dense"!==b.storage())throw Error("Support for SparseMatrix not implemented");var d=a._data,n=a._datatype,c=b._data,l=b._datatype,C=a._size[0],q=b._size[1],k=m,y=p;n&&l&&n===l&&"string"===typeof n&&(g=n,k=e.find(m,[g,g]),y=e.find(p,[g,g]));n=[];for(l=0;l<q;l++){for(var v=y(d[0],c[0][l]),O=1;O<C;O++)v=k(v,y(d[O],c[O][l]));n[l]=v}return new u({data:n,size:[q],datatype:g})}return 1===
c.length?r(a,b):h(a,b)},"Matrix, Array":function(a,b){return n(a,g(b))},"Array, Matrix":function(a,b){return n(g(a,b.storage()),b)},"SparseMatrix, any":function(a,b){return C(a,b,p,!1)},"DenseMatrix, any":function(a,b){return q(a,b,p,!1)},"any, SparseMatrix":function(a,b){return C(b,a,p,!0)},"any, DenseMatrix":function(a,b){return q(b,a,p,!0)},"Array, any":function(a,b){return q(g(a),b,p,!1).valueOf()},"any, Array":function(a,b){return q(g(b),a,p,!0).valueOf()},"any, any":p,"any, any, ...any":function(a,
b,d){a=n(a,b);for(b=0;b<d.length;b++)a=n(a,d[b]);return a}},p.signatures)),r=e("_multiplyMatrixVector",{"DenseMatrix, any":function(a,b){var d=a._data,c=a._size,f=a._datatype,g=b._data,k=b._datatype,y=c[0],c=c[1],C,q=m,r=p;f&&k&&f===k&&"string"===typeof f&&(C=f,q=e.find(m,[C,C]),r=e.find(p,[C,C]));f=[];for(k=0;k<y;k++){for(var n=d[k],h=r(n[0],g[0]),s=1;s<c;s++)h=q(h,r(n[s],g[s]));f[k]=h}return new u({data:f,size:[y],datatype:C})},"SparseMatrix, any":function(a,b){var d=a._values,c=a._index,f=a._ptr,
g=a._datatype;if(!d)throw Error("Cannot multiply Pattern only Matrix times Dense Matrix");var C=b._data,q=b._datatype,r=a._size[0],n=b._size[0],u=[],h=[],s=[],l,v=m,x=p,M=y,H=0;g&&q&&g===q&&"string"===typeof g&&(l=g,v=e.find(m,[l,l]),x=e.find(p,[l,l]),M=e.find(y,[l,l]),H=e.convert(0,l));for(var g=[],q=[],I=s[0]=0;I<n;I++){var F=C[I];if(!M(F,H))for(var S=f[I+1],R=f[I];R<S;R++){var X=c[R];q[X]?g[X]=v(g[X],x(F,d[R])):(q[X]=!0,h.push(X),g[X]=x(F,d[R]))}}d=h.length;for(c=0;c<d;c++)u[c]=g[h[c]];s[1]=h.length;
return new k({values:u,index:h,ptr:s,size:[r,1],datatype:l})}}),h=e("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(a,b){var d=a._data,c=a._size,f=a._datatype,g=b._data,k=b._datatype,y=c[0],c=c[1],C=b._size[1],q,r=m,n=p;f&&k&&f===k&&"string"===typeof f&&(q=f,r=e.find(m,[q,q]),n=e.find(p,[q,q]));f=[];for(k=0;k<y;k++){var h=d[k];f[k]=[];for(var s=0;s<C;s++){for(var l=n(h[0],g[0][s]),v=1;v<c;v++)l=r(l,n(h[v],g[v][s]));f[k][s]=l}}return new u({data:f,size:[y,C],datatype:q})},"DenseMatrix, SparseMatrix":function(a,
b){var d=a._data,c=a._size,f=a._datatype,g=b._values,C=b._index,q=b._ptr,r=b._size,n=b._datatype;if(!g)throw Error("Cannot multiply Dense Matrix times Pattern only Matrix");var c=c[0],r=r[1],u,h=m,s=p,l=y,v=0;f&&n&&f===n&&"string"===typeof f&&(u=f,h=e.find(m,[u,u]),s=e.find(p,[u,u]),l=e.find(y,[u,u]),v=e.convert(0,u));var f=[],n=[],x=[];u=new k({values:f,index:n,ptr:x,size:[c,r],datatype:u});for(var M=0;M<r;M++){x[M]=n.length;var H=q[M],I=q[M+1];if(I>H)for(var F=0,S=0;S<c;S++){for(var R=S+1,X=void 0,
ca=H;ca<I;ca++){var W=C[ca];F!==R?(X=s(d[S][W],g[ca]),F=R):X=h(X,s(d[S][W],g[ca]))}F!==R||l(X,v)||(n.push(S),f.push(X))}}x[r]=n.length;return u},"SparseMatrix, DenseMatrix":function(a,b){var d=a._values,c=a._index,f=a._ptr,g=a._datatype;if(!d)throw Error("Cannot multiply Pattern only Matrix times Dense Matrix");var C=b._data,q=b._datatype,r=a._size[0],n=b._size[0],u=b._size[1],h,s=m,l=p,v=y,x=0;g&&q&&g===q&&"string"===typeof g&&(h=g,s=e.find(m,[h,h]),l=e.find(p,[h,h]),v=e.find(y,[h,h]),x=e.convert(0,
h));var g=[],q=[],M=[],r=new k({values:g,index:q,ptr:M,size:[r,u],datatype:h});h=[];for(var H=[],I=0;I<u;I++){M[I]=q.length;for(var F=I+1,S=0;S<n;S++){var R=C[S][I];if(!v(R,x))for(var X=f[S+1],ca=f[S];ca<X;ca++){var W=c[ca];H[W]!==F?(H[W]=F,q.push(W),h[W]=l(R,d[ca])):h[W]=s(h[W],l(R,d[ca]))}}F=q.length;for(S=M[I];S<F;S++)g[S]=h[q[S]]}M[u]=q.length;return r},"SparseMatrix, SparseMatrix":function(a,b){var d=a._values,c=a._index,f=a._ptr,g=a._datatype,y=b._values,C=b._index,q=b._ptr,r=b._datatype,u=
a._size[0],n=b._size[1],h=d&&y,s,l=m,v=p;g&&r&&g===r&&"string"===typeof g&&(s=g,l=e.find(m,[s,s]),v=e.find(p,[s,s]));var g=h?[]:void 0,r=[],x=[],u=new k({values:g,index:r,ptr:x,size:[u,n],datatype:s});s=h?[]:void 0;for(var H=[],I,F,S,R,X,ca=0;ca<n;ca++){x[ca]=r.length;var W=ca+1;S=q[ca];for(R=q[ca+1];S<R;S++)if(F=C[S],h)for(I=f[F],F=f[F+1];I<F;I++)X=c[I],H[X]!==W?(H[X]=W,r.push(X),s[X]=v(y[S],d[I])):s[X]=l(s[X],v(y[S],d[I]));else for(I=f[F],F=f[F+1];I<F;I++)X=c[I],H[X]!==W&&(H[X]=W,r.push(X));if(h)for(R=
r.length,W=x[ca];W<R;W++)g[W]=s[r[W]]}x[n]=r.length;return u}});n.toTex={2:"\\left(${args[0]}".concat(d.operators.multiply,"${args[1]}\\right)")};return n}},function(x,h){h.factory=function(h,v,b,a){var d=a("multiplyScalar",{"number, number":function(a,b){return a*b},"Complex, Complex":function(a,b){return a.mul(b)},"BigNumber, BigNumber":function(a,b){return a.times(b)},"Fraction, Fraction":function(a,b){return a.mul(b)},"number | Fraction | BigNumber | Complex, Unit":function(a,b){var f=b.clone();
f.value=null===f.value?f._normalize(a):d(f.value,a);return f},"Unit, number | Fraction | BigNumber | Complex":function(a,b){var f=a.clone();f.value=null===f.value?f._normalize(b):d(f.value,b);return f},"Unit, Unit":function(a,b){return a.multiply(b)}});return d}},function(x,h,l){h.name="algorithm11";h.factory=function(h,b,a,d){var c=a(l(40)),e=h.SparseMatrix;return function(a,b,m,p){var y=a._values,C=a._index,q=a._ptr,u=a._size,k=a._datatype;if(!y)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");
var n=u[0],u=u[1],r;a=c;var h=0,l=m;"string"===typeof k&&(r=k,a=d.find(c,[r,r]),h=d.convert(0,r),b=d.convert(b,r),l=d.find(m,[r,r]));m=[];var k=[],A=[];r=new e({values:m,index:k,ptr:A,size:[n,u],datatype:r});for(n=0;n<u;n++){A[n]=k.length;for(var B=q[n+1],v=q[n];v<B;v++){var z=C[v],N=p?l(b,y[v]):l(y[v],b);a(N,h)||(k.push(z),m.push(N))}}A[u]=k.length;return r}}},function(x,h,l){var v=l(28);h.name="fraction";h.factory=function(b,a,d,c){var e=c("fraction",{number:function(a){if(!isFinite(a)||isNaN(a))throw Error(a+
" cannot be represented as a fraction");return new b.Fraction(a)},string:function(a){return new b.Fraction(a)},"number, number":function(a,d){return new b.Fraction(a,d)},"null":function(a){return new b.Fraction(0)},BigNumber:function(a){return new b.Fraction(a.toString())},Fraction:function(a){return a},Object:function(a){return new b.Fraction(a)},"Array | Matrix":function(a){return v(a,e)}});return e}},function(x,h,l){var v=l(28);h.name="number";h.factory=function(b,a,d,c){var e=c("number",{"":function(){return 0},
number:function(a){return a},string:function(a){if("NaN"===a)return NaN;var b=Number(a);if(isNaN(b))throw new SyntaxError('String "'+a+'" is no valid number');return b},BigNumber:function(a){return a.toNumber()},Fraction:function(a){return a.valueOf()},Unit:function(a){throw Error("Second argument with valueless unit expected");},"null":function(a){return 0},"Unit, string | Unit":function(a,b){return a.toNumber(b)},"Array | Matrix":function(a){return v(a,e)}});e.toTex={0:"0",1:"\\left(${args[0]}\\right)",
2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"};return e}},function(x,h,l){var v=l(28);h.name="conj";h.factory=function(b,a,d,c){var e=c("conj",{number:function(a){return a},BigNumber:function(a){return a},Complex:function(a){return a.conjugate()},"Array | Matrix":function(a){return v(a,e)}});e.toTex={1:"\\left(${args[0]}\\right)^*"};return e}},function(x,h,l){var v=l(8).nearlyEqual,b=l(41);h.name="larger";h.factory=function(a,d,c,e){var f=c(l(34)),g=c(l(54)),m=c(l(55)),p=c(l(56)),y=c(l(43)),
C=c(l(44));a=l(36);var q=e("larger",{"boolean, boolean":function(a,b){return a>b},"number, number":function(a,b){return a>b&&!v(a,b,d.epsilon)},"BigNumber, BigNumber":function(a,c){return a.gt(c)&&!b(a,c,d.epsilon)},"Fraction, Fraction":function(a,b){return 1===a.compare(b)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers");},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return q(a.value,
b.value)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,q)},"SparseMatrix, DenseMatrix":function(a,b){return g(b,a,q,!0)},"DenseMatrix, SparseMatrix":function(a,b){return g(a,b,q,!1)},"DenseMatrix, DenseMatrix":function(a,b){return y(a,b,q)},"Array, Array":function(a,b){return q(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return q(f(a),b)},"Matrix, Array":function(a,b){return q(a,f(b))},"SparseMatrix, any":function(a,b){return p(a,b,q,!1)},"DenseMatrix, any":function(a,b){return C(a,
b,q,!1)},"any, SparseMatrix":function(a,b){return p(b,a,q,!0)},"any, DenseMatrix":function(a,b){return C(b,a,q,!0)},"Array, any":function(a,b){return C(f(a),b,q,!1).valueOf()},"any, Array":function(a,b){return C(f(b),a,q,!0).valueOf()}});q.toTex={2:"\\left(${args[0]}".concat(a.operators.larger,"${args[1]}\\right)")};return q}},function(x,h,l){var v=l(20);h.name="algorithm03";h.factory=function(b,a,d,c){var e=b.DenseMatrix;return function(a,b,d,p){var y=a._data,C=a._size,q=a._datatype;a=b._values;
var h=b._index,k=b._ptr,n=b._size,r=b._datatype;if(C.length!==n.length)throw new v(C.length,n.length);if(C[0]!==n[0]||C[1]!==n[1])throw new RangeError("Dimension mismatch. Matrix A ("+C+") must match Matrix B ("+n+")");if(!a)throw Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");b=C[0];var C=C[1],s,n=0,l=d;"string"===typeof q&&q===r&&(s=q,n=c.convert(0,s),l=c.find(d,[s,s]));d=[];for(q=0;q<b;q++)d[q]=[];for(var q=[],r=[],A=0;A<C;A++){for(var B=A+1,x=k[A+1],z=k[A];z<x;z++){var N=
h[z];q[N]=p?l(a[z],y[N][A]):l(y[N][A],a[z]);r[N]=B}for(x=0;x<b;x++)d[x][A]=r[x]===B?q[x]:p?l(n,y[x][A]):l(y[x][A],n)}return new e({data:d,size:[b,C],datatype:s})}}},function(x,h,l){var v=l(20);h.name="algorithm07";h.factory=function(b,a,d,c){function e(a,b,d,c,e){var f=a._values,h=a._index,k=a._ptr;a=k[b];for(b=k[b+1];a<b;a++)k=h[a],d[k]=e,c[k]=f[a]}var f=b.DenseMatrix;return function(a,b,d){var y=a._size,C=a._datatype,q=b._size,h=b._datatype;if(y.length!==q.length)throw new v(y.length,q.length);
if(y[0]!==q[0]||y[1]!==q[1])throw new RangeError("Dimension mismatch. Matrix A ("+y+") must match Matrix B ("+q+")");var q=y[0],y=y[1],k,n=0,r=d;"string"===typeof C&&C===h&&(k=C,n=c.convert(0,k),r=c.find(d,[k,k]));C=[];for(d=0;d<q;d++)C[d]=[];var h=new f({data:C,size:[q,y],datatype:k}),s=[],l=[],A=[],B=[];for(k=0;k<y;k++){var x=k+1;e(a,k,A,s,x);e(b,k,B,l,x);for(d=0;d<q;d++)C[d][k]=r(A[d]===x?s[d]:n,B[d]===x?l[d]:n)}return h}}},function(x,h){h.name="algorithm12";h.factory=function(h,v,b,a){var d=h.DenseMatrix;
return function(b,e,f,g){var m=b._values,p=b._index,y=b._ptr,C=b._size,q=b._datatype;if(!m)throw Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");b=C[0];var C=C[1],h,k=f;"string"===typeof q&&(h=q,e=a.convert(e,h),k=a.find(f,[h,h]));f=[];h=new d({data:f,size:[b,C],datatype:h});for(var q=[],n=[],r=0;r<C;r++){for(var s=r+1,l=y[r+1],A=y[r];A<l;A++){var B=p[A];q[B]=m[A];n[B]=s}for(l=0;l<b;l++)0===r&&(f[l]=[]),f[l][r]=n[l]===s?g?k(e,q[l]):k(q[l],e):g?k(e,0):k(0,e)}return h}}},
function(x,h,l){var v=l(8).nearlyEqual,b=l(41);h.name="smaller";h.factory=function(a,d,c,e){var f=c(l(34)),g=c(l(54)),m=c(l(55)),p=c(l(56)),y=c(l(43)),C=c(l(44));a=l(36);var q=e("smaller",{"boolean, boolean":function(a,b){return a<b},"number, number":function(a,b){return a<b&&!v(a,b,d.epsilon)},"BigNumber, BigNumber":function(a,c){return a.lt(c)&&!b(a,c,d.epsilon)},"Fraction, Fraction":function(a,b){return-1===a.compare(b)},"Complex, Complex":function(a,b){throw new TypeError("No ordering relation is defined for complex numbers");
},"Unit, Unit":function(a,b){if(!a.equalBase(b))throw Error("Cannot compare units with different base");return q(a.value,b.value)},"SparseMatrix, SparseMatrix":function(a,b){return m(a,b,q)},"SparseMatrix, DenseMatrix":function(a,b){return g(b,a,q,!0)},"DenseMatrix, SparseMatrix":function(a,b){return g(a,b,q,!1)},"DenseMatrix, DenseMatrix":function(a,b){return y(a,b,q)},"Array, Array":function(a,b){return q(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return q(f(a),b)},"Matrix, Array":function(a,
b){return q(a,f(b))},"SparseMatrix, any":function(a,b){return p(a,b,q,!1)},"DenseMatrix, any":function(a,b){return C(a,b,q,!1)},"any, SparseMatrix":function(a,b){return p(b,a,q,!0)},"any, DenseMatrix":function(a,b){return C(b,a,q,!0)},"Array, any":function(a,b){return C(f(a),b,q,!1).valueOf()},"any, Array":function(a,b){return C(f(b),a,q,!0).valueOf()}});q.toTex={2:"\\left(${args[0]}".concat(a.operators.smaller,"${args[1]}\\right)")};return q}},function(x,h,l){var v=l(4).extend;h.name="divide";h.factory=
function(b,a,d,c){var e=d(l(59)),f=d(l(47)),g=d(l(62)),m=d(l(34)),p=d(l(49)),y=d(l(44));b=c("divide",v({"Array | Matrix, Array | Matrix":function(a,b){return f(a,g(b))},"DenseMatrix, any":function(a,b){return y(a,b,e,!1)},"SparseMatrix, any":function(a,b){return p(a,b,e,!1)},"Array, any":function(a,b){return y(m(a),b,e,!1).valueOf()},"any, Array | Matrix":function(a,b){return f(a,g(b))}},e.signatures));b.toTex={2:"\\frac{${args[0]}}{${args[1]}}"};return b}},function(x,h,l){h.factory=function(h,b,
a,d){var c=a(l(60)),e=a(l(26)),f=d("divide",{"number, number":function(a,b){return a/b},"Complex, Complex":function(a,b){return a.div(b)},"BigNumber, BigNumber":function(a,b){return a.div(b)},"Fraction, Fraction":function(a,b){return a.div(b)},"Unit, number | Fraction | BigNumber":function(a,b){var d=a.clone(),y=c(1,e(b));d.value=f(null===d.value?d._normalize(y):d.value,b);return d},"number | Fraction | BigNumber, Unit":function(a,b){var d=b.clone(),d=d.pow(-1),y=c(1,e(a));d.value=f(a,null===b.value?
b._normalize(y):b.value);return d},"Unit, Unit":function(a,b){return a.divide(b)}});return f}},function(x,h,l){h.path="type";h.name="_numeric";h.factory=function(h,b,a,d){var c=a(l(26)),e={string:!0,number:!0,BigNumber:!0,Fraction:!0},f={number:a(l(51)),BigNumber:a(l(61)),Fraction:a(l(50))};h=function(a,b){var d=c(a);if(!(d in e))throw new TypeError("Cannot convert "+a+' of type "'+d+'"; valid input types are '+Object.keys(e).join(", "));if(!(b in f))throw new TypeError("Cannot convert "+a+' to type "'+
b+'"; valid output types are '+Object.keys(f).join(", "));return b===d?a:f[b](a)};h.toTex=function(a,b){return a.args[0].toTex()};return h}},function(x,h,l){var v=l(28);h.name="bignumber";h.factory=function(b,a,d,c){var e=c("bignumber",{"":function(){return new b.BigNumber(0)},number:function(a){return new b.BigNumber(a+"")},string:function(a){return new b.BigNumber(a)},BigNumber:function(a){return a},Fraction:function(a){return(new b.BigNumber(a.n)).div(a.d).times(a.s)},"null":function(a){return new b.BigNumber(0)},
"Array | Matrix":function(a){return v(a,e)}});e.toTex={0:"0",1:"\\left(${args[0]}\\right)"};return e}},function(x,h,l){var v=l(16);h.name="inv";h.factory=function(b,a,d,c){function e(a,b,d){var c,e;if(1===b){b=a[0][0];if(0===b)throw Error("Cannot calculate inverse, determinant is zero");return[[g(1,b)]]}if(2===b){b=C(a);if(0===b)throw Error("Cannot calculate inverse, determinant is zero");return[[g(a[1][1],b),g(y(a[0][1]),b)],[g(y(a[1][0]),b),g(a[0][0],b)]]}var f=a.concat();for(a=0;a<b;a++)f[a]=f[a].concat();
for(var l=q(b).valueOf(),v=0;v<d;v++){c=h(f[v][v]);e=v;for(a=v+1;a<b;)h(f[a][v])>c&&(c=h(f[a][v]),e=a),a++;if(0===c)throw Error("Cannot calculate inverse, determinant is zero");a=e;a!==v&&(c=f[v],f[v]=f[a],f[a]=c,c=l[v],l[v]=l[a],l[a]=c);var z=f[v],x=l[v];for(a=0;a<b;a++){var J=f[a],E=l[a];if(a!==v){if(0!==J[v]){e=g(y(J[v]),z[v]);for(c=v;c<d;c++)J[c]=m(J[c],p(e,z[c]));for(c=0;c<d;c++)E[c]=m(E[c],p(e,x[c]))}}else{e=z[v];for(c=v;c<d;c++)J[c]=g(J[c],e);for(c=0;c<d;c++)E[c]=g(E[c],e)}}}return l}var f=
d(l(34)),g=d(l(59)),m=d(l(35)),p=d(l(47)),y=d(l(63)),C=d(l(64)),q=d(l(46)),h=d(l(32));a=c("inv",{"Array | Matrix":function(a){var d=b.isMatrix(a)?a.size():v.array.size(a);switch(d.length){case 1:if(1===d[0])return b.isMatrix(a)?f([g(1,a.valueOf()[0])]):[g(1,a[0])];throw new RangeError("Matrix must be square (size: "+v.string.format(d)+")");case 2:var c=d[0],m=d[1];if(c===m)return b.isMatrix(a)?f(e(a.valueOf(),c,m),a.storage()):e(a,c,m);throw new RangeError("Matrix must be square (size: "+v.string.format(d)+
")");default:throw new RangeError("Matrix must be two dimensional (size: "+v.string.format(d)+")");}},any:function(a){return g(1,a)}});a.toTex={1:"\\left(${args[0]}\\right)^{-1}"};return a}},function(x,h,l){var v=l(28);h.name="unaryMinus";h.factory=function(b,a,d,c){b=l(36);var e=c("unaryMinus",{number:function(a){return-a},Complex:function(a){return a.neg()},BigNumber:function(a){return a.neg()},Fraction:function(a){return a.neg()},Unit:function(a){var b=a.clone();b.value=e(a.value);return b},"Array | Matrix":function(a){return v(a,
e,!0)}});e.toTex={1:"".concat(b.operators.unaryMinus,"\\left(${args[0]}\\right)")};return e}},function(x,h,l){x=l(16);var v=x.object,b=x.string;h.name="det";h.factory=function(a,d,c,e){var f=c(l(34)),g=c(l(65)),m=c(l(47)),p=c(l(63)),y=c(l(67));d=e("det",{any:function(a){return v.clone(a)},"Array | Matrix":function(d){var c;a.isMatrix(d)?c=d.size():Array.isArray(d)?(d=f(d),c=d.size()):c=[];switch(c.length){case 0:return v.clone(d);case 1:if(1===c[0])return v.clone(d.valueOf()[0]);throw new RangeError("Matrix must be square (size: "+
b.format(c)+")");case 2:var e=c[0];if(e===c[1]){d=d.clone().valueOf();if(1===e)e=v.clone(d[0][0]);else if(2===e)e=g(m(d[0][0],d[1][1]),m(d[1][0],d[0][1]));else{d=y(d);c=d.U[0][0];for(var k=1;k<e;k++)c=m(c,d.U[k][k]);for(var h=k=0,r=[];;){for(;r[h];)h++;if(h>=e)break;for(var l=h,t=0;!r[d.p[l]];)r[d.p[l]]=!0,l=d.p[l],t++;0===t%2&&k++}e=0===k%2?c:p(c)}return e}throw new RangeError("Matrix must be square (size: "+b.format(c)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+b.format(c)+
")");}}});d.toTex={1:"\\det\\left(${args[0]}\\right)"};return d}},function(x,h,l){function v(a,d){var c=a.size(),e=d.size();if(c.length!==e.length)throw new b(c.length,e.length);}var b=l(20);h.name="subtract";h.factory=function(a,b,c,e){a=l(36);var f=c(l(34)),g=c(l(35)),m=c(l(63)),p=c(l(38)),y=c(l(54)),h=c(l(66)),q=c(l(42)),u=c(l(43)),k=c(l(44)),n=e("subtract",{"number, number":function(a,b){return a-b},"Complex, Complex":function(a,b){return a.sub(b)},"BigNumber, BigNumber":function(a,b){return a.minus(b)},
"Fraction, Fraction":function(a,b){return a.sub(b)},"Unit, Unit":function(a,b){if(null===a.value)throw Error("Parameter x contains a unit with undefined value");if(null===b.value)throw Error("Parameter y contains a unit with undefined value");if(!a.equalBase(b))throw Error("Units do not match");var d=a.clone();d.value=n(d.value,b.value);d.fixPrefix=!1;return d},"SparseMatrix, SparseMatrix":function(a,b){v(a,b);return h(a,b,n)},"SparseMatrix, DenseMatrix":function(a,b){v(a,b);return y(b,a,n,!0)},"DenseMatrix, SparseMatrix":function(a,
b){v(a,b);return p(a,b,n,!1)},"DenseMatrix, DenseMatrix":function(a,b){v(a,b);return u(a,b,n)},"Array, Array":function(a,b){return n(f(a),f(b)).valueOf()},"Array, Matrix":function(a,b){return n(f(a),b)},"Matrix, Array":function(a,b){return n(a,f(b))},"SparseMatrix, any":function(a,b){return q(a,m(b),g)},"DenseMatrix, any":function(a,b){return k(a,b,n)},"any, SparseMatrix":function(a,b){return q(b,a,n,!0)},"any, DenseMatrix":function(a,b){return k(b,a,n,!0)},"Array, any":function(a,b){return k(f(a),
b,n,!1).valueOf()},"any, Array":function(a,b){return k(f(b),a,n,!0).valueOf()}});n.toTex={2:"\\left(${args[0]}".concat(a.operators.subtract,"${args[1]}\\right)")};return n}},function(x,h,l){var v=l(20);h.name="algorithm05";h.factory=function(b,a,d,c){var e=d(l(40)),f=b.SparseMatrix;return function(a,b,d){var y=a._values,h=a._index,q=a._ptr,l=a._size,k=a._datatype;a=b._values;var n=b._index,r=b._ptr,s=b._size,t=b._datatype;if(l.length!==s.length)throw new v(l.length,s.length);if(l[0]!==s[0]||l[1]!==
s[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+s+")");var A=l[0],l=l[1],B;b=e;var s=0,x=d;"string"===typeof k&&k===t&&(B=k,b=c.find(e,[B,B]),s=c.convert(0,B),x=c.find(d,[B,B]));d=y&&a?[]:void 0;k=[];t=[];B=new f({values:d,index:k,ptr:t,size:[A,l],datatype:B});var A=d?[]:void 0,z=d?[]:void 0,N=[],J=[],E,L,D,Q;for(L=0;L<l;L++){t[L]=k.length;var T=L+1;D=q[L];for(Q=q[L+1];D<Q;D++)E=h[D],k.push(E),N[E]=T,A&&(A[E]=y[D]);D=r[L];for(Q=r[L+1];D<Q;D++)E=n[D],N[E]!==T&&
k.push(E),J[E]=T,z&&(z[E]=a[D]);if(d)for(D=t[L];D<k.length;){E=k[D];Q=N[E];var O=J[E];if(Q===T||O===T)E=x(Q===T?A[E]:s,O===T?z[E]:s),b(E,s)?k.splice(D,1):(d.push(E),D++)}}t[l]=k.length;return B}}},function(x,h,l){var v=l(16).object;h.name="lup";h.factory=function(b,a,d,c){function e(a){var b=a._size[0],d=a._size[1],c=Math.min(b,d),e=v.clone(a._data),f=[],g=[b,c],n=[],c=[c,d],l,r,t=[];for(a=0;a<b;a++)t[a]=a;for(l=0;l<d;l++){if(0<l)for(a=0;a<b;a++){var x=Math.min(a,l),G=0;for(r=0;r<x;r++)G=p(G,h(e[a][r],
e[r][l]));e[a][l]=q(e[a][l],G)}r=l;G=x=0;for(a=l;a<b;a++){var U=e[a][l],K=m(U);u(K,x)&&(r=a,x=K,G=U)}l!==r&&(t[l]=[t[r],t[r]=t[l]][0],s._swapRows(l,r,e));if(l<b)for(a=l+1;a<b;a++)k(e[a][l],0)||(e[a][l]=y(e[a][l],G))}for(l=0;l<d;l++)for(a=0;a<b;a++)0===l&&(a<d&&(n[a]=[]),f[a]=[]),a<l?(a<d&&(n[a][l]=e[a][l]),l<b&&(f[a][l]=0)):a===l?(a<d&&(n[a][l]=e[a][l]),l<b&&(f[a][l]=1)):(a<d&&(n[a][l]=0),l<b&&(f[a][l]=e[a][l]));b=new s({data:f,size:g});d=new s({data:n,size:c});n=[];a=0;for(c=t.length;a<c;a++)n[t[a]]=
a;return{L:b,U:d,p:n,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}function f(a){var b=a._size[0],d=a._size[1],c=Math.min(b,d),e=a._values,f=a._index,g=a._ptr,p=[],l=[],q=[],s=[b,c],v=[],x=[],U=[],K=[c,d],M,H,I,F=[],S=[];for(M=0;M<b;M++)F[M]=M,S[M]=M;var R=function(a,b){var d=S[a],c=S[b];F[d]=b;F[c]=a;S[a]=c;S[b]=d};a=function(){var a=new t;H<b&&(q.push(p.length),p.push(1),l.push(H));U.push(v.length);var d=g[H+1];for(I=g[H];I<d;I++)M=f[I],a.set(F[M],
e[I]);0<H&&a.forEach(0,H-1,function(b,d){r._forEachRow(b,p,l,q,function(c,e){c>b&&a.accumulate(c,n(h(e,d)))})});var c=H,A=a.get(H),z=m(A);a.forEach(H+1,b-1,function(a,b){var d=m(b);u(d,z)&&(c=a,z=d,A=b)});H!==c&&(r._swapRows(H,c,s[1],p,l,q),r._swapRows(H,c,K[1],v,x,U),a.swap(H,c),R(H,c));a.forEach(0,b-1,function(a,b){a<=H?(v.push(b),x.push(a)):(b=y(b,A),k(b,0)||(p.push(b),l.push(a)))})};for(H=0;H<d;H++)a();U.push(v.length);q.push(p.length);return{L:new r({values:p,index:l,ptr:q,size:s}),U:new r({values:v,
index:x,ptr:U,size:K}),p:F,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}var g=d(l(34)),m=d(l(32)),p=d(l(35)),y=d(l(59)),h=d(l(48)),q=d(l(65)),u=d(l(53)),k=d(l(40)),n=d(l(63)),r=b.SparseMatrix,s=b.DenseMatrix,t=b.Spa;return c("lup",{DenseMatrix:function(a){return e(a)},SparseMatrix:function(a){return f(a)},Array:function(a){a=g(a);a=e(a);return{L:a.L.valueOf(),U:a.U.valueOf(),p:a.p}}})}},function(x,h,l){var v=l(17);h.name="cross";h.factory=function(b,
a,d,c){function e(a,b){var d=Math.max(v.size(a).length,v.size(b).length);a=v.squeeze(a);b=v.squeeze(b);var c=v.size(a),e=v.size(b);if(1!==c.length||1!==e.length||3!==c[0]||3!==e[0])throw new RangeError("Vectors with length 3 expected (Size A = ["+c.join(", ")+"], B = ["+e.join(", ")+"])");c=[g(m(a[1],b[2]),m(a[2],b[1])),g(m(a[2],b[0]),m(a[0],b[2])),g(m(a[0],b[1]),m(a[1],b[0]))];return 1<d?[c]:c}var f=d(l(34)),g=d(l(65)),m=d(l(47));b=c("cross",{"Matrix, Matrix":function(a,b){return f(e(a.toArray(),
b.toArray()))},"Matrix, Array":function(a,b){return f(e(a.toArray(),b))},"Array, Matrix":function(a,b){return f(e(a,b.toArray()))},"Array, Array":e});b.toTex={2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"};return b}},function(x,h,l){var v=l(17).size;h.name="dot";h.factory=function(b,a,d,c){function e(a,b){var d=v(a),c=v(b),e=d[0];if(1!==d.length||1!==c.length)throw new RangeError("Vector expected");if(d[0]!==c[0])throw new RangeError("Vectors must have equal length ("+d[0]+" != "+
c[0]+")");if(0===e)throw new RangeError("Cannot calculate the dot product of empty vectors");for(c=d=0;c<e;c++)d=f(d,g(a[c],b[c]));return d}var f=d(l(33)),g=d(l(47));b=c("dot",{"Matrix, Matrix":function(a,b){return e(a.toArray(),b.toArray())},"Matrix, Array":function(a,b){return e(a.toArray(),b)},"Array, Matrix":function(a,b){return e(a,b.toArray())},"Array, Array":e});b.toTex={2:"\\left(${args[0]}\\cdot${args[1]}\\right)"};return b}}])})},function(Z,aa,ga){var x,h,l;(function(v){function b(a){return"[object Function]"===
Q.call(a)}function a(a){return"[object Array]"===Q.call(a)}function d(a,b){if(a){var d;for(d=0;d<a.length&&(!a[d]||!b(a[d],d,a));d+=1);}}function c(a,b){if(a){var d;for(d=a.length-1;-1<d&&(!a[d]||!b(a[d],d,a));d-=1);}}function e(a,b){return T.call(a,b)}function f(a,b){return e(a,b)&&a[b]}function g(a,b){for(var d in a)if(e(a,d)&&b(a[d],d))break}function m(d,c,f,k){c&&g(c,function(c,g){if(f||!e(d,g))!k||"object"!==typeof c||!c||a(c)||b(c)||c instanceof RegExp?d[g]=c:(d[g]||(d[g]={}),m(d[g],c,f,k))});
return d}function p(a,b){return function(){return b.apply(a,arguments)}}function y(a){throw a;}function C(a){if(!a)return a;var b=v;d(a.split("."),function(a){b=b[a]});return b}function q(a,b,d,c){b=Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);b.requireType=a;b.requireModules=c;d&&(b.originalError=d);return b}function u(h){function l(a,b,d){var c,e,g,m,k,p,y,h;b=b&&b.split("/");var C=ba.map,q=C&&C["*"];if(a){a=a.split("/");e=a.length-1;ba.nodeIdCompat&&L.test(a[e])&&(a[e]=a[e].replace(L,
""));"."===a[0].charAt(0)&&b&&(e=b.slice(0,b.length-1),a=e.concat(a));e=a;for(g=0;g<e.length;g++)(m=e[g],"."===m)?(e.splice(g,1),g-=1):".."===m&&0!==g&&(1!==g||".."!==e[2])&&".."!==e[g-1]&&0<g&&(e.splice(g-1,2),g-=2);a=a.join("/")}if(d&&C&&(b||q)){e=a.split("/");g=e.length;a:for(;0<g;g-=1){k=e.slice(0,g).join("/");if(b)for(m=b.length;0<m;m-=1)if(d=f(C,b.slice(0,m).join("/")))if(d=f(d,k)){c=d;p=g;break a}!y&&q&&f(q,k)&&(y=f(q,k),h=g)}!c&&y&&(c=y,p=h);c&&(e.splice(0,p,c),a=e.join("/"))}return(c=f(ba.pkgs,
a))?c:a}function n(a){O&&d(document.getElementsByTagName("script"),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===Y.contextName)return b.parentNode.removeChild(b),!0})}function r(b){var d=f(ba.paths,b);if(d&&a(d)&&1<d.length)return d.shift(),Y.require.undef(b),Y.makeRequire(null,{skipMap:!0})([b]),!0}function s(a){var b,d=a?a.indexOf("!"):-1;-1<d&&(b=a.substring(0,d),a=a.substring(d+1,a.length));return[b,a]}function t(a,b,d,c){var e,g,m=null,k=b?b.name:
null,p=a,y=!0,h="";a||(y=!1,a="_@r"+(ga+=1));a=s(a);m=a[0];a=a[1];m&&(m=l(m,k,c),g=f($,m));a&&(m?h=g&&g.normalize?g.normalize(a,function(a){return l(a,k,c)}):-1===a.indexOf("!")?l(a,k,c):a:(h=l(a,k,c),a=s(h),m=a[0],h=a[1],d=!0,e=Y.nameToUrl(h)));d=!m||g||d?"":"_unnormalized"+(ya+=1);return{prefix:m,name:h,parentMap:b,unnormalized:!!d,url:e,originalName:p,isDefine:y,id:(m?m+"!"+h:h)+d}}function u(a){var b=a.id,d=f(da,b);d||(d=da[b]=new Y.Module(a));return d}function A(a,b,d){var c=a.id,g=f(da,c);if(!e($,
c)||g&&!g.defineEmitComplete)if(g=u(a),g.error&&"error"===b)d(g.error);else g.on(b,d);else"defined"===b&&d($[c])}function z(a,b){var c=a.requireModules,e=!1;if(b)b(a);else if(d(c,function(b){if(b=f(da,b))b.error=a,b.events.error&&(e=!0,b.emit("error",a))}),!e)k.onError(a)}function H(){I.length&&(d(I,function(a){var b=a[0];"string"===typeof b&&(Y.defQueueMap[b]=!0);na.push(a)}),I=[])}function x(a){delete da[a];delete Z[a]}function J(a,b,c){var e=a.map.id;a.error?a.emit("error",a.error):(b[e]=!0,d(a.depMaps,
function(d,e){var g=d.id,m=f(da,g);m&&!a.depMatched[e]&&!c[g]&&(f(b,g)?(a.defineDep(e,$[g]),a.check()):J(m,b,c))}),c[e]=!0)}function N(){var a,b,c=(a=1E3*ba.waitSeconds)&&Y.startTime+a<(new Date).getTime(),e=[],f=[],m=!1,k=!0;if(!Q){Q=!0;g(Z,function(a){var d=a.map,g=d.id;if(a.enabled&&(d.isDefine||f.push(a),!a.error))if(!a.inited&&c)r(g)?m=b=!0:(e.push(g),n(g));else if(!a.inited&&a.fetched&&d.isDefine&&(m=!0,!d.prefix))return k=!1});if(c&&e.length)return a=q("timeout","Load timeout for modules: "+
e,null,e),a.contextName=Y.contextName,z(a);k&&d(f,function(a){J(a,{},{})});c&&!b||!m||!O&&!G||la||(la=setTimeout(function(){la=0;N()},50));Q=!1}}function E(a){e($,a[0])||u(t(a[0],null,!0)).init(a[1],a[2])}function T(a){a=a.currentTarget||a.srcElement;var b=Y.onScriptLoad;a.detachEvent&&!K?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=Y.onScriptError;a.detachEvent&&!K||a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function P(){var a;
for(H();na.length;){a=na.shift();if(null===a[0])return z(q("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));E(a)}Y.defQueueMap={}}var Q,M,Y,ma,la,ba={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},da={},Z={},ia={},na=[],$={},oa={},aa={},ga=1,ya=1;ma={require:function(a){return a.require?a.require:a.require=Y.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?$[a.map.id]=a.exports:a.exports=$[a.map.id]={}},module:function(a){return a.module?
a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return f(ba.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}};M=function(a){this.events=f(ia,a.id)||{};this.map=a;this.shim=f(ba.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};M.prototype={init:function(a,b,d,c){c=c||{};if(!this.inited){this.factory=b;if(d)this.on("error",d);else this.events.error&&(d=p(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=
d;this.inited=!0;this.ignore=c.ignore;c.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;Y.startTime=(new Date).getTime();var a=this.map;if(this.shim)Y.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],p(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;oa[a]||(oa[a]=!0,Y.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,d,c=this.map.id;d=this.depExports;var f=this.exports,g=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(b(g)){if(this.events.error&&this.map.isDefine||k.onError!==y)try{f=Y.execCb(c,g,d,f)}catch(m){a=m}else f=Y.execCb(c,g,d,f);this.map.isDefine&&void 0===f&&((d=this.module)?f=d.exports:this.usingExports&&
(f=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",z(this.error=a)}else f=g;this.exports=f;if(this.map.isDefine&&!this.ignore&&($[c]=f,k.onResourceLoad))k.onResourceLoad(Y,this.map,this.depMaps);x(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else e(Y.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=
this.map,b=a.id,d=t(a.prefix);this.depMaps.push(d);A(d,"defined",p(this,function(d){var c,m;m=f(aa,this.map.id);var y=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,C=Y.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(d.normalize&&(y=d.normalize(y,function(a){return l(a,h,!0)})||""),d=t(a.prefix+"!"+y,this.map.parentMap),A(d,"defined",p(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),m=f(da,d.id)){this.depMaps.push(d);
if(this.events.error)m.on("error",p(this,function(a){this.emit("error",a)}));m.enable()}}else m?(this.map.url=Y.nameToUrl(m),this.load()):(c=p(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),c.error=p(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];g(da,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&x(a.map.id)});z(a)}),c.fromText=p(this,function(d,f){var g=a.name,m=t(g),p=F;f&&(d=f);p&&(F=!1);u(m);e(ba.config,b)&&(ba.config[g]=ba.config[b]);try{k.exec(d)}catch(y){return z(q("fromtexteval",
"fromText eval for "+b+" failed: "+y,y,[b]))}p&&(F=!0);this.depMaps.push(m);Y.completeLoad(g);C([g],c)}),d.load(a.name,C,c,ba))}));Y.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){Z[this.map.id]=this;this.enabling=this.enabled=!0;d(this.depMaps,p(this,function(a,b){var d,c;if("string"===typeof a){a=t(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(d=f(ma,a.id)){this.depExports[b]=d(this);return}this.depCount+=1;A(a,"defined",p(this,function(a){this.undefed||
(this.defineDep(b,a),this.check())}));this.errback?A(a,"error",p(this,this.errback)):this.events.error&&A(a,"error",p(this,function(a){this.emit("error",a)}))}d=a.id;c=da[d];!e(ma,d)&&c&&!c.enabled&&Y.enable(a,this)}));g(this.pluginMaps,p(this,function(a){var b=f(da,a.id);b&&!b.enabled&&Y.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var d=this.events[a];d||(d=this.events[a]=[]);d.push(b)},emit:function(a,b){d(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};
Y={config:ba,contextName:h,registry:da,defined:$,urlFetched:oa,defQueue:na,defQueueMap:{},Module:M,makeModuleMap:t,nextTick:k.nextTick,onError:z,configure:function(b){b.baseUrl&&"/"!==b.baseUrl.charAt(b.baseUrl.length-1)&&(b.baseUrl+="/");var c=ba.shim,e={paths:!0,bundles:!0,config:!0,map:!0};g(b,function(a,b){e[b]?(ba[b]||(ba[b]={}),m(ba[b],a,!0,!0)):ba[b]=a});b.bundles&&g(b.bundles,function(a,b){d(a,function(a){a!==b&&(aa[a]=b)})});b.shim&&(g(b.shim,function(b,d){a(b)&&(b={deps:b});!b.exports&&
!b.init||b.exportsFn||(b.exportsFn=Y.makeShimExports(b));c[d]=b}),ba.shim=c);b.packages&&d(b.packages,function(a){var b;a="string"===typeof a?{name:a}:a;b=a.name;a.location&&(ba.paths[b]=a.location);ba.pkgs[b]=a.name+"/"+(a.main||"main").replace(D,"").replace(L,"")});g(da,function(a,b){a.inited||a.map.unnormalized||(a.map=t(b,null,!0))});(b.deps||b.callback)&&Y.require(b.deps||[],b.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(v,arguments));return b||a.exports&&
C(a.exports)}},makeRequire:function(a,d){function g(c,f,m){var p,y;d.enableBuildCallback&&f&&b(f)&&(f.__requireJsBuild=!0);if("string"===typeof c){if(b(f))return z(q("requireargs","Invalid require call"),m);if(a&&e(ma,c))return ma[c](da[a.id]);if(k.get)return k.get(Y,c,a,g);p=t(c,a,!1,!0);p=p.id;return e($,p)?$[p]:z(q("notloaded",'Module name "'+p+'" has not been loaded yet for context: '+h+(a?"":". Use require([])")))}P();Y.nextTick(function(){P();y=u(t(null,a));y.skipMap=d.skipMap;y.init(c,f,m,
{enabled:!0});N()});return g}d=d||{};m(g,{isBrowser:O,toUrl:function(b){var d,c=b.lastIndexOf("."),e=b.split("/")[0];-1!==c&&("."!==e&&".."!==e||1<c)&&(d=b.substring(c,b.length),b=b.substring(0,c));return Y.nameToUrl(l(b,a&&a.id,!0),d,!0)},defined:function(b){return e($,t(b,a,!1,!0).id)},specified:function(b){b=t(b,a,!1,!0).id;return e($,b)||e(da,b)}});a||(g.undef=function(b){H();var d=t(b,a,!0),e=f(da,b);e.undefed=!0;n(b);delete $[b];delete oa[d.url];delete ia[b];c(na,function(a,d){a[0]===b&&na.splice(d,
1)});delete Y.defQueueMap[b];e&&(e.events.defined&&(ia[b]=e.events),x(b))});return g},enable:function(a){f(da,a.id)&&u(a).enable()},completeLoad:function(a){var b,d,c=f(ba.shim,a)||{},g=c.exports;for(H();na.length;){d=na.shift();if(null===d[0]){d[0]=a;if(b)break;b=!0}else d[0]===a&&(b=!0);E(d)}Y.defQueueMap={};d=f(da,a);if(!b&&!e($,a)&&d&&!d.inited){if(ba.enforceDefine&&(!g||!C(g)))return r(a)?void 0:z(q("nodefine","No define call for "+a,null,[a]));E([a,c.deps||[],c.exportsFn])}N()},nameToUrl:function(b,
d,c){var e,g,m;(e=f(ba.pkgs,b))&&(b=e);if(e=f(aa,b))return Y.nameToUrl(e,d,c);if(k.jsExtRegExp.test(b))e=b+(d||"");else{e=ba.paths;b=b.split("/");for(g=b.length;0<g;g-=1)if(m=b.slice(0,g).join("/"),m=f(e,m)){a(m)&&(m=m[0]);b.splice(0,g,m);break}e=b.join("/");e+=d||(/^data\:|\?/.test(e)||c?"":".js");e=("/"===e.charAt(0)||e.match(/^[\w\+\.\-]+:/)?"":ba.baseUrl)+e}return ba.urlArgs?e+((-1===e.indexOf("?")?"?":"&")+ba.urlArgs):e},load:function(a,b){k.load(Y,a,b)},execCb:function(a,b,d,c){return b.apply(c,
d)},onScriptLoad:function(a){if("load"===a.type||U.test((a.currentTarget||a.srcElement).readyState))B=null,a=T(a),Y.completeLoad(a.id)},onScriptError:function(a){var b=T(a);if(!r(b.id))return z(q("scripterror","Script error for: "+b.id,a,[b.id]))}};Y.require=Y.makeRequire();return Y}var k,n,r,s,t,A,B,P,z,N,J=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,E=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,L=/\.js$/,D=/^\.\//;n=Object.prototype;var Q=n.toString,T=n.hasOwnProperty,O=!("undefined"===typeof window||
"undefined"===typeof navigator||!window.document),G=!O&&"undefined"!==typeof importScripts,U=O&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,K="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),M={},H={},I=[],F=!1;if("undefined"===typeof l){if("undefined"!==typeof h){if(b(h))return;H=h;h=void 0}"undefined"!==typeof x&&!b(x)&&(H=x,x=void 0);k=h=function(b,d,c,e){var g,m="_";!a(b)&&"string"!==typeof b&&(g=b,a(d)?(b=d,d=c,c=e):b=[]);g&&g.context&&(m=g.context);
(e=f(M,m))||(e=M[m]=k.s.newContext(m));g&&e.configure(g);return e.require(b,d,c)};k.config=function(a){return k(a)};k.nextTick="undefined"!==typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()};x||(x=k);k.version="2.1.20";k.jsExtRegExp=/^\/|:|\?|\.js$/;k.isBrowser=O;n=k.s={contexts:M,newContext:u};k({});d(["toUrl","undef","defined","specified"],function(a){k[a]=function(){var b=M._;return b.require[a].apply(b,arguments)}});O&&(r=n.head=document.getElementsByTagName("head")[0],s=document.getElementsByTagName("base")[0])&&
(r=n.head=s.parentNode);k.onError=y;k.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");b.type=a.scriptType||"text/javascript";b.charset="utf-8";b.async=!0;return b};k.load=function(a,b,d){var c=a&&a.config||{},e;if(O){e=k.createNode(c,b,d);if(c.onNodeCreated)c.onNodeCreated(e,c,b,d);e.setAttribute("data-requirecontext",a.contextName);e.setAttribute("data-requiremodule",b);!e.attachEvent||e.attachEvent.toString&&
0>e.attachEvent.toString().indexOf("[native code")||K?(e.addEventListener("load",a.onScriptLoad,!1),e.addEventListener("error",a.onScriptError,!1)):(F=!0,e.attachEvent("onreadystatechange",a.onScriptLoad));e.src=d;P=e;s?r.insertBefore(e,s):r.appendChild(e);P=null;return e}if(G)try{importScripts(d),a.completeLoad(b)}catch(f){a.onError(q("importscripts","importScripts failed for "+b+" at "+d,f,[b]))}};O&&!H.skipDataMain&&c(document.getElementsByTagName("script"),function(a){r||(r=a.parentNode);if(t=
a.getAttribute("data-main"))return z=t,H.baseUrl||(A=z.split("/"),z=A.pop(),N=A.length?A.join("/")+"/":"./",H.baseUrl=N),z=z.replace(L,""),k.jsExtRegExp.test(z)&&(z=t),H.deps=H.deps?H.deps.concat(z):[z],!0});l=function(d,e,f){var g,m;"string"!==typeof d&&(f=e,e=d,d=null);a(e)||(f=e,e=null);!e&&b(f)&&(e=[],f.length&&(f.toString().replace(J,"").replace(E,function(a,b){e.push(b)}),e=(1===f.length?["require"]:["require","exports","module"]).concat(e)));F&&((g=P)||(B&&"interactive"===B.readyState||c(document.getElementsByTagName("script"),
function(a){if("interactive"===a.readyState)return B=a}),g=B),g&&(d||(d=g.getAttribute("data-requiremodule")),m=M[g.getAttribute("data-requirecontext")]));m?(m.defQueue.push([d,e,f]),m.defQueueMap[d]=!0):I.push([d,e,f])};l.amd={jQuery:!0};k.exec=function(a){return eval(a)};k(H)}})(this)},function(Z,aa,ga){var x,h,l;(function(v,b){!(h=[aa],x=b,l="function"===typeof x?x.apply(aa,h):x,void 0!==l&&(Z.exports=l))})(this,function(h){var b={REVISION:"76"};!(x=b,l="function"===typeof x?x.call(h,ga,h,Z):x,
void 0!==l&&(Z.exports=l));void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");
for(var b=Object(a),c=1,e=arguments.length;c!==e;++c){var f=arguments[c];if(void 0!==f&&null!==f)for(var f=Object(f),g=Object.keys(f),m=0,p=g.length;m!==p;++m){var y=g[m],h=Object.getOwnPropertyDescriptor(f,y);void 0!==h&&h.enumerable&&(b[y]=f[y])}}return b}});b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};b.CullFaceNone=0;b.CullFaceBack=1;b.CullFaceFront=2;b.CullFaceFrontBack=3;b.FrontFaceDirectionCW=0;b.FrontFaceDirectionCCW=1;b.BasicShadowMap=0;b.PCFShadowMap=1;b.PCFSoftShadowMap=2;b.FrontSide=0;b.BackSide=
1;b.DoubleSide=2;b.FlatShading=1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=2;b.NoBlending=0;b.NormalBlending=1;b.AdditiveBlending=2;b.SubtractiveBlending=3;b.MultiplyBlending=4;b.CustomBlending=5;b.AddEquation=100;b.SubtractEquation=101;b.ReverseSubtractEquation=102;b.MinEquation=103;b.MaxEquation=104;b.ZeroFactor=200;b.OneFactor=201;b.SrcColorFactor=202;b.OneMinusSrcColorFactor=203;b.SrcAlphaFactor=204;b.OneMinusSrcAlphaFactor=205;b.DstAlphaFactor=206;b.OneMinusDstAlphaFactor=
207;b.DstColorFactor=208;b.OneMinusDstColorFactor=209;b.SrcAlphaSaturateFactor=210;b.NeverDepth=0;b.AlwaysDepth=1;b.LessDepth=2;b.LessEqualDepth=3;b.EqualDepth=4;b.GreaterEqualDepth=5;b.GreaterDepth=6;b.NotEqualDepth=7;b.MultiplyOperation=0;b.MixOperation=1;b.AddOperation=2;b.NoToneMapping=0;b.LinearToneMapping=1;b.ReinhardToneMapping=2;b.Uncharted2ToneMapping=3;b.CineonToneMapping=4;b.UVMapping=300;b.CubeReflectionMapping=301;b.CubeRefractionMapping=302;b.EquirectangularReflectionMapping=303;b.EquirectangularRefractionMapping=
304;b.SphericalReflectionMapping=305;b.CubeUVReflectionMapping=306;b.CubeUVRefractionMapping=307;b.RepeatWrapping=1E3;b.ClampToEdgeWrapping=1001;b.MirroredRepeatWrapping=1002;b.NearestFilter=1003;b.NearestMipMapNearestFilter=1004;b.NearestMipMapLinearFilter=1005;b.LinearFilter=1006;b.LinearMipMapNearestFilter=1007;b.LinearMipMapLinearFilter=1008;b.UnsignedByteType=1009;b.ByteType=1010;b.ShortType=1011;b.UnsignedShortType=1012;b.IntType=1013;b.UnsignedIntType=1014;b.FloatType=1015;b.HalfFloatType=
1025;b.UnsignedShort4444Type=1016;b.UnsignedShort5551Type=1017;b.UnsignedShort565Type=1018;b.AlphaFormat=1019;b.RGBFormat=1020;b.RGBAFormat=1021;b.LuminanceFormat=1022;b.LuminanceAlphaFormat=1023;b.RGBEFormat=b.RGBAFormat;b.DepthFormat=1026;b.RGB_S3TC_DXT1_Format=2001;b.RGBA_S3TC_DXT1_Format=2002;b.RGBA_S3TC_DXT3_Format=2003;b.RGBA_S3TC_DXT5_Format=2004;b.RGB_PVRTC_4BPPV1_Format=2100;b.RGB_PVRTC_2BPPV1_Format=2101;b.RGBA_PVRTC_4BPPV1_Format=2102;b.RGBA_PVRTC_2BPPV1_Format=2103;b.RGB_ETC1_Format=2151;
b.LoopOnce=2200;b.LoopRepeat=2201;b.LoopPingPong=2202;b.InterpolateDiscrete=2300;b.InterpolateLinear=2301;b.InterpolateSmooth=2302;b.ZeroCurvatureEnding=2400;b.ZeroSlopeEnding=2401;b.WrapAroundEnding=2402;b.TrianglesDrawMode=0;b.TriangleStripDrawMode=1;b.TriangleFanDrawMode=2;b.LinearEncoding=3E3;b.sRGBEncoding=3001;b.GammaEncoding=3007;b.RGBEEncoding=3002;b.LogLuvEncoding=3003;b.RGBM7Encoding=3004;b.RGBM16Encoding=3005;b.RGBDEncoding=3006;b.BasicDepthPacking=3200;b.RGBADepthPacking=3201;b.Color=
function(a){return 3===arguments.length?this.fromArray(arguments):this.set(a)};b.Color.prototype={constructor:b.Color,r:1,g:1,b:1,set:function(a){a instanceof b.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,
b,e){0>e&&(e+=1);1<e&&(e-=1);return e<1/6?a+6*(b-a)*e:.5>e?b:e<2/3?a+6*(b-a)*(2/3-e):a}return function(d,c,e){d=b.Math.euclideanModulo(d,1);c=b.Math.clamp(c,0,1);e=b.Math.clamp(e,0,1);0===c?this.r=this.g=this.b=e:(c=.5>=e?e*(1+c):e+c-e*c,e=2*e-c,this.r=a(e,c,d+1/3),this.g=a(e,c,d),this.b=a(e,c,d-1/3));return this}}(),setStyle:function(a){function d(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var e=
c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,d(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,d(c[5]),this;break;
case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e)){var e=parseFloat(c[1])/360,f=parseInt(c[2],10)/100,g=parseInt(c[3],10)/100;d(c[5]);return this.setHSL(e,f,g)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];e=c.length;if(3===e)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(c.charAt(0)+c.charAt(1),
16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=b.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,
b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=
a||{h:0,s:0,l:0};var b=this.r,c=this.g,e=this.b,f=Math.max(b,c,e),g=Math.min(b,c,e),m,p=(g+f)/2;if(g===f)g=m=0;else{var y=f-g,g=.5>=p?y/(f+g):y/(2-f-g);switch(f){case b:m=(c-e)/y+(c<e?6:0);break;case c:m=(e-b)/y+2;break;case e:m=(b-c)/y+4}m/=6}a.h=m;a.s=g;a.l=p;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var e=this.getHSL();e.h+=a;e.s+=b;e.l+=c;this.setHSL(e.h,e.s,e.l);return this},add:function(a){this.r+=a.r;this.g+=
a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,
b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};b.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,
cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,
floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,
lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,
moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,
silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};b.Quaternion=function(a,b,c,e){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==e?e:1};b.Quaternion.prototype={constructor:b.Quaternion,get x(){return this._x},set x(a){this._x=a;
this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=c;this._w=e;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},
setFromEuler:function(a,d){if(!1===a instanceof b.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),e=Math.cos(a._y/2),f=Math.cos(a._z/2),g=Math.sin(a._x/2),m=Math.sin(a._y/2),p=Math.sin(a._z/2),y=a.order;"XYZ"===y?(this._x=g*e*f+c*m*p,this._y=c*m*f-g*e*p,this._z=c*e*p+g*m*f,this._w=c*e*f-g*m*p):"YXZ"===y?(this._x=g*e*f+c*m*p,this._y=c*m*f-g*e*p,this._z=c*e*p-g*m*f,this._w=c*e*f+g*m*p):"ZXY"===y?(this._x=g*e*
f-c*m*p,this._y=c*m*f+g*e*p,this._z=c*e*p+g*m*f,this._w=c*e*f-g*m*p):"ZYX"===y?(this._x=g*e*f-c*m*p,this._y=c*m*f+g*e*p,this._z=c*e*p-g*m*f,this._w=c*e*f+g*m*p):"YZX"===y?(this._x=g*e*f+c*m*p,this._y=c*m*f+g*e*p,this._z=c*e*p-g*m*f,this._w=c*e*f-g*m*p):"XZY"===y&&(this._x=g*e*f-c*m*p,this._y=c*m*f-g*e*p,this._z=c*e*p+g*m*f,this._w=c*e*f+g*m*p);if(!1!==d)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){var c=b/2,e=Math.sin(c);this._x=a.x*e;this._y=a.y*e;this._z=a.z*e;this._w=Math.cos(c);
this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var e=b[8],f=b[1],g=b[5],m=b[9],p=b[2],y=b[6],b=b[10],h=c+g+b;0<h?(c=.5/Math.sqrt(h+1),this._w=.25/c,this._x=(y-m)*c,this._y=(e-p)*c,this._z=(f-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(y-m)/c,this._x=.25*c,this._y=(a+f)/c,this._z=(e+p)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(e-p)/c,this._x=(a+f)/c,this._y=.25*c,this._z=(m+y)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(f-a)/c,this._x=(e+p)/c,this._y=
(m+y)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,d;return function(c,e){void 0===a&&(a=new b.Vector3);d=c.dot(e)+1;1E-6>d?(d=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,e);this._x=a.x;this._y=a.y;this._z=a.z;this._w=d;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*
a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),
this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,e=a._y,f=a._z,g=a._w,m=b._x,p=b._y,y=b._z,h=b._w;this._x=c*h+g*m+e*y-f*p;this._y=e*h+g*p+f*m-c*y;this._z=f*h+g*y+c*p-e*m;this._w=g*h-c*m-e*p-f*y;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,e=this._y,f=this._z,g=this._w,m=g*a._w+c*a._x+e*a._y+f*a._z;0>m?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,m=-m):
this.copy(a);if(1<=m)return this._w=g,this._x=c,this._y=e,this._z=f,this;var p=Math.sqrt(1-m*m);if(.001>Math.abs(p))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(e+this._y),this._z=.5*(f+this._z),this;var y=Math.atan2(p,m),m=Math.sin((1-b)*y)/p,p=Math.sin(b*y)/p;this._w=g*m+this._w*p;this._x=c*m+this._x*p;this._y=e*m+this._y*p;this._z=f*m+this._z*p;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,
b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(b.Quaternion,{slerp:function(a,b,c,e){return c.copy(a).slerp(b,e)},slerpFlat:function(a,b,c,e,f,g,m){var p=c[e+0],y=c[e+1],h=c[e+2];c=c[e+3];e=f[g+0];var l=
f[g+1],u=f[g+2];f=f[g+3];if(c!==f||p!==e||y!==l||h!==u){g=1-m;var k=p*e+y*l+h*u+c*f,n=0<=k?1:-1,r=1-k*k;r>Number.EPSILON&&(r=Math.sqrt(r),k=Math.atan2(r,k*n),g=Math.sin(g*k)/r,m=Math.sin(m*k)/r);n*=m;p=p*g+e*n;y=y*g+l*n;h=h*g+u*n;c=c*g+f*n;g===1-m&&(m=1/Math.sqrt(p*p+y*y+h*h+c*c),p*=m,y*=m,h*=m,c*=m)}a[b]=p;a[b+1]=y;a[b+2]=h;a[b+3]=c}});b.Vector2=function(a,b){this.x=a||0;this.y=b||0};b.Vector2.prototype={constructor:b.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},
set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,
this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,d;return function(c,e){void 0===a&&(a=new b.Vector2,d=new b.Vector2);a.set(c,c);d.set(e,e);return this.clamp(a,d)}}(),clampLength:function(a,b){var c=this.length();this.multiplyScalar(Math.max(a,Math.min(b,c))/c);return this},floor:function(){this.x=Math.floor(this.x);
this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},
length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,
b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,
b){var c=Math.cos(b),e=Math.sin(b),f=this.x-a.x,g=this.y-a.y;this.x=f*c-g*e+a.x;this.y=f*e+g*c+a.y;return this}};b.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};b.Vector3.prototype={constructor:b.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=
b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(d){!1===d instanceof b.Euler&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new b.Quaternion);this.applyQuaternion(a.setFromEuler(d));return this}}(),applyAxisAngle:function(){var a;return function(d,c){void 0===a&&(a=new b.Quaternion);this.applyQuaternion(a.setFromAxisAngle(d,c));return this}}(),applyMatrix3:function(a){var b=
this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*e;this.y=a[1]*b+a[4]*c+a[7]*e;this.z=a[2]*b+a[5]*c+a[8]*e;return this},applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12];this.y=a[1]*b+a[5]*c+a[9]*e+a[13];this.z=a[2]*b+a[6]*c+a[10]*e+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;var f=1/(a[3]*b+a[7]*c+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*e+a[12])*f;this.y=(a[1]*b+a[5]*c+a[9]*e+a[13])*
f;this.z=(a[2]*b+a[6]*c+a[10]*e+a[14])*f;return this},applyQuaternion:function(a){var b=this.x,c=this.y,e=this.z,f=a.x,g=a.y,m=a.z;a=a.w;var p=a*b+g*e-m*c,y=a*c+m*b-f*e,h=a*e+f*c-g*b,b=-f*b-g*c-m*e;this.x=p*a+b*-f+y*-m-h*-g;this.y=y*a+b*-g+h*-f-p*-m;this.z=h*a+b*-m+p*-g-y*-f;return this},project:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.multiplyMatrices(d.projectionMatrix,a.getInverse(d.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(d){void 0===
a&&(a=new b.Matrix4);a.multiplyMatrices(d.matrixWorld,a.getInverse(d.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e;this.y=a[1]*b+a[5]*c+a[9]*e;this.z=a[2]*b+a[6]*c+a[10]*e;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,d;return function(c,e){void 0===a&&(a=new b.Vector3,d=new b.Vector3);a.set(c,c,c);d.set(e,e,e);return this.clamp(a,d)}}(),clampLength:function(a,b){var c=
this.length();this.multiplyScalar(Math.max(a,Math.min(b,c))/c);return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,e=this.y,f=this.z;this.x=e*a.z-f*a.y;this.y=f*a.x-c*a.z;this.z=
c*a.y-e*a.x;return this},crossVectors:function(a,b){var c=a.x,e=a.y,f=a.z,g=b.x,m=b.y,p=b.z;this.x=e*p-f*m;this.y=f*g-c*p;this.z=c*m-e*g;return this},projectOnVector:function(){var a,d;return function(c){void 0===a&&(a=new b.Vector3);a.copy(c).normalize();d=this.dot(a);return this.copy(a).multiplyScalar(d)}}(),projectOnPlane:function(){var a;return function(d){void 0===a&&(a=new b.Vector3);a.copy(this).projectOnVector(d);return this.sub(a)}}(),reflect:function(){var a;return function(d){void 0===
a&&(a=new b.Vector3);return this.sub(a.copy(d).multiplyScalar(2*this.dot(d)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(b.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);
return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){"number"===typeof a&&(console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index )."),b=a=b);return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&
a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};b.Vector4=function(a,b,c,e){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==e?e:1};b.Vector4.prototype={constructor:b.Vector4,set:function(a,
b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},
addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=
a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z,f=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12]*f;this.y=a[1]*b+a[5]*c+a[9]*e+a[13]*f;this.z=a[2]*b+a[6]*c+a[10]*e+a[14]*f;this.w=a[3]*b+a[7]*c+a[11]*e+a[15]*f;return this},
divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,e;a=a.elements;var f=a[0];e=a[4];var g=a[8],m=a[1],p=a[5],y=a[9];c=a[2];b=a[6];var h=a[10];if(.01>Math.abs(e-m)&&.01>Math.abs(g-c)&&.01>Math.abs(y-b)){if(.1>Math.abs(e+m)&&.1>Math.abs(g+c)&&.1>Math.abs(y+b)&&.1>Math.abs(f+
p+h-3))return this.set(1,0,0,0),this;a=Math.PI;f=(f+1)/2;p=(p+1)/2;h=(h+1)/2;e=(e+m)/4;g=(g+c)/4;y=(y+b)/4;f>p&&f>h?.01>f?(b=0,e=c=.707106781):(b=Math.sqrt(f),c=e/b,e=g/b):p>h?.01>p?(b=.707106781,c=0,e=.707106781):(c=Math.sqrt(p),b=e/c,e=y/c):.01>h?(c=b=.707106781,e=0):(e=Math.sqrt(h),b=g/e,c=y/e);this.set(b,c,e,a);return this}a=Math.sqrt((b-y)*(b-y)+(g-c)*(g-c)+(m-e)*(m-e));.001>Math.abs(a)&&(a=1);this.x=(b-y)/a;this.y=(g-c)/a;this.z=(m-e)/a;this.w=Math.acos((f+p+h-1)/2);return this},min:function(a){this.x=
Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,d;return function(c,
e){void 0===a&&(a=new b.Vector4,d=new b.Vector4);a.set(c,c,c,c);d.set(e,e,e,e);return this.clamp(a,d)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},
roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};b.Euler=function(a,d,c,e){this._x=a||0;this._y=d||0;this._z=c||
0;this._order=e||b.Euler.DefaultOrder};b.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");b.Euler.DefaultOrder="XYZ";b.Euler.prototype={constructor:b.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=
c;this._order=e||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,d,c){var e=b.Math.clamp,f=a.elements;a=f[0];var g=f[4],m=f[8],p=f[1],y=f[5],h=f[9],l=f[2],u=f[6],f=f[10];d=d||this._order;"XYZ"===d?(this._y=Math.asin(e(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(-h,f),
this._z=Math.atan2(-g,a)):(this._x=Math.atan2(u,y),this._z=0)):"YXZ"===d?(this._x=Math.asin(-e(h,-1,1)),.99999>Math.abs(h)?(this._y=Math.atan2(m,f),this._z=Math.atan2(p,y)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===d?(this._x=Math.asin(e(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-g,y)):(this._y=0,this._z=Math.atan2(p,a))):"ZYX"===d?(this._y=Math.asin(-e(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(u,f),this._z=Math.atan2(p,a)):(this._x=0,this._z=Math.atan2(-g,
y))):"YZX"===d?(this._z=Math.asin(e(p,-1,1)),.99999>Math.abs(p)?(this._x=Math.atan2(-h,y),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(m,f))):"XZY"===d?(this._z=Math.asin(-e(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(u,y),this._y=Math.atan2(m,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+d);this._order=d;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(d,c,e){void 0===
a&&(a=new b.Matrix4);a.makeRotationFromQuaternion(d);this.setFromRotationMatrix(a,c,e);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new b.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();
return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new b.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};b.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
b.Matrix3.prototype={constructor:b.Matrix3,set:function(a,b,c,e,f,g,m,p,h){var l=this.elements;l[0]=a;l[1]=e;l[2]=m;l[3]=b;l[4]=f;l[5]=p;l[6]=c;l[7]=g;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},
applyToVector3Array:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Vector3);void 0===c&&(c=0);void 0===e&&(e=d.length);for(var f=0;f<e;f+=3,c+=3)a.fromArray(d,c),a.applyMatrix3(this),a.toArray(d,c);return d}}(),applyToBuffer:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Vector3);void 0===c&&(c=0);void 0===e&&(e=d.length/d.itemSize);for(var f=0;f<e;f++,c++)a.x=d.getX(c),a.y=d.getY(c),a.z=d.getZ(c),a.applyMatrix3(this),d.setXYZ(a.x,a.y,a.z);return d}}(),multiplyScalar:function(a){var b=
this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],e=a[2],f=a[3],g=a[4],m=a[5],p=a[6],h=a[7],a=a[8];return b*g*a-b*m*h-c*f*a+c*m*p+e*f*h-e*g*p},getInverse:function(a,d){a instanceof b.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,e=this.elements,f=c[0],g=c[1],m=c[2],p=c[3],h=c[4],l=c[5],q=c[6],u=c[7],c=c[8],k=c*h-l*u,n=l*q-c*p,r=u*p-h*q,
s=f*k+g*n+m*r;if(0===s){if(d)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}e[0]=k;e[1]=m*u-c*g;e[2]=l*g-m*h;e[3]=n;e[4]=c*f-m*q;e[5]=m*p-l*f;e[6]=r;e[7]=g*q-u*f;e[8]=h*f-g*p;return this.multiplyScalar(1/s)},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,
b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;
a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};b.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};b.Matrix4.prototype={constructor:b.Matrix4,set:function(a,b,c,e,f,g,m,p,h,l,q,u,k,n,r,s){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=e;t[1]=f;t[5]=g;t[9]=m;t[13]=p;t[2]=h;t[6]=l;
t[10]=q;t[14]=u;t[3]=k;t[7]=n;t[11]=r;t[15]=s;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new b.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,
b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(d){void 0===a&&(a=new b.Vector3);var c=this.elements,e=d.elements,f=1/a.setFromMatrixColumn(d,0).length(),g=1/a.setFromMatrixColumn(d,1).length();d=1/a.setFromMatrixColumn(d,2).length();c[0]=e[0]*f;c[1]=e[1]*f;c[2]=e[2]*f;c[4]=e[4]*g;c[5]=e[5]*g;c[6]=e[6]*g;c[8]=e[8]*d;c[9]=e[9]*d;c[10]=e[10]*d;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof b.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var d=this.elements,c=a.x,e=a.y,f=a.z,g=Math.cos(c),c=Math.sin(c),m=Math.cos(e),e=Math.sin(e),p=Math.cos(f),f=Math.sin(f);if("XYZ"===a.order){a=g*p;var h=g*f,l=c*p,q=c*f;d[0]=m*p;d[4]=-m*f;d[8]=e;d[1]=h+l*e;d[5]=a-q*e;d[9]=-c*m;d[2]=q-a*e;d[6]=l+h*e;d[10]=g*m}else"YXZ"===a.order?(a=m*p,h=m*f,l=e*p,q=e*f,d[0]=a+q*c,d[4]=l*c-h,d[8]=g*e,d[1]=g*f,d[5]=g*p,d[9]=-c,d[2]=h*c-l,d[6]=q+a*c,d[10]=g*m):"ZXY"===a.order?(a=m*p,h=m*f,l=e*p,q=e*f,d[0]=a-q*c,d[4]=-g*f,d[8]=l+h*c,d[1]=h+l*c,d[5]=g*p,d[9]=q-a*c,d[2]=
-g*e,d[6]=c,d[10]=g*m):"ZYX"===a.order?(a=g*p,h=g*f,l=c*p,q=c*f,d[0]=m*p,d[4]=l*e-h,d[8]=a*e+q,d[1]=m*f,d[5]=q*e+a,d[9]=h*e-l,d[2]=-e,d[6]=c*m,d[10]=g*m):"YZX"===a.order?(a=g*m,h=g*e,l=c*m,q=c*e,d[0]=m*p,d[4]=q-a*f,d[8]=l*f+h,d[1]=f,d[5]=g*p,d[9]=-c*p,d[2]=-e*p,d[6]=h*f+l,d[10]=a-q*f):"XZY"===a.order&&(a=g*m,h=g*e,l=c*m,q=c*e,d[0]=m*p,d[4]=-f,d[8]=e*p,d[1]=a*f+q,d[5]=g*p,d[9]=h*f-l,d[2]=l*f-h,d[6]=c*p,d[10]=q*f+a);d[3]=0;d[7]=0;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return this},makeRotationFromQuaternion:function(a){var b=
this.elements,c=a.x,e=a.y,f=a.z,g=a.w,m=c+c,p=e+e,h=f+f;a=c*m;var l=c*p,c=c*h,q=e*p,e=e*h,f=f*h,m=g*m,p=g*p,g=g*h;b[0]=1-(q+f);b[4]=l-g;b[8]=c+p;b[1]=l+g;b[5]=1-(a+f);b[9]=e-m;b[2]=c-p;b[6]=e+m;b[10]=1-(a+q);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,d,c;return function(e,f,g){void 0===a&&(a=new b.Vector3);void 0===d&&(d=new b.Vector3);void 0===c&&(c=new b.Vector3);var m=this.elements;c.subVectors(e,f).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(g,
c).normalize();0===a.lengthSq()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());d.crossVectors(c,a);m[0]=a.x;m[4]=d.x;m[8]=c.x;m[1]=a.y;m[5]=d.y;m[9]=c.y;m[2]=a.z;m[6]=d.z;m[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=
a.elements,e=b.elements,f=this.elements,g=c[0],m=c[4],p=c[8],h=c[12],l=c[1],q=c[5],u=c[9],k=c[13],n=c[2],r=c[6],s=c[10],t=c[14],A=c[3],B=c[7],v=c[11],c=c[15],z=e[0],x=e[4],J=e[8],E=e[12],L=e[1],D=e[5],Q=e[9],T=e[13],O=e[2],G=e[6],U=e[10],K=e[14],M=e[3],H=e[7],I=e[11],e=e[15];f[0]=g*z+m*L+p*O+h*M;f[4]=g*x+m*D+p*G+h*H;f[8]=g*J+m*Q+p*U+h*I;f[12]=g*E+m*T+p*K+h*e;f[1]=l*z+q*L+u*O+k*M;f[5]=l*x+q*D+u*G+k*H;f[9]=l*J+q*Q+u*U+k*I;f[13]=l*E+q*T+u*K+k*e;f[2]=n*z+r*L+s*O+t*M;f[6]=n*x+r*D+s*G+t*H;f[10]=n*J+r*Q+
s*U+t*I;f[14]=n*E+r*T+s*K+t*e;f[3]=A*z+B*L+v*O+c*M;f[7]=A*x+B*D+v*G+c*H;f[11]=A*J+B*Q+v*U+c*I;f[15]=A*E+B*T+v*K+c*e;return this},multiplyToArray:function(a,b,c){var e=this.elements;this.multiplyMatrices(a,b);c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];c[4]=e[4];c[5]=e[5];c[6]=e[6];c[7]=e[7];c[8]=e[8];c[9]=e[9];c[10]=e[10];c[11]=e[11];c[12]=e[12];c[13]=e[13];c[14]=e[14];c[15]=e[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=
a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Vector3);void 0===c&&(c=0);void 0===e&&(e=d.length);for(var f=0;f<e;f+=3,c+=3)a.fromArray(d,c),a.applyMatrix4(this),a.toArray(d,c);return d}}(),applyToBuffer:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Vector3);void 0===c&&(c=0);void 0===e&&(e=d.length/d.itemSize);for(var f=0;f<e;f++,c++)a.x=d.getX(c),a.y=d.getY(c),a.z=
d.getZ(c),a.applyMatrix4(this),d.setXYZ(a.x,a.y,a.z);return d}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],e=a[8],f=a[12],g=a[1],m=a[5],p=a[9],h=a[13],l=a[2],q=a[6],u=a[10],k=a[14];return a[3]*(+f*p*q-e*h*q-f*m*u+c*h*u+e*m*k-c*p*k)+a[7]*(+b*p*k-b*h*u+f*g*u-e*g*k+e*h*l-f*p*l)+a[11]*(+b*h*q-b*m*k-f*g*q+c*g*k+f*m*l-c*h*l)+a[15]*(-e*m*l-b*p*q+b*m*u+e*g*q-c*g*u+c*p*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];
a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new b.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=
this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,e=a.elements,f=e[0],g=e[1],m=e[2],p=e[3],h=e[4],l=e[5],q=e[6],u=e[7],k=e[8],n=e[9],r=e[10],s=e[11],t=e[12],A=e[13],B=e[14],e=e[15],v=n*B*u-A*r*u+A*q*s-l*B*s-n*q*e+l*r*e,z=t*r*u-k*B*u-t*q*s+h*B*s+k*q*e-h*r*e,x=k*A*u-t*n*u+t*l*s-h*A*s-k*l*e+h*n*e,J=t*n*q-k*A*q-t*l*r+h*A*r+k*l*B-h*n*B,E=f*v+g*z+m*x+p*J;if(0===E){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}c[0]=v;c[1]=A*r*p-n*B*p-A*m*s+g*B*s+n*m*e-g*r*e;c[2]=l*B*p-A*q*p+A*m*u-g*B*u-l*m*e+g*q*e;c[3]=n*q*p-l*r*p-n*m*u+g*r*u+l*m*s-g*q*s;c[4]=z;c[5]=k*B*p-t*r*p+t*m*s-f*B*s-k*m*e+f*r*e;c[6]=t*q*p-h*B*p-t*m*u+f*B*u+h*m*e-f*q*e;c[7]=h*r*p-k*q*p+k*m*u-f*r*u-h*m*s+f*q*s;c[8]=x;c[9]=t*n*p-k*A*p-t*g*s+f*A*s+k*g*e-f*n*e;c[10]=h*A*p-t*l*p+t*g*u-f*A*u-h*g*e+f*l*e;c[11]=k*l*p-h*n*p-k*g*u+f*n*u+h*g*s-f*l*s;c[12]=J;c[13]=k*A*m-t*n*m+t*g*r-f*A*r-k*g*B+f*n*B;c[14]=t*l*m-h*A*m-t*g*q+f*A*q+h*g*B-
f*l*B;c[15]=h*n*m-k*l*m+k*g*q-f*n*q-h*g*r+f*l*r;return this.multiplyScalar(1/E)},scale:function(a){var b=this.elements,c=a.x,e=a.y;a=a.z;b[0]*=c;b[4]*=e;b[8]*=a;b[1]*=c;b[5]*=e;b[9]*=a;b[2]*=c;b[6]*=e;b[10]*=a;b[3]*=c;b[7]*=e;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},
makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),e=Math.sin(b),f=1-c,g=a.x,m=a.y,p=a.z,h=f*g,l=f*m;this.set(h*g+c,h*m-e*p,h*p+e*m,0,h*m+e*p,l*m+c,l*p-e*g,0,h*p-
e*m,l*p+e*g,f*p*p+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,d;return function(c,e,f){void 0===a&&(a=new b.Vector3);void 0===d&&(d=new b.Matrix4);var g=this.elements,m=a.set(g[0],g[1],g[2]).length(),p=a.set(g[4],g[5],g[6]).length(),h=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(m=-m);c.x=g[12];
c.y=g[13];c.z=g[14];d.elements.set(this.elements);c=1/m;var g=1/p,l=1/h;d.elements[0]*=c;d.elements[1]*=c;d.elements[2]*=c;d.elements[4]*=g;d.elements[5]*=g;d.elements[6]*=g;d.elements[8]*=l;d.elements[9]*=l;d.elements[10]*=l;e.setFromRotationMatrix(d);f.x=m;f.y=p;f.z=h;return this}}(),makeFrustum:function(a,b,c,e,f,g){var m=this.elements;m[0]=2*f/(b-a);m[4]=0;m[8]=(b+a)/(b-a);m[12]=0;m[1]=0;m[5]=2*f/(e-c);m[9]=(e+c)/(e-c);m[13]=0;m[2]=0;m[6]=0;m[10]=-(g+f)/(g-f);m[14]=-2*g*f/(g-f);m[3]=0;m[7]=0;
m[11]=-1;m[15]=0;return this},makePerspective:function(a,d,c,e){a=c*Math.tan(b.Math.DEG2RAD*a*.5);var f=-a;return this.makeFrustum(f*d,a*d,f,a,c,e)},makeOrthographic:function(a,b,c,e,f,g){var m=this.elements,p=1/(b-a),h=1/(c-e),l=1/(g-f);m[0]=2*p;m[4]=0;m[8]=0;m[12]=-((b+a)*p);m[1]=0;m[5]=2*h;m[9]=0;m[13]=-((c+e)*h);m[2]=0;m[6]=0;m[10]=-2*l;m[14]=-((g+f)*l);m[3]=0;m[7]=0;m[11]=0;m[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},
fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};b.Ray=function(a,d){this.origin=void 0!==a?a:new b.Vector3;this.direction=void 0!==d?d:new b.Vector3};b.Ray.prototype={constructor:b.Ray,set:function(a,b){this.origin.copy(a);
this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,d){return(d||new b.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize()},recast:function(){var a=new b.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,d){var c=d||
new b.Vector3;c.subVectors(a,this.origin);var e=c.dot(this.direction);return 0>e?c.copy(this.origin):c.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new b.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=
new b.Vector3,d=new b.Vector3,c=new b.Vector3;return function(b,f,g,m){a.copy(b).add(f).multiplyScalar(.5);d.copy(f).sub(b).normalize();c.copy(this.origin).sub(a);var p=.5*b.distanceTo(f),h=-this.direction.dot(d),l=c.dot(this.direction),q=-c.dot(d),u=c.lengthSq(),k=Math.abs(1-h*h),n;0<k?(b=h*q-l,f=h*l-q,n=p*k,0<=b?f>=-n?f<=n?(p=1/k,b*=p,f*=p,h=b*(b+h*f+2*l)+f*(h*b+f+2*q)+u):(f=p,b=Math.max(0,-(h*f+l)),h=-b*b+f*(f+2*q)+u):(f=-p,b=Math.max(0,-(h*f+l)),h=-b*b+f*(f+2*q)+u):f<=-n?(b=Math.max(0,-(-h*p+
l)),f=0<b?-p:Math.min(Math.max(-p,-q),p),h=-b*b+f*(f+2*q)+u):f<=n?(b=0,f=Math.min(Math.max(-p,-q),p),h=f*(f+2*q)+u):(b=Math.max(0,-(h*p+l)),f=0<b?p:Math.min(Math.max(-p,-q),p),h=-b*b+f*(f+2*q)+u)):(f=0<h?-p:p,b=Math.max(0,-(h*f+l)),h=-b*b+f*(f+2*q)+u);g&&g.copy(this.direction).multiplyScalar(b).add(this.origin);m&&m.copy(d).multiplyScalar(f).add(a);return h}}(),intersectSphere:function(){var a=new b.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var e=a.dot(this.direction),f=a.dot(a)-
e*e,g=b.radius*b.radius;if(f>g)return null;g=Math.sqrt(g-f);f=e-g;e+=g;return 0>f&&0>e?null:0>f?this.at(e,c):this.at(f,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=
a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,e,f,g,m;e=1/this.direction.x;g=1/this.direction.y;m=1/this.direction.z;var p=this.origin;0<=e?(c=(a.min.x-p.x)*e,e*=a.max.x-p.x):(c=(a.max.x-p.x)*e,e*=a.min.x-p.x);0<=g?(f=(a.min.y-p.y)*g,g*=a.max.y-p.y):(f=(a.max.y-p.y)*g,g*=a.min.y-p.y);if(c>g||f>e)return null;if(f>c||c!==c)c=f;if(g<e||e!==e)e=g;0<=m?(f=(a.min.z-p.z)*m,m*=a.max.z-p.z):(f=(a.max.z-p.z)*m,m*=a.min.z-p.z);if(c>m||f>
e)return null;if(f>c||c!==c)c=f;if(m<e||e!==e)e=m;return 0>e?null:this.at(0<=c?c:e,b)},intersectsBox:function(){var a=new b.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new b.Vector3,d=new b.Vector3,c=new b.Vector3,e=new b.Vector3;return function(b,g,m,p,h){d.subVectors(g,b);c.subVectors(m,b);e.crossVectors(d,c);g=this.direction.dot(e);if(0<g){if(p)return null;p=1}else if(0>g)p=-1,g=-g;else return null;a.subVectors(this.origin,b);b=p*this.direction.dot(c.crossVectors(a,
c));if(0>b)return null;m=p*this.direction.dot(d.cross(a));if(0>m||b+m>g)return null;b=-p*a.dot(e);return 0>b?null:this.at(b/g,h)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};b.Box2=function(a,d){this.min=void 0!==a?a:new b.Vector2(Infinity,Infinity);this.max=void 0!==d?d:new b.Vector2(-Infinity,
-Infinity)};b.Box2.prototype={constructor:b.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new b.Vector2;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);
return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new b.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new b.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,d){return(d||new b.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?
!1:!0},clampPoint:function(a,d){return(d||new b.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new b.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};
b.Box3=function(a,d){this.min=void 0!==a?a:new b.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==d?d:new b.Vector3(-Infinity,-Infinity,-Infinity)};b.Box3.prototype={constructor:b.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,e=Infinity,f=-Infinity,g=-Infinity,m=-Infinity,p=0,h=a.length;p<h;p+=3){var l=a[p],q=a[p+1],u=a[p+2];l<b&&(b=l);q<c&&(c=q);u<e&&(e=u);l>f&&(f=l);q>g&&(g=q);u>m&&(m=u)}this.min.set(b,c,e);this.max.set(f,
g,m)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new b.Vector3;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),setFromObject:function(){var a=new b.Vector3;return function(d){var c=this;d.updateMatrixWorld(!0);this.makeEmpty();d.traverse(function(d){var f=d.geometry;if(void 0!==f)if(f instanceof b.Geometry)for(var g=f.vertices,
f=0,m=g.length;f<m;f++)a.copy(g[f]),a.applyMatrix4(d.matrixWorld),c.expandByPoint(a);else if(f instanceof b.BufferGeometry&&void 0!==f.attributes.position)for(g=f.attributes.position.array,f=0,m=g.length;f<m;f+=3)a.fromArray(g,f),a.applyMatrix4(d.matrixWorld),c.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=
this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new b.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new b.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);
return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,d){return(d||new b.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<
this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(d){void 0===a&&(a=new b.Vector3);this.clampPoint(d.center,a);return a.distanceToSquared(d.center)<=d.radius*d.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):
(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,d){return(d||new b.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new b.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new b.Vector3;return function(d){d=d||new b.Sphere;
d.center=this.center();d.radius=.5*this.size(a).length();return d}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};b.Sphere=function(a,d){this.center=void 0!==a?a:new b.Vector3;this.radius=void 0!==d?d:0};b.Sphere.prototype={constructor:b.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new b.Box3;return function(b,c){var e=this.center;void 0!==c?e.copy(c):a.setFromPoints(b).center(e);for(var f=0,g=0,m=b.length;g<m;g++)f=Math.max(f,e.distanceToSquared(b[g]));this.radius=
Math.sqrt(f);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},
intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,d){var c=this.center.distanceToSquared(a),e=d||new b.Vector3;e.copy(a);c>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center));return e},getBoundingBox:function(a){a=a||new b.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();
return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}};b.Plane=function(a,d){this.normal=void 0!==a?a:new b.Vector3(1,0,0);this.constant=void 0!==d?d:0};b.Plane.prototype={constructor:b.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,e){this.normal.set(a,b,c);this.constant=e;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=
-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new b.Vector3,d=new b.Vector3;return function(b,e,f){e=a.subVectors(f,e).cross(d.subVectors(b,e)).normalize();this.setFromNormalAndCoplanarPoint(e,b);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=
-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,d){var c=this.distanceToPoint(a);return(d||new b.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new b.Vector3;return function(d,c){var e=c||new b.Vector3,f=d.delta(a),g=this.normal.dot(f);if(0===
g){if(0===this.distanceToPoint(d.start))return e.copy(d.start)}else return g=-(d.start.dot(this.normal)+this.constant)/g,0>g||1<g?void 0:e.copy(f).multiplyScalar(g).add(d.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new b.Vector3).copy(this.normal).multiplyScalar(-this.constant)},
applyMatrix4:function(){var a=new b.Vector3,d=new b.Matrix3;return function(b,e){var f=this.coplanarPoint(a).applyMatrix4(b),g=e||d.getNormalMatrix(b),g=this.normal.applyMatrix3(g).normalize();this.constant=-f.dot(g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};b.Frustum=function(a,d,c,e,f,g){this.planes=[void 0!==a?a:new b.Plane,void 0!==d?d:new b.Plane,void 0!==c?c:new b.Plane,
void 0!==e?e:new b.Plane,void 0!==f?f:new b.Plane,void 0!==g?g:new b.Plane]};b.Frustum.prototype={constructor:b.Frustum,set:function(a,b,c,e,f,g){var m=this.planes;m[0].copy(a);m[1].copy(b);m[2].copy(c);m[3].copy(e);m[4].copy(f);m[5].copy(g);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var e=c[1],f=c[2],g=c[3],m=c[4],p=c[5],
h=c[6],l=c[7],q=c[8],u=c[9],k=c[10],n=c[11],r=c[12],s=c[13],t=c[14],c=c[15];b[0].setComponents(g-a,l-m,n-q,c-r).normalize();b[1].setComponents(g+a,l+m,n+q,c+r).normalize();b[2].setComponents(g+e,l+p,n+u,c+s).normalize();b[3].setComponents(g-e,l-p,n-u,c-s).normalize();b[4].setComponents(g-f,l-h,n-k,c-t).normalize();b[5].setComponents(g+f,l+h,n+k,c+t).normalize();return this},intersectsObject:function(){var a=new b.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();
a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var e=0;6>e;e++)if(b[e].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new b.Vector3,d=new b.Vector3;return function(b){for(var e=this.planes,f=0;6>f;f++){var g=e[f];a.x=0<g.normal.x?b.min.x:b.max.x;d.x=0<g.normal.x?b.max.x:b.min.x;a.y=0<g.normal.y?b.min.y:b.max.y;d.y=0<g.normal.y?b.max.y:b.min.y;a.z=0<g.normal.z?
b.min.z:b.max.z;d.z=0<g.normal.z?b.max.z:b.min.z;var m=g.distanceToPoint(a),g=g.distanceToPoint(d);if(0>m&&0>g)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};b.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,e;return function(){for(var f=0;36>f;f++)8===f||13===f||18===f||23===f?b[f]="-":14===f?b[f]=
"4":(2>=c&&(c=33554432+16777216*Math.random()|0),e=c&15,c>>=4,b[f]=a[19===f?e&3|8:e]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,e,f){return e+(a-b)*(f-e)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");
return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*b.Math.DEG2RAD},radToDeg:function(a){return a*b.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;
return a}};b.Triangle=function(a,d,c){this.a=void 0!==a?a:new b.Vector3;this.b=void 0!==d?d:new b.Vector3;this.c=void 0!==c?c:new b.Vector3};b.Triangle.normal=function(){var a=new b.Vector3;return function(d,c,e,f){f=f||new b.Vector3;f.subVectors(e,c);a.subVectors(d,c);f.cross(a);d=f.lengthSq();return 0<d?f.multiplyScalar(1/Math.sqrt(d)):f.set(0,0,0)}}();b.Triangle.barycoordFromPoint=function(){var a=new b.Vector3,d=new b.Vector3,c=new b.Vector3;return function(e,f,g,m,p){a.subVectors(m,f);d.subVectors(g,
f);c.subVectors(e,f);e=a.dot(a);f=a.dot(d);g=a.dot(c);var h=d.dot(d);m=d.dot(c);var l=e*h-f*f;p=p||new b.Vector3;if(0===l)return p.set(-2,-1,-1);l=1/l;h=(h*g-f*m)*l;e=(e*m-f*g)*l;return p.set(1-h-e,e,h)}}();b.Triangle.containsPoint=function(){var a=new b.Vector3;return function(d,c,e,f){d=b.Triangle.barycoordFromPoint(d,c,e,f,a);return 0<=d.x&&0<=d.y&&1>=d.x+d.y}}();b.Triangle.prototype={constructor:b.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,
b,c,e){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[e]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new b.Vector3,d=new b.Vector3;return function(){a.subVectors(this.c,this.b);d.subVectors(this.a,this.b);return.5*a.cross(d).length()}}(),midpoint:function(a){return(a||new b.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return b.Triangle.normal(this.a,
this.b,this.c,a)},plane:function(a){return(a||new b.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,d){return b.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,d)},containsPoint:function(a){return b.Triangle.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,d,c,e;return function(f,g){void 0===a&&(a=new b.Plane,d=[new b.Line3,new b.Line3,new b.Line3],c=new b.Vector3,e=new b.Vector3);var m=g||new b.Vector3,p=Infinity;a.setFromCoplanarPoints(this.a,
this.b,this.c);a.projectPoint(f,c);if(!0===this.containsPoint(c))m.copy(c);else{d[0].set(this.a,this.b);d[1].set(this.b,this.c);d[2].set(this.c,this.a);for(var h=0;h<d.length;h++){d[h].closestPointToPoint(c,!0,e);var l=c.distanceToSquared(e);l<p&&(p=l,m.copy(e))}}return m}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};b.EventDispatcher=function(){};b.EventDispatcher.prototype={constructor:b.EventDispatcher,apply:function(a){a.addEventListener=b.EventDispatcher.prototype.addEventListener;
a.hasEventListener=b.EventDispatcher.prototype.hasEventListener;a.removeEventListener=b.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=b.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,
b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var e=c.indexOf(b);-1!==e&&c.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],e=b.length,f=0;f<e;f++)c[f]=b[f];for(f=0;f<e;f++)c[f].call(this,a)}}}};(function(a){function b(a,c){return a.distance-c.distance}function c(a,b,d,m){if(!1!==a.visible&&(a.raycast(b,d),!0===m)){a=a.children;m=0;for(var p=a.length;m<p;m++)c(a[m],b,d,!0)}}a.Raycaster=
function(b,c,d,m){this.ray=new a.Ray(b,c);this.near=d||0;this.far=m||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),
this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,f){var g=[];c(a,this,g,f);g.sort(b);return g},intersectObjects:function(a,f){var g=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),
g;for(var m=0,p=a.length;m<p;m++)c(a[m],this,g,f);g.sort(b);return g}}})(b);b.Object3D=function(){Object.defineProperty(this,"id",{value:b.Object3DIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=b.Object3D.DefaultUp.clone();var a=new b.Vector3,d=new b.Euler,c=new b.Quaternion,e=new b.Vector3(1,1,1);d.onChange(function(){c.setFromEuler(d,!1)});c.onChange(function(){d.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:d},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new b.Matrix4},normalMatrix:{value:new b.Matrix3}});this.rotationAutoUpdate=!0;this.matrix=new b.Matrix4;this.matrixWorld=new b.Matrix4;this.matrixAutoUpdate=b.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new b.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData=
{}};b.Object3D.DefaultUp=new b.Vector3(0,1,0);b.Object3D.DefaultMatrixAutoUpdate=!0;b.Object3D.prototype={constructor:b.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},
rotateOnAxis:function(){var a=new b.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new b.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new b.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new b.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new b.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new b.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new b.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new b.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new b.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),
lookAt:function(){var a=new b.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var d=0;d<arguments.length;d++)this.add(arguments[d]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof b.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,e=this.children.length;c<e;c++){var f=this.children[c].getObjectByProperty(a,
b);if(void 0!==f)return f}},getWorldPosition:function(a){a=a||new b.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new b.Vector3,d=new b.Vector3;return function(c){c=c||new b.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,d);return c}}(),getWorldRotation:function(){var a=new b.Quaternion;return function(d){d=d||new b.Euler;this.getWorldQuaternion(a);return d.setFromQuaternion(a,this.rotation.order,!1)}}(),
getWorldScale:function(){var a=new b.Vector3,d=new b.Quaternion;return function(c){c=c||new b.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,d,c);return c}}(),getWorldDirection:function(){var a=new b.Quaternion;return function(d){d=d||new b.Vector3;this.getWorldQuaternion(a);return d.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);
for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var c=[],d;for(d in a){var e=a[d];delete e.metadata;c.push(e)}return c}var c=void 0===a||""===a,e={};c&&(a={geometries:{},materials:{},textures:{},images:{}},e.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var f={};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);"{}"!==JSON.stringify(this.userData)&&
(f.userData=this.userData);!0===this.castShadow&&(f.castShadow=!0);!0===this.receiveShadow&&(f.receiveShadow=!0);!1===this.visible&&(f.visible=!1);f.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),f.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),f.material=this.material.uuid);if(0<this.children.length){f.children=
[];for(var g=0;g<this.children.length;g++)f.children.push(this.children[g].toJSON(a).object)}if(c){var c=b(a.geometries),g=b(a.materials),m=b(a.textures);a=b(a.images);0<c.length&&(e.geometries=c);0<g.length&&(e.materials=g);0<m.length&&(e.textures=m);0<a.length&&(e.images=a)}e.object=f;return e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.rotationAutoUpdate=a.rotationAutoUpdate;this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}};
b.EventDispatcher.prototype.apply(b.Object3D.prototype);b.Object3DIdCount=0;b.Face3=function(a,d,c,e,f,g){this.a=a;this.b=d;this.c=c;this.normal=e instanceof b.Vector3?e:new b.Vector3;this.vertexNormals=Array.isArray(e)?e:[];this.color=f instanceof b.Color?f:new b.Color;this.vertexColors=Array.isArray(f)?f:[];this.materialIndex=void 0!==g?g:0};b.Face3.prototype={constructor:b.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);
this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};b.Layers=function(){this.mask=1};b.Layers.prototype={constructor:b.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==
(this.mask&a.mask)}};b.BufferAttribute=function(a,d,c){this.uuid=b.Math.generateUUID();this.array=a;this.itemSize=d;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};b.BufferAttribute.prototype={constructor:b.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=
a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var e=0,f=this.itemSize;e<f;e++)this.array[a+e]=b.array[c+e];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var d=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),g=new b.Color);d[c++]=g.r;d[c++]=g.g;d[c++]=g.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,
e=0,f=a.length;e<f;e++){var g=a[e];b[c++]=g.a;b[c++]=g.b;b[c++]=g.c}return this},copyVector2sArray:function(a){for(var d=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),g=new b.Vector2);d[c++]=g.x;d[c++]=g.y}return this},copyVector3sArray:function(a){for(var d=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),
g=new b.Vector3);d[c++]=g.x;d[c++]=g.y;d[c++]=g.z}return this},copyVector4sArray:function(a){for(var d=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),g=new b.Vector4);d[c++]=g.x;d[c++]=g.y;d[c++]=g.z;d[c++]=g.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},
getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,e){a*=this.itemSize;this.array[a+0]=
b;this.array[a+1]=c;this.array[a+2]=e;return this},setXYZW:function(a,b,c,e,f){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=e;this.array[a+3]=f;return this},clone:function(){return(new this.constructor).copy(this)}};b.Int8Attribute=function(a,d){return new b.BufferAttribute(new Int8Array(a),d)};b.Uint8Attribute=function(a,d){return new b.BufferAttribute(new Uint8Array(a),d)};b.Uint8ClampedAttribute=function(a,d){return new b.BufferAttribute(new Uint8ClampedArray(a),d)};b.Int16Attribute=
function(a,d){return new b.BufferAttribute(new Int16Array(a),d)};b.Uint16Attribute=function(a,d){return new b.BufferAttribute(new Uint16Array(a),d)};b.Int32Attribute=function(a,d){return new b.BufferAttribute(new Int32Array(a),d)};b.Uint32Attribute=function(a,d){return new b.BufferAttribute(new Uint32Array(a),d)};b.Float32Attribute=function(a,d){return new b.BufferAttribute(new Float32Array(a),d)};b.Float64Attribute=function(a,d){return new b.BufferAttribute(new Float64Array(a),d)};b.DynamicBufferAttribute=
function(a,d){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new b.BufferAttribute(a,d)).setDynamic(!0)};b.InstancedBufferAttribute=function(a,d,c){b.BufferAttribute.call(this,a,d);this.meshPerAttribute=c||1};b.InstancedBufferAttribute.prototype=Object.create(b.BufferAttribute.prototype);b.InstancedBufferAttribute.prototype.constructor=b.InstancedBufferAttribute;b.InstancedBufferAttribute.prototype.copy=function(a){b.BufferAttribute.prototype.copy.call(this,
a);this.meshPerAttribute=a.meshPerAttribute;return this};b.Geometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=
this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};b.Geometry.prototype={constructor:b.Geometry,applyMatrix:function(a){for(var d=(new b.Matrix3).getNormalMatrix(a),c=0,e=this.vertices.length;c<e;c++)this.vertices[c].applyMatrix4(a);c=0;for(e=this.faces.length;c<e;c++){a=this.faces[c];a.normal.applyMatrix3(d).normalize();for(var f=0,g=a.vertexNormals.length;f<g;f++)a.vertexNormals[f].applyMatrix3(d).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&
this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.makeRotationX(d);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.makeRotationY(d);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.makeRotationZ(d);this.applyMatrix(a);return this}}(),translate:function(){var a;
return function(d,c,e){void 0===a&&(a=new b.Matrix4);a.makeTranslation(d,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Matrix4);a.makeScale(d,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(d){void 0===a&&(a=new b.Object3D);a.lookAt(d);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function d(a,d,e,f){var g=void 0!==m?[q[a].clone(),q[d].clone(),q[e].clone()]:[],n=void 0!==
p?[c.colors[a].clone(),c.colors[d].clone(),c.colors[e].clone()]:[];f=new b.Face3(a,d,e,g,n,f);c.faces.push(f);void 0!==h&&c.faceVertexUvs[0].push([u[a].clone(),u[d].clone(),u[e].clone()]);void 0!==l&&c.faceVertexUvs[1].push([k[a].clone(),k[d].clone(),k[e].clone()])}var c=this,e=null!==a.index?a.index.array:void 0,f=a.attributes,g=f.position.array,m=void 0!==f.normal?f.normal.array:void 0,p=void 0!==f.color?f.color.array:void 0,h=void 0!==f.uv?f.uv.array:void 0,l=void 0!==f.uv2?f.uv2.array:void 0;
void 0!==l&&(this.faceVertexUvs[1]=[]);for(var q=[],u=[],k=[],n=f=0;f<g.length;f+=3,n+=2)c.vertices.push(new b.Vector3(g[f],g[f+1],g[f+2])),void 0!==m&&q.push(new b.Vector3(m[f],m[f+1],m[f+2])),void 0!==p&&c.colors.push(new b.Color(p[f],p[f+1],p[f+2])),void 0!==h&&u.push(new b.Vector2(h[n],h[n+1])),void 0!==l&&k.push(new b.Vector2(l[n],l[n+1]));if(void 0!==e)if(g=a.groups,0<g.length)for(f=0;f<g.length;f++)for(var r=g[f],s=r.start,t=r.count,n=s,s=s+t;n<s;n+=3)d(e[n],e[n+1],e[n+2],r.materialIndex);
else for(f=0;f<e.length;f+=3)d(e[f],e[f+1],e[f+2]);else for(f=0;f<g.length/3;f+=3)d(f,f+1,f+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,d=this.boundingSphere.radius,
d=0===d?1:1/d,c=new b.Matrix4;c.set(d,0,0,-d*a.x,0,d,0,-d*a.y,0,0,d,-d*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new b.Vector3,d=new b.Vector3,c=0,e=this.faces.length;c<e;c++){var f=this.faces[c],g=this.vertices[f.a],m=this.vertices[f.b];a.subVectors(this.vertices[f.c],m);d.subVectors(g,m);a.cross(d);a.normalize();f.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var d,c,e;e=Array(this.vertices.length);d=0;for(c=this.vertices.length;d<
c;d++)e[d]=new b.Vector3;if(a){var f,g,m,p=new b.Vector3,h=new b.Vector3;a=0;for(d=this.faces.length;a<d;a++)c=this.faces[a],f=this.vertices[c.a],g=this.vertices[c.b],m=this.vertices[c.c],p.subVectors(m,g),h.subVectors(f,g),p.cross(h),e[c.a].add(p),e[c.b].add(p),e[c.c].add(p)}else for(a=0,d=this.faces.length;a<d;a++)c=this.faces[a],e[c.a].add(c.normal),e[c.b].add(c.normal),e[c.c].add(c.normal);d=0;for(c=this.vertices.length;d<c;d++)e[d].normalize();a=0;for(d=this.faces.length;a<d;a++)c=this.faces[a],
f=c.vertexNormals,3===f.length?(f[0].copy(e[c.a]),f[1].copy(e[c.b]),f[2].copy(e[c.c])):(f[0]=e[c.a].clone(),f[1]=e[c.b].clone(),f[2]=e[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,d,c,e,f;c=0;for(e=this.faces.length;c<e;c++)for(f=this.faces[c],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]),a=0,d=f.vertexNormals.length;a<d;a++)f.__originalVertexNormals[a]?
f.__originalVertexNormals[a].copy(f.vertexNormals[a]):f.__originalVertexNormals[a]=f.vertexNormals[a].clone();var g=new b.Geometry;g.faces=this.faces;a=0;for(d=this.morphTargets.length;a<d;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];f=this.morphNormals[a].faceNormals;var m=this.morphNormals[a].vertexNormals,p,h;c=0;for(e=this.faces.length;c<e;c++)p=new b.Vector3,h={a:new b.Vector3,b:new b.Vector3,c:new b.Vector3},
f.push(p),m.push(h)}m=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices;g.computeFaceNormals();g.computeVertexNormals();c=0;for(e=this.faces.length;c<e;c++)f=this.faces[c],p=m.faceNormals[c],h=m.vertexNormals[c],p.copy(f.normal),h.a.copy(f.vertexNormals[0]),h.b.copy(f.vertexNormals[1]),h.c.copy(f.vertexNormals[2])}c=0;for(e=this.faces.length;c<e;c++)f=this.faces[c],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},
computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,e=b.length;c<e;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new b.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new b.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,d,c){if(!1===a instanceof b.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",
a);else{var e,f=this.vertices.length,g=this.vertices,m=a.vertices,p=this.faces,h=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==d&&(e=(new b.Matrix3).getNormalMatrix(d));for(var q=0,u=m.length;q<u;q++){var k=m[q].clone();void 0!==d&&k.applyMatrix4(d);g.push(k)}q=0;for(u=h.length;q<u;q++){var m=h[q],n,r=m.vertexNormals,s=m.vertexColors,k=new b.Face3(m.a+f,m.b+f,m.c+f);k.normal.copy(m.normal);void 0!==e&&k.normal.applyMatrix3(e).normalize();d=0;for(g=r.length;d<g;d++)n=
r[d].clone(),void 0!==e&&n.applyMatrix3(e).normalize(),k.vertexNormals.push(n);k.color.copy(m.color);d=0;for(g=s.length;d<g;d++)n=s[d],k.vertexColors.push(n.clone());k.materialIndex=m.materialIndex+c;p.push(k)}q=0;for(u=a.length;q<u;q++)if(c=a[q],e=[],void 0!==c){d=0;for(g=c.length;d<g;d++)e.push(c[d].clone());l.push(e)}}},mergeMesh:function(a){!1===a instanceof b.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,
a.matrix))},mergeVertices:function(){var a={},b=[],c=[],e,f=Math.pow(10,4),g,m;g=0;for(m=this.vertices.length;g<m;g++)e=this.vertices[g],e=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===a[e]?(a[e]=g,b.push(this.vertices[g]),c[g]=b.length-1):c[g]=c[a[e]];a=[];g=0;for(m=this.faces.length;g<m;g++)for(f=this.faces[g],f.a=c[f.a],f.b=c[f.b],f.c=c[f.c],f=[f.a,f.b,f.c],e=0;3>e;e++)if(f[e]===f[(e+1)%3]){a.push(g);break}for(g=a.length-1;0<=g;g--)for(f=a[g],this.faces.splice(f,1),c=0,
m=this.faceVertexUvs.length;c<m;c++)this.faceVertexUvs[c].splice(f,1);g=this.vertices.length-b.length;this.vertices=b;return g},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var e=this.faceVertexUvs[0],f=this.faceVertexUvs[1],g,m;e&&e.length===b&&(g=[]);f&&f.length===b&&(m=[]);for(c=0;c<b;c++){var p=a[c]._id;g&&g.push(e[p]);m&&m.push(f[p])}g&&(this.faceVertexUvs[0]=g);m&&(this.faceVertexUvs[1]=
m)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var c=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[c])return l[c];l[c]=h.length/3;h.push(a.x,a.y,a.z);return l[c]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==u[b])return u[b];u[b]=q.length;q.push(a.getHex());return u[b]}function e(a){var b=a.x.toString()+a.y.toString();if(void 0!==n[b])return n[b];n[b]=k.length/2;k.push(a.x,a.y);return n[b]}var f={metadata:{version:4.4,type:"Geometry",
generator:"Geometry.toJSON"}};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);if(void 0!==this.parameters){var g=this.parameters,m;for(m in g)void 0!==g[m]&&(f[m]=g[m]);return f}g=[];for(m=0;m<this.vertices.length;m++){var p=this.vertices[m];g.push(p.x,p.y,p.z)}var p=[],h=[],l={},q=[],u={},k=[],n={};for(m=0;m<this.faces.length;m++){var r=this.faces[m],s=void 0!==this.faceVertexUvs[0][m],t=0<r.normal.length(),A=0<r.vertexNormals.length,B=1!==r.color.r||1!==r.color.g||1!==r.color.b,
v=0<r.vertexColors.length,z=0,z=a(z,0,0),z=a(z,1,!0),z=a(z,2,!1),z=a(z,3,s),z=a(z,4,t),z=a(z,5,A),z=a(z,6,B),z=a(z,7,v);p.push(z);p.push(r.a,r.b,r.c);p.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][m],p.push(e(s[0]),e(s[1]),e(s[2])));t&&p.push(b(r.normal));A&&(t=r.vertexNormals,p.push(b(t[0]),b(t[1]),b(t[2])));B&&p.push(c(r.color));v&&(r=r.vertexColors,p.push(c(r[0]),c(r[1]),c(r[2])))}f.data={};f.data.vertices=g;f.data.normals=h;0<q.length&&(f.data.colors=q);0<k.length&&(f.data.uvs=[k]);f.data.faces=
p;return f},clone:function(){return(new b.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,e=b.length;c<e;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(e=b.length;c<e;c++)this.faces.push(b[c].clone());c=0;for(e=a.faceVertexUvs.length;c<e;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var f=0,g=b.length;f<g;f++){for(var m=b[f],p=[],h=0,l=m.length;h<l;h++)p.push(m[h].clone());this.faceVertexUvs[c].push(p)}}return this},
dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.Geometry.prototype);b.GeometryIdCount=0;b.DirectGeometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;
this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};b.DirectGeometry.prototype={constructor:b.DirectGeometry,computeBoundingBox:b.Geometry.prototype.computeBoundingBox,computeBoundingSphere:b.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},
computeGroups:function(a){var b,c=[],e;a=a.faces;for(var f=0;f<a.length;f++){var g=a[f];g.materialIndex!==e&&(e=g.materialIndex,void 0!==b&&(b.count=3*f-b.start,c.push(b)),b={start:3*f,materialIndex:e})}void 0!==b&&(b.count=3*f-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var d=a.faces,c=a.vertices,e=a.faceVertexUvs,f=e[0]&&0<e[0].length,g=e[1]&&0<e[1].length,m=a.morphTargets,p=m.length,h;if(0<p){h=[];for(var l=0;l<p;l++)h[l]=[];this.morphTargets.position=h}var q=a.morphNormals,u=q.length,
k;if(0<u){k=[];for(l=0;l<u;l++)k[l]=[];this.morphTargets.normal=k}for(var n=a.skinIndices,r=a.skinWeights,s=n.length===c.length,t=r.length===c.length,l=0;l<d.length;l++){var A=d[l];this.vertices.push(c[A.a],c[A.b],c[A.c]);var B=A.vertexNormals;3===B.length?this.normals.push(B[0],B[1],B[2]):(B=A.normal,this.normals.push(B,B,B));B=A.vertexColors;3===B.length?this.colors.push(B[0],B[1],B[2]):(B=A.color,this.colors.push(B,B,B));!0===f&&(B=e[0][l],void 0!==B?this.uvs.push(B[0],B[1],B[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",
l),this.uvs.push(new b.Vector2,new b.Vector2,new b.Vector2)));!0===g&&(B=e[1][l],void 0!==B?this.uvs2.push(B[0],B[1],B[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new b.Vector2,new b.Vector2,new b.Vector2)));for(B=0;B<p;B++){var v=m[B].vertices;h[B].push(v[A.a],v[A.b],v[A.c])}for(B=0;B<u;B++)v=q[B].vertexNormals[l],k[B].push(v.a,v.b,v.c);s&&this.skinIndices.push(n[A.a],n[A.b],n[A.c]);t&&this.skinWeights.push(r[A.a],r[A.b],r[A.c])}this.computeGroups(a);
this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.DirectGeometry.prototype);b.BufferGeometry=function(){Object.defineProperty(this,"id",{value:b.GeometryIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=
null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};b.BufferGeometry.prototype={constructor:b.BufferGeometry,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,d,c){if(!1===d instanceof b.BufferAttribute&&!1===d instanceof b.InterleavedBufferAttribute)console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new b.BufferAttribute(d,
c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(d);else return this.attributes[a]=d,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var d=
this.attributes.position;void 0!==d&&(a.applyToVector3Array(d.array),d.needsUpdate=!0);d=this.attributes.normal;void 0!==d&&((new b.Matrix3).getNormalMatrix(a).applyToVector3Array(d.array),d.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.makeRotationX(d);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(d){void 0===
a&&(a=new b.Matrix4);a.makeRotationY(d);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(d){void 0===a&&(a=new b.Matrix4);a.makeRotationZ(d);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Matrix4);a.makeTranslation(d,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(d,c,e){void 0===a&&(a=new b.Matrix4);a.makeScale(d,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;
return function(d){void 0===a&&(a=new b.Object3D);a.lookAt(d);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var d=a.geometry;if(a instanceof b.Points||a instanceof b.Line){a=new b.Float32Attribute(3*d.vertices.length,3);var c=new b.Float32Attribute(3*d.colors.length,3);this.addAttribute("position",a.copyVector3sArray(d.vertices));this.addAttribute("color",
c.copyColorsArray(d.colors));d.lineDistances&&d.lineDistances.length===d.vertices.length&&(a=new b.Float32Attribute(d.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(d.lineDistances)));null!==d.boundingSphere&&(this.boundingSphere=d.boundingSphere.clone());null!==d.boundingBox&&(this.boundingBox=d.boundingBox.clone())}else a instanceof b.Mesh&&d instanceof b.Geometry&&this.fromGeometry(d);return this},updateFromObject:function(a){var d=a.geometry;if(a instanceof b.Mesh){var c=
d.__directGeometry;if(void 0===c)return this.fromGeometry(d);c.verticesNeedUpdate=d.verticesNeedUpdate;c.normalsNeedUpdate=d.normalsNeedUpdate;c.colorsNeedUpdate=d.colorsNeedUpdate;c.uvsNeedUpdate=d.uvsNeedUpdate;c.groupsNeedUpdate=d.groupsNeedUpdate;d.verticesNeedUpdate=!1;d.normalsNeedUpdate=!1;d.colorsNeedUpdate=!1;d.uvsNeedUpdate=!1;d.groupsNeedUpdate=!1;d=c}!0===d.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(d.vertices),c.needsUpdate=!0),d.verticesNeedUpdate=
!1);!0===d.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(d.normals),c.needsUpdate=!0),d.normalsNeedUpdate=!1);!0===d.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(d.colors),c.needsUpdate=!0),d.colorsNeedUpdate=!1);d.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(d.uvs),c.needsUpdate=!0),d.uvsNeedUpdate=!1);d.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(d.lineDistances),c.needsUpdate=
!0),d.lineDistancesNeedUpdate=!1);d.groupsNeedUpdate&&(d.computeGroups(a.geometry),this.groups=d.groups,d.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new b.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var d=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new b.BufferAttribute(d,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(d=new Float32Array(3*a.normals.length),this.addAttribute("normal",
(new b.BufferAttribute(d,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(d=new Float32Array(3*a.colors.length),this.addAttribute("color",(new b.BufferAttribute(d,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(d=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new b.BufferAttribute(d,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(d=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new b.BufferAttribute(d,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(d=new (65535<
a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new b.BufferAttribute(d,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var d=[],e=a.morphTargets[c],f=0,g=e.length;f<g;f++){var m=e[f],h=new b.Float32Attribute(3*m.length,3);d.push(h.copyVector3sArray(m))}this.morphAttributes[c]=d}0<a.skinIndices.length&&(c=new b.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&
(c=new b.Float32Attribute(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new b.Box3);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||
isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new b.Box3,d=new b.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new b.Sphere);var c=this.attributes.position.array;if(c){var e=this.boundingSphere.center;a.setFromArray(c);a.center(e);for(var f=0,g=0,m=c.length;g<m;g+=3)d.fromArray(c,g),f=Math.max(f,
e.distanceToSquared(d));this.boundingSphere.radius=Math.sqrt(f);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,d=this.attributes,c=this.groups;if(d.position){var e=d.position.array;if(void 0===d.normal)this.addAttribute("normal",new b.BufferAttribute(new Float32Array(e.length),3));
else for(var f=d.normal.array,g=0,m=f.length;g<m;g++)f[g]=0;var f=d.normal.array,h,l,C,q=new b.Vector3,u=new b.Vector3,k=new b.Vector3,n=new b.Vector3,r=new b.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var s=0,t=c.length;s<t;++s)for(g=c[s],m=g.start,h=g.count,g=m,m+=h;g<m;g+=3)h=3*a[g+0],l=3*a[g+1],C=3*a[g+2],q.fromArray(e,h),u.fromArray(e,l),k.fromArray(e,C),n.subVectors(k,u),r.subVectors(q,u),n.cross(r),f[h]+=n.x,f[h+1]+=n.y,f[h+2]+=n.z,f[l]+=n.x,f[l+1]+=n.y,f[l+2]+=n.z,
f[C]+=n.x,f[C+1]+=n.y,f[C+2]+=n.z}else for(g=0,m=e.length;g<m;g+=9)q.fromArray(e,g),u.fromArray(e,g+3),k.fromArray(e,g+6),n.subVectors(k,u),r.subVectors(q,u),n.cross(r),f[g]=n.x,f[g+1]=n.y,f[g+2]=n.z,f[g+3]=n.x,f[g+4]=n.y,f[g+5]=n.z,f[g+6]=n.x,f[g+7]=n.y,f[g+8]=n.z;this.normalizeNormals();d.normal.needsUpdate=!0}},merge:function(a,d){if(!1===a instanceof b.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===d&&(d=0);var c=
this.attributes,e;for(e in c)if(void 0!==a.attributes[e])for(var f=c[e].array,g=a.attributes[e],m=g.array,h=0,g=g.itemSize*d;h<m.length;h++,g++)f[g]=m[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,e,f=0,g=a.length;f<g;f+=3)b=a[f],c=a[f+1],e=a[f+2],b=1/Math.sqrt(b*b+c*c+e*e),a[f]*=b,a[f+1]*=b,a[f+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new b.BufferGeometry,
d=this.index.array,c=this.attributes,e;for(e in c){for(var f=c[e],g=f.array,f=f.itemSize,m=new g.constructor(d.length*f),h=0,l=0,C=0,q=d.length;C<q;C++)for(var h=d[C]*f,u=0;u<f;u++)m[l++]=g[h++];a.addAttribute(e,new b.BufferAttribute(m,f))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==b[c]&&
(a[c]=b[c]);return a}a.data={attributes:{}};var e=this.index;null!==e&&(b=Array.prototype.slice.call(e.array),a.data.index={type:e.array.constructor.name,array:b});e=this.attributes;for(c in e){var f=e[c],b=Array.prototype.slice.call(f.array);a.data.attributes[c]={itemSize:f.itemSize,type:f.array.constructor.name,array:b,normalized:f.normalized}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),
radius:c.radius});return a},clone:function(){return(new b.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count,e.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.BufferGeometry.prototype);b.BufferGeometry.MaxIndex=65535;b.InstancedBufferGeometry=
function(){b.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0};b.InstancedBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.InstancedBufferGeometry.prototype.constructor=b.InstancedBufferGeometry;b.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};b.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,
b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count,e.instances)}return this};b.EventDispatcher.prototype.apply(b.InstancedBufferGeometry.prototype);b.InterleavedBufferAttribute=function(a,d,c){this.uuid=b.Math.generateUUID();this.data=a;this.itemSize=d;this.offset=c};b.InterleavedBufferAttribute.prototype={constructor:b.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},
get count(){return this.data.count},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+
this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=e;return this},setXYZW:function(a,b,c,e,f){a=a*this.data.stride+this.offset;this.data.array[a+0]=
b;this.data.array[a+1]=c;this.data.array[a+2]=e;this.data.array[a+3]=f;return this}};b.Camera=function(){b.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new b.Matrix4;this.projectionMatrix=new b.Matrix4};b.Camera.prototype=Object.create(b.Object3D.prototype);b.Camera.prototype.constructor=b.Camera;b.Camera.prototype.getWorldDirection=function(){var a=new b.Quaternion;return function(d){d=d||new b.Vector3;this.getWorldQuaternion(a);return d.set(0,0,-1).applyQuaternion(a)}}();b.Camera.prototype.lookAt=
function(){var a=new b.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();b.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};b.Camera.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};b.PerspectiveCamera=function(a,d,c,e){b.Camera.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:
50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==e?e:2E3;this.focus=10;this.aspect=void 0!==d?d:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};b.PerspectiveCamera.prototype=Object.create(b.Camera.prototype);b.PerspectiveCamera.prototype.constructor=b.PerspectiveCamera;b.PerspectiveCamera.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==
b&&(this.filmGauge=b);this.setFocalLength(a)};b.PerspectiveCamera.prototype.setFocalLength=function(a){a=.5*this.getFilmHeight()/a;this.fov=2*b.Math.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.getFocalLength=function(){var a=Math.tan(.5*b.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a};b.PerspectiveCamera.prototype.getEffectiveFOV=function(){return 2*b.Math.RAD2DEG*Math.atan(Math.tan(.5*b.Math.DEG2RAD*this.fov)/this.zoom)};b.PerspectiveCamera.prototype.getFilmWidth=
function(){return this.filmGauge*Math.min(this.aspect,1)};b.PerspectiveCamera.prototype.getFilmHeight=function(){return this.filmGauge/Math.max(this.aspect,1)};b.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,e,f,g){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:e,width:f,height:g};this.updateProjectionMatrix()};b.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=this.near,d=a*Math.tan(.5*b.Math.DEG2RAD*this.fov)/this.zoom,c=2*d,e=this.aspect*c,f=
-.5*e,g=this.view;if(null!==g)var m=g.fullWidth,h=g.fullHeight,f=f+g.offsetX*e/m,d=d-g.offsetY*c/h,e=g.width/m*e,c=g.height/h*c;g=this.filmOffset;0!==g&&(f+=a*g/this.getFilmWidth());this.projectionMatrix.makeFrustum(f,f+e,d-c,d,a,this.far)};b.PerspectiveCamera.prototype.copy=function(a){b.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;
this.filmOffset=a.filmOffset;return this};b.PerspectiveCamera.prototype.toJSON=function(a){a=b.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a};b.Light=function(a,d){b.Object3D.call(this);this.type="Light";this.color=new b.Color(a);
this.intensity=void 0!==d?d:1;this.receiveShadow=void 0};b.Light.prototype=Object.create(b.Object3D.prototype);b.Light.prototype.constructor=b.Light;b.Light.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this};b.Light.prototype.toJSON=function(a){a=b.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());
void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a};b.AmbientLight=function(a,d){b.Light.call(this,a,d);this.type="AmbientLight";this.castShadow=void 0};b.AmbientLight.prototype=Object.create(b.Light.prototype);b.AmbientLight.prototype.constructor=b.AmbientLight;b.PointLight=function(a,d,c,e){b.Light.call(this,a,d);this.type="PointLight";
this.distance=void 0!==c?c:0;this.decay=void 0!==e?e:1;this.shadow=new b.LightShadow(new b.PerspectiveCamera(90,1,.5,500))};b.PointLight.prototype=Object.create(b.Light.prototype);b.PointLight.prototype.constructor=b.PointLight;Object.defineProperty(b.PointLight.prototype,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});b.PointLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=
a.shadow.clone();return this};b.DirectionalLight=function(a,d){b.Light.call(this,a,d);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new b.Object3D;this.shadow=new b.DirectionalLightShadow};b.DirectionalLight.prototype=Object.create(b.Light.prototype);b.DirectionalLight.prototype.constructor=b.DirectionalLight;b.DirectionalLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this};
b.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new b.Vector2(512,512);this.map=null;this.matrix=new b.Matrix4};b.LightShadow.prototype={constructor:b.LightShadow,copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}};b.SpotLight=function(a,d,c,e,f,g){b.Light.call(this,a,d);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();
this.target=new b.Object3D;this.distance=void 0!==c?c:0;this.angle=void 0!==e?e:Math.PI/3;this.penumbra=void 0!==f?f:0;this.decay=void 0!==g?g:1;this.shadow=new b.SpotLightShadow};b.SpotLight.prototype=Object.create(b.Light.prototype);b.SpotLight.prototype.constructor=b.SpotLight;Object.defineProperty(b.SpotLight.prototype,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});b.SpotLight.prototype.copy=function(a){b.Light.prototype.copy.call(this,a);this.distance=
a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this};b.Material=function(){Object.defineProperty(this,"id",{value:b.MaterialIdCount++});this.uuid=b.Math.generateUUID();this.name="";this.type="Material";this.side=b.FrontSide;this.opacity=1;this.transparent=!1;this.blending=b.NormalBlending;this.blendSrc=b.SrcAlphaFactor;this.blendDst=b.OneMinusSrcAlphaFactor;this.blendEquation=b.AddEquation;this.blendEquationAlpha=
this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=b.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};b.Material.prototype={constructor:b.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=
a},setValues:function(a){if(void 0!==a)for(var d in a){var c=a[d];if(void 0===c)console.warn("THREE.Material: '"+d+"' parameter is undefined.");else{var e=this[d];void 0===e?console.warn("THREE."+this.type+": '"+d+"' is not a property of this material."):e instanceof b.Color?e.set(c):e instanceof b.Vector3&&c instanceof b.Vector3?e.copy(c):this[d]="overdraw"===d?Number(c):c}}},toJSON:function(a){function d(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;
c&&(a={textures:{},images:{}});var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);this.color instanceof b.Color&&(e.color=this.color.getHex());.5!==this.roughness&&(e.roughness=this.roughness);.5!==this.metalness&&(e.metalness=this.metalness);this.emissive instanceof b.Color&&(e.emissive=this.emissive.getHex());this.specular instanceof b.Color&&(e.specular=this.specular.getHex());void 0!==this.shininess&&
(e.shininess=this.shininess);this.map instanceof b.Texture&&(e.map=this.map.toJSON(a).uuid);this.alphaMap instanceof b.Texture&&(e.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof b.Texture&&(e.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof b.Texture&&(e.bumpMap=this.bumpMap.toJSON(a).uuid,e.bumpScale=this.bumpScale);this.normalMap instanceof b.Texture&&(e.normalMap=this.normalMap.toJSON(a).uuid,e.normalScale=this.normalScale.toArray());this.displacementMap instanceof
b.Texture&&(e.displacementMap=this.displacementMap.toJSON(a).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias);this.roughnessMap instanceof b.Texture&&(e.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof b.Texture&&(e.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap instanceof b.Texture&&(e.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof b.Texture&&(e.specularMap=this.specularMap.toJSON(a).uuid);
this.envMap instanceof b.Texture&&(e.envMap=this.envMap.toJSON(a).uuid,e.reflectivity=this.reflectivity);void 0!==this.size&&(e.size=this.size);void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation);void 0!==this.vertexColors&&this.vertexColors!==b.NoColors&&(e.vertexColors=this.vertexColors);void 0!==this.shading&&this.shading!==b.SmoothShading&&(e.shading=this.shading);void 0!==this.blending&&this.blending!==b.NormalBlending&&(e.blending=this.blending);void 0!==this.side&&this.side!==
b.FrontSide&&(e.side=this.side);1>this.opacity&&(e.opacity=this.opacity);!0===this.transparent&&(e.transparent=this.transparent);0<this.alphaTest&&(e.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(e.wireframe=this.wireframe);1<this.wireframeLinewidth&&(e.wireframeLinewidth=this.wireframeLinewidth);c&&(c=d(a.textures),a=d(a.images),0<c.length&&(e.textures=c),0<a.length&&(e.images=a));return e},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.name=a.name;this.side=a.side;this.opacity=a.opacity;this.transparent=a.transparent;this.blending=a.blending;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;
this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==a)for(var c=a.length,b=Array(c),e=0;e!==c;++e)b[e]=a[e].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.Material.prototype);
b.MaterialIdCount=0;b.LineBasicMaterial=function(a){b.Material.call(this);this.type="LineBasicMaterial";this.color=new b.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=!0;this.setValues(a)};b.LineBasicMaterial.prototype=Object.create(b.Material.prototype);b.LineBasicMaterial.prototype.constructor=b.LineBasicMaterial;b.LineBasicMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);
this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.LineDashedMaterial=function(a){b.Material.call(this);this.type="LineDashedMaterial";this.color=new b.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=!0;this.setValues(a)};b.LineDashedMaterial.prototype=Object.create(b.Material.prototype);b.LineDashedMaterial.prototype.constructor=
b.LineDashedMaterial;b.LineDashedMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.MeshBasicMaterial=function(a){b.Material.call(this);this.type="MeshBasicMaterial";this.color=new b.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=
b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshBasicMaterial.prototype=Object.create(b.Material.prototype);b.MeshBasicMaterial.prototype.constructor=b.MeshBasicMaterial;b.MeshBasicMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=
a.skinning;this.morphTargets=a.morphTargets;return this};b.MeshLambertMaterial=function(a){b.Material.call(this);this.type="MeshLambertMaterial";this.color=new b.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.blending=b.NormalBlending;
this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshLambertMaterial.prototype=Object.create(b.Material.prototype);b.MeshLambertMaterial.prototype.constructor=b.MeshLambertMaterial;b.MeshLambertMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=
a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=
a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};b.MultiMaterial=function(a){this.uuid=b.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0};b.MultiMaterial.prototype={constructor:b.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,
e=0,f=c.length;e<f;e++){var g=c[e].toJSON(a);delete g.metadata;b.materials.push(g)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};b.PointsMaterial=function(a){b.Material.call(this);this.type="PointsMaterial";this.color=new b.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.blending=b.NormalBlending;this.vertexColors=b.NoColors;this.fog=
!0;this.setValues(a)};b.PointsMaterial.prototype=Object.create(b.Material.prototype);b.PointsMaterial.prototype.constructor=b.PointsMaterial;b.PointsMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};b.MeshPhongMaterial=function(a){b.Material.call(this);this.type="MeshPhongMaterial";this.color=new b.Color(16777215);this.specular=
new b.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new b.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=b.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=
!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshPhongMaterial.prototype=Object.create(b.Material.prototype);b.MeshPhongMaterial.prototype.constructor=b.MeshPhongMaterial;b.MeshPhongMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);
this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;
this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
b.MeshDepthMaterial=function(a){b.Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=b.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.setValues(a)};b.MeshDepthMaterial.prototype=Object.create(b.Material.prototype);b.MeshDepthMaterial.prototype.constructor=b.MeshDepthMaterial;b.MeshDepthMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};b.MeshNormalMaterial=function(a){b.Material.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(a)};
b.MeshNormalMaterial.prototype=Object.create(b.Material.prototype);b.MeshNormalMaterial.prototype.constructor=b.MeshNormalMaterial;b.MeshNormalMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};b.MeshStandardMaterial=function(a){b.Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new b.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=
null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new b.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new b.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.fog=!0;this.shading=b.SmoothShading;this.blending=b.NormalBlending;this.wireframe=
!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};b.MeshStandardMaterial.prototype=Object.create(b.Material.prototype);b.MeshStandardMaterial.prototype.constructor=b.MeshStandardMaterial;b.MeshStandardMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=
a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=
a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
b.MeshPhysicalMaterial=function(a){b.MeshStandardMaterial.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.setValues(a)};b.MeshPhysicalMaterial.prototype=Object.create(b.MeshStandardMaterial.prototype);b.MeshPhysicalMaterial.prototype.constructor=b.MeshPhysicalMaterial;b.MeshPhysicalMaterial.prototype.copy=function(a){b.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;return this};b.SpriteMaterial=
function(a){b.Material.call(this);this.type="SpriteMaterial";this.color=new b.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(a)};b.SpriteMaterial.prototype=Object.create(b.Material.prototype);b.SpriteMaterial.prototype.constructor=b.SpriteMaterial;b.SpriteMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;this.fog=a.fog;return this};b.ShaderMaterial=function(a){b.Material.call(this);
this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=b.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.clipping=this.lights=this.fog=!1;this.vertexColors=b.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.extensions={derivatives:!1,
fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))};b.ShaderMaterial.prototype=Object.create(b.Material.prototype);b.ShaderMaterial.prototype.constructor=b.ShaderMaterial;b.ShaderMaterial.prototype.copy=function(a){b.Material.prototype.copy.call(this,
a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=b.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.fog=a.fog;this.lights=a.lights;this.clipping=a.clipping;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};b.ShaderMaterial.prototype.toJSON=function(a){a=
b.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};b.RawShaderMaterial=function(a){b.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};b.RawShaderMaterial.prototype=Object.create(b.ShaderMaterial.prototype);b.RawShaderMaterial.prototype.constructor=b.RawShaderMaterial;b.Texture=function(a,d,c,e,f,g,m,h,l,C){Object.defineProperty(this,"id",{value:b.TextureIdCount++});this.uuid=b.Math.generateUUID();
this.sourceFile=this.name="";this.image=void 0!==a?a:b.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==d?d:b.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:b.ClampToEdgeWrapping;this.wrapT=void 0!==e?e:b.ClampToEdgeWrapping;this.magFilter=void 0!==f?f:b.LinearFilter;this.minFilter=void 0!==g?g:b.LinearMipMapLinearFilter;this.anisotropy=void 0!==l?l:1;this.format=void 0!==m?m:b.RGBAFormat;this.type=void 0!==h?h:b.UnsignedByteType;this.offset=new b.Vector2(0,0);this.repeat=new b.Vector2(1,
1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==C?C:b.LinearEncoding;this.version=0;this.onUpdate=null};b.Texture.DEFAULT_IMAGE=void 0;b.Texture.DEFAULT_MAPPING=b.UVMapping;b.Texture.prototype={constructor:b.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=
a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var d={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},
uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=b.Math.generateUUID());if(void 0===a.images[c.uuid]){var e=a.images,f=c.uuid,g=c.uuid,m;void 0!==c.toDataURL?m=c:(m=document.createElement("canvas"),m.width=c.width,m.height=c.height,m.getContext("2d").drawImage(c,
0,0,c.width,c.height));m=2048<m.width||2048<m.height?m.toDataURL("image/jpeg",.6):m.toDataURL("image/png");e[f]={uuid:g,url:m}}d.image=c.uuid}return a.textures[this.uuid]=d},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(this.mapping===b.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case b.RepeatWrapping:a.x-=Math.floor(a.x);break;case b.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case b.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%
2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case b.RepeatWrapping:a.y-=Math.floor(a.y);break;case b.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case b.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};b.EventDispatcher.prototype.apply(b.Texture.prototype);b.TextureIdCount=0;b.DepthTexture=function(a,d,c,e,f,g,m,h,l){b.Texture.call(this,null,e,f,g,m,h,b.DepthFormat,c,l);this.image={width:a,
height:d};this.type=void 0!==c?c:b.UnsignedShortType;this.magFilter=void 0!==m?m:b.NearestFilter;this.minFilter=void 0!==h?h:b.NearestFilter;this.generateMipmaps=this.flipY=!1};b.DepthTexture.prototype=Object.create(b.Texture.prototype);b.DepthTexture.prototype.constructor=b.DepthTexture;b.CompressedTexture=function(a,d,c,e,f,g,m,h,l,C,q,u){b.Texture.call(this,null,g,m,h,l,C,e,f,q,u);this.image={width:d,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};b.CompressedTexture.prototype=Object.create(b.Texture.prototype);
b.CompressedTexture.prototype.constructor=b.CompressedTexture;b.DataTexture=function(a,d,c,e,f,g,m,h,l,C,q,u){b.Texture.call(this,null,g,m,h,l,C,e,f,q,u);this.image={data:a,width:d,height:c};this.magFilter=void 0!==l?l:b.NearestFilter;this.minFilter=void 0!==C?C:b.NearestFilter;this.generateMipmaps=this.flipY=!1};b.DataTexture.prototype=Object.create(b.Texture.prototype);b.DataTexture.prototype.constructor=b.DataTexture;b.Line=function(a,d,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
new b.LineSegments(a,d);b.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new b.Geometry;this.material=void 0!==d?d:new b.LineBasicMaterial({color:16777215*Math.random()})};b.Line.prototype=Object.create(b.Object3D.prototype);b.Line.prototype.constructor=b.Line;b.Line.prototype.raycast=function(){var a=new b.Matrix4,d=new b.Ray,c=new b.Sphere;return function(e,f){var g=e.linePrecision,g=g*g,m=this.geometry,h=this.matrixWorld;null===m.boundingSphere&&m.computeBoundingSphere();c.copy(m.boundingSphere);
c.applyMatrix4(h);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(h);d.copy(e.ray).applyMatrix4(a);var l=new b.Vector3,C=new b.Vector3,h=new b.Vector3,q=new b.Vector3,u=this instanceof b.LineSegments?2:1;if(m instanceof b.BufferGeometry){var k=m.index,n=m.attributes.position.array;if(null!==k)for(var k=k.array,m=0,r=k.length-1;m<r;m+=u){var s=k[m+1];l.fromArray(n,3*k[m]);C.fromArray(n,3*s);s=d.distanceSqToSegment(l,C,q,h);s>g||(q.applyMatrix4(this.matrixWorld),s=e.ray.origin.distanceTo(q),s<e.near||
s>e.far||f.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,r=n.length/3-1;m<r;m+=u)l.fromArray(n,3*m),C.fromArray(n,3*m+3),s=d.distanceSqToSegment(l,C,q,h),s>g||(q.applyMatrix4(this.matrixWorld),s=e.ray.origin.distanceTo(q),s<e.near||s>e.far||f.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(m instanceof b.Geometry)for(l=m.vertices,C=l.length,m=0;m<C-
1;m+=u)s=d.distanceSqToSegment(l[m],l[m+1],q,h),s>g||(q.applyMatrix4(this.matrixWorld),s=e.ray.origin.distanceTo(q),s<e.near||s>e.far||f.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}();b.Line.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.LineStrip=0;b.LinePieces=1;b.Points=function(a,d){b.Object3D.call(this);this.type="Points";this.geometry=void 0!==a?a:new b.Geometry;this.material=
void 0!==d?d:new b.PointsMaterial({color:16777215*Math.random()})};b.Points.prototype=Object.create(b.Object3D.prototype);b.Points.prototype.constructor=b.Points;b.Points.prototype.raycast=function(){var a=new b.Matrix4,d=new b.Ray,c=new b.Sphere;return function(e,f){function g(a,b){var c=d.distanceSqToPoint(a);if(c<q){var g=d.closestPointToPoint(a);g.applyMatrix4(l);var k=e.ray.origin.distanceTo(g);k<e.near||k>e.far||f.push({distance:k,distanceToRay:Math.sqrt(c),point:g.clone(),index:b,face:null,
object:m})}}var m=this,h=this.geometry,l=this.matrixWorld,C=e.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(l);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(l);d.copy(e.ray).applyMatrix4(a);var C=C/((this.scale.x+this.scale.y+this.scale.z)/3),q=C*C,C=new b.Vector3;if(h instanceof b.BufferGeometry){var u=h.index,h=h.attributes.position.array;if(null!==u)for(var k=u.array,u=0,n=k.length;u<n;u++){var r=k[u];C.fromArray(h,3*r);g(C,
r)}else for(u=0,k=h.length/3;u<k;u++)C.fromArray(h,3*u),g(C,u)}else for(C=h.vertices,u=0,k=C.length;u<k;u++)g(C[u],u)}}}();b.Points.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.LineSegments=function(a,d){b.Line.call(this,a,d);this.type="LineSegments"};b.LineSegments.prototype=Object.create(b.Line.prototype);b.LineSegments.prototype.constructor=b.LineSegments;b.Mesh=function(a,d){b.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:
new b.Geometry;this.material=void 0!==d?d:new b.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=b.TrianglesDrawMode;this.updateMorphTargets()};b.Mesh.prototype=Object.create(b.Object3D.prototype);b.Mesh.prototype.constructor=b.Mesh;b.Mesh.prototype.setDrawMode=function(a){this.drawMode=a};b.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary=
{};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};b.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};b.Mesh.prototype.raycast=function(){function a(a,c,d,e,f,g,m){b.Triangle.barycoordFromPoint(a,
c,d,e,s);f.multiplyScalar(s.x);g.multiplyScalar(s.y);m.multiplyScalar(s.z);f.add(g).add(m);return f.clone()}function d(a,c,d,e,f,g,m){var k=a.material;if(null===(k.side===b.BackSide?d.intersectTriangle(g,f,e,!0,m):d.intersectTriangle(e,f,g,k.side!==b.DoubleSide,m)))return null;A.copy(m);A.applyMatrix4(a.matrixWorld);d=c.ray.origin.distanceTo(A);return d<c.near||d>c.far?null:{distance:d,point:A.clone(),object:a}}function c(c,e,f,g,q,s,u,C){m.fromArray(g,3*s);h.fromArray(g,3*u);l.fromArray(g,3*C);if(c=
d(c,e,f,m,h,l,t))q&&(k.fromArray(q,2*s),n.fromArray(q,2*u),r.fromArray(q,2*C),c.uv=a(t,m,h,l,k,n,r)),c.face=new b.Face3(s,u,C,b.Triangle.normal(m,h,l)),c.faceIndex=s;return c}var e=new b.Matrix4,f=new b.Ray,g=new b.Sphere,m=new b.Vector3,h=new b.Vector3,l=new b.Vector3,C=new b.Vector3,q=new b.Vector3,u=new b.Vector3,k=new b.Vector2,n=new b.Vector2,r=new b.Vector2,s=new b.Vector3,t=new b.Vector3,A=new b.Vector3;return function(s,A){var v=this.geometry,x=this.material,J=this.matrixWorld;if(void 0!==
x&&(null===v.boundingSphere&&v.computeBoundingSphere(),g.copy(v.boundingSphere),g.applyMatrix4(J),!1!==s.ray.intersectsSphere(g)&&(e.getInverse(J),f.copy(s.ray).applyMatrix4(e),null===v.boundingBox||!1!==f.intersectsBox(v.boundingBox)))){var E,L;if(v instanceof b.BufferGeometry){var D,Q,x=v.index,J=v.attributes,v=J.position.array;void 0!==J.uv&&(E=J.uv.array);if(null!==x)for(var J=x.array,T=0,O=J.length;T<O;T+=3){if(x=J[T],D=J[T+1],Q=J[T+2],L=c(this,s,f,v,E,x,D,Q))L.faceIndex=Math.floor(T/3),A.push(L)}else for(T=
0,O=v.length;T<O;T+=9)if(x=T/3,D=x+1,Q=x+2,L=c(this,s,f,v,E,x,D,Q))L.index=x,A.push(L)}else if(v instanceof b.Geometry){var G,U,J=x instanceof b.MultiMaterial,T=!0===J?x.materials:null,O=v.vertices;D=v.faces;Q=v.faceVertexUvs[0];0<Q.length&&(E=Q);for(var K=0,M=D.length;K<M;K++){var H=D[K];L=!0===J?T[H.materialIndex]:x;if(void 0!==L){Q=O[H.a];G=O[H.b];U=O[H.c];if(!0===L.morphTargets){L=v.morphTargets;var I=this.morphTargetInfluences;m.set(0,0,0);h.set(0,0,0);l.set(0,0,0);for(var F=0,S=L.length;F<S;F++){var R=
I[F];if(0!==R){var X=L[F].vertices;m.addScaledVector(C.subVectors(X[H.a],Q),R);h.addScaledVector(q.subVectors(X[H.b],G),R);l.addScaledVector(u.subVectors(X[H.c],U),R)}}m.add(Q);h.add(G);l.add(U);Q=m;G=h;U=l}if(L=d(this,s,f,Q,G,U,t))E&&(I=E[K],k.copy(I[0]),n.copy(I[1]),r.copy(I[2]),L.uv=a(t,Q,G,U,k,n,r)),L.face=H,L.faceIndex=K,A.push(L)}}}}}}();b.Mesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};b.SkinnedMesh=function(a,d,c){b.Mesh.call(this,a,d);
this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new b.Matrix4;this.bindMatrixInverse=new b.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var e,f=0,g=this.geometry.bones.length;f<g;++f)e=this.geometry.bones[f],d=new b.Bone(this),a.push(d),d.name=e.name,d.position.fromArray(e.pos),d.quaternion.fromArray(e.rotq),void 0!==e.scl&&d.scale.fromArray(e.scl);f=0;for(g=this.geometry.bones.length;f<g;++f)e=this.geometry.bones[f],-1!==e.parent&&null!==e.parent&&void 0!==a[e.parent]?
a[e.parent].add(a[f]):this.add(a[f])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new b.Skeleton(a,void 0,c),this.matrixWorld)};b.SkinnedMesh.prototype=Object.create(b.Mesh.prototype);b.SkinnedMesh.prototype.constructor=b.SkinnedMesh;b.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)};b.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};
b.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof b.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var d=this.geometry.skinWeights[a],c=1/d.lengthManhattan();Infinity!==c?d.multiplyScalar(c):d.set(1,0,0,0)}else if(this.geometry instanceof b.BufferGeometry)for(var d=new b.Vector4,e=this.geometry.attributes.skinWeight,a=0;a<e.count;a++)d.x=e.getX(a),d.y=e.getY(a),d.z=e.getZ(a),d.w=e.getW(a),c=1/d.lengthManhattan(),Infinity!==c?d.multiplyScalar(c):d.set(1,
0,0,0),e.setXYZW(a,d.x,d.y,d.z,d.w)};b.SkinnedMesh.prototype.updateMatrixWorld=function(a){b.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)};b.SkinnedMesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material,this.useVertexTexture)).copy(this)};
b.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),d=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),e=new b.BufferGeometry;e.setIndex(new b.BufferAttribute(a,1));e.addAttribute("position",new b.BufferAttribute(d,3));e.addAttribute("uv",new b.BufferAttribute(c,2));return function(a){b.Object3D.call(this);this.type="Sprite";this.geometry=e;this.material=void 0!==a?a:new b.SpriteMaterial}}();b.Sprite.prototype=Object.create(b.Object3D.prototype);b.Sprite.prototype.constructor=
b.Sprite;b.Sprite.prototype.raycast=function(){var a=new b.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.distanceSqToPoint(a);e>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(e),point:this.position,face:null,object:this})}}();b.Sprite.prototype.clone=function(){return(new this.constructor(this.material)).copy(this)};b.Particle=b.Sprite;b.LensFlare=function(a,d,c,e,f){b.Object3D.call(this);this.lensFlares=[];this.positionScreen=new b.Vector3;this.customUpdateCallback=
void 0;void 0!==a&&this.add(a,d,c,e,f)};b.LensFlare.prototype=Object.create(b.Object3D.prototype);b.LensFlare.prototype.constructor=b.LensFlare;b.LensFlare.prototype.add=function(a,d,c,e,f,g){void 0===d&&(d=-1);void 0===c&&(c=0);void 0===g&&(g=1);void 0===f&&(f=new b.Color(16777215));void 0===e&&(e=b.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:d,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:g,color:f,blending:e})};b.LensFlare.prototype.updateLensFlares=function(){var a,
b=this.lensFlares.length,c,e=2*-this.positionScreen.x,f=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+e*c.distance,c.y=this.positionScreen.y+f*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)};b.LensFlare.prototype.copy=function(a){b.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var d=0,c=a.lensFlares.length;d<c;d++)this.lensFlares.push(a.lensFlares[d]);
return this};b.ImmediateRenderObject=function(a){b.Object3D.call(this);this.material=a;this.render=function(a){}};b.ImmediateRenderObject.prototype=Object.create(b.Object3D.prototype);b.ImmediateRenderObject.prototype.constructor=b.ImmediateRenderObject;b.Scene=function(){b.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};b.Scene.prototype=Object.create(b.Object3D.prototype);b.Scene.prototype.constructor=b.Scene;b.Scene.prototype.copy=function(a,d){b.Object3D.prototype.copy.call(this,
a,d);null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};b.FogExp2=function(a,d){this.name="";this.color=new b.Color(a);this.density=void 0!==d?d:2.5E-4};b.FogExp2.prototype.clone=function(){return new b.FogExp2(this.color.getHex(),this.density)};b.ShaderChunk={};b.ShaderChunk.common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n";
b.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";b.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";b.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";b.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";b.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";
b.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n";b.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif";
b.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";b.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";b.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";
b.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";b.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";b.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";b.ShaderChunk.encodings_pars_fragment=
"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n";
b.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";b.ShaderChunk.envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";b.ShaderChunk.envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";
b.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";
b.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";
b.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";
b.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";b.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";b.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";b.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";b.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";b.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";
b.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";b.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";b.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";
b.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";b.ShaderChunk.clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";
b.ShaderChunk.clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";b.ShaderChunk.clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n";b.ShaderChunk.clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";
b.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";b.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";b.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";
b.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";b.ShaderChunk.lights_lambert_vertex=
"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";
b.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";b.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";
b.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";b.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";b.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n";
b.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif";b.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";b.ShaderChunk.packing="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nvec4 packDepthToRGBA( const in float value ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( value * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nfloat unpackRGBAToDepth( const in vec4 rgba ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( rgba, bitSh );\n}\nfloat viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";
b.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";b.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";
b.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";
b.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";
b.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";
b.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";
b.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n";b.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";
b.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";b.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";
b.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";b.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n";b.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n";b.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n";
b.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n";b.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";b.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";
b.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var e=this.clone(a[c]),f;for(f in e)b[f]=e[f]}return b},clone:function(a){var d={},c;for(c in a){d[c]={};for(var e in a[c]){var f=a[c][e];f instanceof b.Color||f instanceof b.Vector2||f instanceof b.Vector3||f instanceof b.Vector4||f instanceof b.Matrix3||f instanceof b.Matrix4||f instanceof b.Texture?d[c][e]=f.clone():Array.isArray(f)?d[c][e]=f.slice():d[c][e]=f}}return d}};b.UniformsLib={common:{diffuse:{type:"c",value:new b.Color(15658734)},
opacity:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"1f",value:-1},reflectivity:{type:"1f",value:1},refractionRatio:{type:"1f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"1f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"1f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},
bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"1f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new b.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"1f",value:1},displacementBias:{type:"1f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"1f",value:2.5E-4},fogNear:{type:"1f",value:1},fogFar:{type:"1f",value:2E3},fogColor:{type:"c",
value:new b.Color(16777215)}},lights:{ambientLightColor:{type:"3fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"1f"},coneCos:{type:"1f"},penumbraCos:{type:"1f"},
decay:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"1f"},distance:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",
value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new b.Color(15658734)},opacity:{type:"1f",value:1},size:{type:"1f",value:1},scale:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new b.Vector4(0,0,1,1)}}};b.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\t#include <logdepthbuf_fragment>\n}\n";
b.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";b.ShaderChunk.depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";
b.ShaderChunk.depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n";b.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n";
b.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <logdepthbuf_fragment>\n}\n";
b.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";b.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n";
b.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n";b.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
b.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
b.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
b.ShaderLib={basic:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.fog]),vertexShader:b.ShaderChunk.meshbasic_vert,fragmentShader:b.ShaderChunk.meshbasic_frag},lambert:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)}}]),vertexShader:b.ShaderChunk.meshlambert_vert,fragmentShader:b.ShaderChunk.meshlambert_frag},
phong:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.bumpmap,b.UniformsLib.normalmap,b.UniformsLib.displacementmap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"1f",value:30}}]),vertexShader:b.ShaderChunk.meshphong_vert,fragmentShader:b.ShaderChunk.meshphong_frag},standard:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,
b.UniformsLib.aomap,b.UniformsLib.lightmap,b.UniformsLib.emissivemap,b.UniformsLib.bumpmap,b.UniformsLib.normalmap,b.UniformsLib.displacementmap,b.UniformsLib.roughnessmap,b.UniformsLib.metalnessmap,b.UniformsLib.fog,b.UniformsLib.lights,{emissive:{type:"c",value:new b.Color(0)},roughness:{type:"1f",value:.5},metalness:{type:"1f",value:0},envMapIntensity:{type:"1f",value:1}}]),vertexShader:b.ShaderChunk.meshphysical_vert,fragmentShader:b.ShaderChunk.meshphysical_frag},points:{uniforms:b.UniformsUtils.merge([b.UniformsLib.points,
b.UniformsLib.fog]),vertexShader:b.ShaderChunk.points_vert,fragmentShader:b.ShaderChunk.points_frag},dashed:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,{scale:{type:"1f",value:1},dashSize:{type:"1f",value:1},totalSize:{type:"1f",value:2}}]),vertexShader:b.ShaderChunk.linedashed_vert,fragmentShader:b.ShaderChunk.linedashed_frag},depth:{uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.displacementmap]),vertexShader:b.ShaderChunk.depth_vert,fragmentShader:b.ShaderChunk.depth_frag},
normal:{uniforms:{opacity:{type:"1f",value:1}},vertexShader:b.ShaderChunk.normal_vert,fragmentShader:b.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:b.ShaderChunk.cube_vert,fragmentShader:b.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:b.ShaderChunk.equirect_vert,fragmentShader:b.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new b.Vector3}},
vertexShader:b.ShaderChunk.distanceRGBA_vert,fragmentShader:b.ShaderChunk.distanceRGBA_frag}};b.ShaderLib.physical={uniforms:b.UniformsUtils.merge([b.ShaderLib.standard.uniforms,{}]),vertexShader:b.ShaderChunk.meshphysical_vert,fragmentShader:b.ShaderChunk.meshphysical_frag};b.WebGLRenderer=function(a){function d(a,b,c,d){!0===F&&(a*=d,b*=d,c*=d);V.clearColor(a,b,c,d)}function c(){V.init();V.scissor(Fa.copy(na).multiplyScalar(ia));V.viewport(Y.copy(oa).multiplyScalar(ia));d(la.r,la.g,la.b,ba)}function e(){xa=
ta=null;Da="";qa=-1;V.reset()}function f(a){a.preventDefault();e();c();ha.clear()}function g(a){a=a.target;a.removeEventListener("dispose",g);a:{var b=ha.get(a);if(a.image&&b.__image__webglTextureCube)w.deleteTexture(b.__image__webglTextureCube);else{if(void 0===b.__webglInit)break a;w.deleteTexture(b.__webglTexture)}ha.delete(a)}Ha.textures--}function m(a){a=a.target;a.removeEventListener("dispose",m);var c=ha.get(a),d=ha.get(a.texture);if(a){void 0!==d.__webglTexture&&w.deleteTexture(d.__webglTexture);
a.depthTexture&&a.depthTexture.dispose();if(a instanceof b.WebGLRenderTargetCube)for(d=0;6>d;d++)w.deleteFramebuffer(c.__webglFramebuffer[d]),c.__webglDepthbuffer&&w.deleteRenderbuffer(c.__webglDepthbuffer[d]);else w.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&w.deleteRenderbuffer(c.__webglDepthbuffer);ha.delete(a.texture);ha.delete(a)}Ha.textures--}function h(a){a=a.target;a.removeEventListener("dispose",h);l(a);ha.delete(a)}function l(a){var b=ha.get(a).program;a.program=void 0;
void 0!==b&&La.releaseProgram(b)}function C(a,b){return Math.abs(b[0])-Math.abs(a[0])}function q(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function u(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function k(a,b,c,d,e){var f;c.transparent?(d=W,f=++sa):(d=X,f=++ca);f=d[f];void 0!==
f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=ra.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:c,z:ra.z,group:e},d.push(f))}function n(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();var c=Ya.copy(b.boundingSphere).applyMatrix4(a.matrixWorld);if(!aa.intersectsSphere(c))return!1;if(0===ua)return!0;a=ka.clippingPlanes;var b=c.center,c=-c.radius,d=0;do if(a[d].distanceToPoint(b)<c)return!1;while(++d!==ua);return!0}function r(a,c){if(!1!==a.visible){if(a.layers.test(c.layers))if(a instanceof
b.Light)R.push(a);else if(a instanceof b.Sprite)!1!==a.frustumCulled&&!0!==n(a)||fa.push(a);else if(a instanceof b.LensFlare)Ka.push(a);else if(a instanceof b.ImmediateRenderObject)!0===ka.sortObjects&&(ra.setFromMatrixPosition(a.matrixWorld),ra.applyProjection(Na)),k(a,null,a.material,ra.z,null);else if(a instanceof b.Mesh||a instanceof b.Line||a instanceof b.Points)if(a instanceof b.SkinnedMesh&&a.skeleton.update(),!1===a.frustumCulled||!0===n(a)){var d=a.material;if(!0===d.visible){!0===ka.sortObjects&&
(ra.setFromMatrixPosition(a.matrixWorld),ra.applyProjection(Na));var e=Ia.update(a);if(d instanceof b.MultiMaterial)for(var f=e.groups,g=d.materials,d=0,m=f.length;d<m;d++){var h=f[d],l=g[h.materialIndex];!0===l.visible&&k(a,e,l,ra.z,h)}else k(a,e,d,ra.z,null)}}e=a.children;d=0;for(m=e.length;d<m;d++)r(e[d],c)}}function s(a,c,d,e){for(var f=0,g=a.length;f<g;f++){var m=a[f],k=m.object,h=m.geometry,l=void 0===e?m.material:e,m=m.group;k.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,k.matrixWorld);
k.normalMatrix.getNormalMatrix(k.modelViewMatrix);if(k instanceof b.ImmediateRenderObject){t(l);var p=v(c,d,l,k);Da="";k.render(function(a){ka.renderBufferImmediate(a,p,l)})}else ka.renderBufferDirect(c,d,h,l,k,m)}}function t(a){a.side!==b.DoubleSide?V.enable(w.CULL_FACE):V.disable(w.CULL_FACE);V.setFlipSided(a.side===b.BackSide);!0===a.transparent?V.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):V.setBlending(b.NoBlending);
V.setDepthFunc(a.depthFunc);V.setDepthTest(a.depthTest);V.setDepthWrite(a.depthWrite);V.setColorWrite(a.colorWrite);V.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function v(a,c,d,e){ma=0;var f=ha.get(d);if(ga){if(ya||a!==xa){var g=d.clippingPlanes,m=a===xa&&d.id===qa;if(!ya||null===g||0===g.length||wa&&!d.clipShadows)wa?P(null):z();else{var k=wa?0:Ja,n=4*k,q=f.clippingState||null;pa.value=q;q=P(g,a,n,m);for(g=0;g!==n;++g)q[g]=va[g];f.clippingState=q;ua+=k}}void 0!==
f.numClippingPlanes&&f.numClippingPlanes!==ua&&(d.needsUpdate=!0)}void 0===f.program&&(d.needsUpdate=!0);void 0!==f.lightsHash&&f.lightsHash!==ea.hash&&(d.needsUpdate=!0);if(d.needsUpdate){a:{k=ha.get(d);n=La.getParameters(d,ea,c,ua,e);q=La.getProgramCode(d,n);g=k.program;m=!0;if(void 0===g)d.addEventListener("dispose",h);else if(g.code!==q)l(d);else if(void 0!==n.shaderID)break a;else m=!1;m&&(n.shaderID?(g=b.ShaderLib[n.shaderID],k.__webglShader={name:d.type,uniforms:b.UniformsUtils.clone(g.uniforms),
vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}):k.__webglShader={name:d.type,uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader},d.__webglShader=k.__webglShader,g=La.acquireProgram(d,n,q),k.program=g,d.program=g);n=g.getAttributes();if(d.morphTargets)for(q=d.numSupportedMorphTargets=0;q<ka.maxMorphTargets;q++)0<=n["morphTarget"+q]&&d.numSupportedMorphTargets++;if(d.morphNormals)for(q=d.numSupportedMorphNormals=0;q<ka.maxMorphNormals;q++)0<=n["morphNormal"+
q]&&d.numSupportedMorphNormals++;n=k.__webglShader.uniforms;(d instanceof b.ShaderMaterial||d instanceof b.RawShaderMaterial)&&!0!==d.clipping||(k.numClippingPlanes=ua,n.clippingPlanes=pa);if(d instanceof b.MeshPhongMaterial||d instanceof b.MeshLambertMaterial||d instanceof b.MeshStandardMaterial||d.lights)k.lightsHash=ea.hash,n.ambientLightColor.value=ea.ambient,n.directionalLights.value=ea.directional,n.spotLights.value=ea.spot,n.pointLights.value=ea.point,n.hemisphereLights.value=ea.hemi,n.directionalShadowMap.value=
ea.directionalShadowMap,n.directionalShadowMatrix.value=ea.directionalShadowMatrix,n.spotShadowMap.value=ea.spotShadowMap,n.spotShadowMatrix.value=ea.spotShadowMatrix,n.pointShadowMap.value=ea.pointShadowMap,n.pointShadowMatrix.value=ea.pointShadowMatrix;q=k.program.getUniforms();q=b.WebGLUniforms.seqWithValue(q.seq,n);k.uniformsList=q;k.dynamicUniforms=b.WebGLUniforms.splitDynamic(q,n)}d.needsUpdate=!1}var r=!1,m=g=!1,k=f.program,q=k.getUniforms(),n=f.__webglShader.uniforms;k.id!==ta&&(w.useProgram(k.program),
ta=k.id,m=g=r=!0);d.id!==qa&&(qa=d.id,g=!0);if(r||a!==xa){q.set(w,a,"projectionMatrix");za.logarithmicDepthBuffer&&q.setValue(w,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==xa&&(xa=a,m=g=!0);if(d instanceof b.ShaderMaterial||d instanceof b.MeshPhongMaterial||d instanceof b.MeshStandardMaterial||d.envMap)r=q.map.cameraPosition,void 0!==r&&r.setValue(w,ra.setFromMatrixPosition(a.matrixWorld));(d instanceof b.MeshPhongMaterial||d instanceof b.MeshLambertMaterial||d instanceof b.MeshBasicMaterial||
d instanceof b.MeshStandardMaterial||d instanceof b.ShaderMaterial||d.skinning)&&q.setValue(w,"viewMatrix",a.matrixWorldInverse);q.set(w,ka,"toneMappingExposure");q.set(w,ka,"toneMappingWhitePoint")}d.skinning&&(q.setOptional(w,e,"bindMatrix"),q.setOptional(w,e,"bindMatrixInverse"),r=e.skeleton)&&(za.floatVertexTextures&&r.useVertexTexture?(q.set(w,r,"boneTexture"),q.set(w,r,"boneTextureWidth"),q.set(w,r,"boneTextureHeight")):q.setOptional(w,r,"boneMatrices"));if(g){if(d instanceof b.MeshPhongMaterial||
d instanceof b.MeshLambertMaterial||d instanceof b.MeshStandardMaterial||d.lights)g=m,n.ambientLightColor.needsUpdate=g,n.directionalLights.needsUpdate=g,n.pointLights.needsUpdate=g,n.spotLights.needsUpdate=g,n.hemisphereLights.needsUpdate=g;c&&d.fog&&(n.fogColor.value=c.color,c instanceof b.Fog?(n.fogNear.value=c.near,n.fogFar.value=c.far):c instanceof b.FogExp2&&(n.fogDensity.value=c.density));if(d instanceof b.MeshBasicMaterial||d instanceof b.MeshLambertMaterial||d instanceof b.MeshPhongMaterial||
d instanceof b.MeshStandardMaterial||d instanceof b.MeshDepthMaterial){n.opacity.value=d.opacity;n.diffuse.value=d.color;d.emissive&&n.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity);n.map.value=d.map;n.specularMap.value=d.specularMap;n.alphaMap.value=d.alphaMap;d.aoMap&&(n.aoMap.value=d.aoMap,n.aoMapIntensity.value=d.aoMapIntensity);var s;d.map?s=d.map:d.specularMap?s=d.specularMap:d.displacementMap?s=d.displacementMap:d.normalMap?s=d.normalMap:d.bumpMap?s=d.bumpMap:d.roughnessMap?
s=d.roughnessMap:d.metalnessMap?s=d.metalnessMap:d.alphaMap?s=d.alphaMap:d.emissiveMap&&(s=d.emissiveMap);void 0!==s&&(s instanceof b.WebGLRenderTarget&&(s=s.texture),c=s.offset,s=s.repeat,n.offsetRepeat.value.set(c.x,c.y,s.x,s.y));n.envMap.value=d.envMap;n.flipEnvMap.value=d.envMap instanceof b.WebGLRenderTargetCube?1:-1;n.reflectivity.value=d.reflectivity;n.refractionRatio.value=d.refractionRatio}d instanceof b.LineBasicMaterial?(n.diffuse.value=d.color,n.opacity.value=d.opacity):d instanceof b.LineDashedMaterial?
(n.diffuse.value=d.color,n.opacity.value=d.opacity,n.dashSize.value=d.dashSize,n.totalSize.value=d.dashSize+d.gapSize,n.scale.value=d.scale):d instanceof b.PointsMaterial?(n.diffuse.value=d.color,n.opacity.value=d.opacity,n.size.value=d.size*ia,n.scale.value=.5*G.clientHeight,n.map.value=d.map,null!==d.map&&(s=d.map.offset,d=d.map.repeat,n.offsetRepeat.value.set(s.x,s.y,d.x,d.y))):d instanceof b.MeshLambertMaterial?(d.lightMap&&(n.lightMap.value=d.lightMap,n.lightMapIntensity.value=d.lightMapIntensity),
d.emissiveMap&&(n.emissiveMap.value=d.emissiveMap)):d instanceof b.MeshPhongMaterial?(n.specular.value=d.specular,n.shininess.value=Math.max(d.shininess,1E-4),d.lightMap&&(n.lightMap.value=d.lightMap,n.lightMapIntensity.value=d.lightMapIntensity),d.emissiveMap&&(n.emissiveMap.value=d.emissiveMap),d.bumpMap&&(n.bumpMap.value=d.bumpMap,n.bumpScale.value=d.bumpScale),d.normalMap&&(n.normalMap.value=d.normalMap,n.normalScale.value.copy(d.normalScale)),d.displacementMap&&(n.displacementMap.value=d.displacementMap,
n.displacementScale.value=d.displacementScale,n.displacementBias.value=d.displacementBias)):d instanceof b.MeshPhysicalMaterial?x(n,d):d instanceof b.MeshStandardMaterial?x(n,d):d instanceof b.MeshDepthMaterial?d.displacementMap&&(n.displacementMap.value=d.displacementMap,n.displacementScale.value=d.displacementScale,n.displacementBias.value=d.displacementBias):d instanceof b.MeshNormalMaterial&&(n.opacity.value=d.opacity);b.WebGLUniforms.upload(w,f.uniformsList,n,ka)}q.set(w,e,"modelViewMatrix");
q.set(w,e,"normalMatrix");q.setValue(w,"modelMatrix",e.matrixWorld);f=f.dynamicUniforms;null!==f&&(b.WebGLUniforms.evalDynamic(f,n,e,a),b.WebGLUniforms.upload(w,f,n,ka));return k}function x(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);
b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function P(a,b,c,d){var e=null!==a?a.length:0,f=null;if(0!==e){f=pa.value;if(!0!==d||null===f){var g=c+4*e;b=b.matrixWorldInverse;d=Xa.getNormalMatrix(b);
if(null===f||f.length<g)f=new Float32Array(g);for(g=0;g!==e;++g,c+=4){var m=Za.copy(a[g]).applyMatrix4(b,d);m.normal.toArray(f,c);f[c+3]=m.constant}}pa.value=f;pa.needsUpdate=!0}ua=e;return f}function z(){pa.value!==va&&(pa.value=va,pa.needsUpdate=0<Ja);ua=Ja}function N(a,c,d){d?(w.texParameteri(a,w.TEXTURE_WRAP_S,O(c.wrapS)),w.texParameteri(a,w.TEXTURE_WRAP_T,O(c.wrapT)),w.texParameteri(a,w.TEXTURE_MAG_FILTER,O(c.magFilter)),w.texParameteri(a,w.TEXTURE_MIN_FILTER,O(c.minFilter))):(w.texParameteri(a,
w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(a,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),c.wrapS===b.ClampToEdgeWrapping&&c.wrapT===b.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",c),w.texParameteri(a,w.TEXTURE_MAG_FILTER,T(c.magFilter)),w.texParameteri(a,w.TEXTURE_MIN_FILTER,T(c.minFilter)),c.minFilter!==b.NearestFilter&&c.minFilter!==b.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",
c));!(d=ja.get("EXT_texture_filter_anisotropic"))||c.type===b.FloatType&&null===ja.get("OES_texture_float_linear")||c.type===b.HalfFloatType&&null===ja.get("OES_texture_half_float_linear")||!(1<c.anisotropy||ha.get(c).__currentAnisotropy)||(w.texParameterf(a,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(c.anisotropy,ka.getMaxAnisotropy())),ha.get(c).__currentAnisotropy=c.anisotropy)}function J(a,c){a instanceof b.WebGLRenderTarget&&(a=a.texture);var d=ha.get(a);if(0<a.version&&d.__version!==a.version){var e=
a.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",a);else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",a);else{e=a;void 0===d.__webglInit&&(d.__webglInit=!0,e.addEventListener("dispose",g),d.__webglTexture=w.createTexture(),Ha.textures++);V.activeTexture(w.TEXTURE0+c);V.bindTexture(w.TEXTURE_2D,d.__webglTexture);w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,e.flipY);w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
e.premultiplyAlpha);w.pixelStorei(w.UNPACK_ALIGNMENT,e.unpackAlignment);var f=E(e.image,za.maxTextureSize);if((e.wrapS!==b.ClampToEdgeWrapping||e.wrapT!==b.ClampToEdgeWrapping||e.minFilter!==b.NearestFilter&&e.minFilter!==b.LinearFilter)&&!1===L(f)){var m=f;if(m instanceof HTMLImageElement||m instanceof HTMLCanvasElement){var k=document.createElement("canvas");k.width=b.Math.nearestPowerOfTwo(m.width);k.height=b.Math.nearestPowerOfTwo(m.height);k.getContext("2d").drawImage(m,0,0,k.width,k.height);
console.warn("THREE.WebGLRenderer: image is not power of two ("+m.width+"x"+m.height+"). Resized to "+k.width+"x"+k.height,m);f=k}else f=m}var m=L(f),k=O(e.format),h=O(e.type);N(w.TEXTURE_2D,e,m);var l=e.mipmaps;if(e instanceof b.DepthTexture){l=w.DEPTH_COMPONENT;if(e.type===b.FloatType){if(!Oa)throw Error("Float Depth Texture only supported in WebGL2.0");l=w.DEPTH_COMPONENT32F}else Oa&&(l=w.DEPTH_COMPONENT16);V.texImage2D(w.TEXTURE_2D,0,l,f.width,f.height,0,k,h,null)}else if(e instanceof b.DataTexture)if(0<
l.length&&m){for(var p=0,n=l.length;p<n;p++)f=l[p],V.texImage2D(w.TEXTURE_2D,p,k,f.width,f.height,0,k,h,f.data);e.generateMipmaps=!1}else V.texImage2D(w.TEXTURE_2D,0,k,f.width,f.height,0,k,h,f.data);else if(e instanceof b.CompressedTexture)for(p=0,n=l.length;p<n;p++)f=l[p],e.format!==b.RGBAFormat&&e.format!==b.RGBFormat?-1<V.getCompressedTextureFormats().indexOf(k)?V.compressedTexImage2D(w.TEXTURE_2D,p,k,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):
V.texImage2D(w.TEXTURE_2D,p,k,f.width,f.height,0,k,h,f.data);else if(0<l.length&&m){p=0;for(n=l.length;p<n;p++)f=l[p],V.texImage2D(w.TEXTURE_2D,p,k,k,h,f);e.generateMipmaps=!1}else V.texImage2D(w.TEXTURE_2D,0,k,k,h,f);e.generateMipmaps&&m&&w.generateMipmap(w.TEXTURE_2D);d.__version=e.version;if(e.onUpdate)e.onUpdate(e)}}else V.activeTexture(w.TEXTURE0+c),V.bindTexture(w.TEXTURE_2D,d.__webglTexture)}function E(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");
d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function L(a){return b.Math.isPowerOfTwo(a.width)&&b.Math.isPowerOfTwo(a.height)}function D(a,b,c,d){var e=O(b.texture.format),f=O(b.texture.type);V.texImage2D(d,0,e,b.width,b.height,0,e,f,null);w.bindFramebuffer(w.FRAMEBUFFER,a);
w.framebufferTexture2D(w.FRAMEBUFFER,c,d,ha.get(b.texture).__webglTexture,0);w.bindFramebuffer(w.FRAMEBUFFER,null)}function Q(a,b){w.bindRenderbuffer(w.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_COMPONENT16,b.width,b.height),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_STENCIL,b.width,b.height),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,
w.RENDERBUFFER,a)):w.renderbufferStorage(w.RENDERBUFFER,w.RGBA4,b.width,b.height);w.bindRenderbuffer(w.RENDERBUFFER,null)}function T(a){return a===b.NearestFilter||a===b.NearestMipMapNearestFilter||a===b.NearestMipMapLinearFilter?w.NEAREST:w.LINEAR}function O(a){var c;if(a===b.RepeatWrapping)return w.REPEAT;if(a===b.ClampToEdgeWrapping)return w.CLAMP_TO_EDGE;if(a===b.MirroredRepeatWrapping)return w.MIRRORED_REPEAT;if(a===b.NearestFilter)return w.NEAREST;if(a===b.NearestMipMapNearestFilter)return w.NEAREST_MIPMAP_NEAREST;
if(a===b.NearestMipMapLinearFilter)return w.NEAREST_MIPMAP_LINEAR;if(a===b.LinearFilter)return w.LINEAR;if(a===b.LinearMipMapNearestFilter)return w.LINEAR_MIPMAP_NEAREST;if(a===b.LinearMipMapLinearFilter)return w.LINEAR_MIPMAP_LINEAR;if(a===b.UnsignedByteType)return w.UNSIGNED_BYTE;if(a===b.UnsignedShort4444Type)return w.UNSIGNED_SHORT_4_4_4_4;if(a===b.UnsignedShort5551Type)return w.UNSIGNED_SHORT_5_5_5_1;if(a===b.UnsignedShort565Type)return w.UNSIGNED_SHORT_5_6_5;if(a===b.ByteType)return w.BYTE;
if(a===b.ShortType)return w.SHORT;if(a===b.UnsignedShortType)return w.UNSIGNED_SHORT;if(a===b.IntType)return w.INT;if(a===b.UnsignedIntType)return w.UNSIGNED_INT;if(a===b.FloatType)return w.FLOAT;c=ja.get("OES_texture_half_float");if(null!==c&&a===b.HalfFloatType)return c.HALF_FLOAT_OES;if(a===b.AlphaFormat)return w.ALPHA;if(a===b.RGBFormat)return w.RGB;if(a===b.RGBAFormat)return w.RGBA;if(a===b.LuminanceFormat)return w.LUMINANCE;if(a===b.LuminanceAlphaFormat)return w.LUMINANCE_ALPHA;if(a===b.DepthFormat)return w.DEPTH_COMPONENT;
if(a===b.AddEquation)return w.FUNC_ADD;if(a===b.SubtractEquation)return w.FUNC_SUBTRACT;if(a===b.ReverseSubtractEquation)return w.FUNC_REVERSE_SUBTRACT;if(a===b.ZeroFactor)return w.ZERO;if(a===b.OneFactor)return w.ONE;if(a===b.SrcColorFactor)return w.SRC_COLOR;if(a===b.OneMinusSrcColorFactor)return w.ONE_MINUS_SRC_COLOR;if(a===b.SrcAlphaFactor)return w.SRC_ALPHA;if(a===b.OneMinusSrcAlphaFactor)return w.ONE_MINUS_SRC_ALPHA;if(a===b.DstAlphaFactor)return w.DST_ALPHA;if(a===b.OneMinusDstAlphaFactor)return w.ONE_MINUS_DST_ALPHA;
if(a===b.DstColorFactor)return w.DST_COLOR;if(a===b.OneMinusDstColorFactor)return w.ONE_MINUS_DST_COLOR;if(a===b.SrcAlphaSaturateFactor)return w.SRC_ALPHA_SATURATE;c=ja.get("WEBGL_compressed_texture_s3tc");if(null!==c){if(a===b.RGB_S3TC_DXT1_Format)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT1_Format)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT3_Format)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===b.RGBA_S3TC_DXT5_Format)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}c=ja.get("WEBGL_compressed_texture_pvrtc");
if(null!==c){if(a===b.RGB_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===b.RGB_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===b.RGBA_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===b.RGBA_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}c=ja.get("WEBGL_compressed_texture_etc1");if(null!==c&&a===b.RGB_ETC1_Format)return c.COMPRESSED_RGB_ETC1_WEBGL;c=ja.get("EXT_blend_minmax");if(null!==c){if(a===b.MinEquation)return c.MIN_EXT;
if(a===b.MaxEquation)return c.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",b.REVISION);a=a||{};var G=void 0!==a.canvas?a.canvas:document.createElement("canvas"),U=void 0!==a.context?a.context:null,K=void 0!==a.alpha?a.alpha:!1,M=void 0!==a.depth?a.depth:!0,H=void 0!==a.stencil?a.stencil:!0,I=void 0!==a.antialias?a.antialias:!1,F=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,S=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,R=[],X=[],ca=-1,W=[],sa=-1,Aa=new Float32Array(8),
fa=[],Ka=[];this.domElement=G;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMapping=b.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;var ka=this,ta=null,Ba=null,Ca=null,qa=-1,Da="",xa=null,Fa=
new b.Vector4,Ga=null,Y=new b.Vector4,ma=0,la=new b.Color(0),ba=0,da=G.width,Z=G.height,ia=1,na=new b.Vector4(0,0,da,Z),$=!1,oa=new b.Vector4(0,0,da,Z),aa=new b.Frustum,ga=!1,ya=!1,wa=!1,ua=0,pa={type:"4fv",value:null,needsUpdate:!1},va=null,Ja=0,Xa=new b.Matrix3,Ya=new b.Sphere,Za=new b.Plane,Na=new b.Matrix4,ra=new b.Vector3,ea={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],
hemi:[],shadows:[]},Ha={geometries:0,textures:0},Ea={calls:0,vertices:0,faces:0,points:0};this.info={render:Ea,memory:Ha,programs:null};var w;try{K={alpha:K,depth:M,stencil:H,antialias:I,premultipliedAlpha:F,preserveDrawingBuffer:S};w=U||G.getContext("webgl",K)||G.getContext("experimental-webgl",K);if(null===w){if(null!==G.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===w.getShaderPrecisionFormat&&(w.getShaderPrecisionFormat=
function(){return{rangeMin:1,rangeMax:1,precision:1}});G.addEventListener("webglcontextlost",f,!1)}catch(Qa){console.error("THREE.WebGLRenderer: "+Qa)}var Oa="undefined"!==typeof WebGL2RenderingContext&&w instanceof WebGL2RenderingContext,ja=new b.WebGLExtensions(w);ja.get("WEBGL_depth_texture");ja.get("OES_texture_float");ja.get("OES_texture_float_linear");ja.get("OES_texture_half_float");ja.get("OES_texture_half_float_linear");ja.get("OES_standard_derivatives");ja.get("ANGLE_instanced_arrays");
ja.get("OES_element_index_uint")&&(b.BufferGeometry.MaxIndex=4294967296);var za=new b.WebGLCapabilities(w,ja,a),V=new b.WebGLState(w,ja,O),ha=new b.WebGLProperties,Ia=new b.WebGLObjects(w,ha,this.info),La=new b.WebGLPrograms(this,za),Ma=new b.WebGLLights;this.info.programs=La.programs;var Va=new b.WebGLBufferRenderer(w,ja,Ea),Wa=new b.WebGLIndexedBufferRenderer(w,ja,Ea);c();this.context=w;this.capabilities=za;this.extensions=ja;this.properties=ha;this.state=V;var Ra=new b.WebGLShadowMap(this,ea,Ia);
this.shadowMap=Ra;var $a=new b.SpritePlugin(this,fa),ab=new b.LensFlarePlugin(this,Ka);this.getContext=function(){return w};this.getContextAttributes=function(){return w.getContextAttributes()};this.forceContextLoss=function(){ja.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ja.get("EXT_texture_filter_anisotropic");return a=null!==b?w.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return za.precision};
this.getPixelRatio=function(){return ia};this.setPixelRatio=function(a){void 0!==a&&(ia=a,this.setSize(oa.z,oa.w,!1))};this.getSize=function(){return{width:da,height:Z}};this.setSize=function(a,b,c){da=a;Z=b;G.width=a*ia;G.height=b*ia;!1!==c&&(G.style.width=a+"px",G.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){V.viewport(oa.set(a,b,c,d))};this.setScissor=function(a,b,c,d){V.scissor(na.set(a,b,c,d))};this.setScissorTest=function(a){V.setScissorTest($=a)};this.getClearColor=
function(){return la};this.setClearColor=function(a,b){la.set(a);ba=void 0!==b?b:1;d(la.r,la.g,la.b,ba)};this.getClearAlpha=function(){return ba};this.setClearAlpha=function(a){ba=a;d(la.r,la.g,la.b,ba)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=w.COLOR_BUFFER_BIT;if(void 0===b||b)d|=w.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=w.STENCIL_BUFFER_BIT;w.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,
!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=e;this.dispose=function(){G.removeEventListener("webglcontextlost",f,!1)};this.renderBufferImmediate=function(a,c,d){V.initAttributes();var e=ha.get(a);a.hasPositions&&!e.position&&(e.position=w.createBuffer());a.hasNormals&&!e.normal&&(e.normal=w.createBuffer());a.hasUvs&&!e.uv&&(e.uv=w.createBuffer());a.hasColors&&!e.color&&(e.color=w.createBuffer());c=c.getAttributes();a.hasPositions&&(w.bindBuffer(w.ARRAY_BUFFER,
e.position),w.bufferData(w.ARRAY_BUFFER,a.positionArray,w.DYNAMIC_DRAW),V.enableAttribute(c.position),w.vertexAttribPointer(c.position,3,w.FLOAT,!1,0,0));if(a.hasNormals){w.bindBuffer(w.ARRAY_BUFFER,e.normal);if("MeshPhongMaterial"!==d.type&&"MeshStandardMaterial"!==d.type&&"MeshPhysicalMaterial"!==d.type&&d.shading===b.FlatShading)for(var f=0,g=3*a.count;f<g;f+=9){var m=a.normalArray,k=(m[f+0]+m[f+3]+m[f+6])/3,h=(m[f+1]+m[f+4]+m[f+7])/3,l=(m[f+2]+m[f+5]+m[f+8])/3;m[f+0]=k;m[f+1]=h;m[f+2]=l;m[f+3]=
k;m[f+4]=h;m[f+5]=l;m[f+6]=k;m[f+7]=h;m[f+8]=l}w.bufferData(w.ARRAY_BUFFER,a.normalArray,w.DYNAMIC_DRAW);V.enableAttribute(c.normal);w.vertexAttribPointer(c.normal,3,w.FLOAT,!1,0,0)}a.hasUvs&&d.map&&(w.bindBuffer(w.ARRAY_BUFFER,e.uv),w.bufferData(w.ARRAY_BUFFER,a.uvArray,w.DYNAMIC_DRAW),V.enableAttribute(c.uv),w.vertexAttribPointer(c.uv,2,w.FLOAT,!1,0,0));a.hasColors&&d.vertexColors!==b.NoColors&&(w.bindBuffer(w.ARRAY_BUFFER,e.color),w.bufferData(w.ARRAY_BUFFER,a.colorArray,w.DYNAMIC_DRAW),V.enableAttribute(c.color),
w.vertexAttribPointer(c.color,3,w.FLOAT,!1,0,0));V.disableUnusedAttributes();w.drawArrays(w.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,c,d,e,f,g){t(e);var m=v(a,c,e,f),k=!1;a=d.id+"_"+m.id+"_"+e.wireframe;a!==Da&&(Da=a,k=!0);c=f.morphTargetInfluences;if(void 0!==c){a=[];for(var h=0,k=c.length;h<k;h++){var l=c[h];a.push([l,h])}a.sort(C);8<a.length&&(a.length=8);for(var p=d.morphAttributes,h=0,k=a.length;h<k;h++)l=a[h],Aa[h]=l[0],0!==l[0]?(c=l[1],!0===e.morphTargets&&p.position&&
d.addAttribute("morphTarget"+h,p.position[c]),!0===e.morphNormals&&p.normal&&d.addAttribute("morphNormal"+h,p.normal[c])):(!0===e.morphTargets&&d.removeAttribute("morphTarget"+h),!0===e.morphNormals&&d.removeAttribute("morphNormal"+h));m.getUniforms().setValue(w,"morphTargetInfluences",Aa);k=!0}c=d.index;h=d.attributes.position;!0===e.wireframe&&(c=Ia.getWireframeAttribute(d));null!==c?(a=Wa,a.setIndex(c)):a=Va;if(k){a:{var k=void 0,n;if(d instanceof b.InstancedBufferGeometry&&(n=ja.get("ANGLE_instanced_arrays"),
null===n)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");break a}void 0===k&&(k=0);V.initAttributes();var l=d.attributes,m=m.getAttributes(),p=e.defaultAttributeValues,q;for(q in m){var r=m[q];if(0<=r){var s=l[q];if(void 0!==s){var u=w.FLOAT,y=s.array,H=s.normalized;y instanceof Float32Array?u=w.FLOAT:y instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):
y instanceof Uint16Array?u=w.UNSIGNED_SHORT:y instanceof Int16Array?u=w.SHORT:y instanceof Uint32Array?u=w.UNSIGNED_INT:y instanceof Int32Array?u=w.INT:y instanceof Int8Array?u=w.BYTE:y instanceof Uint8Array&&(u=w.UNSIGNED_BYTE);var y=s.itemSize,x=Ia.getAttributeBuffer(s);if(s instanceof b.InterleavedBufferAttribute){var z=s.data,F=z.stride,s=s.offset;z instanceof b.InstancedInterleavedBuffer?(V.enableAttributeAndDivisor(r,z.meshPerAttribute,n),void 0===d.maxInstancedCount&&(d.maxInstancedCount=z.meshPerAttribute*
z.count)):V.enableAttribute(r);w.bindBuffer(w.ARRAY_BUFFER,x);w.vertexAttribPointer(r,y,u,H,F*z.array.BYTES_PER_ELEMENT,(k*F+s)*z.array.BYTES_PER_ELEMENT)}else s instanceof b.InstancedBufferAttribute?(V.enableAttributeAndDivisor(r,s.meshPerAttribute,n),void 0===d.maxInstancedCount&&(d.maxInstancedCount=s.meshPerAttribute*s.count)):V.enableAttribute(r),w.bindBuffer(w.ARRAY_BUFFER,x),w.vertexAttribPointer(r,y,u,H,0,k*y*s.array.BYTES_PER_ELEMENT)}else if(void 0!==p&&(u=p[q],void 0!==u))switch(u.length){case 2:w.vertexAttrib2fv(r,
u);break;case 3:w.vertexAttrib3fv(r,u);break;case 4:w.vertexAttrib4fv(r,u);break;default:w.vertexAttrib1fv(r,u)}}}V.disableUnusedAttributes()}null!==c&&w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Ia.getAttributeBuffer(c))}n=Infinity;null!==c?n=c.count:void 0!==h&&(n=h.count);q=d.drawRange.start;c=d.drawRange.count;h=null!==g?g.start:0;k=null!==g?g.count:Infinity;g=Math.max(0,q,h);n=Math.min(0+n,q+c,h+k)-1;n=Math.max(0,n-g+1);if(f instanceof b.Mesh)if(!0===e.wireframe)V.setLineWidth(e.wireframeLinewidth*(null===
Ba?ia:1)),a.setMode(w.LINES);else switch(f.drawMode){case b.TrianglesDrawMode:a.setMode(w.TRIANGLES);break;case b.TriangleStripDrawMode:a.setMode(w.TRIANGLE_STRIP);break;case b.TriangleFanDrawMode:a.setMode(w.TRIANGLE_FAN)}else f instanceof b.Line?(e=e.linewidth,void 0===e&&(e=1),V.setLineWidth(e*(null===Ba?ia:1)),f instanceof b.LineSegments?a.setMode(w.LINES):a.setMode(w.LINE_STRIP)):f instanceof b.Points&&a.setMode(w.POINTS);d instanceof b.InstancedBufferGeometry?0<d.maxInstancedCount&&a.renderInstances(d,
g,n):a.render(g,n)};this.render=function(a,c,d,e){if(!1===c instanceof b.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var f=a.fog;Da="";qa=-1;xa=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);Na.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);aa.setFromMatrix(Na);R.length=0;sa=ca=-1;fa.length=0;Ka.length=0;var g=this.clippingPlanes;ga=0!==ka.clippingPlanes.length||
ka.localClippingEnabled||0!==Ja||ya;ya=ka.localClippingEnabled;va=P(g,c,0);Ja=null!==g?g.length:0;r(a,c);X.length=ca+1;W.length=sa+1;!0===ka.sortObjects&&(X.sort(q),W.sort(u));ga&&(wa=!0,P(null));for(var g=R,m=0,k=0,h=g.length;k<h;k++){var l=g[k];l.castShadow&&(ea.shadows[m++]=l)}ea.shadows.length=m;Ra.render(a,c);for(var g=R,p=l=0,n=0,t,y,C,v=c.matrixWorldInverse,A=0,H=0,x=0,F=0,m=0,k=g.length;m<k;m++)if(h=g[m],t=h.color,y=h.intensity,C=h.distance,h instanceof b.AmbientLight)l+=t.r*y,p+=t.g*y,n+=
t.b*y;else if(h instanceof b.DirectionalLight){var I=Ma.get(h);I.color.copy(h.color).multiplyScalar(h.intensity);I.direction.setFromMatrixPosition(h.matrixWorld);ra.setFromMatrixPosition(h.target.matrixWorld);I.direction.sub(ra);I.direction.transformDirection(v);if(I.shadow=h.castShadow)I.shadowBias=h.shadow.bias,I.shadowRadius=h.shadow.radius,I.shadowMapSize=h.shadow.mapSize;ea.directionalShadowMap[A]=h.shadow.map;ea.directionalShadowMatrix[A]=h.shadow.matrix;ea.directional[A++]=I}else if(h instanceof
b.SpotLight){I=Ma.get(h);I.position.setFromMatrixPosition(h.matrixWorld);I.position.applyMatrix4(v);I.color.copy(t).multiplyScalar(y);I.distance=C;I.direction.setFromMatrixPosition(h.matrixWorld);ra.setFromMatrixPosition(h.target.matrixWorld);I.direction.sub(ra);I.direction.transformDirection(v);I.coneCos=Math.cos(h.angle);I.penumbraCos=Math.cos(h.angle*(1-h.penumbra));I.decay=0===h.distance?0:h.decay;if(I.shadow=h.castShadow)I.shadowBias=h.shadow.bias,I.shadowRadius=h.shadow.radius,I.shadowMapSize=
h.shadow.mapSize;ea.spotShadowMap[x]=h.shadow.map;ea.spotShadowMatrix[x]=h.shadow.matrix;ea.spot[x++]=I}else if(h instanceof b.PointLight){I=Ma.get(h);I.position.setFromMatrixPosition(h.matrixWorld);I.position.applyMatrix4(v);I.color.copy(h.color).multiplyScalar(h.intensity);I.distance=h.distance;I.decay=0===h.distance?0:h.decay;if(I.shadow=h.castShadow)I.shadowBias=h.shadow.bias,I.shadowRadius=h.shadow.radius,I.shadowMapSize=h.shadow.mapSize;ea.pointShadowMap[H]=h.shadow.map;void 0===ea.pointShadowMatrix[H]&&
(ea.pointShadowMatrix[H]=new b.Matrix4);ra.setFromMatrixPosition(h.matrixWorld).negate();ea.pointShadowMatrix[H].identity().setPosition(ra);ea.point[H++]=I}else h instanceof b.HemisphereLight&&(I=Ma.get(h),I.direction.setFromMatrixPosition(h.matrixWorld),I.direction.transformDirection(v),I.direction.normalize(),I.skyColor.copy(h.color).multiplyScalar(y),I.groundColor.copy(h.groundColor).multiplyScalar(y),ea.hemi[F++]=I);ea.ambient[0]=l;ea.ambient[1]=p;ea.ambient[2]=n;ea.directional.length=A;ea.spot.length=
x;ea.point.length=H;ea.hemi.length=F;ea.hash=A+","+H+","+x+","+F+","+ea.shadows.length;ga&&(wa=!1,z());Ea.calls=0;Ea.vertices=0;Ea.faces=0;Ea.points=0;void 0===d&&(d=null);this.setRenderTarget(d);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);a.overrideMaterial?(e=a.overrideMaterial,s(X,c,f,e),s(W,c,f,e)):(V.setBlending(b.NoBlending),s(X,c,f),s(W,c,f));$a.render(a,c);ab.render(a,c,Y);d&&(a=d.texture,a.generateMipmaps&&L(d)&&a.minFilter!==b.NearestFilter&&
a.minFilter!==b.LinearFilter&&(a=d instanceof b.WebGLRenderTargetCube?w.TEXTURE_CUBE_MAP:w.TEXTURE_2D,d=ha.get(d.texture).__webglTexture,V.bindTexture(a,d),w.generateMipmap(a),V.bindTexture(a,null)));V.setDepthTest(!0);V.setDepthWrite(!0);V.setColorWrite(!0)}};this.setFaceCulling=function(a,c){a===b.CullFaceNone?V.disable(w.CULL_FACE):(c===b.FrontFaceDirectionCW?w.frontFace(w.CW):w.frontFace(w.CCW),a===b.CullFaceBack?w.cullFace(w.BACK):a===b.CullFaceFront?w.cullFace(w.FRONT):w.cullFace(w.FRONT_AND_BACK),
V.enable(w.CULL_FACE))};var Ua=!1;this.setTexture=function(a,b){Ua||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),Ua=!0);J(a,b)};this.allocTextureUnit=function(){var a=ma;a>=za.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+za.maxTextures);ma+=1;return a};this.setTexture2D=J;this.setTextureCube=function(a,c){if(a instanceof b.CubeTexture||Array.isArray(a.image)&&6===a.image.length){var d=ha.get(a);
if(6===a.image.length)if(0<a.version&&d.__version!==a.version){d.__image__webglTextureCube||(a.addEventListener("dispose",g),d.__image__webglTextureCube=w.createTexture(),Ha.textures++);V.activeTexture(w.TEXTURE0+c);V.bindTexture(w.TEXTURE_CUBE_MAP,d.__image__webglTextureCube);w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var e=a instanceof b.CompressedTexture,f=a.image[0]instanceof b.DataTexture,m=[],k=0;6>k;k++)m[k]=!ka.autoScaleCubemaps||e||f?f?a.image[k].image:a.image[k]:E(a.image[k],za.maxCubemapSize);
var h=L(m[0]),l=O(a.format),p=O(a.type);N(w.TEXTURE_CUBE_MAP,a,h);for(k=0;6>k;k++)if(e)for(var n,q=m[k].mipmaps,r=0,s=q.length;r<s;r++)n=q[r],a.format!==b.RGBAFormat&&a.format!==b.RGBFormat?-1<V.getCompressedTextureFormats().indexOf(l)?V.compressedTexImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+k,r,l,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):V.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+k,r,l,n.width,n.height,0,
l,p,n.data);else f?V.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,l,m[k].width,m[k].height,0,l,p,m[k].data):V.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,l,l,p,m[k]);a.generateMipmaps&&h&&w.generateMipmap(w.TEXTURE_CUBE_MAP);d.__version=a.version;if(a.onUpdate)a.onUpdate(a)}else V.activeTexture(w.TEXTURE0+c),V.bindTexture(w.TEXTURE_CUBE_MAP,d.__image__webglTextureCube)}else d=a.texture,V.activeTexture(w.TEXTURE0+c),V.bindTexture(w.TEXTURE_CUBE_MAP,ha.get(d).__webglTexture)};this.getCurrentRenderTarget=
function(){return Ba};this.setRenderTarget=function(a){if((Ba=a)&&void 0===ha.get(a).__webglFramebuffer){var c=ha.get(a),d=ha.get(a.texture);a.addEventListener("dispose",m);d.__webglTexture=w.createTexture();Ha.textures++;var e=a instanceof b.WebGLRenderTargetCube,f=b.Math.isPowerOfTwo(a.width)&&b.Math.isPowerOfTwo(a.height);if(e){c.__webglFramebuffer=[];for(var g=0;6>g;g++)c.__webglFramebuffer[g]=w.createFramebuffer()}else c.__webglFramebuffer=w.createFramebuffer();if(e){V.bindTexture(w.TEXTURE_CUBE_MAP,
d.__webglTexture);N(w.TEXTURE_CUBE_MAP,a.texture,f);for(g=0;6>g;g++)D(c.__webglFramebuffer[g],a,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+g);a.texture.generateMipmaps&&f&&w.generateMipmap(w.TEXTURE_CUBE_MAP);V.bindTexture(w.TEXTURE_CUBE_MAP,null)}else V.bindTexture(w.TEXTURE_2D,d.__webglTexture),N(w.TEXTURE_2D,a.texture,f),D(c.__webglFramebuffer,a,w.COLOR_ATTACHMENT0,w.TEXTURE_2D),a.texture.generateMipmaps&&f&&w.generateMipmap(w.TEXTURE_2D),V.bindTexture(w.TEXTURE_2D,null);if(a.depthBuffer){c=
ha.get(a);d=a instanceof b.WebGLRenderTargetCube;if(a.depthTexture){if(d)throw Error("target.depthTexture not supported in Cube render targets");if(a instanceof b.WebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");w.bindFramebuffer(w.FRAMEBUFFER,c.__webglFramebuffer);if(!(a.depthTexture instanceof b.DepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");ha.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===
a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0);ka.setTexture(a.depthTexture,0);c=ha.get(a.depthTexture).__webglTexture;w.framebufferTexture2D(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.TEXTURE_2D,c,0)}else if(d)for(c.__webglDepthbuffer=[],d=0;6>d;d++)w.bindFramebuffer(w.FRAMEBUFFER,c.__webglFramebuffer[d]),c.__webglDepthbuffer[d]=w.createRenderbuffer(),Q(c.__webglDepthbuffer[d],a);else w.bindFramebuffer(w.FRAMEBUFFER,
c.__webglFramebuffer),c.__webglDepthbuffer=w.createRenderbuffer(),Q(c.__webglDepthbuffer,a);w.bindFramebuffer(w.FRAMEBUFFER,null)}}c=a instanceof b.WebGLRenderTargetCube;a?(d=ha.get(a),d=c?d.__webglFramebuffer[a.activeCubeFace]:d.__webglFramebuffer,Fa.copy(a.scissor),Ga=a.scissorTest,Y.copy(a.viewport)):(d=null,Fa.copy(na).multiplyScalar(ia),Ga=$,Y.copy(oa).multiplyScalar(ia));Ca!==d&&(w.bindFramebuffer(w.FRAMEBUFFER,d),Ca=d);V.scissor(Fa);V.setScissorTest(Ga);V.viewport(Y);c&&(c=ha.get(a.texture),
w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,c.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,c,d,e,f,g){if(!1===a instanceof b.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var m=ha.get(a).__webglFramebuffer;if(m){var k=!1;m!==Ca&&(w.bindFramebuffer(w.FRAMEBUFFER,m),k=!0);try{var h=a.texture;h.format!==b.RGBAFormat&&O(h.format)!==
w.getParameter(w.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):h.type===b.UnsignedByteType||O(h.type)===w.getParameter(w.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===b.FloatType&&ja.get("WEBGL_color_buffer_float")||h.type===b.HalfFloatType&&ja.get("EXT_color_buffer_half_float")?w.checkFramebufferStatus(w.FRAMEBUFFER)===w.FRAMEBUFFER_COMPLETE?0<c&&c<=a.width-e&&0<d&&d<=a.height-f&&w.readPixels(c,
d,e,f,O(h.format),O(h.type),g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{k&&w.bindFramebuffer(w.FRAMEBUFFER,Ca)}}}}};b.WebGLRenderTarget=function(a,d,c){this.uuid=b.Math.generateUUID();this.width=a;this.height=d;this.scissor=new b.Vector4(0,0,a,d);this.scissorTest=!1;this.viewport=
new b.Vector4(0,0,a,d);c=c||{};void 0===c.minFilter&&(c.minFilter=b.LinearFilter);this.texture=new b.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=null};b.WebGLRenderTarget.prototype={constructor:b.WebGLRenderTarget,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();
this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};b.EventDispatcher.prototype.apply(b.WebGLRenderTarget.prototype);b.WebGLRenderTargetCube=function(a,
d,c){b.WebGLRenderTarget.call(this,a,d,c);this.activeMipMapLevel=this.activeCubeFace=0};b.WebGLRenderTargetCube.prototype=Object.create(b.WebGLRenderTarget.prototype);b.WebGLRenderTargetCube.prototype.constructor=b.WebGLRenderTargetCube;b.WebGLBufferRenderer=function(a,d,c){var e;this.setMode=function(a){e=a};this.render=function(b,d){a.drawArrays(e,b,d);c.calls++;c.vertices+=d;e===a.TRIANGLES&&(c.faces+=d/3)};this.renderInstances=function(f){var g=d.get("ANGLE_instanced_arrays");if(null===g)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{var m=f.attributes.position,h=0,h=m instanceof b.InterleavedBufferAttribute?m.data.count:m.count;g.drawArraysInstancedANGLE(e,0,h,f.maxInstancedCount);c.calls++;c.vertices+=h*f.maxInstancedCount;e===a.TRIANGLES&&(c.faces+=f.maxInstancedCount*h/3)}}};b.WebGLIndexedBufferRenderer=function(a,b,c){var e,f,g;this.setMode=function(a){e=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(f=a.UNSIGNED_INT,g=4):(f=a.UNSIGNED_SHORT,g=2)};this.render=function(b,
d){a.drawElements(e,d,f,b*g);c.calls++;c.vertices+=d;e===a.TRIANGLES&&(c.faces+=d/3)};this.renderInstances=function(m,h,l){var C=b.get("ANGLE_instanced_arrays");null===C?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(C.drawElementsInstancedANGLE(e,l,f,h*g,m.maxInstancedCount),c.calls++,c.vertices+=l*m.maxInstancedCount,e===a.TRIANGLES&&(c.faces+=m.maxInstancedCount*l/3))}};b.WebGLExtensions=function(a){var b=
{};this.get=function(c){if(void 0!==b[c])return b[c];var e;switch(c){case "WEBGL_depth_texture":a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");case "EXT_texture_filter_anisotropic":e=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":e=a.getExtension("WEBGL_compressed_texture_s3tc")||
a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":e=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":e=a.getExtension("WEBGL_compressed_texture_etc1");break;default:e=a.getExtension(c)}null===e&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=e}};b.WebGLCapabilities=
function(a,b,c){function e(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=e;this.precision=void 0!==c.precision?c.precision:"highp";this.logarithmicDepthBuffer=
void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=
a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=e(this.precision);c!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",c,"instead."),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))};b.WebGLGeometries=function(a,d,c){function e(a){var b=
a.target;a=g[b.id];null!==a.index&&f(a.index);var h=a.attributes,l;for(l in h)f(h[l]);b.removeEventListener("dispose",e);delete g[b.id];l=d.get(b);l.wireframe&&f(l.wireframe);d.delete(b);b=d.get(a);b.wireframe&&f(b.wireframe);d.delete(a);c.memory.geometries--}function f(c){var e;e=c instanceof b.InterleavedBufferAttribute?d.get(c.data).__webglBuffer:d.get(c).__webglBuffer;void 0!==e&&(a.deleteBuffer(e),c instanceof b.InterleavedBufferAttribute?d.delete(c.data):d.delete(c))}var g={};this.get=function(a){var d=
a.geometry;if(void 0!==g[d.id])return g[d.id];d.addEventListener("dispose",e);var f;d instanceof b.BufferGeometry?f=d:d instanceof b.Geometry&&(void 0===d._bufferGeometry&&(d._bufferGeometry=(new b.BufferGeometry).setFromObject(a)),f=d._bufferGeometry);g[d.id]=f;c.memory.geometries++;return f}};b.WebGLLights=function(){var a={};this.get=function(d){if(void 0!==a[d.id])return a[d.id];var c;switch(d.type){case "DirectionalLight":c={direction:new b.Vector3,color:new b.Color,shadow:!1,shadowBias:0,shadowRadius:1,
shadowMapSize:new b.Vector2};break;case "SpotLight":c={position:new b.Vector3,direction:new b.Vector3,color:new b.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new b.Vector2};break;case "PointLight":c={position:new b.Vector3,color:new b.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new b.Vector2};break;case "HemisphereLight":c={direction:new b.Vector3,skyColor:new b.Color,groundColor:new b.Color}}return a[d.id]=
c}};b.WebGLObjects=function(a,d,c){function e(c,e){var f=c instanceof b.InterleavedBufferAttribute?c.data:c,g=d.get(f);void 0===g.__webglBuffer?(g.__webglBuffer=a.createBuffer(),a.bindBuffer(e,g.__webglBuffer),a.bufferData(e,f.array,f.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),g.version=f.version):g.version!==f.version&&(a.bindBuffer(e,g.__webglBuffer),!1===f.dynamic||-1===f.updateRange.count?a.bufferSubData(e,0,f.array):0===f.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(e,f.updateRange.offset*f.array.BYTES_PER_ELEMENT,f.array.subarray(f.updateRange.offset,f.updateRange.offset+f.updateRange.count)),f.updateRange.count=0),g.version=f.version)}function f(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var g=new b.WebGLGeometries(a,d,c);this.getAttributeBuffer=function(a){return a instanceof b.InterleavedBufferAttribute?d.get(a.data).__webglBuffer:d.get(a).__webglBuffer};this.getWireframeAttribute=
function(c){var g=d.get(c);if(void 0!==g.wireframe)return g.wireframe;var h=[],l=c.index,q=c.attributes;c=q.position;if(null!==l)for(var q={},l=l.array,u=0,k=l.length;u<k;u+=3){var n=l[u+0],r=l[u+1],s=l[u+2];f(q,n,r)&&h.push(n,r);f(q,r,s)&&h.push(r,s);f(q,s,n)&&h.push(s,n)}else for(l=q.position.array,u=0,k=l.length/3-1;u<k;u+=3)n=u+0,r=u+1,s=u+2,h.push(n,r,r,s,s,n);h=new b.BufferAttribute(new (65535<c.count?Uint32Array:Uint16Array)(h),1);e(h,a.ELEMENT_ARRAY_BUFFER);return g.wireframe=h};this.update=
function(c){var d=g.get(c);c.geometry instanceof b.Geometry&&d.updateFromObject(c);c=d.index;var f=d.attributes;null!==c&&e(c,a.ELEMENT_ARRAY_BUFFER);for(var h in f)e(f[h],a.ARRAY_BUFFER);c=d.morphAttributes;for(h in c)for(var f=c[h],l=0,u=f.length;l<u;l++)e(f[l],a.ARRAY_BUFFER);return d}};b.WebGLProgram=function(){function a(a){switch(a){case b.LinearEncoding:return["Linear","( value )"];case b.sRGBEncoding:return["sRGB","( value )"];case b.RGBEEncoding:return["RGBE","( value )"];case b.RGBM7Encoding:return["RGBM",
"( value, 7.0 )"];case b.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case b.RGBDEncoding:return["RGBD","( value, 256.0 )"];case b.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function d(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function e(a,c){var d;switch(c){case b.LinearToneMapping:d="Linear";
break;case b.ReinhardToneMapping:d="Reinhard";break;case b.Uncharted2ToneMapping:d="Uncharted2";break;case b.CineonToneMapping:d="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+c);}return"vec3 "+a+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function f(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":
"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(m).join("\n")}function g(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function m(a){return""!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,
b.numHemiLights)}function l(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,c){var d=b.ShaderChunk[c];if(void 0===d)throw Error("Can not resolve #include <"+c+">");return l(d)})}function v(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]");return a})}var q=0;return function(a,k,n,r){var s=a.context,t=n.extensions,A=n.defines,x=n.__webglShader.vertexShader,
P=n.__webglShader.fragmentShader,z="SHADOWMAP_TYPE_BASIC";r.shadowMapType===b.PCFShadowMap?z="SHADOWMAP_TYPE_PCF":r.shadowMapType===b.PCFSoftShadowMap&&(z="SHADOWMAP_TYPE_PCF_SOFT");var N="ENVMAP_TYPE_CUBE",J="ENVMAP_MODE_REFLECTION",E="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(n.envMap.mapping){case b.CubeReflectionMapping:case b.CubeRefractionMapping:N="ENVMAP_TYPE_CUBE";break;case b.CubeUVReflectionMapping:case b.CubeUVRefractionMapping:N="ENVMAP_TYPE_CUBE_UV";break;case b.EquirectangularReflectionMapping:case b.EquirectangularRefractionMapping:N=
"ENVMAP_TYPE_EQUIREC";break;case b.SphericalReflectionMapping:N="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case b.CubeRefractionMapping:case b.EquirectangularRefractionMapping:J="ENVMAP_MODE_REFRACTION"}switch(n.combine){case b.MultiplyOperation:E="ENVMAP_BLENDING_MULTIPLY";break;case b.MixOperation:E="ENVMAP_BLENDING_MIX";break;case b.AddOperation:E="ENVMAP_BLENDING_ADD"}}var L=0<a.gammaFactor?a.gammaFactor:1,t=f(t,r,a.extensions),D=g(A),Q=s.createProgram();n instanceof b.RawShaderMaterial?z=
A="":(A=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.__webglShader.name,D,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+L,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+J:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":
"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":
"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+z:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;",
"uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;",
"\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(m).join("\n"),z=[t,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.__webglShader.name,D,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+
L,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+N:"",r.envMap?"#define "+J:"",r.envMap?"#define "+E:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?
"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+z:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":
"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==b.NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==b.NoToneMapping?b.ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==b.NoToneMapping?e("toneMapping",r.toneMapping):"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?
b.ShaderChunk.encodings_pars_fragment:"",r.mapEncoding?d("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?d("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?d("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?c("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(m).join("\n"));x=l(x,r);x=h(x,r);P=l(P,r);P=h(P,r);!1===n instanceof b.ShaderMaterial&&(x=v(x),P=v(P));P=z+P;x=b.WebGLShader(s,s.VERTEX_SHADER,
A+x);P=b.WebGLShader(s,s.FRAGMENT_SHADER,P);s.attachShader(Q,x);s.attachShader(Q,P);void 0!==n.index0AttributeName?s.bindAttribLocation(Q,0,n.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(Q,0,"position");s.linkProgram(Q);r=s.getProgramInfoLog(Q);N=s.getShaderInfoLog(x);J=s.getShaderInfoLog(P);L=E=!0;if(!1===s.getProgramParameter(Q,s.LINK_STATUS))E=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(Q,s.VALIDATE_STATUS),"gl.getProgramInfoLog",
r,N,J);else if(""!==r)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",r);else if(""===N||""===J)L=!1;L&&(this.diagnostics={runnable:E,material:n,programLog:r,vertexShader:{log:N,prefix:A},fragmentShader:{log:J,prefix:z}});s.deleteShader(x);s.deleteShader(P);var T;this.getUniforms=function(){void 0===T&&(T=new b.WebGLUniforms(s,Q,a));return T};var O;this.getAttributes=function(){if(void 0===O){for(var a={},b=s.getProgramParameter(Q,s.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=s.getActiveAttrib(Q,
c).name;a[d]=s.getAttribLocation(Q,d)}O=a}return O};this.destroy=function(){s.deleteProgram(Q);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=q++;this.code=k;this.usedTimes=1;this.program=Q;this.vertexShader=x;this.fragmentShader=P;return this}}();
b.WebGLPrograms=function(a,d){function c(a,c){var d;a?a instanceof b.Texture?d=a.encoding:a instanceof b.WebGLRenderTarget&&(d=a.texture.encoding):d=b.LinearEncoding;d===b.LinearEncoding&&c&&(d=b.GammaEncoding);return d}var e=[],f={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},
g="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(e,g,h,l,q){var u=f[e.type],k;d.floatVertexTextures&&q&&q.skeleton&&q.skeleton.useVertexTexture?k=1024:(k=Math.floor((d.maxVertexUniforms-20)/4),void 0!==q&&q instanceof b.SkinnedMesh&&(k=Math.min(q.skeleton.bones.length,k),k<q.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+q.skeleton.bones.length+", this GPU supports just "+k+" (try OpenGL instead of ANGLE)")));var n=a.getPrecision();null!==e.precision&&(n=d.getMaxPrecision(e.precision),n!==e.precision&&
console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",n,"instead."));return{shaderID:u,precision:n,supportsVertexTextures:d.vertexTextures,outputEncoding:c(a.getCurrentRenderTarget(),a.gammaOutput),map:!!e.map,mapEncoding:c(e.map,a.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:c(e.envMap,a.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===b.CubeUVReflectionMapping||e.envMap.mapping===b.CubeUVRefractionMapping),lightMap:!!e.lightMap,
aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:c(e.emissiveMap,a.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:h,useFog:e.fog,fogExp:h instanceof b.FogExp2,flatShading:e.shading===b.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:d.logarithmicDepthBuffer,skinning:e.skinning,
maxBones:k,useVertexTexture:d.floatVertexTextures&&q&&q.skeleton&&q.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:g.directional.length,numPointLights:g.point.length,numSpotLights:g.spot.length,numHemiLights:g.hemi.length,numClippingPlanes:l,shadowMapEnabled:a.shadowMap.enabled&&q.receiveShadow&&0<g.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,
premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===b.DoubleSide,flipSided:e.side===b.BackSide,depthPacking:void 0!==e.depthPacking?e.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<g.length;d++)c.push(b[g[d]]);return c.join()};this.acquireProgram=function(c,d,f){for(var g,h=0,l=e.length;h<
l;h++){var k=e[h];if(k.code===f){g=k;++g.usedTimes;break}}void 0===g&&(g=new b.WebGLProgram(a,f,c,d),e.push(g));return g};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e};b.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this.delete=function(b){delete a[b.uuid]};this.clear=function(){a={}}};b.WebGLShader=function(){function a(a){a=a.split("\n");for(var b=
0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}return function(b,c,e){var f=b.createShader(c);b.shaderSource(f,e);b.compileShader(f);!1===b.getShaderParameter(f,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(f)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(f),a(e));return f}}();b.WebGLShadowMap=function(a,d,c){function e(c,d,e,f){var g=c.geometry,h=null,h=r,k=c.customDepthMaterial;
e&&(h=s,k=c.customDistanceMaterial);k?h=k:(c=c instanceof b.SkinnedMesh&&d.skinning,k=0,void 0!==g.morphTargets&&0<g.morphTargets.length&&d.morphTargets&&(k|=1),c&&(k|=2),h=h[k]);a.localClippingEnabled&&!0===d.clipShadows&&0!==d.clippingPlanes.length&&(k=h.uuid,g=d.uuid,c=t[k],void 0===c&&(c={},t[k]=c),k=c[g],void 0===k&&(k=h.clone(),c[g]=k),h=k);h.visible=d.visible;h.wireframe=d.wireframe;h.side=d.side;h.clipShadows=d.clipShadows;h.clippingPlanes=d.clippingPlanes;h.wireframeLinewidth=d.wireframeLinewidth;
h.linewidth=d.linewidth;e&&void 0!==h.uniforms.lightPos&&h.uniforms.lightPos.value.copy(f);return h}function f(a,c,d){if(!1!==a.visible){a.layers.test(c.layers)&&(a instanceof b.Mesh||a instanceof b.Line||a instanceof b.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===l.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,a.matrixWorld),n.push(a));a=a.children;for(var e=0,g=a.length;e<g;e++)f(a[e],c,d)}}var g=a.context,h=a.state,l=new b.Frustum,
y=new b.Matrix4,v=d.shadows,q=new b.Vector2,u=new b.Vector3,k=new b.Vector3,n=[],r=Array(4),s=Array(4),t={},A=[new b.Vector3(1,0,0),new b.Vector3(-1,0,0),new b.Vector3(0,0,1),new b.Vector3(0,0,-1),new b.Vector3(0,1,0),new b.Vector3(0,-1,0)],x=[new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,1,0),new b.Vector3(0,0,1),new b.Vector3(0,0,-1)],P=[new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4,new b.Vector4];d=new b.MeshDepthMaterial;d.depthPacking=
b.RGBADepthPacking;d.clipping=!0;for(var z=b.ShaderLib.distanceRGBA,N=b.UniformsUtils.clone(z.uniforms),J=0;4!==J;++J){var E=0!==(J&1),L=0!==(J&2),D=d.clone();D.morphTargets=E;D.skinning=L;r[J]=D;E=new b.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:N,vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,morphTargets:E,skinning:L,clipping:!0});s[J]=E}var Q=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=b.PCFShadowMap;this.cullFace=b.CullFaceFront;this.render=function(d,
r){if(!1!==Q.enabled&&(!1!==Q.autoUpdate||!1!==Q.needsUpdate)&&0!==v.length){h.clearColor(1,1,1,1);h.disable(g.BLEND);h.enable(g.CULL_FACE);g.frontFace(g.CCW);g.cullFace(Q.cullFace===b.CullFaceFront?g.FRONT:g.BACK);h.setDepthTest(!0);h.setScissorTest(!1);for(var s,t,z=0,J=v.length;z<J;z++){var H=v[z],I=H.shadow,F=I.camera;q.copy(I.mapSize);if(H instanceof b.PointLight){s=6;t=!0;var E=q.x,R=q.y;P[0].set(2*E,R,E,R);P[1].set(0,R,E,R);P[2].set(3*E,R,E,R);P[3].set(E,R,E,R);P[4].set(3*E,0,E,R);P[5].set(E,
0,E,R);q.x*=4;q.y*=2}else s=1,t=!1;null===I.map&&(I.map=new b.WebGLRenderTarget(q.x,q.y,{minFilter:b.NearestFilter,magFilter:b.NearestFilter,format:b.RGBAFormat}),F.updateProjectionMatrix());I instanceof b.SpotLightShadow&&I.update(H);E=I.map;I=I.matrix;k.setFromMatrixPosition(H.matrixWorld);F.position.copy(k);a.setRenderTarget(E);a.clear();for(E=0;E<s;E++){t?(u.copy(F.position),u.add(A[E]),F.up.copy(x[E]),F.lookAt(u),h.viewport(P[E])):(u.setFromMatrixPosition(H.target.matrixWorld),F.lookAt(u));F.updateMatrixWorld();
F.matrixWorldInverse.getInverse(F.matrixWorld);I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);I.multiply(F.projectionMatrix);I.multiply(F.matrixWorldInverse);y.multiplyMatrices(F.projectionMatrix,F.matrixWorldInverse);l.setFromMatrix(y);n.length=0;f(d,r,F);for(var R=0,L=n.length;R<L;R++){var N=n[R],D=c.update(N),sa=N.material;if(sa instanceof b.MultiMaterial)for(var Aa=D.groups,sa=sa.materials,fa=0,Ka=Aa.length;fa<Ka;fa++){var ka=Aa[fa],ta=sa[ka.materialIndex];!0===ta.visible&&(ta=e(N,ta,t,k),a.renderBufferDirect(F,
null,D,ta,N,ka))}else ta=e(N,sa,t,k),a.renderBufferDirect(F,null,D,ta,N,null)}}}s=a.getClearColor();t=a.getClearAlpha();a.setClearColor(s,t);h.enable(g.BLEND);Q.cullFace===b.CullFaceFront&&g.cullFace(g.BACK);Q.needsUpdate=!1}}};b.WebGLState=function(a,d,c){var e=this,f=new b.Vector4,g=a.getParameter(a.MAX_VERTEX_ATTRIBS),h=new Uint8Array(g),l=new Uint8Array(g),y=new Uint8Array(g),v={},q=null,u=null,k=null,n=null,r=null,s=null,t=null,x=null,B=!1,P=null,z=null,N=null,J=null,E=null,L=null,D=null,Q=null,
T=null,O=null,G=null,U=null,K=null,M=null,H=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),F=void 0,S={},R=new b.Vector4,X=null,ca=null,W=new b.Vector4,sa=new b.Vector4;this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);this.enable(a.CULL_FACE);this.enable(a.BLEND);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var a=
0,b=h.length;a<b;a++)h[a]=0};this.enableAttribute=function(b){h[b]=1;0===l[b]&&(a.enableVertexAttribArray(b),l[b]=1);0!==y[b]&&(d.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(b,0),y[b]=0)};this.enableAttributeAndDivisor=function(b,c,d){h[b]=1;0===l[b]&&(a.enableVertexAttribArray(b),l[b]=1);y[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),y[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=l.length;b<c;b++)l[b]!==h[b]&&(a.disableVertexAttribArray(b),l[b]=0)};this.enable=function(b){!0!==
v[b]&&(a.enable(b),v[b]=!0)};this.disable=function(b){!1!==v[b]&&(a.disable(b),v[b]=!1)};this.getCompressedTextureFormats=function(){if(null===q&&(q=[],d.get("WEBGL_compressed_texture_pvrtc")||d.get("WEBGL_compressed_texture_s3tc")||d.get("WEBGL_compressed_texture_etc1")))for(var b=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)q.push(b[c]);return q};this.setBlending=function(d,e,f,g,h,m,l,p){d===b.NoBlending?this.disable(a.BLEND):this.enable(a.BLEND);if(d!==u||p!==B)d===b.AdditiveBlending?
p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):d===b.SubtractiveBlending?p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):d===b.MultiplyBlending?p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.SRC_COLOR,
a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),u=d,B=p;if(d===b.CustomBlending){h=h||e;m=m||f;l=l||g;if(e!==k||h!==s)a.blendEquationSeparate(c(e),c(h)),k=e,s=h;if(f!==n||g!==r||m!==t||l!==x)a.blendFuncSeparate(c(f),
c(g),c(m),c(l)),n=f,r=g,t=m,x=l}else x=t=s=r=n=k=null};this.setDepthFunc=function(c){if(P!==c){if(c)switch(c){case b.NeverDepth:a.depthFunc(a.NEVER);break;case b.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case b.LessDepth:a.depthFunc(a.LESS);break;case b.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case b.EqualDepth:a.depthFunc(a.EQUAL);break;case b.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case b.GreaterDepth:a.depthFunc(a.GREATER);break;case b.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);
P=c}};this.setDepthTest=function(b){b?this.enable(a.DEPTH_TEST):this.disable(a.DEPTH_TEST)};this.setDepthWrite=function(b){z!==b&&(a.depthMask(b),z=b)};this.setColorWrite=function(b){N!==b&&(a.colorMask(b,b,b,b),N=b)};this.setStencilFunc=function(b,c,d){if(E!==b||L!==c||D!==d)a.stencilFunc(b,c,d),E=b,L=c,D=d};this.setStencilOp=function(b,c,d){if(Q!==b||T!==c||O!==d)a.stencilOp(b,c,d),Q=b,T=c,O=d};this.setStencilTest=function(b){b?this.enable(a.STENCIL_TEST):this.disable(a.STENCIL_TEST)};this.setStencilWrite=
function(b){J!==b&&(a.stencilMask(b),J=b)};this.setFlipSided=function(b){G!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),G=b)};this.setLineWidth=function(b){b!==U&&(a.lineWidth(b),U=b)};this.setPolygonOffset=function(b,c,d){b?this.enable(a.POLYGON_OFFSET_FILL):this.disable(a.POLYGON_OFFSET_FILL);!b||K===c&&M===d||(a.polygonOffset(c,d),K=c,M=d)};this.getScissorTest=function(){return H};this.setScissorTest=function(b){(H=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=
function(b){void 0===b&&(b=a.TEXTURE0+I-1);F!==b&&(a.activeTexture(b),F=b)};this.bindTexture=function(b,c){void 0===F&&e.activeTexture();var d=S[F];void 0===d&&(d={type:void 0,texture:void 0},S[F]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(b,c,
d,e){f.set(b,c,d,e);!1===R.equals(f)&&(a.clearColor(b,c,d,e),R.copy(f))};this.clearDepth=function(b){X!==b&&(a.clearDepth(b),X=b)};this.clearStencil=function(b){ca!==b&&(a.clearStencil(b),ca=b)};this.scissor=function(b){!1===W.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),W.copy(b))};this.viewport=function(b){!1===sa.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),sa.copy(b))};this.reset=function(){for(var b=0;b<l.length;b++)1===l[b]&&(a.disableVertexAttribArray(b),l[b]=0);v={};q=null;F=void 0;S={};G=J=z=N=u=null}};
b.WebGLUniforms=function(){var a=[],b=[],c=function(b,c,d){var e=b[0];if(0>=e||0<e)return b;var f=c*d,g=a[f];void 0===g&&(g=new Float32Array(f),a[f]=g);if(0!==c)for(e.toArray(g,0),e=1,f=0;e!==c;++e)f+=d,b[e].toArray(g,f);return g},e=function(a,c){var e=b[c];void 0===e&&(e=new Int32Array(c),b[c]=e);for(var f=0;f!==c;++f)e[f]=a.allocTextureUnit();return e},f=function(a,b){a.uniform1f(this.addr,b)},g=function(a,b){a.uniform1i(this.addr,b)},h=function(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,
b.x,b.y)},l=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},y=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},v=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},q=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},u=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},k=function(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,
d);b&&c.setTexture2D(b,d)},n=function(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);b&&c.setTextureCube(b,d)},r=function(a,b){a.uniform2iv(this.addr,b)},s=function(a,b){a.uniform3iv(this.addr,b)},t=function(a,b){a.uniform4iv(this.addr,b)},x=function(a){switch(a){case 5126:return f;case 35664:return h;case 35665:return l;case 35666:return y;case 35674:return v;case 35675:return q;case 35676:return u;case 35678:return k;case 35680:return n;case 5124:case 35670:return g;case 35667:case 35671:return r;
case 35668:case 35672:return s;case 35669:case 35673:return t}},B=function(a,b){a.uniform1fv(this.addr,b)},P=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,c(b,this.size,2))},N=function(a,b){a.uniform3fv(this.addr,c(b,this.size,3))},J=function(a,b){a.uniform4fv(this.addr,c(b,this.size,4))},E=function(a,b){a.uniformMatrix2fv(this.addr,!1,c(b,this.size,4))},L=function(a,b){a.uniformMatrix3fv(this.addr,!1,c(b,this.size,9))},D=function(a,b){a.uniformMatrix4fv(this.addr,
!1,c(b,this.size,16))},Q=function(a,b,c){var d=b.length,f=e(c,d);a.uniform1iv(this.addr,f);for(a=0;a!==d;++a){var g=b[a];g&&c.setTexture2D(g,f[a])}},T=function(a,b,c){var d=b.length,f=e(c,d);a.uniform1iv(this.addr,f);for(a=0;a!==d;++a){var g=b[a];g&&c.setTextureCube(g,f[a])}},O=function(a){switch(a){case 5126:return B;case 35664:return z;case 35665:return N;case 35666:return J;case 35674:return E;case 35675:return L;case 35676:return D;case 35678:return Q;case 35680:return T;case 5124:case 35670:return P;
case 35667:case 35671:return r;case 35668:case 35672:return s;case 35669:case 35673:return t}},G=function(a,b,c){this.id=a;this.addr=c;this.setValue=x(b.type)},U=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=O(b.type)},K=function(a){this.id=a;this.seq=[];this.map={}};K.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var M=/([\w\d_]+)(\])?(\[|\.)?/g,H=function(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,
a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(M.lastIndex=0;;){var m=M.exec(h),l=M.lastIndex,p=m[1],n=m[3];"]"===m[2]&&(p|=0);if(void 0===n||"["===n&&l+2===k){h=g;e=void 0===n?new G(p,e,f):new U(p,e,f);h.seq.push(e);h.map[e.id]=e;break}else n=g.map[p],void 0===n&&(n=new K(p),p=g,g=n,p.seq.push(g),p.map[g.id]=g),g=n}}};H.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};
H.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};H.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};H.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};H.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};H.splitDynamic=function(a,b){for(var c=null,d=a.length,e=0,f=0;f!==d;++f){var g=a[f],h=
b[g.id];h&&!0===h.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};H.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var g=b[a[e].id],h=g.onUpdateCallback;void 0!==h&&h.call(g,c,d)}};return H}();b.LensFlarePlugin=function(a,d){var c,e,f,g,h,l,y,v,q,u,k=a.context,n=a.state,r,s,t,x,B,P;this.render=function(z,N,J){if(0!==d.length){z=new b.Vector3;var E=J.w/J.z,L=.5*J.z,D=.5*J.w,Q=16/J.w,T=new b.Vector2(Q*E,Q),O=new b.Vector3(1,1,0),G=new b.Vector2(1,
1),U=new b.Box2;U.min.set(0,0);U.max.set(J.z-16,J.w-16);if(void 0===x){var Q=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),K=new Uint16Array([0,1,2,0,2,3]);r=k.createBuffer();s=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,r);k.bufferData(k.ARRAY_BUFFER,Q,k.STATIC_DRAW);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,s);k.bufferData(k.ELEMENT_ARRAY_BUFFER,K,k.STATIC_DRAW);B=k.createTexture();P=k.createTexture();n.bindTexture(k.TEXTURE_2D,B);k.texImage2D(k.TEXTURE_2D,0,k.RGB,16,16,0,k.RGB,k.UNSIGNED_BYTE,
null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);n.bindTexture(k.TEXTURE_2D,P);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,16,16,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,
k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);var Q=t={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},K=k.createProgram(),M=k.createShader(k.FRAGMENT_SHADER),
H=k.createShader(k.VERTEX_SHADER),I="precision "+a.getPrecision()+" float;\n";k.shaderSource(M,I+Q.fragmentShader);k.shaderSource(H,I+Q.vertexShader);k.compileShader(M);k.compileShader(H);k.attachShader(K,M);k.attachShader(K,H);k.linkProgram(K);x=K;q=k.getAttribLocation(x,"position");u=k.getAttribLocation(x,"uv");c=k.getUniformLocation(x,"renderType");e=k.getUniformLocation(x,"map");f=k.getUniformLocation(x,"occlusionMap");g=k.getUniformLocation(x,"opacity");h=k.getUniformLocation(x,"color");l=k.getUniformLocation(x,
"scale");y=k.getUniformLocation(x,"rotation");v=k.getUniformLocation(x,"screenPosition")}k.useProgram(x);n.initAttributes();n.enableAttribute(q);n.enableAttribute(u);n.disableUnusedAttributes();k.uniform1i(f,0);k.uniform1i(e,1);k.bindBuffer(k.ARRAY_BUFFER,r);k.vertexAttribPointer(q,2,k.FLOAT,!1,16,0);k.vertexAttribPointer(u,2,k.FLOAT,!1,16,8);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,s);n.disable(k.CULL_FACE);n.setDepthWrite(!1);K=0;for(M=d.length;K<M;K++)if(Q=16/J.w,T.set(Q*E,Q),H=d[K],z.set(H.matrixWorld.elements[12],
H.matrixWorld.elements[13],H.matrixWorld.elements[14]),z.applyMatrix4(N.matrixWorldInverse),z.applyProjection(N.projectionMatrix),O.copy(z),G.x=J.x+O.x*L+L-8,G.y=J.y+O.y*D+D-8,!0===U.containsPoint(G)){n.activeTexture(k.TEXTURE0);n.bindTexture(k.TEXTURE_2D,null);n.activeTexture(k.TEXTURE1);n.bindTexture(k.TEXTURE_2D,B);k.copyTexImage2D(k.TEXTURE_2D,0,k.RGB,G.x,G.y,16,16,0);k.uniform1i(c,0);k.uniform2f(l,T.x,T.y);k.uniform3f(v,O.x,O.y,O.z);n.disable(k.BLEND);n.enable(k.DEPTH_TEST);k.drawElements(k.TRIANGLES,
6,k.UNSIGNED_SHORT,0);n.activeTexture(k.TEXTURE0);n.bindTexture(k.TEXTURE_2D,P);k.copyTexImage2D(k.TEXTURE_2D,0,k.RGBA,G.x,G.y,16,16,0);k.uniform1i(c,1);n.disable(k.DEPTH_TEST);n.activeTexture(k.TEXTURE1);n.bindTexture(k.TEXTURE_2D,B);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);H.positionScreen.copy(O);H.customUpdateCallback?H.customUpdateCallback(H):H.updateLensFlares();k.uniform1i(c,2);n.enable(k.BLEND);for(var I=0,F=H.lensFlares.length;I<F;I++){var S=H.lensFlares[I];.001<S.opacity&&.001<S.scale&&
(O.x=S.x,O.y=S.y,O.z=S.z,Q=S.size*S.scale/J.w,T.x=Q*E,T.y=Q,k.uniform3f(v,O.x,O.y,O.z),k.uniform2f(l,T.x,T.y),k.uniform1f(y,S.rotation),k.uniform1f(g,S.opacity),k.uniform3f(h,S.color.r,S.color.g,S.color.b),n.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),a.setTexture2D(S.texture,1),k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0))}}n.enable(k.CULL_FACE);n.enable(k.DEPTH_TEST);n.setDepthWrite(!0);a.resetGLState()}}};b.SpritePlugin=function(a,d){var c,e,f,g,h,l,y,v,q,u,k,n,r,s,t,x,B;
function P(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var z=a.context,N=a.state,J,E,L,D,Q=new b.Vector3,T=new b.Quaternion,O=new b.Vector3;this.render=function(G,U){if(0!==d.length){if(void 0===L){var K=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),M=new Uint16Array([0,1,2,0,2,3]);J=z.createBuffer();E=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,J);z.bufferData(z.ARRAY_BUFFER,K,z.STATIC_DRAW);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,
E);z.bufferData(z.ELEMENT_ARRAY_BUFFER,M,z.STATIC_DRAW);var K=z.createProgram(),M=z.createShader(z.VERTEX_SHADER),H=z.createShader(z.FRAGMENT_SHADER);z.shaderSource(M,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
z.shaderSource(H,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
z.compileShader(M);z.compileShader(H);z.attachShader(K,M);z.attachShader(K,H);z.linkProgram(K);L=K;x=z.getAttribLocation(L,"position");B=z.getAttribLocation(L,"uv");c=z.getUniformLocation(L,"uvOffset");e=z.getUniformLocation(L,"uvScale");f=z.getUniformLocation(L,"rotation");g=z.getUniformLocation(L,"scale");h=z.getUniformLocation(L,"color");l=z.getUniformLocation(L,"map");y=z.getUniformLocation(L,"opacity");v=z.getUniformLocation(L,"modelViewMatrix");q=z.getUniformLocation(L,"projectionMatrix");u=
z.getUniformLocation(L,"fogType");k=z.getUniformLocation(L,"fogDensity");n=z.getUniformLocation(L,"fogNear");r=z.getUniformLocation(L,"fogFar");s=z.getUniformLocation(L,"fogColor");t=z.getUniformLocation(L,"alphaTest");K=document.createElement("canvas");K.width=8;K.height=8;M=K.getContext("2d");M.fillStyle="white";M.fillRect(0,0,8,8);D=new b.Texture(K);D.needsUpdate=!0}z.useProgram(L);N.initAttributes();N.enableAttribute(x);N.enableAttribute(B);N.disableUnusedAttributes();N.disable(z.CULL_FACE);N.enable(z.BLEND);
z.bindBuffer(z.ARRAY_BUFFER,J);z.vertexAttribPointer(x,2,z.FLOAT,!1,16,0);z.vertexAttribPointer(B,2,z.FLOAT,!1,16,8);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,E);z.uniformMatrix4fv(q,!1,U.projectionMatrix.elements);N.activeTexture(z.TEXTURE0);z.uniform1i(l,0);M=K=0;(H=G.fog)?(z.uniform3f(s,H.color.r,H.color.g,H.color.b),H instanceof b.Fog?(z.uniform1f(n,H.near),z.uniform1f(r,H.far),z.uniform1i(u,1),M=K=1):H instanceof b.FogExp2&&(z.uniform1f(k,H.density),z.uniform1i(u,2),M=K=2)):(z.uniform1i(u,0),M=K=0);
for(var H=0,I=d.length;H<I;H++){var F=d[H];F.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,F.matrixWorld);F.z=-F.modelViewMatrix.elements[14]}d.sort(P);for(var S=[],H=0,I=d.length;H<I;H++){var F=d[H],R=F.material;z.uniform1f(t,R.alphaTest);z.uniformMatrix4fv(v,!1,F.modelViewMatrix.elements);F.matrixWorld.decompose(Q,T,O);S[0]=O.x;S[1]=O.y;F=0;G.fog&&R.fog&&(F=M);K!==F&&(z.uniform1i(u,F),K=F);null!==R.map?(z.uniform2f(c,R.map.offset.x,R.map.offset.y),z.uniform2f(e,R.map.repeat.x,R.map.repeat.y)):
(z.uniform2f(c,0,0),z.uniform2f(e,1,1));z.uniform1f(y,R.opacity);z.uniform3f(h,R.color.r,R.color.g,R.color.b);z.uniform1f(f,R.rotation);z.uniform2fv(g,S);N.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst);N.setDepthTest(R.depthTest);N.setDepthWrite(R.depthWrite);R.map?a.setTexture2D(R.map,0):a.setTexture2D(D,0);z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0)}N.enable(z.CULL_FACE);a.resetGLState()}}};b.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
b.RenderableFace=function(){this.id=0;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.v3=new b.RenderableVertex;this.normalModel=new b.Vector3;this.vertexNormalsModel=[new b.Vector3,new b.Vector3,new b.Vector3];this.vertexNormalsLength=0;this.color=new b.Color;this.material=null;this.uvs=[new b.Vector2,new b.Vector2,new b.Vector2];this.renderOrder=this.z=0};b.RenderableVertex=function(){this.position=new b.Vector3;this.positionWorld=new b.Vector3;this.positionScreen=new b.Vector4;
this.visible=!0};b.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};b.RenderableLine=function(){this.id=0;this.v1=new b.RenderableVertex;this.v2=new b.RenderableVertex;this.vertexColors=[new b.Color,new b.Color];this.material=null;this.renderOrder=this.z=0};b.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new b.Vector2;this.material=null;this.renderOrder=0};b.Projector=
function(){function a(){if(u===n){var a=new b.RenderableVertex;k.push(a);n++;u++;return a}return k[u++]}function d(){if(s===A){var a=new b.RenderableFace;t.push(a);A++;s++;return a}return t[s++]}function c(){if(P===N){var a=new b.RenderableLine;z.push(a);N++;P++;return a}return z[P++]}function e(){if(E===D){var a=new b.RenderableSprite;L.push(a);D++;E++;return a}return L[E++]}function f(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}
function g(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(0<=e&&0<=f&&0<=g&&0<=h)return!0;if(0>e&&0>f||0>g&&0>h)return!1;0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h)));if(d<c)return!1;a.lerp(b,c);b.lerp(a,1-d);return!0}var h,l,v=[],x=0,q,u,k=[],n=0,r,s,t=[],A=0,B,P,z=[],N=0,J,E,L=[],D=0,Q={objects:[],lights:[],elements:[]},T=new b.Vector3,O=new b.Vector4,G=new b.Box3(new b.Vector3(-1,-1,-1),new b.Vector3(1,1,1)),U=new b.Box3,
K=Array(3),M=new b.Matrix4,H=new b.Matrix4,I,F=new b.Matrix4,S=new b.Matrix3,R=new b.Frustum,X=new b.Vector4,ca=new b.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var W=new function(){function e(a){var b=
a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(I);c.copy(b).applyMatrix4(H);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z}function f(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;K[0]=a.positionScreen;K[1]=b.positionScreen;K[2]=c.positionScreen;return G.intersectsBox(U.setFromPoints(K))}function g(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*
(b.positionScreen.x-a.positionScreen.x)}var h=[],m=[],l=null,p=null,n=new b.Matrix3;return{setObject:function(a){l=a;p=l.material;n.getNormalMatrix(l.matrixWorld);h.length=0;m.length=0},projectVertex:e,checkTriangleVisibility:f,checkBackfaceCulling:g,pushVertex:function(b,c,d){q=a();q.position.set(b,c,d);e(q)},pushNormal:function(a,b,c){h.push(a,b,c)},pushUv:function(a,b){m.push(a,b)},pushLine:function(a,b){var d=k[a],e=k[b];B=c();B.id=l.id;B.v1.copy(d);B.v2.copy(e);B.z=(d.positionScreen.z+e.positionScreen.z)/
2;B.renderOrder=l.renderOrder;B.material=l.material;Q.elements.push(B)},pushTriangle:function(a,c,e){var q=k[a],s=k[c],t=k[e];if(!1!==f(q,s,t)&&(p.side===b.DoubleSide||!0===g(q,s,t))){r=d();r.id=l.id;r.v1.copy(q);r.v2.copy(s);r.v3.copy(t);r.z=(q.positionScreen.z+s.positionScreen.z+t.positionScreen.z)/3;r.renderOrder=l.renderOrder;r.normalModel.fromArray(h,3*a);r.normalModel.applyMatrix3(n).normalize();for(q=0;3>q;q++)s=r.vertexNormalsModel[q],s.fromArray(h,3*arguments[q]),s.applyMatrix3(n).normalize(),
r.uvs[q].fromArray(m,2*arguments[q]);r.vertexNormalsLength=3;r.material=l.material;Q.elements.push(r)}}}};this.projectScene=function(n,q,t,A){E=P=s=0;Q.elements.length=0;!0===n.autoUpdate&&n.updateMatrixWorld();null===q.parent&&q.updateMatrixWorld();M.copy(q.matrixWorldInverse.getInverse(q.matrixWorld));H.multiplyMatrices(q.projectionMatrix,M);R.setFromMatrix(H);l=0;Q.objects.length=0;Q.lights.length=0;n.traverseVisible(function(a){if(a instanceof b.Light)Q.lights.push(a);else if((a instanceof b.Mesh||
a instanceof b.Line||a instanceof b.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===R.intersectsObject(a))){if(l===x){var c=new b.RenderableObject;v.push(c);x++;l++;h=c}else h=v[l++];h.id=a.id;h.object=a;T.setFromMatrixPosition(a.matrixWorld);T.applyProjection(H);h.z=T.z;h.renderOrder=a.renderOrder;Q.objects.push(h)}});!0===t&&Q.objects.sort(f);n=0;for(t=Q.objects.length;n<t;n++){var z=Q.objects[n].object,L=z.geometry;W.setObject(z);I=z.matrixWorld;u=0;if(z instanceof b.Mesh)if(L instanceof
b.BufferGeometry){var G=L.attributes,z=L.groups;if(void 0!==G.position){for(var N=G.position.array,D=0,K=N.length;D<K;D+=3)W.pushVertex(N[D],N[D+1],N[D+2]);if(void 0!==G.normal)for(var U=G.normal.array,D=0,K=U.length;D<K;D+=3)W.pushNormal(U[D],U[D+1],U[D+2]);if(void 0!==G.uv)for(G=G.uv.array,D=0,K=G.length;D<K;D+=2)W.pushUv(G[D],G[D+1]);if(null!==L.index)if(N=L.index.array,0<z.length)for(n=0;n<z.length;n++)for(K=z[n],D=K.start,K=K.start+K.count;D<K;D+=3)W.pushTriangle(N[D],N[D+1],N[D+2]);else for(D=
0,K=N.length;D<K;D+=3)W.pushTriangle(N[D],N[D+1],N[D+2]);else for(D=0,K=N.length/3;D<K;D+=3)W.pushTriangle(D,D+1,D+2)}}else{if(L instanceof b.Geometry){var Z=L.vertices,D=L.faces,K=L.faceVertexUvs[0];S.getNormalMatrix(I);for(var N=z.material,G=N instanceof b.MultiMaterial,U=!0===G?z.material:null,aa=0,Y=Z.length;aa<Y;aa++){var ma=Z[aa];T.copy(ma);if(!0===N.morphTargets)for(var la=L.morphTargets,ba=z.morphTargetInfluences,da=0,ga=la.length;da<ga;da++){var ia=ba[da];if(0!==ia){var na=la[da].vertices[aa];
T.x+=(na.x-ma.x)*ia;T.y+=(na.y-ma.y)*ia;T.z+=(na.z-ma.z)*ia}}W.pushVertex(T.x,T.y,T.z)}Z=0;for(aa=D.length;Z<aa;Z++)if(Y=D[Z],N=!0===G?U.materials[Y.materialIndex]:z.material,void 0!==N&&(ba=N.side,L=k[Y.a],ma=k[Y.b],la=k[Y.c],!1!==W.checkTriangleVisibility(L,ma,la))){da=W.checkBackfaceCulling(L,ma,la);if(ba!==b.DoubleSide){if(ba===b.FrontSide&&!1===da)continue;if(ba===b.BackSide&&!0===da)continue}r=d();r.id=z.id;r.v1.copy(L);r.v2.copy(ma);r.v3.copy(la);r.normalModel.copy(Y.normal);!1!==da||ba!==
b.BackSide&&ba!==b.DoubleSide||r.normalModel.negate();r.normalModel.applyMatrix3(S).normalize();ga=Y.vertexNormals;ia=0;for(na=Math.min(ga.length,3);ia<na;ia++){var $=r.vertexNormalsModel[ia];$.copy(ga[ia]);!1!==da||ba!==b.BackSide&&ba!==b.DoubleSide||$.negate();$.applyMatrix3(S).normalize()}r.vertexNormalsLength=ga.length;ba=K[Z];if(void 0!==ba)for(da=0;3>da;da++)r.uvs[da].copy(ba[da]);r.color=Y.color;r.material=N;r.z=(L.positionScreen.z+ma.positionScreen.z+la.positionScreen.z)/3;r.renderOrder=z.renderOrder;
Q.elements.push(r)}}}else if(z instanceof b.Line)if(L instanceof b.BufferGeometry){if(G=L.attributes,void 0!==G.position){N=G.position.array;D=0;for(K=N.length;D<K;D+=3)W.pushVertex(N[D],N[D+1],N[D+2]);if(null!==L.index)for(N=L.index.array,D=0,K=N.length;D<K;D+=2)W.pushLine(N[D],N[D+1]);else for(G=z instanceof b.LineSegments?2:1,D=0,K=N.length/3-1;D<K;D+=G)W.pushLine(D,D+1)}}else{if(L instanceof b.Geometry&&(F.multiplyMatrices(H,I),Z=z.geometry.vertices,0!==Z.length))for(L=a(),L.positionScreen.copy(Z[0]).applyMatrix4(F),
G=z instanceof b.LineSegments?2:1,aa=1,Y=Z.length;aa<Y;aa++)L=a(),L.positionScreen.copy(Z[aa]).applyMatrix4(F),0<(aa+1)%G||(ma=k[u-2],X.copy(L.positionScreen),ca.copy(ma.positionScreen),!0===g(X,ca)&&(X.multiplyScalar(1/X.w),ca.multiplyScalar(1/ca.w),B=c(),B.id=z.id,B.v1.positionScreen.copy(X),B.v2.positionScreen.copy(ca),B.z=Math.max(X.z,ca.z),B.renderOrder=z.renderOrder,B.material=z.material,z.material.vertexColors===b.VertexColors&&(B.vertexColors[0].copy(z.geometry.colors[aa]),B.vertexColors[1].copy(z.geometry.colors[aa-
1])),Q.elements.push(B)))}else z instanceof b.Sprite&&(O.set(I.elements[12],I.elements[13],I.elements[14],1),O.applyMatrix4(H),D=1/O.w,O.z*=D,-1<=O.z&&1>=O.z&&(J=e(),J.id=z.id,J.x=O.x*D,J.y=O.y*D,J.z=O.z,J.renderOrder=z.renderOrder,J.object=z,J.rotation=z.rotation,J.scale.x=z.scale.x*Math.abs(J.x-(O.x+q.projectionMatrix.elements[0])/(O.w+q.projectionMatrix.elements[12])),J.scale.y=z.scale.y*Math.abs(J.y-(O.y+q.projectionMatrix.elements[5])/(O.w+q.projectionMatrix.elements[13])),J.material=z.material,
Q.elements.push(J)))}!0===A&&Q.elements.sort(f);return Q}};b.SpriteCanvasMaterial=function(a){b.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new b.Color(16777215);this.program=function(a,b){};this.setValues(a)};b.SpriteCanvasMaterial.prototype=Object.create(b.Material.prototype);b.SpriteCanvasMaterial.prototype.constructor=b.SpriteCanvasMaterial;b.SpriteCanvasMaterial.prototype.clone=function(){var a=new b.SpriteCanvasMaterial;a.copy(this);a.color.copy(this.color);a.program=this.program;
return a};b.CanvasRenderer=function(a){function d(a,b,c,d){v(b);x(c);q(d);u(a.getStyle());G.stroke();oa.expandByScalar(2*b)}function c(a){k(a.getStyle());G.fill()}function e(a){if(0===a.version||a instanceof b.CompressedTexture||a instanceof b.DataTexture)return{canvas:void 0,version:a.version};var c=a.image;if(!1===c.complete)return{canvas:void 0,version:0};var d=document.createElement("canvas");d.width=c.width;d.height=c.height;var e=d.getContext("2d");e.setTransform(1,0,0,-1,0,c.height);e.drawImage(c,
0,0);var c=a.wrapS===b.RepeatWrapping,e=a.wrapT===b.RepeatWrapping,f="no-repeat";!0===c&&!0===e?f="repeat":!0===c?f="repeat-x":!0===e&&(f="repeat-y");d=G.createPattern(d,f);if(a.onUpdate)a.onUpdate(a);return{canvas:d,version:a.version}}function f(a,b,c,d,f,g,h,m,l,p,n,q,r){var s=Ga[r.id];if(void 0===s||s.version!==r.version)s=e(r),Ga[r.id]=s;if(void 0!==s.canvas){k(s.canvas);var s=r.offset.x/r.repeat.x,t=r.offset.y/r.repeat.y,u=r.image.width*r.repeat.x;r=r.image.height*r.repeat.y;h=(h+s)*u;m=(m+t)*
r;c-=a;d-=b;f-=a;g-=b;l=(l+s)*u-h;p=(p+t)*r-m;n=(n+s)*u-h;q=(q+t)*r-m;r=l*q-n*p;0!==r&&(s=1/r,r=(q*c-p*f)*s,p=(q*d-p*g)*s,c=(l*f-n*c)*s,d=(l*g-n*d)*s,a=a-r*h-c*m,b=b-p*h-d*m,G.save(),G.transform(r,p,c,d,a,b),G.fill(),G.restore())}else k("rgba( 0, 0, 0, 1)"),G.fill()}function g(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c/=Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}function h(a){M!==a&&(M=G.globalAlpha=a)}function l(a){H!==a&&(a===b.NormalBlending?G.globalCompositeOperation="source-over":
a===b.AdditiveBlending?G.globalCompositeOperation="lighter":a===b.SubtractiveBlending&&(G.globalCompositeOperation="darker"),H=a)}function v(a){S!==a&&(S=G.lineWidth=a)}function x(a){R!==a&&(R=G.lineCap=a)}function q(a){X!==a&&(X=G.lineJoin=a)}function u(a){I!==a&&(I=G.strokeStyle=a)}function k(a){F!==a&&(F=G.fillStyle=a)}function n(a){ca.length!==a.length&&(G.setLineDash(a),ca=a)}console.log("THREE.CanvasRenderer",b.REVISION);a=a||{};var r=this,s,t,A,B=new b.Projector,P=void 0!==a.canvas?a.canvas:
document.createElement("canvas"),z=P.width,N=P.height,J=Math.floor(z/2),E=Math.floor(N/2),L=0,D=0,Q=z,T=N,O=1,G=P.getContext("2d",{alpha:!0===a.alpha}),U=new b.Color(0),K=!0===a.alpha?0:1,M=1,H=0,I=null,F=null,S=null,R=null,X=null,ca=[],W,Z,aa;new b.RenderableVertex;new b.RenderableVertex;var fa,ga,ka,ta,Ba,Ca,qa=new b.Color;new b.Color;new b.Color;new b.Color;new b.Color;var Da=new b.Color,xa=new b.Color,Fa=new b.Color,Ga={},Y,ma,la,ba,da,Sa,ia,na=new b.Box2,$=new b.Box2,oa=new b.Box2,Pa=new b.Color,
Ta=new b.Color,ya=new b.Color,wa=new b.Vector3,ua=new b.Vector3,pa=new b.Vector3,va=new b.Matrix3;void 0===G.setLineDash&&(G.setLineDash=function(){});this.domElement=P;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return G};this.getContextAttributes=function(){return G.getContextAttributes()};this.getPixelRatio=function(){return O};this.setPixelRatio=
function(a){void 0!==a&&(O=a)};this.setSize=function(a,b,c){z=a*O;N=b*O;P.width=z;P.height=N;J=Math.floor(z/2);E=Math.floor(N/2);!1!==c&&(P.style.width=a+"px",P.style.height=b+"px");na.min.set(-J,-E);na.max.set(J,E);$.min.set(-J,-E);$.max.set(J,E);M=1;H=0;X=R=S=F=I=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){L=a*O;D=b*O;Q=c*O;T=d*O};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(a,b){U.set(a);K=void 0!==b?b:1;$.min.set(-J,-E);$.max.set(J,
E)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return U};this.getClearAlpha=function(){return K};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===$.isEmpty()&&($.intersect(na),$.expandByScalar(2),$.min.x+=J,$.min.y=-$.min.y+E,$.max.x+=J,$.max.y=-$.max.y+E,1>K&&G.clearRect($.min.x|0,$.max.y|0,$.max.x-$.min.x|0,$.min.y-$.max.y|
0),0<K&&(l(b.NormalBlending),h(1),k("rgba("+Math.floor(255*U.r)+","+Math.floor(255*U.g)+","+Math.floor(255*U.b)+","+K+")"),G.fillRect($.min.x|0,$.max.y|0,$.max.x-$.min.x|0,$.min.y-$.max.y|0)),$.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,H){if(!1===H instanceof b.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();r.info.render.vertices=
0;r.info.render.faces=0;G.setTransform(Q/z,0,0,-T/N,L,N-D);G.translate(J,E);s=B.projectScene(a,H,this.sortObjects,this.sortElements);t=s.elements;A=s.lights;va.getNormalMatrix(H.matrixWorldInverse);Pa.setRGB(0,0,0);Ta.setRGB(0,0,0);ya.setRGB(0,0,0);for(var I=0,O=A.length;I<O;I++){var F=A[I],K=F.color;F instanceof b.AmbientLight?Pa.add(K):F instanceof b.DirectionalLight?Ta.add(K):F instanceof b.PointLight&&ya.add(K)}I=0;for(O=t.length;I<O;I++){var M=t[I],R=M.material;if(void 0!==R&&0!==R.opacity){oa.makeEmpty();
if(M instanceof b.RenderableSprite){W=M;W.x*=J;W.y*=E;var F=W,P=M,K=R;h(K.opacity);l(K.blending);var w=P.scale.x*J,P=P.scale.y*E,M=.5*Math.sqrt(w*w+P*P);oa.min.set(F.x-M,F.y-M);oa.max.set(F.x+M,F.y+M);if(K instanceof b.SpriteMaterial){var S=K.map;if(null!==S){M=Ga[S.id];if(void 0===M||M.version!==S.version)M=e(S),Ga[S.id]=M;if(void 0!==M.canvas){k(M.canvas);var U=S.image,M=U.width*S.offset.x,R=U.height*S.offset.y,X=U.width*S.repeat.x,S=U.height*S.repeat.y,U=w/X,ca=P/S;G.save();G.translate(F.x,F.y);
0!==K.rotation&&G.rotate(K.rotation);G.translate(-w/2,-P/2);G.scale(U,ca);G.translate(-M,-R);G.fillRect(M,R,X,S);G.restore()}}else k(K.color.getStyle()),G.save(),G.translate(F.x,F.y),0!==K.rotation&&G.rotate(K.rotation),G.scale(w,-P),G.fillRect(-.5,-.5,1,1),G.restore()}else K instanceof b.SpriteCanvasMaterial&&(u(K.color.getStyle()),k(K.color.getStyle()),G.save(),G.translate(F.x,F.y),0!==K.rotation&&G.rotate(K.rotation),G.scale(w,P),K.program(G),G.restore())}else if(M instanceof b.RenderableLine){if(W=
M.v1,Z=M.v2,W.positionScreen.x*=J,W.positionScreen.y*=E,Z.positionScreen.x*=J,Z.positionScreen.y*=E,oa.setFromPoints([W.positionScreen,Z.positionScreen]),!0===na.intersectsBox(oa))if(F=W,K=Z,w=M,P=R,h(P.opacity),l(P.blending),G.beginPath(),G.moveTo(F.positionScreen.x,F.positionScreen.y),G.lineTo(K.positionScreen.x,K.positionScreen.y),P instanceof b.LineBasicMaterial){v(P.linewidth);x(P.linecap);q(P.linejoin);if(P.vertexColors!==b.VertexColors)u(P.color.getStyle());else if(M=w.vertexColors[0].getStyle(),
w=w.vertexColors[1].getStyle(),M===w)u(M);else{try{var V=G.createLinearGradient(F.positionScreen.x,F.positionScreen.y,K.positionScreen.x,K.positionScreen.y);V.addColorStop(0,M);V.addColorStop(1,w)}catch(ha){V=M}u(V)}G.stroke();oa.expandByScalar(2*P.linewidth)}else P instanceof b.LineDashedMaterial&&(v(P.linewidth),x(P.linecap),q(P.linejoin),u(P.color.getStyle()),n([P.dashSize,P.gapSize]),G.stroke(),oa.expandByScalar(2*P.linewidth),n([]))}else if(M instanceof b.RenderableFace){W=M.v1;Z=M.v2;aa=M.v3;
if(-1>W.positionScreen.z||1<W.positionScreen.z)continue;if(-1>Z.positionScreen.z||1<Z.positionScreen.z)continue;if(-1>aa.positionScreen.z||1<aa.positionScreen.z)continue;W.positionScreen.x*=J;W.positionScreen.y*=E;Z.positionScreen.x*=J;Z.positionScreen.y*=E;aa.positionScreen.x*=J;aa.positionScreen.y*=E;0<R.overdraw&&(g(W.positionScreen,Z.positionScreen,R.overdraw),g(Z.positionScreen,aa.positionScreen,R.overdraw),g(aa.positionScreen,W.positionScreen,R.overdraw));oa.setFromPoints([W.positionScreen,
Z.positionScreen,aa.positionScreen]);if(!0===na.intersectsBox(oa)){K=W;w=Z;P=aa;F=R;r.info.render.vertices+=3;r.info.render.faces++;h(F.opacity);l(F.blending);fa=K.positionScreen.x;ga=K.positionScreen.y;ka=w.positionScreen.x;ta=w.positionScreen.y;Ba=P.positionScreen.x;Ca=P.positionScreen.y;var R=fa,X=ga,S=ka,U=ta,ca=Ba,Ia=Ca;G.beginPath();G.moveTo(R,X);G.lineTo(S,U);G.lineTo(ca,Ia);G.closePath();if((F instanceof b.MeshLambertMaterial||F instanceof b.MeshPhongMaterial)&&null===F.map){Da.copy(F.color);
xa.copy(F.emissive);F.vertexColors===b.FaceColors&&Da.multiply(M.color);qa.copy(Pa);ua.copy(K.positionWorld).add(w.positionWorld).add(P.positionWorld).divideScalar(3);K=ua;w=M.normalModel;P=qa;M=0;for(R=A.length;M<R;M++)X=A[M],Fa.copy(X.color),X instanceof b.DirectionalLight?(S=wa.setFromMatrixPosition(X.matrixWorld).normalize(),U=w.dot(S),0>=U||(U*=X.intensity,P.add(Fa.multiplyScalar(U)))):X instanceof b.PointLight&&(S=wa.setFromMatrixPosition(X.matrixWorld),U=w.dot(wa.subVectors(S,K).normalize()),
0>=U||(U*=0==X.distance?1:1-Math.min(K.distanceTo(S)/X.distance,1),0!=U&&(U*=X.intensity,P.add(Fa.multiplyScalar(U)))));qa.multiply(Da).add(xa);!0===F.wireframe?d(qa,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(qa)}else F instanceof b.MeshBasicMaterial||F instanceof b.MeshLambertMaterial||F instanceof b.MeshPhongMaterial?null!==F.map?F.map.mapping===b.UVMapping&&(Y=M.uvs,f(fa,ga,ka,ta,Ba,Ca,Y[0].x,Y[0].y,Y[1].x,Y[1].y,Y[2].x,Y[2].y,F.map)):null!==F.envMap?F.envMap.mapping===b.SphericalReflectionMapping&&
(pa.copy(M.vertexNormalsModel[0]).applyMatrix3(va),ma=.5*pa.x+.5,la=.5*pa.y+.5,pa.copy(M.vertexNormalsModel[1]).applyMatrix3(va),ba=.5*pa.x+.5,da=.5*pa.y+.5,pa.copy(M.vertexNormalsModel[2]).applyMatrix3(va),Sa=.5*pa.x+.5,ia=.5*pa.y+.5,f(fa,ga,ka,ta,Ba,Ca,ma,la,ba,da,Sa,ia,F.envMap)):(qa.copy(F.color),F.vertexColors===b.FaceColors&&qa.multiply(M.color),!0===F.wireframe?d(qa,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(qa)):(F instanceof b.MeshNormalMaterial?(pa.copy(M.normalModel).applyMatrix3(va),
qa.setRGB(pa.x,pa.y,pa.z).multiplyScalar(.5).addScalar(.5)):qa.setRGB(1,1,1),!0===F.wireframe?d(qa,F.wireframeLinewidth,F.wireframeLinecap,F.wireframeLinejoin):c(qa))}}$.union(oa)}}G.setTransform(1,0,0,1,0,0)}}};b.TrackballControls=function(a,d){function c(a){!1!==k.enabled&&(window.removeEventListener("keydown",c),t=s,s===n.NONE)&&(a.keyCode!==k.keys[n.ROTATE]||k.noRotate?a.keyCode!==k.keys[n.ZOOM]||k.noZoom?a.keyCode!==k.keys[n.PAN]||k.noPan||(s=n.PAN):s=n.ZOOM:s=n.ROTATE)}function e(a){!1!==k.enabled&&
(s=t,window.addEventListener("keydown",c,!1))}function f(a){!1!==k.enabled&&(a.preventDefault(),a.stopPropagation(),s===n.NONE&&(s=a.button),s!==n.ROTATE||k.noRotate?s!==n.ZOOM||k.noZoom?s!==n.PAN||k.noPan||(Q.copy(K(a.pageX,a.pageY)),T.copy(Q)):(J.copy(K(a.pageX,a.pageY)),E.copy(J)):(P.copy(M(a.pageX,a.pageY)),B.copy(P)),document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",h,!1),k.dispatchEvent(G))}function g(a){!1!==k.enabled&&(a.preventDefault(),a.stopPropagation(),s!==
n.ROTATE||k.noRotate?s!==n.ZOOM||k.noZoom?s!==n.PAN||k.noPan||T.copy(K(a.pageX,a.pageY)):E.copy(K(a.pageX,a.pageY)):(B.copy(P),P.copy(M(a.pageX,a.pageY))))}function h(a){!1!==k.enabled&&(a.preventDefault(),a.stopPropagation(),s=n.NONE,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",h),k.dispatchEvent(U))}function l(a){if(!1!==k.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);J.y+=.01*b;k.dispatchEvent(G);
k.dispatchEvent(U)}}function v(a){if(!1!==k.enabled){switch(a.touches.length){case 1:s=n.TOUCH_ROTATE;P.copy(M(a.touches[0].pageX,a.touches[0].pageY));B.copy(P);break;default:s=n.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;D=L=Math.sqrt(b*b+c*c);Q.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));T.copy(Q)}k.dispatchEvent(G)}}function x(a){if(!1!==k.enabled)switch(a.preventDefault(),a.stopPropagation(),
a.touches.length){case 1:B.copy(P);P.copy(M(a.touches[0].pageX,a.touches[0].pageY));break;default:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;D=Math.sqrt(b*b+c*c);T.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2))}}function q(a){if(!1!==k.enabled){switch(a.touches.length){case 0:s=n.NONE;break;case 1:s=n.TOUCH_ROTATE,P.copy(M(a.touches[0].pageX,a.touches[0].pageY)),B.copy(P)}k.dispatchEvent(U)}}function u(a){a.preventDefault()}
var k=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==d?d:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new b.Vector3;var r=new b.Vector3,s=n.NONE,t=n.NONE,A=new b.Vector3,B=new b.Vector2,P=new b.Vector2,
z=new b.Vector3,N=0,J=new b.Vector2,E=new b.Vector2,L=0,D=0,Q=new b.Vector2,T=new b.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var O={type:"change"},G={type:"start"},U={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;
this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var K=function(){var a=new b.Vector2;return function(b,c){a.set((b-k.screen.left)/k.screen.width,(c-k.screen.top)/k.screen.height);return a}}(),M=function(){var a=new b.Vector2;return function(b,c){a.set((b-.5*k.screen.width-k.screen.left)/(.5*k.screen.width),
(k.screen.height+2*(k.screen.top-c))/k.screen.width);return a}}();this.rotateCamera=function(){var a=new b.Vector3,c=new b.Quaternion,d=new b.Vector3,e=new b.Vector3,f=new b.Vector3,g=new b.Vector3,h;return function(){g.set(P.x-B.x,P.y-B.y,0);(h=g.length())?(A.copy(k.object.position).sub(k.target),d.copy(A).normalize(),e.copy(k.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(P.y-B.y),f.setLength(P.x-B.x),g.copy(e.add(f)),a.crossVectors(g,A).normalize(),h*=k.rotateSpeed,c.setFromAxisAngle(a,
h),A.applyQuaternion(c),k.object.up.applyQuaternion(c),z.copy(a),N=h):!k.staticMoving&&N&&(N*=Math.sqrt(1-k.dynamicDampingFactor),A.copy(k.object.position).sub(k.target),c.setFromAxisAngle(z,N),A.applyQuaternion(c),k.object.up.applyQuaternion(c));B.copy(P)}}();this.zoomCamera=function(){var a;s===n.TOUCH_ZOOM_PAN?(a=L/D,L=D,A.multiplyScalar(a)):(a=1+(E.y-J.y)*k.zoomSpeed,1!==a&&0<a&&(A.multiplyScalar(a),k.staticMoving?J.copy(E):J.y+=(E.y-J.y)*this.dynamicDampingFactor))};this.panCamera=function(){var a=
new b.Vector2,c=new b.Vector3,d=new b.Vector3;return function(){a.copy(T).sub(Q);a.lengthSq()&&(a.multiplyScalar(A.length()*k.panSpeed),d.copy(A).cross(k.object.up).setLength(a.x),d.add(c.copy(k.object.up).setLength(a.y)),k.object.position.add(d),k.target.add(d),k.staticMoving?Q.copy(T):Q.add(a.subVectors(T,Q).multiplyScalar(k.dynamicDampingFactor)))}}();this.checkDistances=function(){k.noZoom&&k.noPan||(A.lengthSq()>k.maxDistance*k.maxDistance&&(k.object.position.addVectors(k.target,A.setLength(k.maxDistance)),
J.copy(E)),A.lengthSq()<k.minDistance*k.minDistance&&(k.object.position.addVectors(k.target,A.setLength(k.minDistance)),J.copy(E)))};this.update=function(){A.subVectors(k.object.position,k.target);k.noRotate||k.rotateCamera();k.noZoom||k.zoomCamera();k.noPan||k.panCamera();k.object.position.addVectors(k.target,A);k.checkDistances();k.object.lookAt(k.target);1E-6<r.distanceToSquared(k.object.position)&&(k.dispatchEvent(O),r.copy(k.object.position))};this.reset=function(){t=s=n.NONE;k.target.copy(k.target0);
k.object.position.copy(k.position0);k.object.up.copy(k.up0);A.subVectors(k.object.position,k.target);k.object.lookAt(k.target);k.dispatchEvent(O);r.copy(k.object.position)};this.dispose=function(){this.domElement.removeEventListener("contextmenu",u,!1);this.domElement.removeEventListener("mousedown",f,!1);this.domElement.removeEventListener("mousewheel",l,!1);this.domElement.removeEventListener("MozMousePixelScroll",l,!1);this.domElement.removeEventListener("touchstart",v,!1);this.domElement.removeEventListener("touchend",
q,!1);this.domElement.removeEventListener("touchmove",x,!1);document.removeEventListener("mousemove",g,!1);document.removeEventListener("mouseup",h,!1);window.removeEventListener("keydown",c,!1);window.removeEventListener("keyup",e,!1)};this.domElement.addEventListener("contextmenu",u,!1);this.domElement.addEventListener("mousedown",f,!1);this.domElement.addEventListener("mousewheel",l,!1);this.domElement.addEventListener("MozMousePixelScroll",l,!1);this.domElement.addEventListener("touchstart",v,
!1);this.domElement.addEventListener("touchend",q,!1);this.domElement.addEventListener("touchmove",x,!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",e,!1);this.handleResize();this.update()};b.TrackballControls.prototype=Object.create(b.EventDispatcher.prototype);b.TrackballControls.prototype.constructor=b.TrackballControls;b.SphereGeometry=function(a,d,c,e,f,g,h){b.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:d,heightSegments:c,
phiStart:e,phiLength:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new b.SphereBufferGeometry(a,d,c,e,f,g,h))};b.SphereGeometry.prototype=Object.create(b.Geometry.prototype);b.SphereGeometry.prototype.constructor=b.SphereGeometry;b.SphereBufferGeometry=function(a,d,c,e,f,g,h){b.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:d,heightSegments:c,phiStart:e,phiLength:f,thetaStart:g,thetaLength:h};a=a||50;d=Math.max(3,Math.floor(d)||8);c=Math.max(2,
Math.floor(c)||6);e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;g=void 0!==g?g:0;h=void 0!==h?h:Math.PI;for(var l=g+h,v=(d+1)*(c+1),x=new b.BufferAttribute(new Float32Array(3*v),3),q=new b.BufferAttribute(new Float32Array(3*v),3),v=new b.BufferAttribute(new Float32Array(2*v),2),u=0,k=[],n=new b.Vector3,r=0;r<=c;r++){for(var s=[],t=r/c,A=0;A<=d;A++){var B=A/d,P=-a*Math.cos(e+B*f)*Math.sin(g+t*h),z=a*Math.cos(g+t*h),N=a*Math.sin(e+B*f)*Math.sin(g+t*h);n.set(P,z,N).normalize();x.setXYZ(u,P,z,N);q.setXYZ(u,
n.x,n.y,n.z);v.setXY(u,B,1-t);s.push(u);u++}k.push(s)}e=[];for(r=0;r<c;r++)for(A=0;A<d;A++)f=k[r][A+1],h=k[r][A],u=k[r+1][A],n=k[r+1][A+1],(0!==r||0<g)&&e.push(f,h,n),(r!==c-1||l<Math.PI)&&e.push(h,u,n);this.setIndex(new (65535<x.count?b.Uint32Attribute:b.Uint16Attribute)(e,1));this.addAttribute("position",x);this.addAttribute("normal",q);this.addAttribute("uv",v);this.boundingSphere=new b.Sphere(new b.Vector3,a)};b.SphereBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.SphereBufferGeometry.prototype.constructor=
b.SphereBufferGeometry;b.CylinderGeometry=function(a,d,c,e,f,g,h,l){b.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:d,height:c,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:l};this.fromBufferGeometry(new b.CylinderBufferGeometry(a,d,c,e,f,g,h,l));this.mergeVertices()};b.CylinderGeometry.prototype=Object.create(b.Geometry.prototype);b.CylinderGeometry.prototype.constructor=b.CylinderGeometry;b.CylinderBufferGeometry=function(a,d,
c,e,f,g,h,l){function v(c){var f,g,q;q=new b.Vector2;var u=new b.Vector3,y=0,B=!0===c?a:d,O=!0===c?1:-1;g=t;for(f=1;f<=e;f++)n.setXYZ(t,0,P*O,0),r.setXYZ(t,0,O,0),!0===c?(q.x=f/e,q.y=0):(q.x=(f-1)/e,q.y=1),s.setXY(t,q.x,q.y),t++;q=t;for(f=0;f<=e;f++){var G=f/e;u.x=B*Math.sin(G*l+h);u.y=P*O;u.z=B*Math.cos(G*l+h);n.setXYZ(t,u.x,u.y,u.z);r.setXYZ(t,0,O,0);s.setXY(t,G,!0===c?1:0);t++}for(f=0;f<e;f++)u=g+f,B=q+f,!0===c?(k.setX(A,B),A++,k.setX(A,B+1)):(k.setX(A,B+1),A++,k.setX(A,B)),A++,k.setX(A,u),A++,
y+=3;x.addGroup(z,y,!0===c?1:2);z+=y}b.BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:d,height:c,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:l};var x=this;a=void 0!==a?a:20;d=void 0!==d?d:20;c=void 0!==c?c:100;e=Math.floor(e)||8;f=Math.floor(f)||1;g=void 0!==g?g:!1;h=void 0!==h?h:0;l=void 0!==l?l:2*Math.PI;var q=function(){var a=(e+1)*(f+1);!1===g&&(a+=2*(e+1)+2*e);return a}(),u=function(){var a=e*f*6;!1===g&&(a+=6*
e);return a}(),k=new b.BufferAttribute(new (65535<u?Uint32Array:Uint16Array)(u),1),n=new b.BufferAttribute(new Float32Array(3*q),3),r=new b.BufferAttribute(new Float32Array(3*q),3),s=new b.BufferAttribute(new Float32Array(2*q),2),t=0,A=0,B=[],P=c/2,z=0;(function(){var g,q,u=new b.Vector3,v=new b.Vector3,y=0,Q=(d-a)/c;for(q=0;q<=f;q++){var T=[],O=q/f,G=O*(d-a)+a;for(g=0;g<=e;g++){var U=g/e;v.x=G*Math.sin(U*l+h);v.y=-O*c+P;v.z=G*Math.cos(U*l+h);n.setXYZ(t,v.x,v.y,v.z);u.copy(v);if(0===a&&0===q||0===
d&&q===f)u.x=Math.sin(U*l+h),u.z=Math.cos(U*l+h);u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*Q).normalize();r.setXYZ(t,u.x,u.y,u.z);s.setXY(t,U,1-O);T.push(t);t++}B.push(T)}for(g=0;g<e;g++)for(q=0;q<f;q++)u=B[q+1][g],v=B[q+1][g+1],Q=B[q][g+1],k.setX(A,B[q][g]),A++,k.setX(A,u),A++,k.setX(A,Q),A++,k.setX(A,u),A++,k.setX(A,v),A++,k.setX(A,Q),A++,y+=6;x.addGroup(z,y,0);z+=y})();!1===g&&(0<a&&v(!0),0<d&&v(!1));this.setIndex(k);this.addAttribute("position",n);this.addAttribute("normal",r);this.addAttribute("uv",
s)};b.CylinderBufferGeometry.prototype=Object.create(b.BufferGeometry.prototype);b.CylinderBufferGeometry.prototype.constructor=b.CylinderBufferGeometry;b.ArrowHelper=function(){var a=new b.Geometry;a.vertices.push(new b.Vector3(0,0,0),new b.Vector3(0,1,0));var d=new b.CylinderGeometry(0,.5,1,5,1);d.translate(0,-.5,0);return function(c,e,f,g,h,l){b.Object3D.call(this);void 0===g&&(g=16776960);void 0===f&&(f=1);void 0===h&&(h=.2*f);void 0===l&&(l=.2*h);this.position.copy(e);this.line=new b.Line(a,
new b.LineBasicMaterial({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new b.Mesh(d,new b.MeshBasicMaterial({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(f,h,l)}}();b.ArrowHelper.prototype=Object.create(b.Object3D.prototype);b.ArrowHelper.prototype.constructor=b.ArrowHelper;b.ArrowHelper.prototype.setDirection=function(){var a=new b.Vector3,d;return function(b){.99999<b.y?this.quaternion.set(0,0,0,1):-.99999>b.y?this.quaternion.set(1,
0,0,0):(a.set(b.z,0,-b.x).normalize(),d=Math.acos(b.y),this.quaternion.setFromAxisAngle(a,d))}}();b.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};b.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};h.THREE=b})}]);
</script>
</body>
</html>
